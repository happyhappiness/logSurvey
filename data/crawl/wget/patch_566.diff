diff --git a/ChangeLog b/ChangeLog
index 43a2d0a..047ab44 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,5 +1,14 @@
 2003-11-04  Hrvoje Niksic  <hniksic@xemacs.org>
 
+	* aclocal.m4: Ditto.
+
+	* configure.in: Add description annotations to AC_DEFINE.
+
+	* Makefile.in: Update maintenance targets, preparing them for the
+	use of `autoheader'.
+
+2003-11-04  Hrvoje Niksic  <hniksic@xemacs.org>
+
 	* configure.in: Don't misuse AC_MSG_RESULT.  Use AC_MSG_NOTICE
 	where appropriate.
 
diff --git a/Makefile.in b/Makefile.in
index 23058c0..ef584e5 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -176,22 +176,23 @@ clean-recursive distclean-recursive realclean-recursive:
 # Dependencies for maintenance
 #
 
-Makefile: Makefile.in config.status
-	CONFIG_HEADERS= ./config.status
-
-config.status: configure
-	./config.status --recheck
-
-configure: configure.in aclocal.m4
+$(srcdir)/configure: configure.in aclocal.m4
 	cd $(srcdir) && autoconf
 
+# autoheader might not change config.h.in, so touch a stamp file.
+$(srcdir)/src/config.h.in: stamp-h.in
+$(srcdir)/stamp-h.in: configure.in aclocal.m4
+	cd $(srcdir) && autoheader
+	echo timestamp > $(srcdir)/stamp-h.in
+
 src/config.h: stamp-h
 stamp-h: src/config.h.in config.status
-	CONFIG_FILES= CONFIG_HEADERS=src/config.h ./config.status
+	./config.status
 
-src/config.h.in: stamp-h.in
-stamp-h.in: configure.in aclocal.m4
-	echo timestamp > $@
+Makefile: Makefile.in config.status
+	./config.status
 
-FORCE:
+config.status: configure
+	./config.status --recheck
 
+FORCE:
diff --git a/aclocal.m4 b/aclocal.m4
index d20e6e8..e56ae76 100644
--- a/aclocal.m4
+++ b/aclocal.m4
@@ -8,7 +8,7 @@ AC_DEFUN([WGET_STRUCT_UTIMBUF], [
     AC_EGREP_CPP([struct[ 	]+utimbuf],
       [#include <utime.h>
       ], [
-	AC_DEFINE([HAVE_STRUCT_UTIMBUF], [],
+	AC_DEFINE([HAVE_STRUCT_UTIMBUF], 1,
 		  [Define if you have struct utimbuf.])
 	AC_MSG_RESULT(yes)
       ],
@@ -61,7 +61,7 @@ AC_DEFUN([WGET_FNMATCH], [
   AC_COMPILE_IFELSE([#include <fnmatch.h>
                     ], [
     AC_MSG_RESULT(yes)
-    AC_DEFINE([HAVE_WORKING_FNMATCH_H], [],
+    AC_DEFINE([HAVE_WORKING_FNMATCH_H], 1,
               [Define if fnmatch.h can be included.])
   ], [
     AC_MSG_RESULT(no)
@@ -74,12 +74,12 @@ dnl link with -lt (recently) or with -lposix (older releases).
 AC_DEFUN([WGET_NANOSLEEP], [
   AC_CHECK_FUNCS(nanosleep, [], [
     AC_CHECK_LIB(rt, nanosleep, [
-      AC_DEFINE([HAVE_NANOSLEEP], [],
+      AC_DEFINE([HAVE_NANOSLEEP], 1,
                 [Define if you have the nanosleep function.])
       LIBS="-lrt $LIBS"
     ], [
       AC_CHECK_LIB(posix4, nanosleep, [
-	AC_DEFINE([HAVE_NANOSLEEP], [],
+	AC_DEFINE([HAVE_NANOSLEEP], 1,
 		  [Define if you have the nanosleep function.])
 	LIBS="-lposix4 $LIBS"
       ])
@@ -121,7 +121,7 @@ AC_BEFORE([$0], [AC_C_INLINE])
 AC_MSG_CHECKING([for function prototypes])
 if test "$am_cv_prog_cc_stdc" != no; then
   AC_MSG_RESULT(yes)
-  AC_DEFINE([PROTOTYPES], [],
+  AC_DEFINE([PROTOTYPES], 1,
             [Define if ANSI function prototypes are available.])
   U= ANSI2KNR=
 else
@@ -393,7 +393,7 @@ AC_DEFUN(WGET_WITH_NLS,
       AC_CHECK_LIB(intl, gettext, [
         dnl gettext is in libintl; announce the fact manually.
         LIBS="-lintl $LIBS"
-	AC_DEFINE([HAVE_GETTEXT], [],
+	AC_DEFINE([HAVE_GETTEXT], 1,
                   [Define if you have the gettext function.])
       ], [
         AC_CHECK_FUNCS(gettext, [], [
@@ -429,7 +429,7 @@ AC_DEFUN(WGET_WITH_NLS,
     USE_NLS=$HAVE_NLS
     AC_SUBST(USE_NLS)
     if test "x$HAVE_NLS" = xyes; then
-      AC_DEFINE([HAVE_NLS], [], [Define this if you want the NLS support.])
+      AC_DEFINE([HAVE_NLS], 1, [Define this if you want the NLS support.])
     fi
   ])
 
diff --git a/configure.in b/configure.in
index dbd019b..35eaed8 100644
--- a/configure.in
+++ b/configure.in
@@ -29,9 +29,13 @@ dnl
 dnl Process this file with autoconf to produce a configure script.
 dnl
 
-AC_INIT(src/version.c)
+AC_INIT([src/version.c])
 AC_PREREQ(2.50)
-AC_CONFIG_HEADER(src/config.h)
+
+AC_CONFIG_HEADERS([src/config.h])
+AH_BOTTOM([
+#include "config-post.h"
+])
 
 dnl
 dnl What version of Wget are we building?
@@ -54,7 +58,7 @@ dnl Process features.
 dnl
 AC_ARG_WITH(socks,
   [  --with-socks            use the socks library],
-  [AC_DEFINE([HAVE_SOCKS], [],
+  [AC_DEFINE([HAVE_SOCKS], 1,
              [Define if you wish to compile with socks support.])]
 )
 
@@ -65,19 +69,19 @@ AC_ARG_WITH(ssl,
 AC_ARG_ENABLE(opie,
 [  --disable-opie          disable support for opie or s/key FTP login],
 USE_OPIE=$enableval, USE_OPIE=yes)
-test x"${USE_OPIE}" = xyes && AC_DEFINE([USE_OPIE], [],
+test x"${USE_OPIE}" = xyes && AC_DEFINE([USE_OPIE], 1,
    [Define if you want the Opie support for FTP compiled in.])
 
 AC_ARG_ENABLE(digest,
 [  --disable-digest        disable support for HTTP digest authorization],
 USE_DIGEST=$enableval, USE_DIGEST=yes)
-test x"${USE_DIGEST}" = xyes && AC_DEFINE([USE_DIGEST], [],
+test x"${USE_DIGEST}" = xyes && AC_DEFINE([USE_DIGEST], 1,
    [Define if you want the HTTP Digest Authorization compiled in.])
 
 AC_ARG_ENABLE(debug,
 [  --disable-debug         disable support for debugging output],
 ENABLE_DEBUG=$enableval, ENABLE_DEBUG=yes)
-test x"${ENABLE_DEBUG}" = xyes && AC_DEFINE([ENABLE_DEBUG], [],
+test x"${ENABLE_DEBUG}" = xyes && AC_DEFINE([ENABLE_DEBUG], 1,
    [Define if you want the debug output support compiled in.])
 
 wget_need_md5=no
@@ -165,9 +169,15 @@ AC_C_BIGENDIAN
 dnl
 dnl Checks for headers
 dnl
-AC_CHECK_HEADERS(string.h stdarg.h unistd.h sys/time.h utime.h sys/utime.h)
-AC_CHECK_HEADERS(termios.h sys/ioctl.h sys/select.h sys/utsname.h)
-AC_CHECK_HEADERS(inttypes.h signal.h setjmp.h pwd.h)
+
+dnl Check for these even though we assume their presence.  This is
+dnl because Autoconf built-in macros expect their HAVE_* constants to
+dnl be available.
+AC_CHECK_HEADERS(sys/types.h sys/stat.h)
+
+AC_CHECK_HEADERS(string.h strings.h stdarg.h unistd.h sys/time.h)
+AC_CHECK_HEADERS(termios.h sys/ioctl.h sys/select.h utime.h sys/utime.h)
+AC_CHECK_HEADERS(stdint.h inttypes.h signal.h setjmp.h pwd.h)
 AC_HEADER_TIME
 
 dnl
@@ -379,7 +389,7 @@ main(){return 0;}
 
   if test x"$ssl_success" = xyes; then
     AC_MSG_NOTICE([compiling in support for SSL in $ssl_root])
-    AC_DEFINE([HAVE_SSL], [],
+    AC_DEFINE([HAVE_SSL], 1,
               [Define if SSL support should be compiled in.])
     AC_SUBST(SSL_INCLUDES)
     SSL_OBJ='gen_sslfunc$o'
@@ -428,7 +438,7 @@ then
       AC_COMPILE_IFELSE([#include <md5.h>
                         ], [
         AC_MSG_RESULT(yes)
-        AC_DEFINE([HAVE_SOLARIS_MD5], [], [Define to use Solaris MD5.])
+        AC_DEFINE([HAVE_SOLARIS_MD5], 1, [Define to use Solaris MD5.])
         LIBS="-lmd5 $LIBS"
         found_md5=yes
         AC_MSG_NOTICE([using the Solaris MD5 implementation])
@@ -440,7 +450,7 @@ then
   dnl implementation.
   if test x"$found_md5" = xno; then
     if test x"$ssl_success" = xyes; then
-      AC_DEFINE([HAVE_OPENSSL_MD5], [], [Define to use OpenSSL MD5.])
+      AC_DEFINE([HAVE_OPENSSL_MD5], 1, [Define to use OpenSSL MD5.])
       found_md5=yes
       AC_MSG_NOTICE([using the OpenSSL MD5 implementation])
     fi
@@ -448,13 +458,13 @@ then
 
   dnl If none of the above worked, use the one we ship with Wget.
   if test x"$found_md5" = xno; then
-    AC_DEFINE([HAVE_BUILTIN_MD5], [], [Define to use built-in MD5.])
+    AC_DEFINE([HAVE_BUILTIN_MD5], 1, [Define to use built-in MD5.])
     MD5_OBJ="$MD5_OBJ gnu-md5\$o"
     found_md5=yes
     AC_MSG_NOTICE([using the GNU MD5 implementation])
   fi
 fi
-AC_DEFINE([HAVE_MD5], [], [Define if we're compiling support for MD5.])
+AC_DEFINE([HAVE_MD5], 1, [Define if we're compiling support for MD5.])
 AC_SUBST(MD5_OBJ)
 
 dnl **********************************************************************
diff --git a/src/ChangeLog b/src/ChangeLog
index 1d520fb..3c4244d 100644
--- a/src/ChangeLog
+++ b/src/ChangeLog
@@ -1,5 +1,10 @@
 2003-11-04  Hrvoje Niksic  <hniksic@xemacs.org>
 
+	* config-post.h: New file, included from now autogenerated
+	config.h.in.
+
+2003-11-04  Hrvoje Niksic  <hniksic@xemacs.org>
+
 	* progress.c (progress_handle_sigwinch): Don't call
 	determine_screen_width() from the signal handler.  Instead, just
 	set a volatile variable.
diff --git a/src/config.h.in b/src/config.h.in
deleted file mode 100644
index 98cb9ba..0000000
--- a/src/config.h.in
+++ /dev/null
@@ -1,338 +0,0 @@
-/* Configuration header file.
-   Copyright (C) 1995, 1996, 1997, 1998, 2000, 2001
-   Free Software Foundation, Inc.
-
-This file is part of GNU Wget.
-
-GNU Wget is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-GNU Wget is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with Wget; if not, write to the Free Software
-Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
-
-In addition, as a special exception, the Free Software Foundation
-gives permission to link the code of its release of Wget with the
-OpenSSL project's "OpenSSL" library (or with modified versions of it
-that use the same license as the "OpenSSL" library), and distribute
-the linked executables.  You must obey the GNU General Public License
-in all respects for all of the code used other than "OpenSSL".  If you
-modify this file, you may extend this exception to your version of the
-file, but you are not obligated to do so.  If you do not wish to do
-so, delete this exception statement from your version.  */
-
-#ifndef CONFIG_H
-#define CONFIG_H
-
-/* Define if you have the <alloca.h> header file.  */
-#undef HAVE_ALLOCA_H
-
-/* AIX requires this to be the first thing in the file.  */
-#ifdef __GNUC__
-# define alloca __builtin_alloca
-#else
-# if HAVE_ALLOCA_H
-#  include <alloca.h>
-# else
-#  ifdef _AIX
- #pragma alloca
-#  else
-#   ifndef alloca /* predefined by HP cc +Olibcalls */
-char *alloca ();
-#   endif
-#  endif
-# endif
-#endif
-
-/* Define if on AIX 3.
-   System headers sometimes define this.
-   We just want to avoid a redefinition error message.  */
-#ifndef _ALL_SOURCE
-#undef _ALL_SOURCE
-#endif
-
-/* Define to empty if the keyword does not work.  */
-#undef const
-
-/* Define to empty or __inline__ or __inline.  */
-#undef inline
-
-/* Define to empty if the keyword does not work.  */
-#undef volatile
-
-/* Define to `unsigned' if <sys/types.h> doesn't define.  */
-#undef size_t
-
-/* Define to `int' if <sys/types.h> doesn't define.  */
-#undef pid_t
-
-/* Define if you have the ANSI C header files.  */
-#undef STDC_HEADERS
-
-/* Define as the return type of signal handlers (int or void).  */
-#undef RETSIGTYPE
-
-/* Define if your architecture is big endian (with the most
-   significant byte first).  */
-#undef WORDS_BIGENDIAN
-
-/* Define to the length of short. */
-#undef SIZEOF_SHORT
-
-/* Define to the length of int. */
-#undef SIZEOF_INT
-
-/* Define to the length of long. */
-#undef SIZEOF_LONG
-
-/* Define to the length of long long. */
-#undef SIZEOF_LONG_LONG
-
-/* Define this if you want the NLS support.  */
-#undef HAVE_NLS
-
-/* Define if you want the FTP support for Opie compiled in.  */
-#undef USE_OPIE
-
-/* Define if you want the HTTP Digest Authorization compiled in.  */
-#undef USE_DIGEST
-
-/* Define if you want the debug output support compiled in.  */
-#undef ENABLE_DEBUG
-
-/* Define if you have sys/time.h header.  */
-#undef HAVE_SYS_TIME_H
-
-/* Define if you can safely include both <sys/time.h> and <time.h>.  */
-#undef TIME_WITH_SYS_TIME
-
-/* Define if you have inttypes.h header.  */
-#undef HAVE_INTTYPES_H
-
-/* Define if you have struct utimbuf.  */
-#undef HAVE_STRUCT_UTIMBUF
-
-/* Define if you have a working version of mmap.  */
-#undef HAVE_MMAP
-
-/* Define if you have the select function.  */
-#undef HAVE_SELECT
-
-/* Define if you have the gettimeofday function.  */
-#undef HAVE_GETTIMEOFDAY
-
-/* Define if you have the strdup function.  */
-#undef HAVE_STRDUP
-
-/* Define if you have the sys/utsname.h header.  */
-#undef HAVE_SYS_UTSNAME_H
-
-/* Define if you have the strerror function.  */
-#undef HAVE_STRERROR
-
-/* Define if you have the snprintf function.  */
-#undef HAVE_SNPRINTF
-
-/* Define if you have the vsnprintf function.  */
-#undef HAVE_VSNPRINTF
-
-/* Define if you have the strstr function.  */
-#undef HAVE_STRSTR
-
-/* Define if you have the strcasecmp function.  */
-#undef HAVE_STRCASECMP
-
-/* Define if you have the strncasecmp function.  */
-#undef HAVE_STRNCASECMP
-
-/* Define if you have the strpbrk function.  */
-#undef HAVE_STRPBRK
-
-/* Define if you have the memmove function.  */
-#undef HAVE_MEMMOVE
-
-/* Define if you have the strptime function.  */
-#undef HAVE_STRPTIME
-
-/* Define if you have the mktime function.  */
-#undef HAVE_MKTIME
-
-/* Define if you have the symlink function.  */
-#undef HAVE_SYMLINK
-
-/* Define if you have the access function.  */
-#undef HAVE_ACCESS
-
-/* Define if you have the isatty function.  */
-#undef HAVE_ISATTY
-
-/* Define if you have the signal function.  */
-#undef HAVE_SIGNAL
-
-/* Define if you have the sigsetjmp function.  */
-#undef HAVE_SIGSETJMP
-
-/* Define if you have the sigblock function.  */
-#undef HAVE_SIGBLOCK
-
-/* Define if you have the gettext function.  */
-#undef HAVE_GETTEXT
-
-/* Define if you have the usleep function.  */
-#undef HAVE_USLEEP
-
-/* Define if you have the nanosleep function.  */
-#undef HAVE_NANOSLEEP
-
-/* Define if you have the <string.h> header file.  */
-#undef HAVE_STRING_H
-
-/* Define if you have the <stdarg.h> header file.  */
-#undef HAVE_STDARG_H
-
-/* Define if you have the <unistd.h> header file.  */
-#undef HAVE_UNISTD_H
-
-/* Define if you have the <utime.h> header file.  */
-#undef HAVE_UTIME_H
-
-/* Define if you have the <sys/utime.h> header file.  */
-#undef HAVE_SYS_UTIME_H
-
-/* Define if you have the <termios.h> header file.  */
-#undef HAVE_TERMIOS_H
-
-/* Define if you have the <sys/ioctl.h> header file.  */
-#undef HAVE_SYS_IOCTL_H
-
-/* Define if you have the <sys/select.h> header file.  */
-#undef HAVE_SYS_SELECT_H
-
-/* Define if you have the <pwd.h> header file.  */
-#undef HAVE_PWD_H
-
-/* Define if you have the <signal.h> header file.  */
-#undef HAVE_SIGNAL_H
-
-/* Define if you have the <setjmp.h> header file.  */
-#undef HAVE_SETJMP_H
-
-/* Define if you have the <libintl.h> header file.  */
-#undef HAVE_LIBINTL_H
-
-/* Define if you have the <locale.h> header file.  */
-#undef HAVE_LOCALE_H
-
-/* Define if you have the <fnmatch.h> header file.  */
-#undef HAVE_FNMATCH_H
-
-/* Define to be the name of the operating system.  */
-#undef OS_TYPE
-
-/* Define if you wish to compile with socks support.  */
-#undef HAVE_SOCKS
-
-/* Define to 1 if ANSI function prototypes are usable.  */
-#undef PROTOTYPES
-
-/* Define if all libs needed for ssl support are existing */
-#undef HAVE_SSL
-
-/* Define if we're compiling in support for MD5.  */
-#undef HAVE_MD5
-
-/* Define if we're using Solaris libmd5.  */
-#undef HAVE_SOLARIS_MD5
-
-/* Define if we're using OpenSSL md5.  */
-#undef HAVE_OPENSSL_MD5
-
-/* Define if we're using builtin (GNU) md5.c.  */
-#undef HAVE_BUILTIN_MD5
-
-/* Define if you have the getaddrinfo function.  */
-#undef HAVE_GETADDRINFO
-
-/* Define if the system headers support the AI_ADDRCONFIG flag. */
-#undef HAVE_GETADDRINFO_AI_ADDRCONFIG
-
-/* Define if the system headers support the AI_V4MAPPED flag. */
-#undef HAVE_GETADDRINFO_AI_V4MAPPED
-
-/* Define if the system headers support the AI_ALL flag. */
-#undef HAVE_GETADDRINFO_AI_ALL
-
-/* Define if the system supports struct sockaddr_in6 */
-#undef HAVE_HAVE_STRUCT_SOCKADDR_IN6
-
-/* Define if struct sockaddr_in6 has the sin6_scope_id member */
-#undef HAVE_SOCKADDR_IN6_SCOPE_ID
-
-/* Define if you want to enable the IPv6 support.  */
-#undef ENABLE_IPV6
-
-/* Defined to int or size_t on systems without socklen_t.  */
-#undef socklen_t
-
-/* Define if you have uint32_t.  */
-#undef HAVE_UINT32_T
-
-/* Define if you have sig_atomic_t.  */
-#undef HAVE_SIG_ATOMIC_T
-
-/* Some autoconf-unrelated preprocessor magic that cannot be in
-   sysdep.h because it must be done before including the system
-   headers.  */
-
-/* First a gambit to see whether we're on Solaris.  We'll
-   need it below.  */
-#ifdef __sun
-# ifdef __SVR4
-#  define solaris
-# endif
-#endif
-
-/* The following several lines can be very dangerous; they can cripple
-   the header files and break compilation in _verY_ non-obvious ways.
-   Because of that, we define them only on architectures we know
-   about.  */
-
-#undef NAMESPACE_TWEAKS
-
-#ifdef solaris
-# define NAMESPACE_TWEAKS
-# ifdef __GNUC__
-/* Prevent stdio.h from declaring va_list and thus tripping gcc's
-   stdarg.h. */
-#  define _VA_LIST
-# endif
-#endif
-
-#ifdef __linux__
-# define NAMESPACE_TWEAKS
-#endif
-
-#ifdef NAMESPACE_TWEAKS
-
-/* Request the "Unix 98 compilation environment". */
-#define _XOPEN_SOURCE 500
-
-/* For Solaris: request everything else that is available and doesn't
-   conflict with the above.  */
-#define __EXTENSIONS__
-
-/* For Linux: request features of 4.3BSD and SVID (System V Interface
-   Definition). */
-#define _SVID_SOURCE
-#define _BSD_SOURCE
-
-#endif /* NAMESPACE_TWEAKS */
-
-#endif /* CONFIG_H */
diff --git a/src/host.c b/src/host.c
index 6555680..81c8a54 100644
--- a/src/host.c
+++ b/src/host.c
@@ -57,12 +57,9 @@ so, delete this exception statement from your version.  */
 #endif /* WINDOWS */
 
 #ifndef NO_ADDRESS
-#define NO_ADDRESS NO_DATA
+# define NO_ADDRESS NO_DATA
 #endif
 
-#ifdef HAVE_SYS_UTSNAME_H
-# include <sys/utsname.h>
-#endif
 #include <errno.h>
 
 #include "wget.h"
-- 
cgit v1.0-41-gc330

