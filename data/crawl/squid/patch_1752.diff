@@ -35,6 +35,25 @@
 	  Forster).
 	- Patches for Qnx4 (Jean-Claude MICHOT).
 	- Fixed returning void functions which seems to be a GCC-ism.
+	- New configure script options (Henrik Nordstrom):
+		--enable-new-storekey=[sha|md5(|url)] (was --enable-hashkey)
+		--enable-acltree
+		--enable-icmp
+		--enable-delay-hack
+		--enable-useragent-log
+		--enable-kill-parent  (this should be named -hack)
+		--enable-snmp
+		--enable-time-hack
+		--enable-cachemgr-hostname[=hostname]   (new)
+		--enable-arp-acl  (new)
+	- Added Doug Lea malloc-2.6.4 to the distribution, so that
+	  people easily can try a decent malloc package if they syspect
+	  their malloc is broken.  --enable-dlmalloc (Henrik Nordstrom).
+	- Made XMALLOC_DEBUG_COUNT working again. Requires a small stub
+	  function (Henrik Nordstrom).
+	- Removed top-level Makefile.  People must now run 'configure'
+	  before 'make'.
+
 
 Changes to squid-1.2.beta10 (Jan 1, 1998):
 
@@ -12,11 +12,16 @@ ac_help=
 ac_default_prefix=/usr/local
 # Any additions from configure.in:
 ac_default_prefix=/usr/local/squid
+ac_help="$ac_help
+  --enable-dlmalloc       Compile & use the malloc package by Doug Lea"
 ac_help="$ac_help
   --enable-gnuregex       Compile GNUregex"
 ac_help="$ac_help
-  --enable-hashkey[=sha|md5]
-                          Use hash function as store index, instead of URL"
+  --enable-new-storekey[=sha|md5]
+                          Use SHA/MD5 as store index, instead of URL"
+ac_help="$ac_help
+  --enable-acltree[=bin|splay]
+                          Use tree function to store ACL lists"
 ac_help="$ac_help
   --enable-xmalloc-debug  Do some simple malloc debugging"
 ac_help="$ac_help
@@ -26,7 +31,24 @@ ac_help="$ac_help
   --enable-xmalloc-statistics
                           Show malloc statistics in status page"
 ac_help="$ac_help
-  --enable-async-io       Use ASYNC disk I/O"
+  --enable-async-io       Do ASYNC disk I/O using threads"
+ac_help="$ac_help
+  --enable-icmp           Enable ICMP pinging"
+ac_help="$ac_help
+  --enable-delay-hack     Enable delay hack to limit bandwith usage"
+ac_help="$ac_help
+  --enable-useragent-log  Enable logging of User-Agent header"
+ac_help="$ac_help
+  --enable-kill-parent    Kill parent on shutdown"
+ac_help="$ac_help
+  --enable-snmp           Enable SNMP monitoring"
+ac_help="$ac_help
+  --enable-time-hack      Update internal timestamp only once per second"
+ac_help="$ac_help
+  --enable-cachemgr-hostname[=hostname]
+                          Make cachemgr.cgi default to this host"
+ac_help="$ac_help
+  --enable-arp-acl        Enable use of ARP ACL lists (ether address)"
 
 # Initialize some variables set by options.
 # The variables have the same names as the options, with
@@ -535,7 +557,7 @@ fi
 
 
 
-# From configure.in Revision: 1.92 
+# From configure.in Revision: 1.93 
 ac_aux_dir=
 for ac_dir in aux $srcdir/aux; do
   if test -f $ac_dir/install-sh; then
@@ -563,7 +585,7 @@ else { echo "configure: error: can not run $ac_config_sub" 1>&2; exit 1; }
 fi
 
 echo $ac_n "checking host system type""... $ac_c" 1>&6
-echo "configure:567: checking host system type" >&5
+echo "configure:589: checking host system type" >&5
 
 host_alias=$host
 case "$host_alias" in
@@ -618,7 +640,7 @@ PRESET_CFLAGS="$CFLAGS"
 # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:622: checking for $ac_word" >&5
+echo "configure:644: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -647,7 +669,7 @@ if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:651: checking for $ac_word" >&5
+echo "configure:673: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -695,7 +717,7 @@ fi
 fi
 
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works""... $ac_c" 1>&6
-echo "configure:699: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
+echo "configure:721: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
 
 ac_ext=c
 # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
@@ -705,11 +727,11 @@ ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS
 cross_compiling=$ac_cv_prog_cc_cross
 
 cat > conftest.$ac_ext <<EOF
-#line 709 "configure"
+#line 731 "configure"
 #include "confdefs.h"
 main(){return(0);}
 EOF
-if { (eval echo configure:713: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:735: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   ac_cv_prog_cc_works=yes
   # If we can't run a trivial program, we are probably using a cross compiler.
   if (./conftest; exit) 2>/dev/null; then
@@ -729,12 +751,12 @@ if test $ac_cv_prog_cc_works = no; then
   { echo "configure: error: installation or configuration problem: C compiler cannot create executables." 1>&2; exit 1; }
 fi
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
-echo "configure:733: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
+echo "configure:755: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
 echo "$ac_t""$ac_cv_prog_cc_cross" 1>&6
 cross_compiling=$ac_cv_prog_cc_cross
 
 echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
-echo "configure:738: checking whether we are using GNU C" >&5
+echo "configure:760: checking whether we are using GNU C" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -743,7 +765,7 @@ else
   yes;
 #endif
 EOF
-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:747: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:769: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
   ac_cv_prog_gcc=yes
 else
   ac_cv_prog_gcc=no
@@ -758,7 +780,7 @@ if test $ac_cv_prog_gcc = yes; then
   ac_save_CFLAGS="$CFLAGS"
   CFLAGS=
   echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
-echo "configure:762: checking whether ${CC-cc} accepts -g" >&5
+echo "configure:784: checking whether ${CC-cc} accepts -g" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_cc_g'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -817,8 +839,345 @@ if test -z "$PRESET_LDFLAGS"; then
     fi
 fi
 
+# Check whether --enable-dlmalloc or --disable-dlmalloc was given.
+if test "${enable_dlmalloc+set}" = set; then
+  enableval="$enable_dlmalloc"
+  
+ if test "$enableval" = "yes" ; then
+   LIBDLMALLOC="libdlmalloc.a"
+   LIB_MALLOC="-L../lib -ldlmalloc"
+   ac_cv_func_mallinfo="yes"
+   ac_cv_func_mallocblksize="no"
+   ac_cv_func_free="yes"
+   ac_cv_func_realloc="yes"
+   ac_cv_func_memalign="yes"
+   ac_cv_func_valloc="yes"
+   ac_cv_func_pvalloc="yes"
+   ac_cv_func_calloc="yes"
+   ac_cv_func_cfree="yes"
+   ac_cv_func_malloc_trim="yes"
+   ac_cv_func_malloc_usable_size="yes"
+   ac_cv_func_malloc_stats="yes"
+   ac_cv_func_mallinfo="yes"
+   ac_cv_func_mallopt="yes"
+   ac_cv_lib_gnumalloc="no"
+   ac_cv_lib_malloc="no"
+   ac_cv_enabled_dlmalloc="yes"
+   echo "dlmalloc build enabled"
+ elif test "x$ac_cv_enabled_dlmalloc" = "xyes"; then
+   # Ok. dlmalloc was enabled before, but now disabled.
+   # we have to test these again
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallocblksize
+   unset ac_cv_func_free
+   unset ac_cv_func_realloc
+   unset ac_cv_func_memalign
+   unset ac_cv_func_valloc
+   unset ac_cv_func_pvalloc
+   unset ac_cv_func_calloc
+   unset ac_cv_func_cfree
+   unset ac_cv_func_malloc_trim
+   unset ac_cv_func_malloc_usable_size
+   unset ac_cv_func_malloc_stats
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallopt
+   unset ac_cv_lib_gnumalloc
+   unset ac_cv_lib_malloc
+   unset ac_cv_enabled_dlmalloc
+ fi
+ 
+else
+  
+ if test "x$ac_cv_enabled_dlmalloc" = "xyes"; then
+   # Ok. dlmalloc was enabled before, but now disabled.
+   # we have to test these again
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallocblksize
+   unset ac_cv_func_free
+   unset ac_cv_func_realloc
+   unset ac_cv_func_memalign
+   unset ac_cv_func_valloc
+   unset ac_cv_func_pvalloc
+   unset ac_cv_func_calloc
+   unset ac_cv_func_cfree
+   unset ac_cv_func_malloc_trim
+   unset ac_cv_func_malloc_usable_size
+   unset ac_cv_func_malloc_stats
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallopt
+   unset ac_cv_lib_gnumalloc
+   unset ac_cv_lib_malloc
+   unset ac_cv_enabled_dlmalloc
+ fi
+ 
+fi
+
+
+
+
+# Check whether --enable-gnuregex or --disable-gnuregex was given.
+if test "${enable_gnuregex+set}" = set; then
+  enableval="$enable_gnuregex"
+  USE_GNUREGEX=$enableval
+fi
+
+
+# Check whether --enable-new_storekey or --disable-new_storekey was given.
+if test "${enable_new_storekey+set}" = set; then
+  enableval="$enable_new_storekey"
+   case "$enableval" in
+  yes|sha)
+  	echo "Store key set to SHA"
+  	cat >> confdefs.h <<\EOF
+#define STORE_KEY_SHA 1
+EOF
+
+	STORE_KEY=sha
+      	;;
+  md5)
+  	echo "Store key set to MD5"
+  	cat >> confdefs.h <<\EOF
+#define STORE_KEY_MD5 1
+EOF
+
+	STORE_KEY=md5
+	;;
+  no|url)
+	echo "Store key set to URL"
+	cat >> confdefs.h <<\EOF
+#define STORE_KEY_URL 1
+EOF
+
+	STORE_KEY=url
+  esac
+
+else
+  
+  STORE_KEY=url
+  cat >> confdefs.h <<\EOF
+#define STORE_KEY_URL 1
+EOF
+
+
+fi
+
+
+
+# Check whether --enable-acltree or --disable-acltree was given.
+if test "${enable_acltree+set}" = set; then
+  enableval="$enable_acltree"
+   case "$enableval" in
+  splay)
+  	echo "ACL lists using BIN trees"
+  	cat >> confdefs.h <<\EOF
+#define USE_SPLAY_TREE 1
+EOF
+
+      	;;
+  yes|bin)
+  	echo "ACL lists using SPLAY trees"
+  	cat >> confdefs.h <<\EOF
+#define USE_BIN_TREE 1
+EOF
+
+	;;
+  esac
+
+fi
+
+
+# Check whether --enable-xmalloc_debug or --disable-xmalloc_debug was given.
+if test "${enable_xmalloc_debug+set}" = set; then
+  enableval="$enable_xmalloc_debug"
+   if test "$enableval" = "yes" ; then
+    echo "Malloc debugging enabled"
+    cat >> confdefs.h <<\EOF
+#define XMALLOC_DEBUG 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-xmalloc_debug_count or --disable-xmalloc_debug_count was given.
+if test "${enable_xmalloc_debug_count+set}" = set; then
+  enableval="$enable_xmalloc_debug_count"
+   if test "$enableval" = "yes" ; then
+    echo "Malloc tracing enabled"
+    cat >> confdefs.h <<\EOF
+#define XMALLOC_COUNT 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-xmalloc_statistics or --disable-xmalloc_statistics was given.
+if test "${enable_xmalloc_statistics+set}" = set; then
+  enableval="$enable_xmalloc_statistics"
+   if test "$enableval" = "yes" ; then
+    echo "Malloc statistics enabled"
+    cat >> confdefs.h <<\EOF
+#define XMALLOC_STATISTICS 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-async_io or --disable-async_io was given.
+if test "${enable_async_io+set}" = set; then
+  enableval="$enable_async_io"
+   if test "$enableval" = "yes" ; then
+    echo "Async I/O enabled"
+    cat >> confdefs.h <<\EOF
+#define USE_ASYNC_IO 1
+EOF
+
+    ASYNC_OBJS='$(ASYNC_OBJS)'
+    SQUID_PTHREAD_LIB='$(PTHREAD_LIB)'
+  fi
+
+fi
+
+
+
+
+# Check whether --enable-icmp or --disable-icmp was given.
+if test "${enable_icmp+set}" = set; then
+  enableval="$enable_icmp"
+   if test "$enableval" = "yes" ; then
+    echo "ICMP enabled"
+    cat >> confdefs.h <<\EOF
+#define USE_ICMP 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-delay_hack or --disable-delay_hack was given.
+if test "${enable_delay_hack+set}" = set; then
+  enableval="$enable_delay_hack"
+   if test "$enableval" = "yes" ; then
+    echo "Delay hack enabled"
+    cat >> confdefs.h <<\EOF
+#define DELAY_HACK 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-useragent_log or --disable-useragent_log was given.
+if test "${enable_useragent_log+set}" = set; then
+  enableval="$enable_useragent_log"
+   if test "$enableval" = "yes" ; then
+    echo "User-Agent logging enabled"
+    cat >> confdefs.h <<\EOF
+#define USE_USERAGENT_LOG 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-kill_parent or --disable-kill_parent was given.
+if test "${enable_kill_parent+set}" = set; then
+  enableval="$enable_kill_parent"
+   if test "$enableval" = "yes" ; then
+    echo "Kill parent on shutdown"
+    cat >> confdefs.h <<\EOF
+#define KILL_PARENT_OPT 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-snmp or --disable-snmp was given.
+if test "${enable_snmp+set}" = set; then
+  enableval="$enable_snmp"
+   if test "$enableval" = "yes" ; then
+    echo "SNMP monitoring enabled"
+    cat >> confdefs.h <<\EOF
+#define SQUID_SNMP 1
+EOF
+
+    SNMPLIB='-L../snmplib -lsnmp'
+    SNMP_OBJS='$(SNMP_OBJS)'
+    makesnmplib=snmplib
+  fi
+
+fi
+
+
+
+
+
+# Check whether --enable-time_hack or --disable-time_hack was given.
+if test "${enable_time_hack+set}" = set; then
+  enableval="$enable_time_hack"
+   if test "$enableval" = "yes" ; then
+    echo "Update internal timestamp only once per second"
+    cat >> confdefs.h <<\EOF
+#define ALARM_UPDATES_TIME 1
+EOF
+
+  fi
+
+fi
+
+
+# Check whether --enable-cachemgr_hostname or --disable-cachemgr_hostname was given.
+if test "${enable_cachemgr_hostname+set}" = set; then
+  enableval="$enable_cachemgr_hostname"
+    case $enableval in
+   yes)
+       cat >> confdefs.h <<\EOF
+#define CACHEMGR_HOSTNAME getfullhostname()
+EOF
+
+       echo "Cachemgr default hostname == host where cachemgr runs"
+       ;;
+   no)
+       : # Nothing to do..
+       ;;
+   *)
+       cat >> confdefs.h <<EOF
+#define CACHEMGR_HOSTNAME "${enableval}"
+EOF
+
+       echo "Cachemgr default hostname set to ${enableval}"
+       ;;
+   esac
+
+fi
+
+
+# Check whether --enable-arp_acl or --disable-arp_acl was given.
+if test "${enable_arp_acl+set}" = set; then
+  enableval="$enable_arp_acl"
+    if test "$enableval" = "yes" ; then
+     echo "ARP ACL lists enabled (ether address)"
+     cat >> confdefs.h <<\EOF
+#define USE_ARP_ACL 1
+EOF
+
+   fi
+
+fi
+
+
 echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
-echo "configure:822: checking how to run the C preprocessor" >&5
+echo "configure:1181: checking how to run the C preprocessor" >&5
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
@@ -833,13 +1192,13 @@ else
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp.
   cat > conftest.$ac_ext <<EOF
-#line 837 "configure"
+#line 1196 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:843: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1202: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out`
 if test -z "$ac_err"; then
   :
@@ -850,13 +1209,13 @@ else
   rm -rf conftest*
   CPP="${CC-cc} -E -traditional-cpp"
   cat > conftest.$ac_ext <<EOF
-#line 854 "configure"
+#line 1213 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:860: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1219: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out`
 if test -z "$ac_err"; then
   :
@@ -889,7 +1248,7 @@ echo "$ac_t""$CPP" 1>&6
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
 # ./install, which can be erroneously created by make from ./install.sh.
 echo $ac_n "checking for a BSD compatible install""... $ac_c" 1>&6
-echo "configure:893: checking for a BSD compatible install" >&5
+echo "configure:1252: checking for a BSD compatible install" >&5
 if test -z "$INSTALL"; then
 if eval "test \"`echo '$''{'ac_cv_path_install'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -941,7 +1300,7 @@ test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:945: checking for $ac_word" >&5
+echo "configure:1304: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -968,7 +1327,7 @@ else
 fi
 
 echo $ac_n "checking whether ln -s works""... $ac_c" 1>&6
-echo "configure:972: checking whether ln -s works" >&5
+echo "configure:1331: checking whether ln -s works" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_LN_S'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -991,7 +1350,7 @@ fi
 # Extract the first word of "sh", so it can be a program name with args.
 set dummy sh; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:995: checking for $ac_word" >&5
+echo "configure:1354: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_SH'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1023,7 +1382,7 @@ fi
 # Extract the first word of "false", so it can be a program name with args.
 set dummy false; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1027: checking for $ac_word" >&5
+echo "configure:1386: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_FALSE'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1055,7 +1414,7 @@ fi
 # Extract the first word of "true", so it can be a program name with args.
 set dummy true; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1059: checking for $ac_word" >&5
+echo "configure:1418: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_TRUE'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1087,7 +1446,7 @@ fi
 # Extract the first word of "rm", so it can be a program name with args.
 set dummy rm; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1091: checking for $ac_word" >&5
+echo "configure:1450: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_RM'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1119,7 +1478,7 @@ fi
 # Extract the first word of "mv", so it can be a program name with args.
 set dummy mv; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1123: checking for $ac_word" >&5
+echo "configure:1482: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_MV'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1151,7 +1510,7 @@ fi
 # Extract the first word of "mkdir", so it can be a program name with args.
 set dummy mkdir; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1155: checking for $ac_word" >&5
+echo "configure:1514: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_MKDIR'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1183,7 +1542,7 @@ fi
 # Extract the first word of "ln", so it can be a program name with args.
 set dummy ln; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1187: checking for $ac_word" >&5
+echo "configure:1546: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_LN'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1215,7 +1574,7 @@ fi
 # Extract the first word of "perl", so it can be a program name with args.
 set dummy perl; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1219: checking for $ac_word" >&5
+echo "configure:1578: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_PERL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1247,7 +1606,7 @@ fi
 # Extract the first word of "makedepend", so it can be a program name with args.
 set dummy makedepend; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1251: checking for $ac_word" >&5
+echo "configure:1610: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_MAKEDEPEND'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1279,7 +1638,7 @@ fi
 # Extract the first word of "ar", so it can be a program name with args.
 set dummy ar; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1283: checking for $ac_word" >&5
+echo "configure:1642: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_AR'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1329,20 +1688,20 @@ for ac_hdr in dirent.h sys/ndir.h sys/dir.h ndir.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr that defines DIR""... $ac_c" 1>&6
-echo "configure:1333: checking for $ac_hdr that defines DIR" >&5
+echo "configure:1692: checking for $ac_hdr that defines DIR" >&5
 if eval "test \"`echo '$''{'ac_cv_header_dirent_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1338 "configure"
+#line 1697 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <$ac_hdr>
 int main() {
 DIR *dirp = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:1346: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:1705: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_dirent_$ac_safe=yes"
 else
@@ -1367,15 +1726,15 @@ done
 # Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
 if test $ac_header_dirent = dirent.h; then
 echo $ac_n "checking for opendir in -ldir""... $ac_c" 1>&6
-echo "configure:1371: checking for opendir in -ldir" >&5
+echo "configure:1730: checking for opendir in -ldir" >&5
 ac_lib_var=`echo dir'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-ldir  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 1379 "configure"
+#line 1738 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -1386,7 +1745,7 @@ int main() {
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:1390: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:1749: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -1408,15 +1767,15 @@ fi
 
 else
 echo $ac_n "checking for opendir in -lx""... $ac_c" 1>&6
-echo "configure:1412: checking for opendir in -lx" >&5
+echo "configure:1771: checking for opendir in -lx" >&5
 ac_lib_var=`echo x'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lx  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 1420 "configure"
+#line 1779 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -1427,7 +1786,7 @@ int main() {
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:1431: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:1790: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -1450,20 +1809,20 @@ fi
 fi
 
 echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
-echo "configure:1454: checking for ANSI C header files" >&5
+echo "configure:1813: checking for ANSI C header files" >&5
 if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1459 "configure"
+#line 1818 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 #include <stdarg.h>
 #include <string.h>
 #include <float.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1467: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1826: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1480,7 +1839,7 @@ rm -f conftest*
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 1484 "configure"
+#line 1843 "configure"
 #include "confdefs.h"
 #include <string.h>
 EOF
@@ -1498,7 +1857,7 @@ fi
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 1502 "configure"
+#line 1861 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 EOF
@@ -1519,7 +1878,7 @@ if test "$cross_compiling" = yes; then
   :
 else
   cat > conftest.$ac_ext <<EOF
-#line 1523 "configure"
+#line 1882 "configure"
 #include "confdefs.h"
 #include <ctype.h>
 #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
@@ -1530,7 +1889,7 @@ if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);
 exit (0); }
 
 EOF
-if { (eval echo configure:1534: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:1893: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   :
 else
@@ -1554,7 +1913,6 @@ EOF
 fi
 
 
-
 for ac_hdr in \
 	alloca.h \
 	arpa/inet.h \
@@ -1607,17 +1965,17 @@ for ac_hdr in \
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:1611: checking for $ac_hdr" >&5
+echo "configure:1969: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1616 "configure"
+#line 1974 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1621: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1979: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -1645,12 +2003,12 @@ done
 
 
 echo $ac_n "checking for working const""... $ac_c" 1>&6
-echo "configure:1649: checking for working const" >&5
+echo "configure:2007: checking for working const" >&5
 if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 1654 "configure"
+#line 2012 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -1699,7 +2057,7 @@ ccp = (char const *const *) p;
 
 ; return 0; }
 EOF
-if { (eval echo configure:1703: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2061: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_c_const=yes
 else
@@ -1720,14 +2078,14 @@ EOF
 fi
 
 echo $ac_n "checking whether byte ordering is bigendian""... $ac_c" 1>&6
-echo "configure:1724: checking whether byte ordering is bigendian" >&5
+echo "configure:2082: checking whether byte ordering is bigendian" >&5
 if eval "test \"`echo '$''{'ac_cv_c_bigendian'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_cv_c_bigendian=unknown
 # See if sys/param.h defines the BYTE_ORDER macro.
 cat > conftest.$ac_ext <<EOF
-#line 1731 "configure"
+#line 2089 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/param.h>
@@ -1738,11 +2096,11 @@ int main() {
 #endif
 ; return 0; }
 EOF
-if { (eval echo configure:1742: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2100: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   # It does; now see whether it defined to BIG_ENDIAN or not.
 cat > conftest.$ac_ext <<EOF
-#line 1746 "configure"
+#line 2104 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/param.h>
@@ -1753,7 +2111,7 @@ int main() {
 #endif
 ; return 0; }
 EOF
-if { (eval echo configure:1757: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2115: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_c_bigendian=yes
 else
@@ -1773,7 +2131,7 @@ if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 1777 "configure"
+#line 2135 "configure"
 #include "confdefs.h"
 main () {
   /* Are we little or big endian?  From Harbison&Steele.  */
@@ -1786,7 +2144,7 @@ main () {
   exit (u.c[sizeof (long) - 1] == 1);
 }
 EOF
-if { (eval echo configure:1790: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:2148: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   ac_cv_c_bigendian=no
 else
@@ -1811,20 +2169,20 @@ fi
 
 
 echo $ac_n "checking if ANSI prototypes work""... $ac_c" 1>&6
-echo "configure:1815: checking if ANSI prototypes work" >&5
+echo "configure:2173: checking if ANSI prototypes work" >&5
 if eval "test \"`echo '$''{'ac_cv_have_ansi_prototypes'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   
   cat > conftest.$ac_ext <<EOF
-#line 1821 "configure"
+#line 2179 "configure"
 #include "confdefs.h"
 int foo(char *); int foo (char *bar) {return 1;}
 int main() {
 foo("bar")
 ; return 0; }
 EOF
-if { (eval echo configure:1828: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2186: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_have_ansi_prototypes="yes"
 else
@@ -1846,13 +2204,13 @@ EOF
 fi
 
 echo $ac_n "checking for tm->tm_gmtoff""... $ac_c" 1>&6
-echo "configure:1850: checking for tm->tm_gmtoff" >&5
+echo "configure:2208: checking for tm->tm_gmtoff" >&5
 if eval "test \"`echo '$''{'ac_cv_have_tm_gmoff'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   
   cat > conftest.$ac_ext <<EOF
-#line 1856 "configure"
+#line 2214 "configure"
 #include "confdefs.h"
 #include <time.h>
 #include <sys/time.h>
@@ -1861,7 +2219,7 @@ struct tm foo;
       foo.tm_gmtoff = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:1865: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2223: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_have_tm_gmoff="yes"
 else
@@ -1883,13 +2241,13 @@ EOF
 fi
 
 echo $ac_n "checking for extended mallinfo""... $ac_c" 1>&6
-echo "configure:1887: checking for extended mallinfo" >&5
+echo "configure:2245: checking for extended mallinfo" >&5
 if eval "test \"`echo '$''{'ac_cv_have_ext_mallinfo'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   
   cat > conftest.$ac_ext <<EOF
-#line 1893 "configure"
+#line 2251 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <malloc.h>
@@ -1898,7 +2256,7 @@ struct mallinfo foo;
       foo.mxfast = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:1902: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2260: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_have_ext_mallinfo="yes"
 else
@@ -1920,13 +2278,13 @@ EOF
 fi
 
 echo $ac_n "checking for struct rusage""... $ac_c" 1>&6
-echo "configure:1924: checking for struct rusage" >&5
+echo "configure:2282: checking for struct rusage" >&5
 if eval "test \"`echo '$''{'ac_cv_have_struct_rusage'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   
   cat > conftest.$ac_ext <<EOF
-#line 1930 "configure"
+#line 2288 "configure"
 #include "confdefs.h"
 
 #if HAVE_SYS_TIME_H
@@ -1939,7 +2297,7 @@ int main() {
 struct rusage R;
 ; return 0; }
 EOF
-if { (eval echo configure:1943: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2301: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_have_struct_rusage="yes"
 else
@@ -1961,13 +2319,13 @@ EOF
 fi
 
 echo $ac_n "checking for ip->ip_hl""... $ac_c" 1>&6
-echo "configure:1965: checking for ip->ip_hl" >&5
+echo "configure:2323: checking for ip->ip_hl" >&5
 if eval "test \"`echo '$''{'ac_cv_have_ip_hl'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   
   cat > conftest.$ac_ext <<EOF
-#line 1971 "configure"
+#line 2329 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <netinet/in.h>
@@ -1984,7 +2342,7 @@ struct iphdr ip;
       ip.ip_hl= 0;
 ; return 0; }
 EOF
-if { (eval echo configure:1988: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2346: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_have_ip_hl="yes"
 else
@@ -2006,15 +2364,15 @@ EOF
 fi
 
 echo $ac_n "checking size of int""... $ac_c" 1>&6
-echo "configure:2010: checking size of int" >&5
+echo "configure:2368: checking size of int" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_int'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 2018 "configure"
+#line 2376 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -2025,7 +2383,7 @@ main()
   exit(0);
 }
 EOF
-if { (eval echo configure:2029: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:2387: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_int=`cat conftestval`
 else
@@ -2045,15 +2403,15 @@ EOF
 
 
 echo $ac_n "checking size of long""... $ac_c" 1>&6
-echo "configure:2049: checking size of long" >&5
+echo "configure:2407: checking size of long" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_long'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 2057 "configure"
+#line 2415 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main()
@@ -2064,7 +2422,7 @@ main()
   exit(0);
 }
 EOF
-if { (eval echo configure:2068: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:2426: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_long=`cat conftestval`
 else
@@ -2087,19 +2445,19 @@ EOF
 # The Ultrix 4.2 mips builtin alloca declared by alloca.h only works
 # for constant arguments.  Useless!
 echo $ac_n "checking for working alloca.h""... $ac_c" 1>&6
-echo "configure:2091: checking for working alloca.h" >&5
+echo "configure:2449: checking for working alloca.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_alloca_h'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2096 "configure"
+#line 2454 "configure"
 #include "confdefs.h"
 #include <alloca.h>
 int main() {
 char *p = alloca(2 * sizeof(int));
 ; return 0; }
 EOF
-if { (eval echo configure:2103: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:2461: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   ac_cv_header_alloca_h=yes
 else
@@ -2120,12 +2478,12 @@ EOF
 fi
 
 echo $ac_n "checking for alloca""... $ac_c" 1>&6
-echo "configure:2124: checking for alloca" >&5
+echo "configure:2482: checking for alloca" >&5
 if eval "test \"`echo '$''{'ac_cv_func_alloca_works'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2129 "configure"
+#line 2487 "configure"
 #include "confdefs.h"
 
 #ifdef __GNUC__
@@ -2148,7 +2506,7 @@ int main() {
 char *p = (char *) alloca(1);
 ; return 0; }
 EOF
-if { (eval echo configure:2152: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:2510: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   ac_cv_func_alloca_works=yes
 else
@@ -2180,12 +2538,12 @@ EOF
 
 
 echo $ac_n "checking whether alloca needs Cray hooks""... $ac_c" 1>&6
-echo "configure:2184: checking whether alloca needs Cray hooks" >&5
+echo "configure:2542: checking whether alloca needs Cray hooks" >&5
 if eval "test \"`echo '$''{'ac_cv_os_cray'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2189 "configure"
+#line 2547 "configure"
 #include "confdefs.h"
 #if defined(CRAY) && ! defined(CRAY2)
 webecray
@@ -2210,12 +2568,12 @@ echo "$ac_t""$ac_cv_os_cray" 1>&6
 if test $ac_cv_os_cray = yes; then
 for ac_func in _getb67 GETB67 getb67; do
   echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:2214: checking for $ac_func" >&5
+echo "configure:2572: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2219 "configure"
+#line 2577 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -2238,7 +2596,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:2242: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:2600: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -2265,15 +2623,15 @@ done
 fi
 
 echo $ac_n "checking stack direction for C alloca""... $ac_c" 1>&6
-echo "configure:2269: checking stack direction for C alloca" >&5
+echo "configure:2627: checking stack direction for C alloca" >&5
 if eval "test \"`echo '$''{'ac_cv_c_stack_direction'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
   ac_cv_c_stack_direction=0
 else
   cat > conftest.$ac_ext <<EOF
-#line 2277 "configure"
+#line 2635 "configure"
 #include "confdefs.h"
 find_stack_direction ()
 {
@@ -2292,7 +2650,7 @@ main ()
   exit (find_stack_direction() < 0);
 }
 EOF
-if { (eval echo configure:2296: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:2654: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   ac_cv_c_stack_direction=1
 else
@@ -2315,12 +2673,12 @@ fi
 
 
 echo $ac_n "checking for pid_t""... $ac_c" 1>&6
-echo "configure:2319: checking for pid_t" >&5
+echo "configure:2677: checking for pid_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_pid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2324 "configure"
+#line 2682 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -2348,12 +2706,12 @@ EOF
 fi
 
 echo $ac_n "checking for size_t""... $ac_c" 1>&6
-echo "configure:2352: checking for size_t" >&5
+echo "configure:2710: checking for size_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_size_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2357 "configure"
+#line 2715 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -2381,12 +2739,12 @@ EOF
 fi
 
 echo $ac_n "checking for ssize_t""... $ac_c" 1>&6
-echo "configure:2385: checking for ssize_t" >&5
+echo "configure:2743: checking for ssize_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_ssize_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2390 "configure"
+#line 2748 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -2414,12 +2772,12 @@ EOF
 fi
 
 echo $ac_n "checking for off_t""... $ac_c" 1>&6
-echo "configure:2418: checking for off_t" >&5
+echo "configure:2776: checking for off_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_off_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2423 "configure"
+#line 2781 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -2447,12 +2805,12 @@ EOF
 fi
 
 echo $ac_n "checking for mode_t""... $ac_c" 1>&6
-echo "configure:2451: checking for mode_t" >&5
+echo "configure:2809: checking for mode_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_mode_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2456 "configure"
+#line 2814 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -2481,22 +2839,22 @@ fi
 
 
 echo $ac_n "checking for main in -lnsl""... $ac_c" 1>&6
-echo "configure:2485: checking for main in -lnsl" >&5
+echo "configure:2843: checking for main in -lnsl" >&5
 ac_lib_var=`echo nsl'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lnsl  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2493 "configure"
+#line 2851 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2500: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:2858: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2524,22 +2882,22 @@ else
 fi
 
 echo $ac_n "checking for main in -lsocket""... $ac_c" 1>&6
-echo "configure:2528: checking for main in -lsocket" >&5
+echo "configure:2886: checking for main in -lsocket" >&5
 ac_lib_var=`echo socket'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lsocket  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2536 "configure"
+#line 2894 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2543: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:2901: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2567,22 +2925,22 @@ else
 fi
 
 echo $ac_n "checking for main in -lgnumalloc""... $ac_c" 1>&6
-echo "configure:2571: checking for main in -lgnumalloc" >&5
+echo "configure:2929: checking for main in -lgnumalloc" >&5
 ac_lib_var=`echo gnumalloc'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lgnumalloc  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2579 "configure"
+#line 2937 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2586: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:2944: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2624,22 +2982,22 @@ else
 			;;
 		*)
 			echo $ac_n "checking for main in -lmalloc""... $ac_c" 1>&6
-echo "configure:2628: checking for main in -lmalloc" >&5
+echo "configure:2986: checking for main in -lmalloc" >&5
 ac_lib_var=`echo malloc'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lmalloc  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2636 "configure"
+#line 2994 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2643: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3001: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2670,22 +3028,22 @@ fi
 	esac
 fi
 echo $ac_n "checking for main in -lbsd""... $ac_c" 1>&6
-echo "configure:2674: checking for main in -lbsd" >&5
+echo "configure:3032: checking for main in -lbsd" >&5
 ac_lib_var=`echo bsd'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lbsd  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2682 "configure"
+#line 3040 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2689: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3047: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2713,22 +3071,22 @@ else
 fi
 
 echo $ac_n "checking for main in -lregex""... $ac_c" 1>&6
-echo "configure:2717: checking for main in -lregex" >&5
+echo "configure:3075: checking for main in -lregex" >&5
 ac_lib_var=`echo regex'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lregex  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2725 "configure"
+#line 3083 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2732: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3090: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2754,15 +3112,15 @@ case "$host" in
 		;;
 	*)
 		echo $ac_n "checking for inet_aton in -lresolv""... $ac_c" 1>&6
-echo "configure:2758: checking for inet_aton in -lresolv" >&5
+echo "configure:3116: checking for inet_aton in -lresolv" >&5
 ac_lib_var=`echo resolv'_'inet_aton | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lresolv  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2766 "configure"
+#line 3124 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2773,7 +3131,7 @@ int main() {
 inet_aton()
 ; return 0; }
 EOF
-if { (eval echo configure:2777: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3135: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2789,15 +3147,15 @@ fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
   echo $ac_n "checking for inet_aton in -l44bsd""... $ac_c" 1>&6
-echo "configure:2793: checking for inet_aton in -l44bsd" >&5
+echo "configure:3151: checking for inet_aton in -l44bsd" >&5
 ac_lib_var=`echo 44bsd'_'inet_aton | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-l44bsd  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2801 "configure"
+#line 3159 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2808,7 +3166,7 @@ int main() {
 inet_aton()
 ; return 0; }
 EOF
-if { (eval echo configure:2812: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3170: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2840,22 +3198,22 @@ else
 fi
 
 		echo $ac_n "checking for main in -lresolv""... $ac_c" 1>&6
-echo "configure:2844: checking for main in -lresolv" >&5
+echo "configure:3202: checking for main in -lresolv" >&5
 ac_lib_var=`echo resolv'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lresolv  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2852 "configure"
+#line 3210 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2859: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3217: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2885,22 +3243,22 @@ fi
 		;;
 esac
 echo $ac_n "checking for main in -lm""... $ac_c" 1>&6
-echo "configure:2889: checking for main in -lm" >&5
+echo "configure:3247: checking for main in -lm" >&5
 ac_lib_var=`echo m'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lm  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2897 "configure"
+#line 3255 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2904: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3262: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2929,15 +3287,15 @@ fi
 
 
 echo $ac_n "checking for crypt in -lcrypt""... $ac_c" 1>&6
-echo "configure:2933: checking for crypt in -lcrypt" >&5
+echo "configure:3291: checking for crypt in -lcrypt" >&5
 ac_lib_var=`echo crypt'_'crypt | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lcrypt  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2941 "configure"
+#line 3299 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -2948,7 +3306,7 @@ int main() {
 crypt()
 ; return 0; }
 EOF
-if { (eval echo configure:2952: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3310: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -2971,22 +3329,22 @@ fi
 
 
 echo $ac_n "checking for main in -lpthread""... $ac_c" 1>&6
-echo "configure:2975: checking for main in -lpthread" >&5
+echo "configure:3333: checking for main in -lpthread" >&5
 ac_lib_var=`echo pthread'_'main | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
 LIBS="-lpthread  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 2983 "configure"
+#line 3341 "configure"
 #include "confdefs.h"
 
 int main() {
 main()
 ; return 0; }
 EOF
-if { (eval echo configure:2990: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3348: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3089,12 +3447,12 @@ for ac_func in \
 
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:3093: checking for $ac_func" >&5
+echo "configure:3451: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3098 "configure"
+#line 3456 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -3117,7 +3475,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:3121: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3479: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -3155,12 +3513,12 @@ case "$host" in
 		;;
 	*)
 		echo $ac_n "checking for poll""... $ac_c" 1>&6
-echo "configure:3159: checking for poll" >&5
+echo "configure:3517: checking for poll" >&5
 if eval "test \"`echo '$''{'ac_cv_func_poll'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3164 "configure"
+#line 3522 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char poll(); below.  */
@@ -3183,7 +3541,7 @@ poll();
 
 ; return 0; }
 EOF
-if { (eval echo configure:3187: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3545: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_func_poll=yes"
 else
@@ -3206,15 +3564,15 @@ fi
 esac
 
 echo $ac_n "checking if setresuid is implemented""... $ac_c" 1>&6
-echo "configure:3210: checking if setresuid is implemented" >&5
+echo "configure:3568: checking if setresuid is implemented" >&5
 if eval "test \"`echo '$''{'ac_cv_func_setresuid'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
   cat > conftest.$ac_ext <<EOF
-#line 3218 "configure"
+#line 3576 "configure"
 #include "confdefs.h"
 
 #include <stdlib.h>
@@ -3227,7 +3585,7 @@ else
   }
   
 EOF
-if { (eval echo configure:3231: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3589: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   ac_cv_func_setresuid="yes"
 else
@@ -3250,94 +3608,8 @@ EOF
 
 fi
 
-# Check whether --enable-gnuregex or --disable-gnuregex was given.
-if test "${enable_gnuregex+set}" = set; then
-  enableval="$enable_gnuregex"
-  USE_GNUREGEX=$enableval
-fi
-
-
-# Check whether --enable-hashkey or --disable-hashkey was given.
-if test "${enable_hashkey+set}" = set; then
-  enableval="$enable_hashkey"
-   case "$enableval" in
-  yes|sha)
-  	echo "Store key set to SHA"
-  	cat >> confdefs.h <<\EOF
-#define STORE_KEY_SHA 1
-EOF
-
-      	;;
-  md5)
-  	echo "Store key set to MD5"
-  	cat >> confdefs.h <<\EOF
-#define STORE_KEY_MD5 1
-EOF
-
-	;;
-  esac
-
-fi
-
-
-# Check whether --enable-xmalloc_debug or --disable-xmalloc_debug was given.
-if test "${enable_xmalloc_debug+set}" = set; then
-  enableval="$enable_xmalloc_debug"
-   if test "$enableval" = "yes" ; then
-    echo "Malloc debugging enabled"
-    cat >> confdefs.h <<\EOF
-#define XMALLOC_DEBUG 1
-EOF
-
-  fi
-
-fi
-
-
-# Check whether --enable-xmalloc_debug_count or --disable-xmalloc_debug_count was given.
-if test "${enable_xmalloc_debug_count+set}" = set; then
-  enableval="$enable_xmalloc_debug_count"
-   if test "$enableval" = "yes" ; then
-    echo "Malloc tracing enabled"
-    cat >> confdefs.h <<\EOF
-#define XMALLOC_COUNT 1
-EOF
-
-  fi
-
-fi
-
-
-# Check whether --enable-xmalloc_statistics or --disable-xmalloc_statistics was given.
-if test "${enable_xmalloc_statistics+set}" = set; then
-  enableval="$enable_xmalloc_statistics"
-   if test "$enableval" = "yes" ; then
-    echo "Malloc statistics enabled"
-    cat >> confdefs.h <<\EOF
-#define XMALLOC_STATISTICS 1
-EOF
-
-  fi
-
-fi
-
-
-# Check whether --enable-async_io or --disable-async_io was given.
-if test "${enable_async_io+set}" = set; then
-  enableval="$enable_async_io"
-   if test "$enableval" = "yes" ; then
-    echo "Async I/O enabled"
-    cat >> confdefs.h <<\EOF
-#define USE_ASYNC_IO 1
-EOF
-
-  fi
-
-fi
-
-
 echo $ac_n "checking if GNUregex needs to be compiled""... $ac_c" 1>&6
-echo "configure:3341: checking if GNUregex needs to be compiled" >&5
+echo "configure:3613: checking if GNUregex needs to be compiled" >&5
 if test "$ac_cv_func_regcomp" = "no" ; then
 	USE_GNUREGEX="yes"
 else
@@ -3369,12 +3641,12 @@ for ac_func in \
 
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:3373: checking for $ac_func" >&5
+echo "configure:3645: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3378 "configure"
+#line 3650 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
@@ -3397,7 +3669,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:3401: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:3673: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -3425,12 +3697,12 @@ done
 
 
 echo $ac_n "checking Default FD_SETSIZE value""... $ac_c" 1>&6
-echo "configure:3429: checking Default FD_SETSIZE value" >&5
+echo "configure:3701: checking Default FD_SETSIZE value" >&5
 if test "$cross_compiling" = yes; then
   DEFAULT_FD_SETSIZE=256
 else
   cat > conftest.$ac_ext <<EOF
-#line 3434 "configure"
+#line 3706 "configure"
 #include "confdefs.h"
 
 #if HAVE_STDIO_H
@@ -3454,7 +3726,7 @@ main() {
 }
 
 EOF
-if { (eval echo configure:3458: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3730: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   DEFAULT_FD_SETSIZE=`cat conftestval`
 else
@@ -3473,12 +3745,12 @@ EOF
 
 
 echo $ac_n "checking Maximum number of filedescriptors we can open""... $ac_c" 1>&6
-echo "configure:3477: checking Maximum number of filedescriptors we can open" >&5
+echo "configure:3749: checking Maximum number of filedescriptors we can open" >&5
 if test "$cross_compiling" = yes; then
   SQUID_MAXFD=256
 else
   cat > conftest.$ac_ext <<EOF
-#line 3482 "configure"
+#line 3754 "configure"
 #include "confdefs.h"
 
 #include <stdio.h>
@@ -3530,7 +3802,7 @@ main() {
 }
 
 EOF
-if { (eval echo configure:3534: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3806: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   SQUID_MAXFD=`cat conftestval`
 else
@@ -3549,12 +3821,12 @@ EOF
 
 
 echo $ac_n "checking Default UDP send buffer size""... $ac_c" 1>&6
-echo "configure:3553: checking Default UDP send buffer size" >&5
+echo "configure:3825: checking Default UDP send buffer size" >&5
 if test "$cross_compiling" = yes; then
   SQUID_UDP_SO_SNDBUF=16384
 else
   cat > conftest.$ac_ext <<EOF
-#line 3558 "configure"
+#line 3830 "configure"
 #include "confdefs.h"
 
 #include <stdlib.h>
@@ -3573,7 +3845,7 @@ main ()
 }
 
 EOF
-if { (eval echo configure:3577: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3849: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   SQUID_UDP_SO_SNDBUF=`cat conftestval`
 else
@@ -3592,12 +3864,12 @@ EOF
 
 
 echo $ac_n "checking Default UDP receive buffer size""... $ac_c" 1>&6
-echo "configure:3596: checking Default UDP receive buffer size" >&5
+echo "configure:3868: checking Default UDP receive buffer size" >&5
 if test "$cross_compiling" = yes; then
   SQUID_UDP_SO_RCVBUF=16384
 else
   cat > conftest.$ac_ext <<EOF
-#line 3601 "configure"
+#line 3873 "configure"
 #include "confdefs.h"
 
 #include <stdlib.h>
@@ -3616,7 +3888,7 @@ main ()
 }
 
 EOF
-if { (eval echo configure:3620: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3892: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   SQUID_UDP_SO_RCVBUF=`cat conftestval`
 else
@@ -3635,12 +3907,12 @@ EOF
 
 
 echo $ac_n "checking Default TCP send buffer size""... $ac_c" 1>&6
-echo "configure:3639: checking Default TCP send buffer size" >&5
+echo "configure:3911: checking Default TCP send buffer size" >&5
 if test "$cross_compiling" = yes; then
   SQUID_TCP_SO_SNDBUF=16384
 else
   cat > conftest.$ac_ext <<EOF
-#line 3644 "configure"
+#line 3916 "configure"
 #include "confdefs.h"
 
 #include <stdlib.h>
@@ -3659,7 +3931,7 @@ main ()
 }
 
 EOF
-if { (eval echo configure:3663: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3935: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   SQUID_TCP_SO_SNDBUF=`cat conftestval`
 else
@@ -3678,12 +3950,12 @@ EOF
 
 
 echo $ac_n "checking Default TCP receive buffer size""... $ac_c" 1>&6
-echo "configure:3682: checking Default TCP receive buffer size" >&5
+echo "configure:3954: checking Default TCP receive buffer size" >&5
 if test "$cross_compiling" = yes; then
   SQUID_TCP_SO_RCVBUF=16384
 else
   cat > conftest.$ac_ext <<EOF
-#line 3687 "configure"
+#line 3959 "configure"
 #include "confdefs.h"
 
 #include <stdlib.h>
@@ -3702,7 +3974,7 @@ main ()
 }
 
 EOF
-if { (eval echo configure:3706: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3978: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null
 then
   SQUID_TCP_SO_RCVBUF=`cat conftestval`
 else
@@ -3721,19 +3993,19 @@ EOF
 
 
 echo $ac_n "checking if sys_errlist is already defined""... $ac_c" 1>&6
-echo "configure:3725: checking if sys_errlist is already defined" >&5
+echo "configure:3997: checking if sys_errlist is already defined" >&5
 if eval "test \"`echo '$''{'ac_cv_needs_sys_errlist'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3730 "configure"
+#line 4002 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main() {
 char *s = sys_errlist0;
 ; return 0; }
 EOF
-if { (eval echo configure:3737: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4009: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_needs_sys_errlist="no"
 else
@@ -3755,16 +4027,16 @@ EOF
 fi
 
 echo $ac_n "checking for libresolv _dns_ttl_ hack""... $ac_c" 1>&6
-echo "configure:3759: checking for libresolv _dns_ttl_ hack" >&5
+echo "configure:4031: checking for libresolv _dns_ttl_ hack" >&5
 cat > conftest.$ac_ext <<EOF
-#line 3761 "configure"
+#line 4033 "configure"
 #include "confdefs.h"
 extern int _dns_ttl_;
 int main() {
 return _dns_ttl_;
 ; return 0; }
 EOF
-if { (eval echo configure:3768: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
+if { (eval echo configure:4040: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 cat >> confdefs.h <<\EOF
@@ -3788,8 +4060,6 @@ if test "$ac_cv_lib_malloc_main" = "yes" ; then
 		XTRA_OBJS="$XTRA_OBJS /usr/lib/debug/mallocmap.o"
 	fi
 fi
-SNMPLIB='libsnmp.a'
-
 
 
 
@@ -3953,6 +4223,14 @@ s%@host_os@%$host_os%g
 s%@CACHE_HTTP_PORT@%$CACHE_HTTP_PORT%g
 s%@CACHE_ICP_PORT@%$CACHE_ICP_PORT%g
 s%@CC@%$CC%g
+s%@LIBDLMALLOC@%$LIBDLMALLOC%g
+s%@LIB_MALLOC@%$LIB_MALLOC%g
+s%@STORE_KEY@%$STORE_KEY%g
+s%@ASYNC_OBJS@%$ASYNC_OBJS%g
+s%@SQUID_PTHREAD_LIB@%$SQUID_PTHREAD_LIB%g
+s%@SNMPLIB@%$SNMPLIB%g
+s%@SNMP_OBJS@%$SNMP_OBJS%g
+s%@makesnmplib@%$makesnmplib%g
 s%@CPP@%$CPP%g
 s%@INSTALL_PROGRAM@%$INSTALL_PROGRAM%g
 s%@INSTALL_DATA@%$INSTALL_DATA%g
@@ -3975,7 +4253,6 @@ s%@PTHREADLIB@%$PTHREADLIB%g
 s%@REGEXLIB@%$REGEXLIB%g
 s%@LIBREGEX@%$LIBREGEX%g
 s%@LIBOBJS@%$LIBOBJS%g
-s%@SNMPLIB@%$SNMPLIB%g
 s%@XTRA_OBJS@%$XTRA_OBJS%g
 s%@XTRA_LIBS@%$XTRA_LIBS%g
 
@@ -3,13 +3,13 @@ dnl  Configuration input file for Squid
 dnl
 dnl  Duane Wessels, wessels@nlanr.net, February 1996 (autoconf v2.9)
 dnl
-dnl  $Id: configure.in,v 1.93 1998/01/04 00:17:52 wessels Exp $
+dnl  $Id: configure.in,v 1.94 1998/01/06 00:27:45 wessels Exp $
 dnl
 dnl
 dnl
 AC_INIT(src/main.c)
 AC_CONFIG_HEADER(include/autoconf.h)
-AC_REVISION($Revision: 1.93 $)dnl
+AC_REVISION($Revision: 1.94 $)dnl
 AC_PREFIX_DEFAULT(/usr/local/squid)
 AC_CONFIG_AUX_DIR(aux)
 
@@ -95,6 +95,240 @@ if test -z "$PRESET_LDFLAGS"; then
     fi
 fi
 
+dnl Enable optional modules
+AC_ARG_ENABLE(dlmalloc,
+[  --enable-dlmalloc       Compile & use the malloc package by Doug Lea],
+[
+ if test "$enableval" = "yes" ; then
+   LIBDLMALLOC="libdlmalloc.a"
+   LIB_MALLOC="-L../lib -ldlmalloc"
+   ac_cv_func_mallinfo="yes"
+   ac_cv_func_mallocblksize="no"
+   ac_cv_func_free="yes"
+   ac_cv_func_realloc="yes"
+   ac_cv_func_memalign="yes"
+   ac_cv_func_valloc="yes"
+   ac_cv_func_pvalloc="yes"
+   ac_cv_func_calloc="yes"
+   ac_cv_func_cfree="yes"
+   ac_cv_func_malloc_trim="yes"
+   ac_cv_func_malloc_usable_size="yes"
+   ac_cv_func_malloc_stats="yes"
+   ac_cv_func_mallinfo="yes"
+   ac_cv_func_mallopt="yes"
+   ac_cv_lib_gnumalloc="no"
+   ac_cv_lib_malloc="no"
+   ac_cv_enabled_dlmalloc="yes"
+   echo "dlmalloc build enabled"
+ elif test "x$ac_cv_enabled_dlmalloc" = "xyes"; then
+   # Ok. dlmalloc was enabled before, but now disabled.
+   # we have to test these again
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallocblksize
+   unset ac_cv_func_free
+   unset ac_cv_func_realloc
+   unset ac_cv_func_memalign
+   unset ac_cv_func_valloc
+   unset ac_cv_func_pvalloc
+   unset ac_cv_func_calloc
+   unset ac_cv_func_cfree
+   unset ac_cv_func_malloc_trim
+   unset ac_cv_func_malloc_usable_size
+   unset ac_cv_func_malloc_stats
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallopt
+   unset ac_cv_lib_gnumalloc
+   unset ac_cv_lib_malloc
+   unset ac_cv_enabled_dlmalloc
+ fi
+ ],[
+ if test "x$ac_cv_enabled_dlmalloc" = "xyes"; then
+   # Ok. dlmalloc was enabled before, but now disabled.
+   # we have to test these again
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallocblksize
+   unset ac_cv_func_free
+   unset ac_cv_func_realloc
+   unset ac_cv_func_memalign
+   unset ac_cv_func_valloc
+   unset ac_cv_func_pvalloc
+   unset ac_cv_func_calloc
+   unset ac_cv_func_cfree
+   unset ac_cv_func_malloc_trim
+   unset ac_cv_func_malloc_usable_size
+   unset ac_cv_func_malloc_stats
+   unset ac_cv_func_mallinfo
+   unset ac_cv_func_mallopt
+   unset ac_cv_lib_gnumalloc
+   unset ac_cv_lib_malloc
+   unset ac_cv_enabled_dlmalloc
+ fi
+ ])
+AC_SUBST(LIBDLMALLOC)
+AC_SUBST(LIB_MALLOC)
+
+AC_ARG_ENABLE(gnuregex,
+[  --enable-gnuregex       Compile GNUregex],
+[USE_GNUREGEX=$enableval])
+
+AC_ARG_ENABLE(new_storekey,
+[  --enable-new-storekey[=sha|md5]
+                          Use SHA/MD5 as store index, instead of URL],
+[ case "$enableval" in
+  yes|sha)
+  	echo "Store key set to SHA"
+  	AC_DEFINE(STORE_KEY_SHA)
+	STORE_KEY=sha
+      	;;
+  md5)
+  	echo "Store key set to MD5"
+  	AC_DEFINE(STORE_KEY_MD5)
+	STORE_KEY=md5
+	;;
+  no|url)
+	echo "Store key set to URL"
+	AC_DEFINE(STORE_KEY_URL)
+	STORE_KEY=url
+  esac
+],[
+  STORE_KEY=url
+  AC_DEFINE(STORE_KEY_URL)
+])
+AC_SUBST(STORE_KEY)
+
+AC_ARG_ENABLE(acltree,
+[  --enable-acltree[=bin|splay]
+                          Use tree function to store ACL lists],
+[ case "$enableval" in
+  splay)
+  	echo "ACL lists using BIN trees"
+  	AC_DEFINE(USE_SPLAY_TREE)
+      	;;
+  yes|bin)
+  	echo "ACL lists using SPLAY trees"
+  	AC_DEFINE(USE_BIN_TREE)
+	;;
+  esac
+])
+
+AC_ARG_ENABLE(xmalloc_debug,
+[  --enable-xmalloc-debug  Do some simple malloc debugging],
+[ if test "$enableval" = "yes" ; then
+    echo "Malloc debugging enabled"
+    AC_DEFINE(XMALLOC_DEBUG)
+  fi
+])
+
+AC_ARG_ENABLE(xmalloc_debug_count,
+[  --enable-xmalloc-debug-count
+                          Detailed trace of memory allocations],
+[ if test "$enableval" = "yes" ; then
+    echo "Malloc tracing enabled"
+    AC_DEFINE(XMALLOC_COUNT)
+  fi
+])
+
+AC_ARG_ENABLE(xmalloc_statistics,
+[  --enable-xmalloc-statistics
+                          Show malloc statistics in status page],
+[ if test "$enableval" = "yes" ; then
+    echo "Malloc statistics enabled"
+    AC_DEFINE(XMALLOC_STATISTICS)
+  fi
+])
+
+AC_ARG_ENABLE(async_io,
+[  --enable-async-io       Do ASYNC disk I/O using threads],
+[ if test "$enableval" = "yes" ; then
+    echo "Async I/O enabled"
+    AC_DEFINE(USE_ASYNC_IO)
+    ASYNC_OBJS='$(ASYNC_OBJS)'
+    SQUID_PTHREAD_LIB='$(PTHREAD_LIB)'
+  fi
+])
+AC_SUBST(ASYNC_OBJS)
+AC_SUBST(SQUID_PTHREAD_LIB)
+
+AC_ARG_ENABLE(icmp,
+[  --enable-icmp           Enable ICMP pinging],
+[ if test "$enableval" = "yes" ; then
+    echo "ICMP enabled"
+    AC_DEFINE(USE_ICMP)
+  fi
+])
+
+AC_ARG_ENABLE(delay_hack,
+[  --enable-delay-hack     Enable delay hack to limit bandwith usage],
+[ if test "$enableval" = "yes" ; then
+    echo "Delay hack enabled"
+    AC_DEFINE(DELAY_HACK)
+  fi
+])
+
+AC_ARG_ENABLE(useragent_log,
+[  --enable-useragent-log  Enable logging of User-Agent header],
+[ if test "$enableval" = "yes" ; then
+    echo "User-Agent logging enabled"
+    AC_DEFINE(USE_USERAGENT_LOG)
+  fi
+])
+
+AC_ARG_ENABLE(kill_parent,
+[  --enable-kill-parent    Kill parent on shutdown],
+[ if test "$enableval" = "yes" ; then
+    echo "Kill parent on shutdown"
+    AC_DEFINE(KILL_PARENT_OPT)
+  fi
+])
+
+AC_ARG_ENABLE(snmp,
+[  --enable-snmp           Enable SNMP monitoring],
+[ if test "$enableval" = "yes" ; then
+    echo "SNMP monitoring enabled"
+    AC_DEFINE(SQUID_SNMP)
+    SNMPLIB='-L../snmplib -lsnmp'
+    SNMP_OBJS='$(SNMP_OBJS)'
+    makesnmplib=snmplib
+  fi
+])
+AC_SUBST(SNMPLIB)
+AC_SUBST(SNMP_OBJS)
+AC_SUBST(makesnmplib)
+
+AC_ARG_ENABLE(time_hack,
+[  --enable-time-hack      Update internal timestamp only once per second],
+[ if test "$enableval" = "yes" ; then
+    echo "Update internal timestamp only once per second"
+    AC_DEFINE(ALARM_UPDATES_TIME)
+  fi
+])
+
+AC_ARG_ENABLE(cachemgr_hostname,
+[  --enable-cachemgr-hostname[=hostname]
+                          Make cachemgr.cgi default to this host],
+[  case $enableval in
+   yes)
+       AC_DEFINE(CACHEMGR_HOSTNAME,[getfullhostname()])
+       echo "Cachemgr default hostname == host where cachemgr runs"
+       ;;
+   no)
+       : # Nothing to do..
+       ;;
+   *)
+       AC_DEFINE_UNQUOTED(CACHEMGR_HOSTNAME,"${enableval}")
+       echo "Cachemgr default hostname set to ${enableval}"
+       ;;
+   esac
+])
+
+AC_ARG_ENABLE(arp_acl,
+[  --enable-arp-acl        Enable use of ARP ACL lists (ether address)],
+[  if test "$enableval" = "yes" ; then
+     echo "ARP ACL lists enabled (ether address)"
+     AC_DEFINE(USE_ARP_ACL)
+   fi
+])
+
 dnl Check for programs
 AC_PROG_CPP
 AC_PROG_INSTALL
@@ -131,7 +365,6 @@ dnl Check for headers
 AC_HEADER_DIRENT
 AC_HEADER_STDC
 
-
 AC_CHECK_HEADERS( \
 	alloca.h \
 	arpa/inet.h \
@@ -308,8 +541,8 @@ dnl We use crypt(3) which may be in libc, or in libcrypt (eg FreeBSD)
 AC_CHECK_LIB(crypt, crypt, [CRYPTLIB="-lcrypt"])
 AC_SUBST(CRYPTLIB)
 
-dnl Check for libcrypt
-dnl We use crypt(3) which may be in libc, or in libcrypt (eg FreeBSD)
+dnl Check for pthreads
+dnl We use pthreads when doing ASYNC I/O
 AC_CHECK_LIB(pthread, main, [PTHREADLIB="-lpthread"])
 AC_SUBST(PTHREADLIB)
 
@@ -429,59 +662,6 @@ if test "$ac_cv_func_setresuid" = "yes" ; then
   AC_DEFINE(HAVE_SETRESUID)
 fi
 
-AC_ARG_ENABLE(gnuregex,
-[  --enable-gnuregex       Compile GNUregex],
-[USE_GNUREGEX=$enableval])
-
-AC_ARG_ENABLE(hashkey,
-[  --enable-hashkey[=sha|md5]
-                          Use hash function as store index, instead of URL],
-[ case "$enableval" in
-  yes|sha)
-  	echo "Store key set to SHA"
-  	AC_DEFINE(STORE_KEY_SHA)
-      	;;
-  md5)
-  	echo "Store key set to MD5"
-  	AC_DEFINE(STORE_KEY_MD5)
-	;;
-  esac
-])
-
-AC_ARG_ENABLE(xmalloc_debug,
-[  --enable-xmalloc-debug  Do some simple malloc debugging],
-[ if test "$enableval" = "yes" ; then
-    echo "Malloc debugging enabled"
-    AC_DEFINE(XMALLOC_DEBUG)
-  fi
-])
-
-AC_ARG_ENABLE(xmalloc_debug_count,
-[  --enable-xmalloc-debug-count
-                          Detailed trace of memory allocations],
-[ if test "$enableval" = "yes" ; then
-    echo "Malloc tracing enabled"
-    AC_DEFINE(XMALLOC_COUNT)
-  fi
-])
-
-AC_ARG_ENABLE(xmalloc_statistics,
-[  --enable-xmalloc-statistics
-                          Show malloc statistics in status page],
-[ if test "$enableval" = "yes" ; then
-    echo "Malloc statistics enabled"
-    AC_DEFINE(XMALLOC_STATISTICS)
-  fi
-])
-
-AC_ARG_ENABLE(async_io,
-[  --enable-async-io       Use ASYNC disk I/O],
-[ if test "$enableval" = "yes" ; then
-    echo "Async I/O enabled"
-    AC_DEFINE(USE_ASYNC_IO)
-  fi
-])
-
 AC_MSG_CHECKING(if GNUregex needs to be compiled)
 if test "$ac_cv_func_regcomp" = "no" ; then
 	USE_GNUREGEX="yes"
@@ -718,8 +898,6 @@ if test "$ac_cv_lib_malloc_main" = "yes" ; then
 		XTRA_OBJS="$XTRA_OBJS /usr/lib/debug/mallocmap.o"
 	fi
 fi
-SNMPLIB='libsnmp.a'
-AC_SUBST(SNMPLIB)
 
 AC_SUBST(XTRA_OBJS)
 
@@ -1,4 +1,25 @@
 /* include/autoconf.h.in.  Generated automatically from configure.in by autoheader.  */
+/* 
+ * All configurable options are enabled by using --enable-....
+ * when running configure. See configure --help for a list
+ * of all available options.
+ *
+ * You are free to edit this file, but it will be overwritten
+ * each time you run configure. You may need to edit this file
+ * if configure falsely picks up a library function or structure
+ * that doesn't really work on your system.
+ *
+ * Another way to block a function that should not be detected
+ * is to
+ * setenv ac_cv_func_<functionname> no
+ * before running configure, as in
+ * setenv ac_cv_func_setresuid no
+ *
+ * It is possible to enable some of the configurable options
+ * by editing this file alone, but some of them requires changes
+ * in the Makefiles, wich is done automatically by configure.
+ *
+ */
 
 /* Define if using alloca.c.  */
 #undef C_ALLOCA
@@ -44,6 +65,101 @@
    byte first (like Motorola and SPARC, unlike Intel and VAX).  */
 #undef WORDS_BIGENDIAN
 
+/*********************************
+ * START OF CONFIGURABLE OPTIONS *
+ *********************************/
+/*
+ * If you are upset that the cachemgr.cgi form comes up with the hostname
+ * field blank, then define this to getfullhostname()
+ */
+#undef CACHEMGR_HOSTNAME
+
+/*
+ * Normally Squid uses URLs as cache keys, and these are kept in memory.
+ * For large caches, this can become a significant use of memory.  Define
+ * one of the options below for alternatives.  SHA (Secure Hash Algorithm)
+ * is a 20-byte cryptographic digest.  MD5 is a 16-byte cryptographic
+ * digest.  Calculating SHA digests requires more CPU, and MD5 digests
+ * are slighly more likely to have collisions.
+ */
+#undef STORE_KEY_SHA
+#undef STORE_KEY_MD5
+#undef STORE_KEY_URL
+
+/* Define to do simple malloc debugging */
+#undef XMALLOC_DEBUG
+
+/* Define to have malloc statistics */
+#undef XMALLOC_STATISTICS
+
+/* Define to have a detailed trace of memory allocations */
+#undef XMALLOC_COUNT
+
+/* Define to use async disk I/O operations */
+#undef USE_ASYNC_IO
+
+/*
+ * If you want to use Squid's ICMP features (highly recommended!) then
+ * define this.  When USE_ICMP is defined, Squid will send ICMP pings
+ * to origin server sites.  This information is used in numerous ways:
+ *         - Sent in ICP replies so neighbor caches know how close
+ *           you are to the source.
+ *         - For finding the closest instance of a URN.
+ *         - With the 'test_reachability' option.  Squid will return
+ *           ICP_OP_MISS_NOFETCH for sites which it cannot ping.
+ */
+#undef USE_ICMP
+
+/*
+ * David Luyer's Delay hack
+ */
+#undef DELAY_HACK
+
+/*
+ * If you want to log User-Agent request header values, define this.
+ * By default, they are written to useragent.log in the Squid log
+ * directory.
+ */
+#undef USE_USERAGENT_LOG
+
+/*
+ * A dangerous feature which causes Squid to kill its parent process
+ * (presumably the RunCache script) upon receipt of SIGTERM or SIGINT.
+ * Use with caution.
+ */
+#undef KILL_PARENT_OPT
+
+/* Define to enable SNMP monitoring of Squid */
+#undef SQUID_SNMP
+
+/*
+ * Normally Squid's ACL information is stored as singly-linked lists.
+ * When matches are found, they are moved to the top of the list.
+ * However, these options allow you to explore other searching structures
+ * such as splay trees and binary trees.  Define only one of these.
+ */
+#undef USE_SPLAY_TREE
+#undef USE_BIN_TREE
+
+/*
+ * Squid frequently calls gettimeofday() for accurate timestamping.
+ * If you are concerned that gettimeofday() is called too often, and
+ * could be causing performance degradation, then you can define
+ * ALARM_UPDATES_TIME and cause Squid's clock to be updated at regular
+ * intervals (one second) with ALARM signals.
+ */
+#undef ALARM_UPDATES_TIME
+
+/*
+ * Define this to include code which lets you specify access control
+ * elements based on ethernet hardware addresses.  This code uses
+ * functions found in 4.4 BSD derviations (e.g. FreeBSD, ?).
+ */
+#undef USE_ARP_ACL
+/********************************
+ *  END OF CONFIGURABLE OPTIONS *
+ ********************************/
+
 /* Define if struct tm has tm_gmtoff member */
 #undef HAVE_TM_GMTOFF
 
@@ -92,27 +208,13 @@
 /* signed size_t, grr */
 #undef ssize_t
 
-/* Define if you have the setresuid function.  */
+/*
+ * Yay! Another Linux brokenness.  Its not good enough to know that
+ * setresuid() exists, because RedHat 5.0 declare setresuid() but
+ * doesn't implement it.
+ */
 #undef HAVE_SETRESUID
 
-/* Define if you want to use SHA as store index key. */
-#undef STORE_KEY_SHA
-
-/* Define if you want to use MD5 as store index key. */
-#undef STORE_KEY_MD5
-
-/* Define to do simple malloc debugging */
-#undef XMALLOC_DEBUG
-
-/* Define to have malloc statistics */
-#undef XMALLOC_STATISTICS
-
-/* Define to have a detailed trace of memory allocations */
-#undef XMALLOC_COUNT
-
-/* Define to use async disk I/O operations */
-#undef USE_ASYNC_IO
-
 /* Define if you have struct rusage */
 #undef HAVE_STRUCT_RUSAGE
 
@@ -1,5 +1,5 @@
 #
-#  $Id: Makefile.in,v 1.30 1997/12/21 11:01:51 kostas Exp $
+#  $Id: Makefile.in,v 1.31 1998/01/06 00:27:50 wessels Exp $
 #
 prefix		= @prefix@
 srcdir		= @srcdir@
@@ -35,9 +35,11 @@ UTILOBJS	= rfc1123.o \
 		  md5.o \
 		  radix.o \
 		  String.o \
+		  stub_memaccount.o \
 		  $(LIBOBJS)
 REGEXOBJS	= GNUregex.o
-LIBS		= libmiscutil.a @LIBREGEX@
+DLMALLOCOBJS	= malloc-2.6.4.o
+LIBS		= libmiscutil.a @LIBREGEX@ @LIBDLMALLOC@
 
 CFLAGS		= $(AC_CFLAGS) $(INCLUDE)
 
@@ -55,6 +57,11 @@ libregex.a: $(REGEXOBJS)
 	$(AR_R) $@ $(REGEXOBJS)
 	$(RANLIB) $@
 
+libdlmalloc.a: $(DLMALLOCOBJS)
+	$(RM) -f $@
+	$(AR_R) $@ $(DLMALLOCOBJS)
+	$(RANLIB) $@
+
 clean:
 	-rm -f *.o $(LIBS) core
 
@@ -38,7 +38,7 @@ splay_insert(void *data, splayNode * top, SPCMP * compare)
 	return new;
     } else {
 	/* duplicate entry */
-	free(new);
+	xfree(new);
 	return top;
     }
 }
@@ -1,6 +1,6 @@
 
 /*
- * $Id: util.c,v 1.38 1998/01/05 00:57:55 wessels Exp $
+ * $Id: util.c,v 1.39 1998/01/06 00:27:53 wessels Exp $
  *
  * DEBUG: 
  * AUTHOR: Harvest Derived
@@ -259,16 +259,22 @@ mallocblksize(void *p)
 static void
 xmalloc_count(void *p, int sign)
 {
+    int statMemoryAccounted();
+    static size_t last_total=0,last_accounted=0,last_mallinfo=0;
+    struct mallinfo mp=mallinfo();
+    size_t accounted=statMemoryAccounted();
+    size_t mi = mp.uordblks + mp.usmblks + mp.hblkhd;
     size_t sz;
     static size_t total = 0;
-    int memoryAccounted();
-    int mallinfoTotal();
     sz = mallocblksize(p) * sign;
     total += sz;
-    fprintf(stderr, "xmalloc_count=%9d  accounted=%9d  mallinfo=%9d\n",
-	(int) total,
-	memoryAccounted(),
-	mallinfoTotal());
+    fprintf(stderr, "xmalloc_count=%7d/%9d  accounted=%7d/%9d  mallinfo=%7d%9d\n",
+	(int) total - last_total, (int) total,
+	(int) accounted - last_accounted, (int) accounted,
+	(int) mi - last_mallinfo, (int) mi);
+    last_total=total;
+    last_accounted=accounted;
+    last_mallinfo=mi;
 }
 
 #endif /* XMALLOC_COUNT */
@@ -12,7 +12,7 @@ prefix		= @prefix@
 VERSION		= 3.4
 ALIB		= libsnmp.a
 
-TARG		= @SNMPLIB@
+TARG		= libsnmp.a
 
 CSRCS		= snmp_client.c snmp.c snmp_auth.c asn1.c mib.c \
 		  parse.c snmp_api.c usec.c snmpdump.c
@@ -1,17 +1,11 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.111 1998/01/02 02:05:19 wessels Exp $
+#  $Id: Makefile.in,v 1.112 1998/01/06 00:27:55 wessels Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
 
-# define all three for SNMP support
-#SQUID_SNMP		= -DSQUID_SNMP=1
-#SQUID_SNMP_LIBS 	= -L../snmplib -lsnmp
-
-DEFINES         = $(SQUID_SNMP)
-
 prefix		= @prefix@
 exec_prefix	= @exec_prefix@
 top_srcdir	= @top_srcdir@
@@ -48,6 +42,7 @@ PERL            = @PERL@
 CRYPTLIB	= @CRYPTLIB@
 REGEXLIB	= @REGEXLIB@
 PTHREADLIB	= @PTHREADLIB@
+SNMPLIB		= @SNMPLIB@
 AC_CFLAGS	= @CFLAGS@
 LDFLAGS		= @LDFLAGS@
 XTRA_LIBS	= @XTRA_LIBS@
@@ -59,8 +54,8 @@ SHELL		= /bin/sh
 
 INCLUDE		= -I. -I../include -I$(srcdir)/../include
 CFLAGS 		= $(AC_CFLAGS) $(INCLUDE) $(DEFINES)
-SQUID_LIBS	= -L../lib $(CRYPTLIB) $(REGEXLIB) $(PTHREADLIB) \
-		  -lmiscutil $(XTRA_LIBS)
+SQUID_LIBS	= -L../lib $(CRYPTLIB) $(REGEXLIB) @PTHREADLIB@ \
+		  $(SNMPLIB) -lmiscutil $(XTRA_LIBS)
 CLIENT_LIBS	= -L../lib -lmiscutil $(XTRA_LIBS)
 DNSSERVER_LIBS	= -L../lib -lmiscutil $(XTRA_LIBS)
 PINGER_LIBS	= -L../lib -lmiscutil $(XTRA_LIBS)
@@ -72,9 +67,8 @@ CGIPROGS	= cachemgr.cgi
 OBJS	 	= \
 		access_log.o \
 		acl.o \
-		aiops.o \
 		asn.o \
-		async_io.o \
+		@ASYNC_OBJS@ \
 		cache_cf.o \
 		cbdata.o \
 		client_db.o \
@@ -113,17 +107,15 @@ OBJS	 	= \
 		redirect.o \
 		refresh.o \
 		send-announce.o \
-		$(SNMP_OBJS) \
+		@SNMP_OBJS@ \
 		ssl.o \
 		stack.o \
 		stat.o \
 		stmem.o \
 		store.o \
 		store_clean.o \
 		store_dir.o \
-		store_key_md5.o \
-		store_key_sha.o \
-		store_key_url.o \
+		store_key_@STORE_KEY@.o \
 		string_arrays.o \
 		tools.o \
 		unlinkd.o \
@@ -139,6 +131,10 @@ SNMP_OBJS	= \
                 snmp_agent.o \
                 snmp_config.o 
 
+ASYNC_OBJS	= \
+		aiops.o \
+		async_io.o
+		
 DEFAULTS        = \
 	-DDEFAULT_CONFIG_FILE=\"$(DEFAULT_CONFIG_FILE)\"
 
@@ -147,7 +143,7 @@ all:    squid.conf $(PROGS) $(UTILS) $(SUID_UTILS) $(CGIPROGS)
 $(OBJS): ../include/version.h
 
 squid:	$(OBJS)
-	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(SQUID_SNMP_LIBS) $(SQUID_LIBS)
+	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(SQUID_LIBS)
 
 globals.o: globals.c Makefile
 	$(CC) -c $< $(CFLAGS) $(DEFAULTS)
@@ -300,7 +296,7 @@ clean:
 	-rm -f cf_gen cf_parser.c cf.data globals.c string_arrays.c
 
 distclean:	clean
-	-rm -f Makefile squid.conf squid.conf.pre options.h
+	-rm -f Makefile squid.conf squid.conf.pre
 
 tags:
 	ctags *.[ch] ../include/*.h ../lib/*.[ch]
@@ -1,9 +1,5 @@
-
-
-
-
 /*
- * $Id: client.cc,v 1.47 1998/01/02 02:06:03 wessels Exp $
+ * $Id: client.cc,v 1.48 1998/01/06 00:27:56 wessels Exp $
  *
  * DEBUG: section 0     WWW Client
  * AUTHOR: Harvest Derived
@@ -225,7 +221,7 @@ main(int argc, char *argv[])
     if (strncmp(url, "mgr:", 4) == 0) {
 	char *t = xstrdup(url + 4);
 	snprintf(url, BUFSIZ, "cache_object://%s/%s", hostname, t);
-	free(t);
+	xfree(t);
     }
     snprintf(msg, BUFSIZ, "%s %s HTTP/1.0\r\n", method, url);
     if (reload) {
@@ -1,4 +1,3 @@
-#ifdef SQUID_SNMP
 /*
  * Simple Network Management Protocol (RFC 1067).
  *
@@ -991,4 +990,3 @@ bulk_var_op_list(sn_data, length, out_sn_data, out_length, non_repeaters, max_re
     *index = 0;
     return SNMP_ERR_NOERROR;
 }
-#endif
@@ -1,6 +1,6 @@
 
 /*
- * $Id: squid.h,v 1.151 1998/01/05 21:44:42 wessels Exp $
+ * $Id: squid.h,v 1.152 1998/01/06 00:28:01 wessels Exp $
  *
  * AUTHOR: Duane Wessels
  *
@@ -32,7 +32,6 @@
 #define SQUID_H
 
 #include "config.h"
-#include "options.h"
 
 /*
  * On some systems, FD_SETSIZE is set to something lower than the