----++++src/auth/SchemeConfig.cc
@@ -126,6 +126,10 @@ Auth::SchemeConfig::parse(Auth::SchemeConfig * scheme, int, char *param_str)
             debugs(29, DBG_CRITICAL, &quot;FATAL: Unexpected argument &#39;&quot; &lt;&lt; t &lt;&lt; &quot;&#39; after request_format specification&quot;);
             self_destruct();
         }
+    } else if (strcmp(param_str, &quot;keep_alive&quot;) == 0) {
+        parse_onoff(&amp;keep_alive);
+    } else if (strcmp(param_str, &quot;utf8&quot;) == 0) {
+        parse_onoff(&amp;utf8);
     } else {
         debugs(29, DBG_CRITICAL, &quot;Unrecognised &quot; &lt;&lt; scheme-&gt;type() &lt;&lt; &quot; auth scheme parameter &#39;&quot; &lt;&lt; param_str &lt;&lt; &quot;&#39;&quot;);
     }
@@ -137,23 +141,31 @@ Auth::SchemeConfig::dump(StoreEntry *entry, const char *name, Auth::SchemeConfig
     if (!authenticateProgram)
         return false; // not configured
 
+    const char *type = scheme-&gt;type();
+
     wordlist *list = authenticateProgram;
-    storeAppendPrintf(entry, "%s %s", name, scheme-&gt;type());
+    storeAppendPrintf(entry, "%s %s", name, type);
     while (list != NULL) {
         storeAppendPrintf(entry, &quot; %s&quot;, list-&gt;key);
         list = list-&gt;next;
     }
     storeAppendPrintf(entry, &quot;\n&quot;);
 
-    storeAppendPrintf(entry, "%s %s realm " SQUIDSBUFPH "\n", name, scheme-&gt;type(), SQUIDSBUFPRINT(realm));
+    storeAppendPrintf(entry, "%s %s realm " SQUIDSBUFPH "\n", name, type, SQUIDSBUFPRINT(realm));
 
     storeAppendPrintf(entry, &quot;%s %s children %d startup=%d idle=%d concurrency=%d\n&quot;,
-                      name, scheme-&gt;type(),
+                      name, type,
                       authenticateChildren.n_max, authenticateChildren.n_startup,
                       authenticateChildren.n_idle, authenticateChildren.concurrency);
 
-    if (keyExtrasLine.size() &gt; 0)
-        storeAppendPrintf(entry, &quot;%s %s key_extras \&quot;%s\&quot;\n&quot;, name, scheme-&gt;type(), keyExtrasLine.termedBuf());
+    if (keyExtrasLine.size() &gt; 0) // default is none
+        storeAppendPrintf(entry, &quot;%s %s key_extras \&quot;%s\&quot;\n&quot;, name, type, keyExtrasLine.termedBuf());
+
+    if (!keep_alive) // default is on
+        storeAppendPrintf(entry, &quot;%s %s keep_alive off\n&quot;, name, type);
+
+    if (utf8) // default is off
+        storeAppendPrintf(entry, &quot;%s %s utf8 on\n&quot;, name, type);
 
     return true;
 }
----++++src/auth/SchemeConfig.h
@@ -53,7 +53,7 @@ class SchemeConfig
     /// Call this method if you need a guarantee that all auth schemes has been
     /// already configured.
     static SchemeConfig *GetParsed(const char *proxy_auth);
-    SchemeConfig() : authenticateChildren(20), authenticateProgram(NULL), keyExtras(NULL) {}
+    SchemeConfig() : authenticateChildren(20) {}
 
     virtual ~SchemeConfig() {}
 
@@ -126,9 +126,11 @@ class SchemeConfig
 
 public:
     Helper::ChildConfig authenticateChildren;
-    wordlist *authenticateProgram; ///&lt; Helper program to run, includes all parameters
+    wordlist *authenticateProgram = nullptr; ///&lt; Helper program to run, includes all parameters
     String keyExtrasLine;  ///&lt; The format of the request to the auth helper
-    Format::Format *keyExtras; ///&lt; The compiled request format
+    Format::Format *keyExtras = nullptr; ///&lt; The compiled request format
+    int keep_alive = 1; ///&lt; whether to close the connection on auth challenges. default: on
+    int utf8 = 0; ///&lt; wheter to accept UTF-8 characterset instead of ASCII. default: off
 
 protected:
     /// RFC 7235 section 2.2 - Protection Space (Realm)
----++++src/auth/basic/Config.cc
@@ -119,14 +119,12 @@ Auth::Basic::Config::dump(StoreEntry * entry, const char *name, Auth::SchemeConf
 
     storeAppendPrintf(entry, &quot;%s basic credentialsttl %d seconds\n&quot;, name, (int) credentialsTTL);
     storeAppendPrintf(entry, &quot;%s basic casesensitive %s\n&quot;, name, casesensitive ? &quot;on&quot; : &quot;off&quot;);
-    storeAppendPrintf(entry, &quot;%s basic utf8 %s\n&quot;, name, utf8 ? &quot;on&quot; : &quot;off&quot;);
     return true;
 }
 
 Auth::Basic::Config::Config() :
     credentialsTTL( 2*60*60 ),
-    casesensitive(0),
-    utf8(0)
+    casesensitive(0)
 {
     static const SBuf defaultRealm(&quot;Squid proxy-caching web server&quot;);
     realm = defaultRealm;
@@ -139,8 +137,6 @@ Auth::Basic::Config::parse(Auth::SchemeConfig * scheme, int n_configured, char *
         parse_time_t(&amp;credentialsTTL);
     } else if (strcmp(param_str, &quot;casesensitive&quot;) == 0) {
         parse_onoff(&amp;casesensitive);
-    } else if (strcmp(param_str, &quot;utf8&quot;) == 0) {
-        parse_onoff(&amp;utf8);
     } else
         Auth::SchemeConfig::parse(scheme, n_configured, param_str);
 }
----++++src/auth/basic/Config.h
@@ -42,7 +42,6 @@ class Config : public Auth::SchemeConfig
 public:
     time_t credentialsTTL;
     int casesensitive;
-    int utf8;
 
 private:
     char * decodeCleartext(const char *httpAuthHeader);
----++++src/auth/digest/Config.cc
@@ -487,7 +487,6 @@ Auth::Digest::Config::dump(StoreEntry * entry, const char *name, Auth::SchemeCon
                       name, &quot;digest&quot;, noncemaxuses,
                       name, &quot;digest&quot;, (int) noncemaxduration,
                       name, &quot;digest&quot;, (int) nonceGCInterval);
-    storeAppendPrintf(entry, &quot;%s digest utf8 %s\n&quot;, name, utf8 ? &quot;on&quot; : &quot;off&quot;);
     return true;
 }
 
@@ -600,8 +599,7 @@ Auth::Digest::Config::Config() :
     noncemaxuses(50),
     NonceStrictness(0),
     CheckNonceCount(1),
-    PostWorkaround(0),
-    utf8(0)
+    PostWorkaround(0)
 {}
 
 void
@@ -619,8 +617,6 @@ Auth::Digest::Config::parse(Auth::SchemeConfig * scheme, int n_configured, char
         parse_onoff(&amp;CheckNonceCount);
     } else if (strcmp(param_str, &quot;post_workaround&quot;) == 0) {
         parse_onoff(&amp;PostWorkaround);
-    } else if (strcmp(param_str, &quot;utf8&quot;) == 0) {
-        parse_onoff(&amp;utf8);
     } else
         Auth::SchemeConfig::parse(scheme, n_configured, param_str);
 }
----++++src/auth/digest/Config.h
@@ -94,7 +94,6 @@ class Config : public Auth::SchemeConfig
     int NonceStrictness;
     int CheckNonceCount;
     int PostWorkaround;
-    int utf8;
 };
 
 } // namespace Digest
----++++src/auth/negotiate/Config.cc
@@ -73,28 +73,6 @@ Auth::Negotiate::Config::done()
     debugs(29, DBG_IMPORTANT, &quot;Reconfigure: Negotiate authentication configuration cleared.&quot;);
 }
 
-bool
-Auth::Negotiate::Config::dump(StoreEntry * entry, const char *name, Auth::SchemeConfig * scheme) const
-{
-    if (!Auth::SchemeConfig::dump(entry, name, scheme))
-        return false;
-
-    storeAppendPrintf(entry, &quot;%s negotiate keep_alive %s\n&quot;, name, keep_alive ? &quot;on&quot; : &quot;off&quot;);
-    return true;
-}
-
-Auth::Negotiate::Config::Config() : keep_alive(1)
-{ }
-
-void
-Auth::Negotiate::Config::parse(Auth::SchemeConfig * scheme, int n_configured, char *param_str)
-{
-    if (strcmp(param_str, &quot;keep_alive&quot;) == 0) {
-        parse_onoff(&amp;keep_alive);
-    } else
-        Auth::SchemeConfig::parse(scheme, n_configured, param_str);
-}
-
 const char *
 Auth::Negotiate::Config::type() const
 {
----++++src/auth/negotiate/Config.h
@@ -25,21 +25,15 @@ namespace Negotiate
 class Config : public Auth::SchemeConfig
 {
 public:
-    Config();
     virtual bool active() const;
     virtual bool configured() const;
     virtual Auth::UserRequest::Pointer decode(char const *proxy_auth, const char *requestRealm);
     virtual void done();
     virtual void rotateHelpers();
-    virtual bool dump(StoreEntry *, const char *, Auth::SchemeConfig *) const;
     virtual void fixHeader(Auth::UserRequest::Pointer, HttpReply *, Http::HdrType, HttpRequest *);
     virtual void init(Auth::SchemeConfig *);
-    virtual void parse(Auth::SchemeConfig *, int, char *);
     virtual void registerWithCacheManager(void);
     virtual const char * type() const;
-
-public:
-    int keep_alive;
 };
 
 } // namespace Negotiate
----++++src/auth/ntlm/Config.cc
@@ -74,28 +74,6 @@ Auth::Ntlm::Config::done()
     debugs(29, DBG_IMPORTANT, &quot;Reconfigure: NTLM authentication configuration cleared.&quot;);
 }
 
-bool
-Auth::Ntlm::Config::dump(StoreEntry * entry, const char *name, Auth::SchemeConfig * scheme) const
-{
-    if (!Auth::SchemeConfig::dump(entry, name, scheme))
-        return false;
-
-    storeAppendPrintf(entry, &quot;%s ntlm keep_alive %s\n&quot;, name, keep_alive ? &quot;on&quot; : &quot;off&quot;);
-    return true;
-}
-
-Auth::Ntlm::Config::Config() : keep_alive(1)
-{ }
-
-void
-Auth::Ntlm::Config::parse(Auth::SchemeConfig * scheme, int n_configured, char *param_str)
-{
-    if (strcmp(param_str, &quot;keep_alive&quot;) == 0) {
-        parse_onoff(&amp;keep_alive);
-    } else
-        Auth::SchemeConfig::parse(scheme, n_configured, param_str);
-}
-
 const char *
 Auth::Ntlm::Config::type() const
 {
----++++src/auth/ntlm/Config.h
@@ -28,21 +28,15 @@ namespace Ntlm
 class Config : public Auth::SchemeConfig
 {
 public:
-    Config();
     virtual bool active() const;
     virtual bool configured() const;
     virtual Auth::UserRequest::Pointer decode(char const *proxy_auth, const char *requestRealm);
     virtual void done();
     virtual void rotateHelpers();
-    virtual bool dump(StoreEntry *, const char *, Auth::SchemeConfig *) const;
     virtual void fixHeader(Auth::UserRequest::Pointer, HttpReply *, Http::HdrType, HttpRequest *);
     virtual void init(Auth::SchemeConfig *);
-    virtual void parse(Auth::SchemeConfig *, int, char *);
     virtual void registerWithCacheManager(void);
     virtual const char * type() const;
-
-public:
-    int keep_alive;
 };
 
 } // namespace Ntlm
----++++src/cf.data.pre
@@ -617,16 +617,26 @@ DOC_START
 		NOTE: NTLM and Negotiate schemes do not support concurrency
 			in the Squid code module even though some helpers can.
 
+	&quot;keep_alive&quot; on|off
+		If you experience problems with PUT/POST requests when using
+		the NTLM or Negotiate schemes then you can try setting this
+		to off. This will cause Squid to forcibly close the connection
+		on the initial request where the browser asks which schemes
+		are supported by the proxy.
 
-IF HAVE_AUTH_MODULE_BASIC
-	=== Basic authentication parameters ===
+		For Basic and Digest this parameter is ignored.
 
 	&quot;utf8&quot; on|off
 		HTTP uses iso-latin-1 as character set, while some
 		authentication backends such as LDAP expects UTF-8. If this is
 		set to on Squid will translate the HTTP iso-latin-1 charset to
 		UTF-8 before sending the username and password to the helper.
 
+		For NTLM and Negotiate this parameter is ignored.
+
+IF HAVE_AUTH_MODULE_BASIC
+	=== Basic authentication parameters ===
+
 	&quot;credentialsttl&quot; timetolive
 		Specifies how long squid assumes an externally validated
 		username:password pair is valid for - in other words how
@@ -650,12 +660,6 @@ ENDIF
 IF HAVE_AUTH_MODULE_DIGEST
 	=== Digest authentication parameters ===
 
-	&quot;utf8&quot; on|off
-		HTTP uses iso-latin-1 as character set, while some
-		authentication backends such as LDAP expects UTF-8. If this is
-		set to on Squid will translate the HTTP iso-latin-1 charset to
-		UTF-8 before sending the username and password to the helper.
-
 	&quot;nonce_garbage_interval&quot; timeinterval
 		Specifies the interval that nonces that have been issued
 		to client_agent&#39;s are checked for validity.
@@ -685,27 +689,6 @@ IF HAVE_AUTH_MODULE_DIGEST
 		incorrect request digest in POST requests when reusing the
 		same nonce as acquired earlier on a GET request.
 
-ENDIF
-IF HAVE_AUTH_MODULE_NEGOTIATE
-	=== Negotiate authentication parameters ===
-
-	&quot;keep_alive&quot; on|off
-		If you experience problems with PUT/POST requests when using
-		the this authentication scheme then you can try setting this
-		to off. This will cause Squid to forcibly close the connection
-		on the initial request where the browser asks which schemes
-		are supported by the proxy.
-
-ENDIF
-IF HAVE_AUTH_MODULE_NTLM
-	=== NTLM authentication parameters ===
-
-	&quot;keep_alive&quot; on|off
-		If you experience problems with PUT/POST requests when using
-		the this authentication scheme then you can try setting this
-		to off. This will cause Squid to forcibly close the connection
-		on the initial request where the browser asks which schemes
-		are supported by the proxy.
 ENDIF
 
 	=== Example Configuration ===
@@ -716,7 +699,6 @@ ENDIF
 
 #auth_param negotiate program &lt;uncomment and complete this line to activate&gt;
 #auth_param negotiate children 20 startup=0 idle=1
-#auth_param negotiate keep_alive on
 #
 #auth_param digest program &lt;uncomment and complete this line to activate&gt;
 #auth_param digest children 20 startup=0 idle=1
@@ -727,11 +709,9 @@ ENDIF
 #
 #auth_param ntlm program &lt;uncomment and complete this line to activate&gt;
 #auth_param ntlm children 20 startup=0 idle=1
-#auth_param ntlm keep_alive on
 #
 #auth_param basic program &lt;uncomment and complete this line&gt;
 #auth_param basic children 5 startup=5 idle=1
-#auth_param basic realm Squid proxy-caching web server
 #auth_param basic credentialsttl 2 hours
 DOC_END
 
----++++GitHub