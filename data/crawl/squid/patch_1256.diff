@@ -1,4 +1,4 @@
-$Id: CREDITS,v 1.8 2002/07/07 18:18:11 hno Exp $
+$Id: CREDITS,v 1.9 2003/01/23 00:34:50 robertc Exp $
 
 ==============================================================================
 
@@ -1,6 +1,6 @@
 ## Process this file with automake to produce Makefile.in
 #
-# $Id: Makefile.am,v 1.17 2003/01/17 03:53:46 robertc Exp $
+# $Id: Makefile.am,v 1.18 2003/01/23 00:34:50 robertc Exp $
 #
 
 AUTOMAKE_OPTIONS = dist-bzip2 subdir-objects 1.5
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -14,9 +15,8 @@
 @SET_MAKE@
 
 #
-# $Id: Makefile.in,v 1.35 2003/01/17 03:58:49 robertc Exp $
+# $Id: Makefile.in,v 1.36 2003/01/23 00:34:50 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -47,9 +47,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -61,6 +65,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -78,7 +86,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -91,7 +98,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -108,6 +114,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -147,21 +154,22 @@ RECURSIVE_TARGETS = info-recursive dvi-recursive install-info-recursive \
 	uninstall-info-recursive all-recursive install-data-recursive \
 	install-exec-recursive installdirs-recursive install-recursive \
 	uninstall-recursive check-recursive installcheck-recursive
-DIST_COMMON = README ./include/autoconf.h.in ./include/stamp-h.in \
-	COPYING ChangeLog INSTALL Makefile.am Makefile.in TODO \
-	acinclude.m4 aclocal.m4 cfgaux/compile cfgaux/config.guess \
-	cfgaux/config.sub cfgaux/depcomp cfgaux/install-sh \
-	cfgaux/missing cfgaux/mkinstalldirs configure configure.in
+DIST_COMMON = README ./include/autoconf.h.in COPYING ChangeLog INSTALL \
+	Makefile.am Makefile.in TODO acinclude.m4 aclocal.m4 \
+	cfgaux/compile cfgaux/config.guess cfgaux/config.sub \
+	cfgaux/depcomp cfgaux/install-sh cfgaux/missing \
+	cfgaux/mkinstalldirs configure configure.in
 all: all-recursive
 
 .SUFFIXES:
+
+am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \
+ configure.lineno
 $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configure.in $(ACLOCAL_M4)
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $@ $(am__depfiles_maybe)
 
 $(top_builddir)/config.status: $(srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	$(SHELL) ./config.status --recheck
@@ -170,31 +178,23 @@ $(srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(srcdir)/configure.in $(ACLOCAL_M4)
 
 $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ configure.in acinclude.m4
 	cd $(srcdir) && $(ACLOCAL) $(ACLOCAL_AMFLAGS)
-include/autoconf.h: include/stamp-h
-	@if test ! -f $@; then \
-		rm -f include/stamp-h; \
-		$(MAKE) include/stamp-h; \
-	else :; fi
-include/stamp-h: $(srcdir)/./include/autoconf.h.in $(top_builddir)/config.status
-	@rm -f include/stamp-h include/stamp-hT
-	@echo timestamp > include/stamp-hT 2> /dev/null
-	cd $(top_builddir) \
-	  && CONFIG_FILES= CONFIG_HEADERS=include/autoconf.h \
-	     $(SHELL) ./config.status
-	@mv include/stamp-hT include/stamp-h
-$(srcdir)/./include/autoconf.h.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/./include/stamp-h.in
+
+include/autoconf.h: include/stamp-h1
 	@if test ! -f $@; then \
-		rm -f $(srcdir)/./include/stamp-h.in; \
-		$(MAKE) $(srcdir)/./include/stamp-h.in; \
+	  rm -f include/stamp-h1; \
+	  $(MAKE) include/stamp-h1; \
 	else :; fi
-$(srcdir)/./include/stamp-h.in: $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	@rm -f $(srcdir)/./include/stamp-h.in $(srcdir)/./include/stamp-h.inT
-	@echo timestamp > $(srcdir)/./include/stamp-h.inT 2> /dev/null
+
+include/stamp-h1: $(srcdir)/./include/autoconf.h.in $(top_builddir)/config.status
+	@rm -f include/stamp-h1
+	cd $(top_builddir) && $(SHELL) ./config.status include/autoconf.h
+
+$(srcdir)/./include/autoconf.h.in: @MAINTAINER_MODE_TRUE@ $(top_srcdir)/configure.in $(ACLOCAL_M4) 
 	cd $(top_srcdir) && $(AUTOHEADER)
-	@mv $(srcdir)/./include/stamp-h.inT $(srcdir)/./include/stamp-h.in
+	touch $(srcdir)/./include/autoconf.h.in
 
 distclean-hdr:
-	-rm -f include/autoconf.h
+	-rm -f include/autoconf.h include/stamp-h1
 uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -204,7 +204,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -224,7 +224,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -252,16 +252,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -272,51 +275,61 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = .
-# Avoid unsightly `./'.
 distdir = $(PACKAGE)-$(VERSION)
 
+am__remove_distdir = \
+  { test ! -d $(distdir) \
+    || { find $(distdir) -type d ! -perm -200 -exec chmod u+w {} ';' \
+         && rm -fr $(distdir); }; }
+
 GZIP_ENV = --best
+distcleancheck_listfiles = find . -type f -print
 
 distdir: $(DISTFILES)
-	-chmod -R a+w $(distdir) >/dev/null 2>&1; rm -rf $(distdir)
+	$(am__remove_distdir)
 	mkdir $(distdir)
 	$(mkinstalldirs) $(distdir)/./include $(distdir)/cfgaux $(distdir)/scripts
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(DIST_SUBDIRS); do \
+	list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -337,45 +350,58 @@ distdir: $(DISTFILES)
 	  ! -type d ! -perm -400 -exec chmod a+r {} \; -o \
 	  ! -type d ! -perm -444 -exec $(SHELL) $(install_sh) -c -m a+r {} {} \; \
 	|| chmod -R a+r $(distdir)
-dist: distdir
+dist-gzip: distdir
 	$(AMTAR) chof - $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
-	-chmod -R a+w $(distdir) >/dev/null 2>&1; rm -rf $(distdir)
+	$(am__remove_distdir)
 
 dist-bzip2: distdir
 	$(AMTAR) chof - $(distdir) | bzip2 -9 -c >$(distdir).tar.bz2
-	-chmod -R a+w $(distdir) >/dev/null 2>&1; rm -rf $(distdir)
+	$(am__remove_distdir)
+
+dist dist-all: distdir
+	$(AMTAR) chof - $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
+	$(AMTAR) chof - $(distdir) | bzip2 -9 -c >$(distdir).tar.bz2
+	$(am__remove_distdir)
 
 # This target untars the dist file and tries a VPATH configuration.  Then
 # it guarantees that the distribution is self-contained by making another
 # tarfile.
 distcheck: dist
-	-chmod -R a+w $(distdir) > /dev/null 2>&1; rm -rf $(distdir)
+	$(am__remove_distdir)
 	GZIP=$(GZIP_ENV) gunzip -c $(distdir).tar.gz | $(AMTAR) xf -
 	chmod -R a-w $(distdir); chmod a+w $(distdir)
 	mkdir $(distdir)/=build
 	mkdir $(distdir)/=inst
 	chmod a-w $(distdir)
-	dc_install_base=`CDPATH=: && cd $(distdir)/=inst && pwd` \
+	dc_install_base=`$(am__cd) $(distdir)/=inst && pwd` \
 	  && cd $(distdir)/=build \
 	  && ../configure --srcdir=.. --prefix=$$dc_install_base \
+	    $(DISTCHECK_CONFIGURE_FLAGS) \
 	  && $(MAKE) $(AM_MAKEFLAGS) \
 	  && $(MAKE) $(AM_MAKEFLAGS) dvi \
 	  && $(MAKE) $(AM_MAKEFLAGS) check \
 	  && $(MAKE) $(AM_MAKEFLAGS) install \
 	  && $(MAKE) $(AM_MAKEFLAGS) installcheck \
 	  && $(MAKE) $(AM_MAKEFLAGS) uninstall \
 	  && (test `find $$dc_install_base -type f -print | wc -l` -le 1 \
-	     || (echo "Error: files left after uninstall" 1>&2; \
-	         exit 1) ) \
-	  && $(MAKE) $(AM_MAKEFLAGS) dist \
-	  && $(MAKE) $(AM_MAKEFLAGS) distclean \
+	      || { echo "ERROR: files left after uninstall:" ; \
+	           find $$dc_install_base -type f -print ; \
+	           exit 1; } >&2 ) \
+	  && $(MAKE) $(AM_MAKEFLAGS) dist-gzip \
 	  && rm -f $(distdir).tar.gz \
-	  && (test `find . -type f -print | wc -l` -eq 0 \
-	     || (echo "Error: files left after distclean" 1>&2; \
-	         exit 1) )
-	-chmod -R a+w $(distdir) > /dev/null 2>&1; rm -rf $(distdir)
+	  && $(MAKE) $(AM_MAKEFLAGS) distcleancheck
+	$(am__remove_distdir)
 	@echo "$(distdir).tar.gz is ready for distribution" | \
 	  sed 'h;s/./=/g;p;x;p;x'
+distcleancheck: distclean
+	if test '$(srcdir)' = . ; then \
+	  echo "ERROR: distcleancheck can only run from a VPATH build" ; \
+	  exit 1 ; \
+	fi
+	test `$(distcleancheck_listfiles) | wc -l` -eq 0 \
+	  || { echo "ERROR: files left after distclean:" ; \
+	       $(distcleancheck_listfiles) ; \
+	       exit 1; } >&2
 check-am: all-am
 check: check-recursive
 all-am: Makefile
@@ -393,14 +419,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
 
 maintainer-clean-generic:
@@ -410,12 +437,8 @@ clean: clean-recursive
 
 clean-am: clean-generic mostlyclean-am
 
-dist-all: distdir
-	$(AMTAR) chof - $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
-	$(AMTAR) chof - $(distdir) | bzip2 -9 -c >$(distdir).tar.bz2
-	-chmod -R a+w $(distdir) >/dev/null 2>&1; rm -rf $(distdir)
 distclean: distclean-recursive
-	-rm -f config.status config.cache config.log
+	-rm -f $(am__CONFIG_DISTCLEAN_FILES)
 distclean-am: clean-am distclean-generic distclean-hdr distclean-tags
 
 dvi: dvi-recursive
@@ -437,7 +460,8 @@ install-man:
 installcheck-am:
 
 maintainer-clean: maintainer-clean-recursive
-
+	-rm -f $(am__CONFIG_DISTCLEAN_FILES)
+	-rm -rf autom4te.cache
 maintainer-clean-am: distclean-am maintainer-clean-generic
 
 mostlyclean: mostlyclean-recursive
@@ -450,10 +474,10 @@ uninstall-info: uninstall-info-recursive
 
 .PHONY: $(RECURSIVE_TARGETS) GTAGS all all-am check check-am clean \
 	clean-generic clean-recursive dist dist-all dist-bzip2 \
-	distcheck distclean distclean-generic distclean-hdr \
-	distclean-recursive distclean-tags distdir dvi dvi-am \
-	dvi-recursive info info-am info-recursive install install-am \
-	install-data install-data-am install-data-recursive \
+	dist-gzip distcheck distclean distclean-generic distclean-hdr \
+	distclean-recursive distclean-tags distcleancheck distdir dvi \
+	dvi-am dvi-recursive info info-am info-recursive install \
+	install-am install-data install-data-am install-data-recursive \
 	install-exec install-exec-am install-exec-recursive \
 	install-info install-info-am install-info-recursive install-man \
 	install-recursive install-strip installcheck installcheck-am \
@@ -1,7 +1,7 @@
 
 Squid QUICKSTART
 
-$Id: QUICKSTART,v 1.6 2002/08/18 10:48:58 robertc Exp $
+$Id: QUICKSTART,v 1.7 2003/01/23 00:34:50 robertc Exp $
 
 This document is intended only for people who want to get Squid running
 quickly It is not a substitute for the real documentation.  Squid has
@@ -1,6 +1,6 @@
-# aclocal.m4 generated automatically by aclocal 1.5
+# aclocal.m4 generated automatically by aclocal 1.6.3 -*- Autoconf -*-
 
-# Copyright 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -60,11 +60,30 @@ SQUID_DEFAULT_INCLUDES
 #endif
 ])
 
-# Do all the work for Automake.  This macro actually does too much --
-# some checks are only needed if your package does certain things.
-# But this isn't really a big deal.
+# Do all the work for Automake.                            -*- Autoconf -*-
 
-# serial 5
+# This macro actually does too much some checks are only needed if
+# your package does certain things.  But this isn't really a big deal.
+
+# Copyright 1996, 1997, 1998, 1999, 2000, 2001, 2002
+# Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+# serial 8
 
 # There are a few dirty hacks below to avoid letting `AC_PROG_CC' be
 # written in clear, in which case automake, when reading aclocal.m4,
@@ -73,62 +92,52 @@ SQUID_DEFAULT_INCLUDES
 # CC etc. in the Makefile, will ask for an AC_PROG_CC use...
 
 
-# We require 2.13 because we rely on SHELL being computed by configure.
-AC_PREREQ([2.13])
-
-# AC_PROVIDE_IFELSE(MACRO-NAME, IF-PROVIDED, IF-NOT-PROVIDED)
-# -----------------------------------------------------------
-# If MACRO-NAME is provided do IF-PROVIDED, else IF-NOT-PROVIDED.
-# The purpose of this macro is to provide the user with a means to
-# check macros which are provided without letting her know how the
-# information is coded.
-# If this macro is not defined by Autoconf, define it here.
-ifdef([AC_PROVIDE_IFELSE],
-      [],
-      [define([AC_PROVIDE_IFELSE],
-              [ifdef([AC_PROVIDE_$1],
-                     [$2], [$3])])])
+AC_PREREQ([2.52])
 
-
-# AM_INIT_AUTOMAKE(PACKAGE,VERSION, [NO-DEFINE])
-# ----------------------------------------------
+# Autoconf 2.50 wants to disallow AM_ names.  We explicitly allow
+# the ones we care about.
+m4_pattern_allow([^AM_[A-Z]+FLAGS$])dnl
+
+# AM_INIT_AUTOMAKE(PACKAGE, VERSION, [NO-DEFINE])
+# AM_INIT_AUTOMAKE([OPTIONS])
+# -----------------------------------------------
+# The call with PACKAGE and VERSION arguments is the old style
+# call (pre autoconf-2.50), which is being phased out.  PACKAGE
+# and VERSION should now be passed to AC_INIT and removed from
+# the call to AM_INIT_AUTOMAKE.
+# We support both call styles for the transition.  After
+# the next Automake release, Autoconf can make the AC_INIT
+# arguments mandatory, and then we can depend on a new Autoconf
+# release and drop the old call support.
 AC_DEFUN([AM_INIT_AUTOMAKE],
-[AC_REQUIRE([AC_PROG_INSTALL])dnl
+[AC_REQUIRE([AM_SET_CURRENT_AUTOMAKE_VERSION])dnl
+ AC_REQUIRE([AC_PROG_INSTALL])dnl
 # test to see if srcdir already configured
-if test "`CDPATH=:; cd $srcdir && pwd`" != "`pwd`" &&
+if test "`cd $srcdir && pwd`" != "`pwd`" &&
    test -f $srcdir/config.status; then
-  AC_MSG_ERROR([source directory already configured; run \"make distclean\" there first])
+  AC_MSG_ERROR([source directory already configured; run "make distclean" there first])
 fi
 
 # Define the identity of the package.
-PACKAGE=$1
-AC_SUBST(PACKAGE)dnl
-VERSION=$2
-AC_SUBST(VERSION)dnl
-ifelse([$3],,
+dnl Distinguish between old-style and new-style calls.
+m4_ifval([$2],
+[m4_ifval([$3], [_AM_SET_OPTION([no-define])])dnl
+ AC_SUBST([PACKAGE], [$1])dnl
+ AC_SUBST([VERSION], [$2])],
+[_AM_SET_OPTIONS([$1])dnl
+ AC_SUBST([PACKAGE], [AC_PACKAGE_TARNAME])dnl
+ AC_SUBST([VERSION], [AC_PACKAGE_VERSION])])dnl
+
+_AM_IF_OPTION([no-define],,
 [AC_DEFINE_UNQUOTED(PACKAGE, "$PACKAGE", [Name of package])
-AC_DEFINE_UNQUOTED(VERSION, "$VERSION", [Version number of package])])
-
-# Autoconf 2.50 wants to disallow AM_ names.  We explicitly allow
-# the ones we care about.
-ifdef([m4_pattern_allow],
-      [m4_pattern_allow([^AM_[A-Z]+FLAGS])])dnl
-
-# Autoconf 2.50 always computes EXEEXT.  However we need to be
-# compatible with 2.13, for now.  So we always define EXEEXT, but we
-# don't compute it.
-AC_SUBST(EXEEXT)
-# Similar for OBJEXT -- only we only use OBJEXT if the user actually
-# requests that it be used.  This is a bit dumb.
-: ${OBJEXT=o}
-AC_SUBST(OBJEXT)
+ AC_DEFINE_UNQUOTED(VERSION, "$VERSION", [Version number of package])])dnl
 
 # Some tools Automake needs.
 AC_REQUIRE([AM_SANITY_CHECK])dnl
 AC_REQUIRE([AC_ARG_PROGRAM])dnl
-AM_MISSING_PROG(ACLOCAL, aclocal)
+AM_MISSING_PROG(ACLOCAL, aclocal-${am__api_version})
 AM_MISSING_PROG(AUTOCONF, autoconf)
-AM_MISSING_PROG(AUTOMAKE, automake)
+AM_MISSING_PROG(AUTOMAKE, automake-${am__api_version})
 AM_MISSING_PROG(AUTOHEADER, autoheader)
 AM_MISSING_PROG(MAKEINFO, makeinfo)
 AM_MISSING_PROG(AMTAR, tar)
@@ -138,9 +147,9 @@ AM_PROG_INSTALL_STRIP
 # some platforms.
 AC_REQUIRE([AC_PROG_AWK])dnl
 AC_REQUIRE([AC_PROG_MAKE_SET])dnl
-AC_REQUIRE([AM_DEP_TRACK])dnl
-AC_REQUIRE([AM_SET_DEPDIR])dnl
-AC_PROVIDE_IFELSE([AC_PROG_][CC],
+
+_AM_IF_OPTION([no-dependencies],,
+[AC_PROVIDE_IFELSE([AC_PROG_][CC],
                   [_AM_DEPENDENCIES(CC)],
                   [define([AC_PROG_][CC],
                           defn([AC_PROG_][CC])[_AM_DEPENDENCIES(CC)])])dnl
@@ -149,11 +158,102 @@ AC_PROVIDE_IFELSE([AC_PROG_][CXX],
                   [define([AC_PROG_][CXX],
                           defn([AC_PROG_][CXX])[_AM_DEPENDENCIES(CXX)])])dnl
 ])
+])
+
+# Copyright 2002  Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+
+# AM_AUTOMAKE_VERSION(VERSION)
+# ----------------------------
+# Automake X.Y traces this macro to ensure aclocal.m4 has been
+# generated from the m4 files accompanying Automake X.Y.
+AC_DEFUN([AM_AUTOMAKE_VERSION],[am__api_version="1.6"])
+
+# AM_SET_CURRENT_AUTOMAKE_VERSION
+# -------------------------------
+# Call AM_AUTOMAKE_VERSION so it can be traced.
+# This function is AC_REQUIREd by AC_INIT_AUTOMAKE.
+AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],
+	 [AM_AUTOMAKE_VERSION([1.6.3])])
+
+# Helper functions for option handling.                    -*- Autoconf -*-
+
+# Copyright 2001, 2002  Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+# serial 2
+
+# _AM_MANGLE_OPTION(NAME)
+# -----------------------
+AC_DEFUN([_AM_MANGLE_OPTION],
+[[_AM_OPTION_]m4_bpatsubst($1, [[^a-zA-Z0-9_]], [_])])
+
+# _AM_SET_OPTION(NAME)
+# ------------------------------
+# Set option NAME.  Presently that only means defining a flag for this option.
+AC_DEFUN([_AM_SET_OPTION],
+[m4_define(_AM_MANGLE_OPTION([$1]), 1)])
+
+# _AM_SET_OPTIONS(OPTIONS)
+# ----------------------------------
+# OPTIONS is a space-separated list of Automake options.
+AC_DEFUN([_AM_SET_OPTIONS],
+[AC_FOREACH([_AM_Option], [$1], [_AM_SET_OPTION(_AM_Option)])])
+
+# _AM_IF_OPTION(OPTION, IF-SET, [IF-NOT-SET])
+# -------------------------------------------
+# Execute IF-SET if OPTION is set, IF-NOT-SET otherwise.
+AC_DEFUN([_AM_IF_OPTION],
+[m4_ifset(_AM_MANGLE_OPTION([$1]), [$2], [$3])])
 
 #
 # Check to make sure that the build environment is sane.
 #
 
+# Copyright 1996, 1997, 2000, 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
 # serial 3
 
 # AM_SANITY_CHECK
@@ -197,8 +297,27 @@ Check your system clock])
 fi
 AC_MSG_RESULT(yes)])
 
+#  -*- Autoconf -*-
 
-# serial 2
+
+# Copyright 1997, 1999, 2000, 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+# serial 3
 
 # AM_MISSING_PROG(NAME, PROGRAM)
 # ------------------------------
@@ -220,13 +339,29 @@ if eval "$MISSING --run true"; then
   am_missing_run="$MISSING --run "
 else
   am_missing_run=
-  am_backtick='`'
-  AC_MSG_WARN([${am_backtick}missing' script is too old or missing])
+  AC_MSG_WARN([`missing' script is too old or missing])
 fi
 ])
 
 # AM_AUX_DIR_EXPAND
 
+# Copyright 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
 # For projects using AC_CONFIG_AUX_DIR([foo]), Autoconf sets
 # $ac_aux_dir to `$srcdir/foo'.  In other projects, it is set to
 # `$srcdir', `$srcdir/..', or `$srcdir/../..'.
@@ -265,19 +400,59 @@ fi
 # absolute PATH.  The drawback is that using absolute paths prevent a
 # configured tree to be moved without reconfiguration.
 
+# Rely on autoconf to set up CDPATH properly.
+AC_PREREQ([2.50])
+
 AC_DEFUN([AM_AUX_DIR_EXPAND], [
 # expand $ac_aux_dir to an absolute path
-am_aux_dir=`CDPATH=:; cd $ac_aux_dir && pwd`
+am_aux_dir=`cd $ac_aux_dir && pwd`
 ])
 
 # AM_PROG_INSTALL_SH
 # ------------------
 # Define $install_sh.
+
+# Copyright 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
 AC_DEFUN([AM_PROG_INSTALL_SH],
 [AC_REQUIRE([AM_AUX_DIR_EXPAND])dnl
 install_sh=${install_sh-"$am_aux_dir/install-sh"}
 AC_SUBST(install_sh)])
 
+# AM_PROG_INSTALL_STRIP
+
+# Copyright 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
 # One issue with vendor `install' (even GNU) is that you can't
 # specify the program used to strip binaries.  This is especially
 # annoying in cross-compiling environments, where the build's strip
@@ -287,11 +462,35 @@ AC_SUBST(install_sh)])
 # STRIPPROG with the value of the STRIP variable (set by the user).
 AC_DEFUN([AM_PROG_INSTALL_STRIP],
 [AC_REQUIRE([AM_PROG_INSTALL_SH])dnl
+# Installed binaries are usually stripped using `strip' when the user
+# run `make install-strip'.  However `strip' might not be the right
+# tool to use in cross-compilation environments, therefore Automake
+# will honor the `STRIP' environment variable to overrule this program.
+dnl Don't test for $cross_compiling = yes, because it might be `maybe'.
+if test "$cross_compiling" != no; then
+  AC_CHECK_TOOL([STRIP], [strip], :)
+fi
 INSTALL_STRIP_PROGRAM="\${SHELL} \$(install_sh) -c -s"
 AC_SUBST([INSTALL_STRIP_PROGRAM])])
 
 # serial 4						-*- Autoconf -*-
 
+# Copyright 1999, 2000, 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
 
 
 # There are a few dirty hacks below to avoid letting `AC_PROG_CC' be
@@ -303,9 +502,9 @@ AC_SUBST([INSTALL_STRIP_PROGRAM])])
 
 
 # _AM_DEPENDENCIES(NAME)
-# ---------------------
+# ----------------------
 # See how the compiler implements dependency checking.
-# NAME is "CC", "CXX" or "OBJC".
+# NAME is "CC", "CXX", "GCJ", or "OBJC".
 # We try a few techniques and use that to set a single cache variable.
 #
 # We don't AC_REQUIRE the corresponding AC_PROG_CC since the latter was
@@ -320,7 +519,7 @@ AC_REQUIRE([AM_DEP_TRACK])dnl
 
 ifelse([$1], CC,   [depcc="$CC"   am_compiler_list=],
        [$1], CXX,  [depcc="$CXX"  am_compiler_list=],
-       [$1], OBJC, [depcc="$OBJC" am_compiler_list='gcc3 gcc']
+       [$1], OBJC, [depcc="$OBJC" am_compiler_list='gcc3 gcc'],
        [$1], GCJ,  [depcc="$GCJ"  am_compiler_list='gcc3 gcc'],
                    [depcc="$$1"   am_compiler_list=])
 
@@ -382,8 +581,7 @@ else
   am_cv_$1_dependencies_compiler_type=none
 fi
 ])
-$1DEPMODE="depmode=$am_cv_$1_dependencies_compiler_type"
-AC_SUBST([$1DEPMODE])
+AC_SUBST([$1DEPMODE], [depmode=$am_cv_$1_dependencies_compiler_type])
 ])
 
 
@@ -401,7 +599,7 @@ else
   DEPDIR=_deps
 fi
 rmdir .deps 2>/dev/null
-AC_SUBST(DEPDIR)
+AC_SUBST([DEPDIR])
 ])
 
 
@@ -416,30 +614,48 @@ if test "x$enable_dependency_tracking" != xno; then
   AMDEPBACKSLASH='\'
 fi
 AM_CONDITIONAL([AMDEP], [test "x$enable_dependency_tracking" != xno])
-pushdef([subst], defn([AC_SUBST]))
-subst(AMDEPBACKSLASH)
-popdef([subst])
+AC_SUBST([AMDEPBACKSLASH])
 ])
 
-# Generate code to set up dependency tracking.
-# This macro should only be invoked once -- use via AC_REQUIRE.
-# Usage:
-# AM_OUTPUT_DEPENDENCY_COMMANDS
+# Generate code to set up dependency tracking.   -*- Autoconf -*-
 
-#
-# This code is only required when automatic dependency tracking
-# is enabled.  FIXME.  This creates each `.P' file that we will
-# need in order to bootstrap the dependency handling code.
-AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],[
-AC_OUTPUT_COMMANDS([
-test x"$AMDEP_TRUE" != x"" ||
-for mf in $CONFIG_FILES; do
-  case "$mf" in
-  Makefile) dirpart=.;;
-  */Makefile) dirpart=`echo "$mf" | sed -e 's|/[^/]*$||'`;;
-  *) continue;;
-  esac
-  grep '^DEP_FILES *= *[^ #]' < "$mf" > /dev/null || continue
+# Copyright 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+#serial 2
+
+# _AM_OUTPUT_DEPENDENCY_COMMANDS
+# ------------------------------
+AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
+[for mf in $CONFIG_FILES; do
+  # Strip MF so we end up with the name of the file.
+  mf=`echo "$mf" | sed -e 's/:.*$//'`
+  # Check whether this is an Automake generated Makefile or not.
+  # We used to match only the files named `Makefile.in', but
+  # some people rename them; so instead we look at the file content.
+  # Grep'ing the first line is not enough: some people post-process
+  # each Makefile.in and add a new line on top of each file to say so.
+  # So let's grep whole file.
+  if grep '^#.*generated by automake' $mf > /dev/null 2>&1; then
+    dirpart=`AS_DIRNAME("$mf")`
+  else
+    continue
+  fi
+  grep '^DEP_FILES *= *[[^ @%:@]]' < "$mf" > /dev/null || continue
   # Extract the definition of DEP_FILES from the Makefile without
   # running `make'.
   DEPDIR=`sed -n -e '/^DEPDIR = / s///p' < "$mf"`
@@ -463,14 +679,46 @@ for mf in $CONFIG_FILES; do
        sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
     # Make sure the directory exists.
     test -f "$dirpart/$file" && continue
-    fdir=`echo "$file" | sed -e 's|/[^/]*$||'`
-    $ac_aux_dir/mkinstalldirs "$dirpart/$fdir" > /dev/null 2>&1
+    fdir=`AS_DIRNAME(["$file"])`
+    AS_MKDIR_P([$dirpart/$fdir])
     # echo "creating $dirpart/$file"
     echo '# dummy' > "$dirpart/$file"
   done
 done
-], [AMDEP_TRUE="$AMDEP_TRUE"
-ac_aux_dir="$ac_aux_dir"])])
+])# _AM_OUTPUT_DEPENDENCY_COMMANDS
+
+
+# AM_OUTPUT_DEPENDENCY_COMMANDS
+# -----------------------------
+# This macro should only be invoked once -- use via AC_REQUIRE.
+#
+# This code is only required when automatic dependency tracking
+# is enabled.  FIXME.  This creates each `.P' file that we will
+# need in order to bootstrap the dependency handling code.
+AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],
+[AC_CONFIG_COMMANDS([depfiles],
+     [test x"$AMDEP_TRUE" != x"" || _AM_OUTPUT_DEPENDENCY_COMMANDS],
+     [AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"])
+])
+
+# Copyright 2001 Free Software Foundation, Inc.             -*- Autoconf -*-
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+# serial 2
 
 # AM_MAKE_INCLUDE()
 # -----------------
@@ -483,7 +731,7 @@ doit:
 END
 # If we don't find an include directive, just comment out the code.
 AC_MSG_CHECKING([for style of include used by $am_make])
-am__include='#'
+am__include="#"
 am__quote=
 _am_result=none
 # First try GNU make style include.
@@ -503,7 +751,7 @@ if test "$am__include" = "#"; then
    echo '.include "confinc"' > confmf
    if test "`$am_make -s -f confmf 2> /dev/null`" = "done"; then
       am__include=.include
-      am__quote='"'
+      am__quote="\""
       _am_result=BSD
    fi
 fi
@@ -513,23 +761,35 @@ AC_MSG_RESULT($_am_result)
 rm -f confinc confmf
 ])
 
-# serial 3
+# AM_CONDITIONAL                                              -*- Autoconf -*-
+
+# Copyright 1997, 2000, 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+# serial 5
+
+AC_PREREQ(2.52)
 
 # AM_CONDITIONAL(NAME, SHELL-CONDITION)
 # -------------------------------------
 # Define a conditional.
-#
-# FIXME: Once using 2.50, use this:
-# m4_match([$1], [^TRUE\|FALSE$], [AC_FATAL([$0: invalid condition: $1])])dnl
 AC_DEFUN([AM_CONDITIONAL],
-[ifelse([$1], [TRUE],
-        [errprint(__file__:__line__: [$0: invalid condition: $1
-])dnl
-m4exit(1)])dnl
-ifelse([$1], [FALSE],
-       [errprint(__file__:__line__: [$0: invalid condition: $1
-])dnl
-m4exit(1)])dnl
+[ifelse([$1], [TRUE],  [AC_FATAL([$0: invalid condition: $1])],
+        [$1], [FALSE], [AC_FATAL([$0: invalid condition: $1])])dnl
 AC_SUBST([$1_TRUE])
 AC_SUBST([$1_FALSE])
 if $2; then
@@ -538,78 +798,111 @@ if $2; then
 else
   $1_TRUE='#'
   $1_FALSE=
-fi])
+fi
+AC_CONFIG_COMMANDS_PRE(
+[if test -z "${$1_TRUE}" && test -z "${$1_FALSE}"; then
+  AC_MSG_ERROR([conditional \"$1\" was never defined.
+Usually this means the macro was only invoked conditionally.])
+fi])])
 
-# Like AC_CONFIG_HEADER, but automatically create stamp file.
+# Like AC_CONFIG_HEADER, but automatically create stamp file. -*- Autoconf -*-
 
-# serial 3
+# Copyright 1996, 1997, 2000, 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+AC_PREREQ([2.52])
+
+# serial 6
 
 # When config.status generates a header, we must update the stamp-h file.
 # This file resides in the same directory as the config header
 # that is generated.  We must strip everything past the first ":",
 # and everything past the last "/".
 
-AC_PREREQ([2.12])
-
-AC_DEFUN([AM_CONFIG_HEADER],
-[ifdef([AC_FOREACH],dnl
-	 [dnl init our file count if it isn't already
-	 m4_ifndef([_AM_Config_Header_Index], m4_define([_AM_Config_Header_Index], [0]))
-	 dnl prepare to store our destination file list for use in config.status
-	 AC_FOREACH([_AM_File], [$1],
-		    [m4_pushdef([_AM_Dest], m4_bpatsubst(_AM_File, [:.*]))
-		    m4_define([_AM_Config_Header_Index], m4_incr(_AM_Config_Header_Index))
-		    dnl and add it to the list of files AC keeps track of, along
-		    dnl with our hook
-		    AC_CONFIG_HEADERS(_AM_File,
-dnl COMMANDS, [, INIT-CMDS]
-[# update the timestamp
-echo timestamp >"AS_ESCAPE(_AM_DIRNAME(]_AM_Dest[))/stamp-h]_AM_Config_Header_Index["
-][$2]m4_ifval([$3], [, [$3]]))dnl AC_CONFIG_HEADERS
-		    m4_popdef([_AM_Dest])])],dnl
-[AC_CONFIG_HEADER([$1])
-  AC_OUTPUT_COMMANDS(
-   ifelse(patsubst([$1], [[^ ]], []),
-	  [],
-	  [test -z "$CONFIG_HEADERS" || echo timestamp >dnl
-	   patsubst([$1], [^\([^:]*/\)?.*], [\1])stamp-h]),dnl
-[am_indx=1
-for am_file in $1; do
-  case " \$CONFIG_HEADERS " in
-  *" \$am_file "*)
-    am_dir=\`echo \$am_file |sed 's%:.*%%;s%[^/]*\$%%'\`
-    if test -n "\$am_dir"; then
-      am_tmpdir=\`echo \$am_dir |sed 's%^\(/*\).*\$%\1%'\`
-      for am_subdir in \`echo \$am_dir |sed 's%/% %'\`; do
-        am_tmpdir=\$am_tmpdir\$am_subdir/
-        if test ! -d \$am_tmpdir; then
-          mkdir \$am_tmpdir
-        fi
-      done
-    fi
-    echo timestamp > "\$am_dir"stamp-h\$am_indx
-    ;;
-  esac
-  am_indx=\`expr \$am_indx + 1\`
-done])
-])]) # AM_CONFIG_HEADER
-
 # _AM_DIRNAME(PATH)
 # -----------------
 # Like AS_DIRNAME, only do it during macro expansion
 AC_DEFUN([_AM_DIRNAME],
-       [m4_if(m4_bregexp([$1], [^.*[^/]//*[^/][^/]*/*$]), -1,
-	      m4_if(m4_bregexp([$1], [^//\([^/]\|$\)]), -1,
-		    m4_if(m4_bregexp([$1], [^/.*]), -1,
+       [m4_if(regexp([$1], [^.*[^/]//*[^/][^/]*/*$]), -1,
+	      m4_if(regexp([$1], [^//\([^/]\|$\)]), -1,
+		    m4_if(regexp([$1], [^/.*]), -1,
 			  [.],
-			  m4_bpatsubst([$1], [^\(/\).*], [\1])),
-		    m4_bpatsubst([$1], [^\(//\)\([^/].*\|$\)], [\1])),
-	      m4_bpatsubst([$1], [^\(.*[^/]\)//*[^/][^/]*/*$], [\1]))[]dnl
-]) # _AM_DIRNAME
+			  patsubst([$1], [^\(/\).*], [\1])),
+		    patsubst([$1], [^\(//\)\([^/].*\|$\)], [\1])),
+	      patsubst([$1], [^\(.*[^/]\)//*[^/][^/]*/*$], [\1]))[]dnl
+])# _AM_DIRNAME
+
+
+# The stamp files are numbered to have different names.
+# We could number them on a directory basis, but that's additional
+# complications, let's have a unique counter.
+m4_define([_AM_STAMP_Count], [0])
+
+
+# _AM_STAMP(HEADER)
+# -----------------
+# The name of the stamp file for HEADER.
+AC_DEFUN([_AM_STAMP],
+[m4_define([_AM_STAMP_Count], m4_incr(_AM_STAMP_Count))dnl
+AS_ESCAPE(_AM_DIRNAME(patsubst([$1],
+                               [:.*])))/stamp-h[]_AM_STAMP_Count])
+
+
+# _AM_CONFIG_HEADER(HEADER[:SOURCES], COMMANDS, INIT-COMMANDS)
+# ------------------------------------------------------------
+# We used to try to get a real timestamp in stamp-h.  But the fear is that
+# that will cause unnecessary cvs conflicts.
+AC_DEFUN([_AM_CONFIG_HEADER],
+[# Add the stamp file to the list of files AC keeps track of,
+# along with our hook.
+AC_CONFIG_HEADERS([$1],
+                  [# update the timestamp
+echo 'timestamp for $1' >"_AM_STAMP([$1])"
+$2],
+                  [$3])
+])# _AM_CONFIG_HEADER
+
+
+# AM_CONFIG_HEADER(HEADER[:SOURCES]..., COMMANDS, INIT-COMMANDS)
+# --------------------------------------------------------------
+AC_DEFUN([AM_CONFIG_HEADER],
+[AC_FOREACH([_AM_File], [$1], [_AM_CONFIG_HEADER(_AM_File, [$2], [$3])])
+])# AM_CONFIG_HEADER
 
 # Add --enable-maintainer-mode option to configure.
 # From Jim Meyering
 
+# Copyright 1996, 1998, 2000, 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
 # serial 1
 
 AC_DEFUN([AM_MAINTAINER_MODE],
@@ -632,6 +925,24 @@ AC_DEFUN([AM_MAINTAINER_MODE],
 # AM_PROG_CC_C_O
 # --------------
 # Like AC_PROG_CC_C_O, but changed for automake.
+
+# Copyright 1999, 2000, 2001 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
 AC_DEFUN([AM_PROG_CC_C_O],
 [AC_REQUIRE([AC_PROG_CC_C_O])dnl
 AC_REQUIRE([AM_AUX_DIR_EXPAND])dnl
@@ -4,7 +4,7 @@
 # Created: 1993-05-16
 # Public domain
 
-# $Id: mkinstalldirs,v 1.1 2001/08/31 11:19:07 robertc Exp $
+# $Id: mkinstalldirs,v 1.2 2003/01/23 00:34:52 robertc Exp $
 
 errstatus=0
 
@@ -3,7 +3,7 @@ dnl  Configuration input file for Squid
 dnl
 dnl  Duane Wessels, wessels@nlanr.net, February 1996 (autoconf v2.9)
 dnl
-dnl  $Id: configure.in,v 1.314 2003/01/18 02:30:05 hno Exp $
+dnl  $Id: configure.in,v 1.315 2003/01/23 00:34:51 robertc Exp $
 dnl
 dnl
 dnl
@@ -13,7 +13,7 @@ AC_CONFIG_SRCDIR([src/main.cc])
 AC_CONFIG_AUX_DIR(cfgaux)
 AM_INIT_AUTOMAKE(squid, 3.0-DEVEL)
 AM_CONFIG_HEADER(include/autoconf.h)
-AC_REVISION($Revision: 1.314 $)dnl
+AC_REVISION($Revision: 1.315 $)dnl
 AC_PREFIX_DEFAULT(/usr/local/squid)
 AM_MAINTAINER_MODE
 
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -17,7 +18,6 @@
 # Makefile for installing Squid startup files on systems
 # using a SVR4-based startup mechanism/file system layout
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +48,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +66,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +87,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +99,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +115,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -151,30 +158,32 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  contrib/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
 	$(mkinstalldirs) $(distdir)/nextstep
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -196,14 +205,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,4 +1,4 @@
-/* $Id: rredir.c,v 1.4 2001/01/07 10:57:13 hno Exp $ */
+/* $Id: rredir.c,v 1.5 2003/01/23 00:34:52 robertc Exp $ */
 
 /*
  * From:    richard@hekkihek.hacom.nl (Richard Huveneers)
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.2 2002/07/20 22:51:17 hno Exp $
+#  $Id: Makefile.am,v 1.3 2003/01/23 00:34:53 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.17 2002/10/15 08:10:53 robertc Exp $
+#  $Id: Makefile.in,v 1.18 2003/01/23 00:34:53 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -145,9 +152,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  doc/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 
 man8dir = $(mandir)/man8
@@ -165,6 +170,10 @@ install-man8: $(man8_MANS) $(man_MANS)
 	  if test -f $(srcdir)/$$i; then file=$(srcdir)/$$i; \
 	  else file=$$i; fi; \
 	  ext=`echo $$i | sed -e 's/^.*\\.//'`; \
+	  case "$$ext" in \
+	    8*) ;; \
+	    *) ext='8' ;; \
+	  esac; \
 	  inst=`echo $$i | sed -e 's/\\.[0-9a-z]*$$//'`; \
 	  inst=`echo $$inst | sed -e 's/^.*\///'`; \
 	  inst=`echo $$inst | sed '$(transform)'`.$$ext; \
@@ -191,22 +200,26 @@ uninstall-man8:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -231,14 +244,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -2,7 +2,7 @@
 <article>
 <title>Squid Programmers Guide</title>
 <author>Squid Developers</author>
-<date>$Id: prog-guide.sgml,v 1.53 2002/12/16 19:53:06 robertc Exp $</date>
+<date>$Id: prog-guide.sgml,v 1.54 2003/01/23 00:34:54 robertc Exp $</date>
 
 <abstract>
 Squid is a WWW Cache application developed by the National Laboratory
@@ -7,7 +7,7 @@
 <BODY>
 <H1>Squid 2.5 release notes</H1>
 
-<H2>Squid Developers</H2>$Id: release-2.5.html,v 1.3 2002/09/07 05:41:41 robertc Exp $
+<H2>Squid Developers</H2>$Id: release-2.5.html,v 1.4 2003/01/23 00:34:59 robertc Exp $
 <HR>
 <EM>This document contains the release notes for version 2.5 of Squid.
 Squid is a WWW Cache application developed by the National Laboratory
@@ -2,7 +2,7 @@
 <article>
 <title>Squid 2.5 release notes</title>
 <author>Squid Developers</author>
-<date>$Id: release-2.5.sgml,v 1.4 2002/09/07 10:17:00 hno Exp $</date>
+<date>$Id: release-2.5.sgml,v 1.5 2003/01/23 00:34:59 robertc Exp $</date>
 
 <abstract>
 This document contains the release notes for version 2.5 of Squid.
@@ -1,6 +1,6 @@
 ## Process this file with automake to produce Makefile.in
 #
-# $Id: Makefile.am,v 1.9 2002/10/18 21:21:22 hno Exp $
+# $Id: Makefile.am,v 1.10 2003/01/23 00:35:06 robertc Exp $
 #
 
 errordir = $(datadir)/errors
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -14,9 +15,8 @@
 @SET_MAKE@
 
 #
-# $Id: Makefile.in,v 1.33 2002/10/18 21:25:24 hno Exp $
+# $Id: Makefile.in,v 1.34 2003/01/23 00:35:06 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -47,9 +47,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -61,6 +65,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -78,7 +86,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -91,7 +98,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -108,6 +114,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -164,29 +171,31 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  errors/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -213,14 +222,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -12,7 +13,6 @@
 # PARTICULAR PURPOSE.
 
 @SET_MAKE@
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -43,9 +43,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -57,6 +61,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -74,7 +82,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -87,7 +94,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -104,6 +110,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -112,7 +119,6 @@ am__include = @am__include@
 am__quote = @am__quote@
 install_sh = @install_sh@
 makesnmplib = @makesnmplib@
-
 SUBDIRS = basic_auth ntlm_auth digest_auth external_acl
 subdir = helpers
 mkinstalldirs = $(SHELL) $(top_srcdir)/cfgaux/mkinstalldirs
@@ -133,9 +139,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -145,7 +149,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -165,7 +169,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -193,16 +197,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -213,45 +220,50 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -281,14 +293,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.am,v 1.4 2002/08/12 01:11:48 hno Exp $
+#  $Id: Makefile.am,v 1.5 2003/01/23 00:35:21 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.in,v 1.26 2002/10/15 08:10:59 robertc Exp $
+#  $Id: Makefile.in,v 1.27 2003/01/23 00:35:21 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -147,7 +154,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/squid_ldap_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/squid_ldap_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -168,26 +176,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/LDAP/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -204,16 +211,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/squid_ldap_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/squid_ldap_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -238,6 +245,10 @@ install-man8: $(man8_MANS) $(man_MANS)
 	  if test -f $(srcdir)/$$i; then file=$(srcdir)/$$i; \
 	  else file=$$i; fi; \
 	  ext=`echo $$i | sed -e 's/^.*\\.//'`; \
+	  case "$$ext" in \
+	    8*) ;; \
+	    *) ext='8' ;; \
+	  esac; \
 	  inst=`echo $$i | sed -e 's/\\.[0-9a-z]*$$//'`; \
 	  inst=`echo $$inst | sed -e 's/^.*\///'`; \
 	  inst=`echo $$inst | sed '$(transform)'`.$$ext; \
@@ -262,53 +273,61 @@ uninstall-man8:
 	  rm -f $(DESTDIR)$(man8dir)/$$inst; \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -333,14 +352,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.9 2002/08/12 01:11:48 hno Exp $
+#  $Id: Makefile.am,v 1.10 2003/01/23 00:35:26 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.29 2002/10/15 08:11:00 robertc Exp $
+#  $Id: Makefile.in,v 1.30 2003/01/23 00:35:26 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -170,13 +177,15 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/allowusers.Po $(DEPDIR)/confload.Po \
-@AMDEP_TRUE@	$(DEPDIR)/denyusers.Po $(DEPDIR)/md4.Po \
-@AMDEP_TRUE@	$(DEPDIR)/msntauth.Po $(DEPDIR)/rfcnb-io.Po \
-@AMDEP_TRUE@	$(DEPDIR)/rfcnb-util.Po $(DEPDIR)/session.Po \
-@AMDEP_TRUE@	$(DEPDIR)/smbdes.Po $(DEPDIR)/smbencrypt.Po \
-@AMDEP_TRUE@	$(DEPDIR)/smblib-util.Po $(DEPDIR)/smblib.Po \
-@AMDEP_TRUE@	$(DEPDIR)/usersfile.Po $(DEPDIR)/valid.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/allowusers.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/confload.Po ./$(DEPDIR)/denyusers.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/md4.Po ./$(DEPDIR)/msntauth.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/rfcnb-io.Po ./$(DEPDIR)/rfcnb-util.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/session.Po ./$(DEPDIR)/smbdes.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/smbencrypt.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/smblib-util.Po ./$(DEPDIR)/smblib.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/usersfile.Po ./$(DEPDIR)/valid.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -196,26 +205,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/MSNT/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -232,29 +240,29 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/allowusers.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/confload.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/denyusers.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/md4.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/msntauth.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/rfcnb-io.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/rfcnb-util.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/session.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smbdes.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smbencrypt.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smblib-util.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smblib.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/usersfile.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/valid.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/allowusers.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/confload.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/denyusers.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/md4.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/msntauth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rfcnb-io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rfcnb-util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/session.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smbdes.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smbencrypt.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smblib-util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smblib.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/usersfile.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/valid.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -263,14 +271,15 @@ distclean-depend:
 	$(COMPILE) -c `cygpath -w $<`
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
+sysconfDATA_INSTALL = $(INSTALL_DATA)
 install-sysconfDATA: $(sysconf_DATA)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)
 	@list='$(sysconf_DATA)'; for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  f="`echo $$p | sed -e 's|^.*/||'`"; \
-	  echo " $(INSTALL_DATA) $$d$$p $(DESTDIR)$(sysconfdir)/$$f"; \
-	  $(INSTALL_DATA) $$d$$p $(DESTDIR)$(sysconfdir)/$$f; \
+	  echo " $(sysconfDATA_INSTALL) $$d$$p $(DESTDIR)$(sysconfdir)/$$f"; \
+	  $(sysconfDATA_INSTALL) $$d$$p $(DESTDIR)$(sysconfdir)/$$f; \
 	done
 
 uninstall-sysconfDATA:
@@ -281,53 +290,61 @@ uninstall-sysconfDATA:
 	  rm -f $(DESTDIR)$(sysconfdir)/$$f; \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -352,14 +369,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,6 @@
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.3 2002/05/20 01:42:50 hno Exp $
+#  $Id: Makefile.am,v 1.4 2003/01/23 00:35:16 robertc Exp $
 #
 
 DIST_SUBDIRS	= getpwnam LDAP MSNT multi-domain-NTLM NCSA PAM SMB YP SASL winbind
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -15,9 +16,8 @@
 
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.24 2002/10/15 08:10:58 robertc Exp $
+#  $Id: Makefile.in,v 1.25 2003/01/23 00:35:16 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +48,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +66,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +87,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +99,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +115,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -138,9 +145,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -150,7 +155,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -170,7 +175,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -198,16 +203,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -218,45 +226,50 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(DIST_SUBDIRS); do \
+	list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -286,14 +299,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.2 2002/08/12 01:11:49 hno Exp $
+#  $Id: Makefile.am,v 1.3 2003/01/23 00:35:30 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.24 2002/10/15 08:11:04 robertc Exp $
+#  $Id: Makefile.in,v 1.25 2003/01/23 00:35:30 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -144,7 +151,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/ncsa_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/ncsa_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -162,26 +170,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/NCSA/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -198,16 +205,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ncsa_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ncsa_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -217,53 +224,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -288,14 +303,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid PAM authentication helper
 #
-#  $Id: Makefile.am,v 1.4 2002/08/12 01:11:50 hno Exp $
+#  $Id: Makefile.am,v 1.5 2003/01/23 00:35:35 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid PAM authentication helper
 #
-#  $Id: Makefile.in,v 1.25 2002/10/15 08:11:06 robertc Exp $
+#  $Id: Makefile.in,v 1.26 2003/01/23 00:35:35 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -146,7 +153,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/pam_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/pam_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -167,26 +175,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/PAM/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -203,16 +210,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/pam_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pam_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -237,6 +244,10 @@ install-man8: $(man8_MANS) $(man_MANS)
 	  if test -f $(srcdir)/$$i; then file=$(srcdir)/$$i; \
 	  else file=$$i; fi; \
 	  ext=`echo $$i | sed -e 's/^.*\\.//'`; \
+	  case "$$ext" in \
+	    8*) ;; \
+	    *) ext='8' ;; \
+	  esac; \
 	  inst=`echo $$i | sed -e 's/\\.[0-9a-z]*$$//'`; \
 	  inst=`echo $$inst | sed -e 's/^.*\///'`; \
 	  inst=`echo $$inst | sed '$(transform)'`.$$ext; \
@@ -261,53 +272,61 @@ uninstall-man8:
 	  rm -f $(DESTDIR)$(man8dir)/$$inst; \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -332,14 +351,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,5 +1,5 @@
 /*
- * $Id: pam_auth.c,v 1.11 2002/10/11 03:05:41 wessels Exp $
+ * $Id: pam_auth.c,v 1.12 2003/01/23 00:35:35 robertc Exp $
  *
  * PAM authenticator module for Squid.
  * Copyright (C) 1999,2002 Henrik Nordstrom <hno@squid-cache.org>
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid SASL authentication helper
 #
-#  $Id: Makefile.am,v 1.3 2002/08/12 01:11:51 hno Exp $
+#  $Id: Makefile.am,v 1.4 2003/01/23 00:35:37 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid SASL authentication helper
 #
-#  $Id: Makefile.in,v 1.22 2002/10/15 08:11:07 robertc Exp $
+#  $Id: Makefile.in,v 1.23 2003/01/23 00:35:37 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -145,7 +152,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/sasl_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/sasl_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -163,26 +171,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/SASL/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -199,16 +206,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/sasl_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/sasl_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -218,53 +225,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -289,14 +304,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,5 +1,5 @@
 /*
- * $Id: sasl_auth.c,v 1.4 2002/08/12 16:58:12 hno Exp $
+ * $Id: sasl_auth.c,v 1.5 2003/01/23 00:35:38 robertc Exp $
  *
  * SASL authenticator module for Squid.
  * Copyright (C) 2002 Ian Castle <ian.castle@coldcomfortfarm.net>
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.4 2002/08/12 01:11:55 hno Exp $
+#  $Id: Makefile.am,v 1.5 2003/01/23 00:35:40 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,7 +17,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.25 2002/10/15 08:11:10 robertc Exp $
+#  $Id: Makefile.in,v 1.26 2003/01/23 00:35:40 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -25,7 +26,6 @@
 # By default, Samba is installed in /usr/local/samba. If you changed this
 # by using the --prefix option when configuring Samba, you need to change
 # SAMBAPREFIX accordingly.
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -56,9 +56,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -70,6 +74,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -87,7 +95,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -100,7 +107,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -117,6 +123,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -159,7 +166,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/smb_auth-smb_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/smb_auth-smb_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -177,26 +185,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/SMB/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -207,24 +214,23 @@ smb_auth-smb_auth.$(OBJEXT): smb_auth.c
 smb_auth$(EXEEXT): $(smb_auth_OBJECTS) $(smb_auth_DEPENDENCIES) 
 	@rm -f smb_auth$(EXEEXT)
 	$(LINK) $(smb_auth_LDFLAGS) $(smb_auth_OBJECTS) $(smb_auth_LDADD) $(LIBS)
+libexecSCRIPT_INSTALL = $(INSTALL_SCRIPT)
 install-libexecSCRIPTS: $(libexec_SCRIPTS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
-	  if test -f $$p; then \
-	    echo " $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f; \
-	  elif test -f $(srcdir)/$$p; then \
-	    echo " $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f; \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  if test -f $$d$$p; then \
+	    f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
+	    echo " $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f"; \
+	    $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecSCRIPTS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
+	  f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -235,16 +241,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smb_auth-smb_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smb_auth-smb_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -256,7 +262,7 @@ smb_auth-smb_auth.o: smb_auth.c
 @AMDEP_TRUE@	source='smb_auth.c' object='smb_auth-smb_auth.o' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/smb_auth-smb_auth.Po' tmpdepfile='$(DEPDIR)/smb_auth-smb_auth.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(smb_auth_CFLAGS) $(CFLAGS) -c -o smb_auth-smb_auth.o `test -f smb_auth.c || echo '$(srcdir)/'`smb_auth.c
+	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(smb_auth_CFLAGS) $(CFLAGS) -c -o smb_auth-smb_auth.o `test -f 'smb_auth.c' || echo '$(srcdir)/'`smb_auth.c
 
 smb_auth-smb_auth.obj: smb_auth.c
 @AMDEP_TRUE@	source='smb_auth.c' object='smb_auth-smb_auth.obj' libtool=no @AMDEPBACKSLASH@
@@ -266,53 +272,61 @@ smb_auth-smb_auth.obj: smb_auth.c
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -337,14 +351,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.4 2002/08/12 01:11:55 hno Exp $
+#  $Id: Makefile.am,v 1.5 2003/01/23 00:35:44 robertc Exp $
 #
 #
 
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,10 +17,9 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.26 2002/10/15 08:11:12 robertc Exp $
+#  $Id: Makefile.in,v 1.27 2003/01/23 00:35:44 robertc Exp $
 #
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -50,9 +50,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -64,6 +68,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -81,7 +89,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -94,7 +101,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -111,6 +117,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -143,7 +150,9 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/nis_support.Po $(DEPDIR)/yp_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/nis_support.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/yp_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -161,26 +170,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/YP/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -197,17 +205,17 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/nis_support.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/yp_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/nis_support.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/yp_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -217,53 +225,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -288,14 +304,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.2 2002/08/12 01:11:56 hno Exp $
+#  $Id: Makefile.am,v 1.3 2003/01/23 00:35:47 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.24 2002/10/15 08:11:12 robertc Exp $
+#  $Id: Makefile.in,v 1.25 2003/01/23 00:35:47 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -146,7 +153,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/getpwnam_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/getpwnam_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -164,26 +172,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/getpwnam/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -200,16 +207,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/getpwnam_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/getpwnam_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -219,53 +226,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -290,14 +305,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.3 2002/05/20 02:03:56 hno Exp $
+#  $Id: Makefile.am,v 1.4 2003/01/23 00:35:49 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.22 2002/10/15 08:11:13 robertc Exp $
+#  $Id: Makefile.in,v 1.23 2003/01/23 00:35:50 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -144,50 +151,51 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/multi-domain-NTLM/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecSCRIPT_INSTALL = $(INSTALL_SCRIPT)
 install-libexecSCRIPTS: $(libexec_SCRIPTS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
-	  if test -f $$p; then \
-	    echo " $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f; \
-	  elif test -f $(srcdir)/$$p; then \
-	    echo " $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f; \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  if test -f $$d$$p; then \
+	    f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
+	    echo " $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f"; \
+	    $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecSCRIPTS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
+	  f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
 uninstall-info-am:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -212,14 +220,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,5 +1,5 @@
 #!/usr/bin/perl
-# $Id: smb_auth.pl,v 1.3 2002/08/12 01:11:57 hno Exp $
+# $Id: smb_auth.pl,v 1.4 2003/01/23 00:35:50 robertc Exp $
 
 #if you define this, debugging output will be printed to STDERR.
 #$debug=1;
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.5 2002/08/12 01:11:57 hno Exp $
+#  $Id: Makefile.am,v 1.6 2003/01/23 00:35:52 robertc Exp $
 #
 
 libexec_PROGRAMS = wb_auth
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,9 +17,8 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.16 2002/10/15 08:11:13 robertc Exp $
+#  $Id: Makefile.in,v 1.17 2003/01/23 00:35:52 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -49,9 +49,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -63,6 +67,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -80,7 +88,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -93,7 +100,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -110,6 +116,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -142,8 +149,9 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/wb_basic_auth.Po \
-@AMDEP_TRUE@	$(DEPDIR)/wb_common.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/wb_basic_auth.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/wb_common.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -161,26 +169,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/basic_auth/winbind/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -197,17 +204,17 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wb_basic_auth.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wb_common.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wb_basic_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wb_common.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -217,53 +224,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -288,14 +303,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,6 @@
 #  Makefile for digest auth helpers in the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.1 2001/08/31 11:19:23 robertc Exp $
+#  $Id: Makefile.am,v 1.2 2003/01/23 00:35:53 robertc Exp $
 #
 
 DIST_SUBDIRS	= password
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -15,9 +16,8 @@
 
 #  Makefile for digest auth helpers in the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.21 2002/10/15 08:11:13 robertc Exp $
+#  $Id: Makefile.in,v 1.22 2003/01/23 00:35:53 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +48,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +66,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +87,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +99,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +115,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -138,9 +145,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/digest_auth/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -150,7 +155,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -170,7 +175,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -198,16 +203,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -218,45 +226,50 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(DIST_SUBDIRS); do \
+	list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -286,14 +299,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.1 2001/08/31 11:19:24 robertc Exp $
+#  $Id: Makefile.am,v 1.2 2003/01/23 00:35:54 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.23 2002/10/15 08:11:15 robertc Exp $
+#  $Id: Makefile.in,v 1.24 2003/01/23 00:35:54 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -146,7 +153,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/digest_pw_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/digest_pw_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -164,26 +172,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/digest_auth/password/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -200,16 +207,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/digest_pw_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/digest_pw_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -219,53 +226,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -290,14 +305,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,6 @@
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.2 2002/07/07 18:18:12 hno Exp $
+#  $Id: Makefile.am,v 1.3 2003/01/23 00:35:59 robertc Exp $
 #
 
 DIST_SUBDIRS	= ip_user ldap_group unix_group wbinfo_group winbind_group
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -15,9 +16,8 @@
 
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.11 2002/10/15 08:11:16 robertc Exp $
+#  $Id: Makefile.in,v 1.12 2003/01/23 00:35:59 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +48,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +66,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +87,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +99,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +115,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -138,9 +145,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/external_acl/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -150,7 +155,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -170,7 +175,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -198,16 +203,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -218,45 +226,50 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(DIST_SUBDIRS); do \
+	list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -286,14 +299,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the ip_user external_acl helper by Rodrigo Campos
 #
-#  $Id: Makefile.am,v 1.2 2002/07/22 00:38:14 robertc Exp $
+#  $Id: Makefile.am,v 1.3 2003/01/23 00:36:01 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the ip_user external_acl helper by Rodrigo Campos
 #
-#  $Id: Makefile.in,v 1.11 2002/10/15 08:11:17 robertc Exp $
+#  $Id: Makefile.in,v 1.12 2003/01/23 00:36:01 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -163,8 +170,9 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/dict.Po $(DEPDIR)/main.Po \
-@AMDEP_TRUE@	$(DEPDIR)/match.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/dict.Po ./$(DEPDIR)/main.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/match.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -182,26 +190,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/external_acl/ip_user/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -218,18 +225,18 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/dict.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/main.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/match.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dict.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/main.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/match.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -239,53 +246,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -310,14 +325,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,4 +1,4 @@
-# $Id: Makefile.separate,v 1.1 2002/07/06 12:23:13 hno Exp $
+# $Id: Makefile.separate,v 1.2 2003/01/23 00:36:01 robertc Exp $
 CC=gcc
 CFLAGS=-Wall
 LIBS=
@@ -1,4 +1,4 @@
-$Id: README,v 1.1 2002/06/23 14:25:16 hno Exp $
+$Id: README,v 1.2 2003/01/23 00:36:01 robertc Exp $
 
 README file for ip_user_check, an external helper for the 
 Squid external acl scheme.
@@ -1,4 +1,4 @@
-/* $Id: dict.c,v 1.1 2002/06/23 14:25:17 hno Exp $ 
+/* $Id: dict.c,v 1.2 2003/01/23 00:36:01 robertc Exp $ 
 * Copyright (C) 2002 Rodrigo Campos
 *
 * This program is free software; you can redistribute it and/or modify
@@ -1,4 +1,4 @@
-# $Id: example.conf,v 1.1 2002/06/23 14:25:17 hno Exp $
+# $Id: example.conf,v 1.2 2003/01/23 00:36:01 robertc Exp $
 # Lines that begin with a # are ignored
 # The main format is:
 # 
@@ -1,4 +1,4 @@
-/* $Id: ip_user.h,v 1.1 2002/06/23 14:25:17 hno Exp $
+/* $Id: ip_user.h,v 1.2 2003/01/23 00:36:01 robertc Exp $
 * Copyright (C) 2002 Rodrigo Campos
 *
 * This program is free software; you can redistribute it and/or modify
@@ -1,4 +1,4 @@
-/* $Id: main.c,v 1.2 2002/07/06 12:33:09 hno Exp $ 
+/* $Id: main.c,v 1.3 2003/01/23 00:36:01 robertc Exp $ 
 * Copyright (C) 2002 Rodrigo Campos
 *
 * This program is free software; you can redistribute it and/or modify
@@ -1,4 +1,4 @@
-/* $Id: match.c,v 1.1 2002/06/23 14:25:17 hno Exp $ 
+/* $Id: match.c,v 1.2 2003/01/23 00:36:01 robertc Exp $ 
 * Copyright (C) 2002 Rodrigo Campos
 *
 * This program is free software; you can redistribute it and/or modify
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.am,v 1.3 2002/12/22 13:54:50 hno Exp $
+#  $Id: Makefile.am,v 1.4 2003/01/23 00:36:05 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.in,v 1.12 2002/12/23 01:12:55 hno Exp $
+#  $Id: Makefile.in,v 1.13 2003/01/23 00:36:06 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -146,7 +153,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/squid_ldap_group.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/squid_ldap_group.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -167,26 +175,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/external_acl/ldap_group/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -203,16 +210,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/squid_ldap_group.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/squid_ldap_group.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -237,6 +244,10 @@ install-man8: $(man8_MANS) $(man_MANS)
 	  if test -f $(srcdir)/$$i; then file=$(srcdir)/$$i; \
 	  else file=$$i; fi; \
 	  ext=`echo $$i | sed -e 's/^.*\\.//'`; \
+	  case "$$ext" in \
+	    8*) ;; \
+	    *) ext='8' ;; \
+	  esac; \
 	  inst=`echo $$i | sed -e 's/\\.[0-9a-z]*$$//'`; \
 	  inst=`echo $$inst | sed -e 's/^.*\///'`; \
 	  inst=`echo $$inst | sed '$(transform)'`.$$ext; \
@@ -261,53 +272,61 @@ uninstall-man8:
 	  rm -f $(DESTDIR)$(man8dir)/$$inst; \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -332,14 +351,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.am,v 1.2 2002/08/12 13:56:35 hno Exp $
+#  $Id: Makefile.am,v 1.3 2003/01/23 00:36:12 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.in,v 1.11 2002/10/15 08:11:22 robertc Exp $
+#  $Id: Makefile.in,v 1.12 2003/01/23 00:36:12 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -144,7 +151,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/check_group.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/check_group.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -165,26 +173,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/external_acl/unix_group/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -201,16 +208,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/check_group.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/check_group.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -235,6 +242,10 @@ install-man8: $(man8_MANS) $(man_MANS)
 	  if test -f $(srcdir)/$$i; then file=$(srcdir)/$$i; \
 	  else file=$$i; fi; \
 	  ext=`echo $$i | sed -e 's/^.*\\.//'`; \
+	  case "$$ext" in \
+	    8*) ;; \
+	    *) ext='8' ;; \
+	  esac; \
 	  inst=`echo $$i | sed -e 's/\\.[0-9a-z]*$$//'`; \
 	  inst=`echo $$inst | sed -e 's/^.*\///'`; \
 	  inst=`echo $$inst | sed '$(transform)'`.$$ext; \
@@ -259,53 +270,61 @@ uninstall-man8:
 	  rm -f $(DESTDIR)$(man8dir)/$$inst; \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -330,14 +349,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,4 +1,4 @@
-$Id: README,v 1.2 2002/08/12 13:56:35 hno Exp $
+$Id: README,v 1.3 2003/01/23 00:36:13 robertc Exp $
 
 This is the README file for check_group, an external
 helper fo the External ACL Scheme for Squid.
@@ -1,5 +1,5 @@
 /*
- * $Id: check_group.c,v 1.2 2002/10/22 09:45:16 hno Exp $
+ * $Id: check_group.c,v 1.3 2003/01/23 00:36:13 robertc Exp $
  *
  * This is a helper for the external ACL interface for Squid Cache
  * Copyright (C) 2002 Rodrigo Albani de Campos (rodrigo@geekbunker.org)
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.am,v 1.1 2002/07/06 12:23:14 hno Exp $
+#  $Id: Makefile.am,v 1.2 2003/01/23 00:36:16 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid LDAP authentication helper
 #
-#  $Id: Makefile.in,v 1.10 2002/10/15 08:11:23 robertc Exp $
+#  $Id: Makefile.in,v 1.11 2003/01/23 00:36:16 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -140,50 +147,51 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/external_acl/wbinfo_group/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecSCRIPT_INSTALL = $(INSTALL_SCRIPT)
 install-libexecSCRIPTS: $(libexec_SCRIPTS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
-	  if test -f $$p; then \
-	    echo " $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f; \
-	  elif test -f $(srcdir)/$$p; then \
-	    echo " $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f; \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  if test -f $$d$$p; then \
+	    f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
+	    echo " $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f"; \
+	    $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecSCRIPTS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
+	  f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
 uninstall-info-am:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -208,14 +216,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the wb_group external_acl helper
 #
-#  $Id: Makefile.am,v 1.3 2002/09/10 22:22:27 hno Exp $
+#  $Id: Makefile.am,v 1.4 2003/01/23 00:36:20 robertc Exp $
 #
 
 libexec_PROGRAMS = wb_group
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,9 +17,8 @@
 #
 #  Makefile for the wb_group external_acl helper
 #
-#  $Id: Makefile.in,v 1.11 2002/10/15 08:11:24 robertc Exp $
+#  $Id: Makefile.in,v 1.12 2003/01/23 00:36:20 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -49,9 +49,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -63,6 +67,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -80,7 +88,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -93,7 +100,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -110,6 +116,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -145,8 +152,9 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/wb_check_group.Po \
-@AMDEP_TRUE@	$(DEPDIR)/wb_common.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/wb_check_group.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/wb_common.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -164,26 +172,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/external_acl/winbind_group/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -200,17 +207,17 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wb_check_group.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wb_common.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wb_check_group.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wb_common.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -220,53 +227,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -291,14 +306,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,5 +1,5 @@
 /*
- * $Id: wb_check_group.c,v 1.7 2002/11/29 21:35:07 hno Exp $
+ * $Id: wb_check_group.c,v 1.8 2003/01/23 00:36:20 robertc Exp $
  *
  * This is a helper for the external ACL interface for Squid Cache
  * Copyright (C) 2002 Guido Serassio <squidnt@serassio.it>
@@ -1,6 +1,6 @@
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.5 2002/05/19 23:42:42 hno Exp $
+#  $Id: Makefile.am,v 1.6 2003/01/23 00:36:25 robertc Exp $
 #
 
 DIST_SUBDIRS	= fakeauth no_check SMB winbind
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -15,9 +16,8 @@
 
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.24 2002/10/15 08:11:25 robertc Exp $
+#  $Id: Makefile.in,v 1.25 2003/01/23 00:36:25 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +48,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +66,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +87,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +99,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +115,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -138,9 +145,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/ntlm_auth/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -150,7 +155,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -170,7 +175,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -198,16 +203,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -218,45 +226,50 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(DIST_SUBDIRS); do \
+	list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -286,14 +299,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.1 2001/08/31 11:19:26 robertc Exp $
+#  $Id: Makefile.am,v 1.2 2003/01/23 00:36:27 robertc Exp $
 #
 
 SUBDIRS = smbval
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,9 +17,8 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.24 2002/10/15 08:11:26 robertc Exp $
+#  $Id: Makefile.in,v 1.25 2003/01/23 00:36:27 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -49,9 +49,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -63,6 +67,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -80,7 +88,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -93,7 +100,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -110,6 +116,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -148,7 +155,9 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/libntlmssp.Po $(DEPDIR)/ntlm_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/libntlmssp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ntlm_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -172,26 +181,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/ntlm_auth/SMB/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -208,17 +216,17 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/libntlmssp.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ntlm_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libntlmssp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ntlm_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -235,7 +243,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -255,7 +263,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -283,16 +291,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -303,45 +314,50 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -372,14 +388,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -14,7 +15,6 @@
 @SET_MAKE@
 
 # makefile for smblib
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -45,9 +45,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -59,6 +63,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -76,7 +84,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -89,7 +96,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -106,6 +112,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -146,11 +153,12 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/md4.Po $(DEPDIR)/rfcnb-io.Po \
-@AMDEP_TRUE@	$(DEPDIR)/rfcnb-util.Po $(DEPDIR)/session.Po \
-@AMDEP_TRUE@	$(DEPDIR)/smbdes.Po $(DEPDIR)/smbencrypt.Po \
-@AMDEP_TRUE@	$(DEPDIR)/smblib-util.Po $(DEPDIR)/smblib.Po \
-@AMDEP_TRUE@	$(DEPDIR)/valid.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/md4.Po ./$(DEPDIR)/rfcnb-io.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/rfcnb-util.Po ./$(DEPDIR)/session.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/smbdes.Po ./$(DEPDIR)/smbencrypt.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/smblib-util.Po ./$(DEPDIR)/smblib.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/valid.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -168,11 +176,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/ntlm_auth/SMB/smbval/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
-
-AR = ar
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 
 clean-noinstLIBRARIES:
 	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
@@ -187,24 +191,24 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/md4.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/rfcnb-io.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/rfcnb-util.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/session.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smbdes.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smbencrypt.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smblib-util.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/smblib.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/valid.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/md4.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rfcnb-io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rfcnb-util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/session.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smbdes.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smbencrypt.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smblib-util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smblib.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/valid.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -214,53 +218,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -284,14 +296,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.1 2001/08/31 11:19:27 robertc Exp $
+#  $Id: Makefile.am,v 1.2 2003/01/23 00:36:34 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.23 2002/10/15 08:11:29 robertc Exp $
+#  $Id: Makefile.in,v 1.24 2003/01/23 00:36:35 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -146,7 +153,8 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/fakeauth_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/fakeauth_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -164,26 +172,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/ntlm_auth/fakeauth/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -200,16 +207,16 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/fakeauth_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fakeauth_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -219,53 +226,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -290,14 +305,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,5 +1,5 @@
 /*
- * $Id: ntlm.h,v 1.4 2001/08/29 14:57:38 robertc Exp $
+ * $Id: ntlm.h,v 1.5 2003/01/23 00:36:35 robertc Exp $
  *
  * AUTHOR: Andrew Doran <ad@interlude.eu.org>
  *
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.3 2002/05/20 02:03:57 hno Exp $
+#  $Id: Makefile.am,v 1.4 2003/01/23 00:36:38 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.25 2002/10/15 08:11:31 robertc Exp $
+#  $Id: Makefile.in,v 1.26 2003/01/23 00:36:38 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -142,50 +149,51 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/ntlm_auth/no_check/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecSCRIPT_INSTALL = $(INSTALL_SCRIPT)
 install-libexecSCRIPTS: $(libexec_SCRIPTS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
-	  if test -f $$p; then \
-	    echo " $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $$p $(DESTDIR)$(libexecdir)/$$f; \
-	  elif test -f $(srcdir)/$$p; then \
-	    echo " $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f"; \
-	    $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(libexecdir)/$$f; \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  if test -f $$d$$p; then \
+	    f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
+	    echo " $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f"; \
+	    $(libexecSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecSCRIPTS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
+	  f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
 uninstall-info-am:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -210,14 +218,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.5 2002/05/23 14:01:20 hno Exp $
+#  $Id: Makefile.am,v 1.6 2003/01/23 00:36:40 robertc Exp $
 #
 
 libexec_PROGRAMS = wb_ntlmauth
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,9 +17,8 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.16 2002/10/15 08:11:32 robertc Exp $
+#  $Id: Makefile.in,v 1.17 2003/01/23 00:36:40 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -49,9 +49,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -63,6 +67,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -80,7 +88,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -93,7 +100,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -110,6 +116,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -148,7 +155,9 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/wb_common.Po $(DEPDIR)/wb_ntlm_auth.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/wb_common.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/wb_ntlm_auth.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -166,26 +175,25 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  helpers/ntlm_auth/winbind/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -202,17 +210,17 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wb_common.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wb_ntlm_auth.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wb_common.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wb_ntlm_auth.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -222,54 +230,62 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
 	$(mkinstalldirs) $(distdir)/patches
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -294,14 +310,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,4 +1,4 @@
-# $Id: Makefile.am,v 1.5 2001/11/30 15:27:13 hno Exp $
+# $Id: Makefile.am,v 1.6 2003/01/23 00:36:43 robertc Exp $
 #
 
 ICON1	=	anthony-binhex.gif
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -13,9 +14,8 @@
 
 @SET_MAKE@
 
-# $Id: Makefile.in,v 1.35 2002/10/15 08:11:35 robertc Exp $
+# $Id: Makefile.in,v 1.36 2003/01/23 00:36:43 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -46,9 +46,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -60,6 +64,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -77,7 +85,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -90,7 +97,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -107,6 +113,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -164,18 +171,17 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  icons/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
+iconDATA_INSTALL = $(INSTALL_DATA)
 install-iconDATA: $(icon_DATA)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(icondir)
 	@list='$(icon_DATA)'; for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  f="`echo $$p | sed -e 's|^.*/||'`"; \
-	  echo " $(INSTALL_DATA) $$d$$p $(DESTDIR)$(icondir)/$$f"; \
-	  $(INSTALL_DATA) $$d$$p $(DESTDIR)$(icondir)/$$f; \
+	  echo " $(iconDATA_INSTALL) $$d$$p $(DESTDIR)$(icondir)/$$f"; \
+	  $(iconDATA_INSTALL) $$d$$p $(DESTDIR)$(icondir)/$$f; \
 	done
 
 uninstall-iconDATA:
@@ -188,22 +194,26 @@ uninstall-iconDATA:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -228,14 +238,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
 
 maintainer-clean-generic:
@@ -1,5 +1,5 @@
 /*
- * $Id: Array.h,v 1.9 2003/01/18 14:06:33 robertc Exp $
+ * $Id: Array.h,v 1.10 2003/01/23 00:36:46 robertc Exp $
  *
  * AUTHOR: Alex Rousskov
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: GNUregex.h,v 1.7 2001/10/08 16:18:31 hno Exp $
+ * $Id: GNUregex.h,v 1.8 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_REGEXP_LIBRARY_H
@@ -1,6 +1,6 @@
 
 /*
- * $Id: Range.h,v 1.1 2003/01/22 11:05:49 robertc Exp $
+ * $Id: Range.h,v 1.2 2003/01/23 00:36:47 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -35,26 +35,34 @@
 #define SQUID_RANGE_H
 
 /* represents [start, end) */
-template <class C> class Range {
-  public:
+
+template <class C>
+
+class Range
+{
+
+public:
     Range (C start_, C end_);
     C start;
     C end;
     Range intersection (Range const &);
     size_t size() const;
 };
 
-template<class C> 
+template<class C>
 Range<C>::Range (C start_, C end_) : start(start_), end(end_){}
 
-template<class C> class Range<C>
-Range<C>::intersection (Range const &rhs)
+template<class C>
+
+class Range<C>
+            Range<C>::intersection (Range const &rhs)
 {
     Range<C> result (XMAX(start, rhs.start), XMIN(end, rhs.end));
     return result;
 }
 
-template<class C> size_t
+template<class C>
+size_t
 Range<C>::size() const
 {
     return end > start ? end - start : 0;
@@ -1,6 +1,6 @@
 
 /*
- * $Id: RefCount.h,v 1.2 2002/12/13 03:41:28 robertc Exp $
+ * $Id: RefCount.h,v 1.3 2003/01/23 00:36:47 robertc Exp $
  *
  * DEBUG: section xx    Refcount allocator
  * AUTHOR:  Robert Collins
@@ -1,5 +1,5 @@
 /*
- * $Id: Stack.h,v 1.13 2003/01/22 10:05:42 robertc Exp $
+ * $Id: Stack.h,v 1.14 2003/01/23 00:36:47 robertc Exp $
  *
  * AUTHOR: Alex Rousskov
  *
@@ -28,7 +28,7 @@
  * ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
  * SOFTWARE.
  * 
- * $Id: asn1.h,v 1.12 2001/10/08 16:18:31 hno Exp $
+ * $Id: asn1.h,v 1.13 2003/01/23 00:36:47 robertc Exp $
  * 
  **********************************************************************/
 
@@ -1,5 +1,5 @@
 /*
- * $Id: cache_snmp.h,v 1.26 2001/10/08 16:55:25 hno Exp $
+ * $Id: cache_snmp.h,v 1.27 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_CACHE_SNMP_H
@@ -1,5 +1,5 @@
 /*
- * $Id: config.h,v 1.7 2002/10/13 20:34:51 robertc Exp $
+ * $Id: config.h,v 1.8 2003/01/23 00:36:47 robertc Exp $
  *
  * AUTHOR: Duane Wessels
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: hash.h,v 1.7 2002/10/15 09:25:32 robertc Exp $
+ * $Id: hash.h,v 1.8 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_HASH_H
@@ -1,5 +1,5 @@
 /*
- * $Id: heap.h,v 1.5 2002/10/13 20:34:51 robertc Exp $
+ * $Id: heap.h,v 1.6 2003/01/23 00:36:47 robertc Exp $
  *
  * AUTHOR: John Dilley, Hewlett Packard
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: md5.h,v 1.14 2002/10/13 20:34:51 robertc Exp $
+ * $Id: md5.h,v 1.15 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_MD5_H
@@ -1,5 +1,5 @@
 /*
- * $Id: ntlmauth.h,v 1.9 2002/10/06 02:05:22 robertc Exp $
+ * $Id: ntlmauth.h,v 1.10 2003/01/23 00:36:47 robertc Exp $
  *
  * * * * * * * * Legal stuff * * * * * * *
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: parse.h,v 1.11 2001/10/17 19:05:37 hno Exp $
+ * $Id: parse.h,v 1.12 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_PARSE_H
@@ -1,5 +1,5 @@
 /*
- * $Id: radix.h,v 1.15 2002/10/14 07:50:38 hno Exp $
+ * $Id: radix.h,v 1.16 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_RADIX_H
@@ -1,5 +1,5 @@
 /*
- * $Id: rfc1035.h,v 1.8 2002/10/13 20:34:51 robertc Exp $
+ * $Id: rfc1035.h,v 1.9 2003/01/23 00:36:47 robertc Exp $
  *
  * AUTHOR: Duane Wessels
  *
@@ -14,7 +14,7 @@
 
 
 /*
- * $Id: rfc2617.h,v 1.4 2002/10/13 20:34:51 robertc Exp $
+ * $Id: rfc2617.h,v 1.5 2003/01/23 00:36:47 robertc Exp $
  *
  * DEBUG:
  * AUTHOR: RFC 2617 & Robert Collins
@@ -24,7 +24,7 @@
  * ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
  * SOFTWARE.
  * 
- * $Id: snmp-internal.h,v 1.3 2001/10/08 16:18:31 hno Exp $
+ * $Id: snmp-internal.h,v 1.4 2003/01/23 00:36:47 robertc Exp $
  * 
  **********************************************************************/
 
@@ -26,7 +26,7 @@
  * 
  * Author: Ryan Troll <ryan+@andrew.cmu.edu>
  * 
- * $Id: snmp-mib.h,v 1.3 2001/10/08 16:18:31 hno Exp $
+ * $Id: snmp-mib.h,v 1.4 2003/01/23 00:36:47 robertc Exp $
  * 
  ***************************************************************************/
 
@@ -27,7 +27,7 @@
  * ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
  * SOFTWARE.
  * 
- * $Id: snmp.h,v 1.15 2002/02/13 02:01:10 hno Exp $
+ * $Id: snmp.h,v 1.16 2003/01/23 00:36:47 robertc Exp $
  * 
  **********************************************************************/
 
@@ -1,5 +1,5 @@
 /*
- * $Id: snmp_api.h,v 1.12 2001/10/08 16:18:31 hno Exp $
+ * $Id: snmp_api.h,v 1.13 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_SNMP_API_H
@@ -26,7 +26,7 @@
  * 
  * Author: Ryan Troll <ryan+@andrew.cmu.edu>
  * 
- * $Id: snmp_api_error.h,v 1.4 2001/10/17 19:05:37 hno Exp $
+ * $Id: snmp_api_error.h,v 1.5 2003/01/23 00:36:47 robertc Exp $
  * 
  ***************************************************************************/
 
@@ -1,5 +1,5 @@
 /*
- * $Id: snmp_api_util.h,v 1.4 2001/10/08 16:18:31 hno Exp $
+ * $Id: snmp_api_util.h,v 1.5 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_SNMP_API_UTIL_H
@@ -1,5 +1,5 @@
 /*
- * $Id: snmp_client.h,v 1.8 2001/10/08 16:18:31 hno Exp $
+ * $Id: snmp_client.h,v 1.9 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_SNMP_CLIENT_H
@@ -26,7 +26,7 @@
  * 
  * Author: Ryan Troll <ryan+@andrew.cmu.edu>
  * 
- * $Id: snmp_coexist.h,v 1.3 2001/10/08 16:18:31 hno Exp $
+ * $Id: snmp_coexist.h,v 1.4 2003/01/23 00:36:47 robertc Exp $
  * 
  **********************************************************************/
 
@@ -1,5 +1,5 @@
 /*
- * $Id: snmp_debug.h,v 1.12 2002/10/13 20:34:51 robertc Exp $
+ * $Id: snmp_debug.h,v 1.13 2003/01/23 00:36:47 robertc Exp $
  */
 
 #ifndef SQUID_SNMP_DEBUG_H
@@ -24,7 +24,7 @@
  * ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
  * SOFTWARE.
  * 
- * $Id: snmp_error.h,v 1.4 2001/10/17 19:05:37 hno Exp $
+ * $Id: snmp_error.h,v 1.5 2003/01/23 00:36:47 robertc Exp $
  * 
  **********************************************************************/
 
@@ -1,5 +1,5 @@
 /*
- * $Id: snmp_impl.h,v 1.14 2002/02/19 00:27:43 hno Exp $
+ * $Id: snmp_impl.h,v 1.15 2003/01/23 00:36:48 robertc Exp $
  */
 
 #ifndef SQUID_SNMP_IMPL_H
@@ -26,7 +26,7 @@
  * 
  * Author: Ryan Troll <ryan+@andrew.cmu.edu>
  * 
- * $Id: snmp_msg.h,v 1.3 2001/10/08 16:18:31 hno Exp $
+ * $Id: snmp_msg.h,v 1.4 2003/01/23 00:36:48 robertc Exp $
  * 
  **********************************************************************/
 
@@ -25,7 +25,7 @@
  * 
  * Author: Ryan Troll <ryan+@andrew.cmu.edu>
  * 
- * $Id: snmp_pdu.h,v 1.10 2002/10/13 20:34:51 robertc Exp $
+ * $Id: snmp_pdu.h,v 1.11 2003/01/23 00:36:48 robertc Exp $
  * 
  **********************************************************************/
 
@@ -24,7 +24,7 @@
  * ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
  * SOFTWARE.
  * 
- * $Id: snmp_session.h,v 1.4 2001/10/17 19:05:37 hno Exp $
+ * $Id: snmp_session.h,v 1.5 2003/01/23 00:36:48 robertc Exp $
  * 
  **********************************************************************/
 
@@ -1,5 +1,5 @@
 /*
- * $Id: snmp_util.h,v 1.9 2002/10/13 20:34:51 robertc Exp $
+ * $Id: snmp_util.h,v 1.10 2003/01/23 00:36:48 robertc Exp $
  */
 
 #ifndef SQUID_SNMP_UTIL_H
@@ -25,7 +25,7 @@
  * 
  * Author: Ryan Troll <ryan+@andrew.cmu.edu>
  * 
- * $Id: snmp_vars.h,v 1.12 2002/10/13 20:34:51 robertc Exp $
+ * $Id: snmp_vars.h,v 1.13 2003/01/23 00:36:48 robertc Exp $
  * 
  **********************************************************************/
 
@@ -1,5 +1,5 @@
 /*
- * $Id: snprintf.h,v 1.6 2001/10/08 16:18:31 hno Exp $
+ * $Id: snprintf.h,v 1.7 2003/01/23 00:36:48 robertc Exp $
  */
 
 #ifndef SQUID_SNPRINTF_H
@@ -1,5 +1,5 @@
 /*
- * $Id: splay.h,v 1.12 2002/10/13 20:34:51 robertc Exp $
+ * $Id: splay.h,v 1.13 2003/01/23 00:36:48 robertc Exp $
  */
 
 #ifndef SQUID_SPLAY_H
@@ -1,5 +1,5 @@
 /*
- * $Id: squid_types.h,v 1.6 2002/10/07 14:15:32 hno Exp $
+ * $Id: squid_types.h,v 1.7 2003/01/23 00:36:48 robertc Exp $
  *
  * * * * * * * * Legal stuff * * * * * * *
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: tempnam.h,v 1.11 2001/10/08 16:18:31 hno Exp $
+ * $Id: tempnam.h,v 1.12 2003/01/23 00:36:48 robertc Exp $
  */
 
 
@@ -1,5 +1,5 @@
 /*
- * $Id: util.h,v 1.66 2003/01/17 04:53:35 robertc Exp $
+ * $Id: util.h,v 1.67 2003/01/23 00:36:48 robertc Exp $
  *
  * AUTHOR: Harvest Derived
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: version.h,v 1.133 2001/08/31 11:19:09 robertc Exp $
+ * $Id: version.h,v 1.134 2003/01/23 00:36:48 robertc Exp $
  *
  *  SQUID_VERSION - String for version id of this distribution
  */
@@ -1,5 +1,5 @@
 /*
- * $Id: Array.cc,v 1.9 2003/01/18 14:06:32 robertc Exp $
+ * $Id: Array.cc,v 1.10 2003/01/23 00:37:00 robertc Exp $
  *
  * AUTHOR: Alex Rousskov
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: GNUregex.c,v 1.12 2001/01/07 09:55:22 hno Exp $
+ * $Id: GNUregex.c,v 1.13 2003/01/23 00:37:00 robertc Exp $
  */
 
 /* Extended regular expression matching and search library,
@@ -1,6 +1,6 @@
 ## Process this file with automake to produce Makefile.in
 #
-#  $Id: Makefile.am,v 1.7 2003/01/22 10:05:41 robertc Exp $
+#  $Id: Makefile.am,v 1.8 2003/01/23 00:37:01 robertc Exp $
 #
 
 if ENABLE_XPROF_STATS
@@ -1,6 +1,6 @@
 
 /*
- * $Id: MemPool.c,v 1.14 2002/11/15 13:07:25 hno Exp $
+ * $Id: MemPool.c,v 1.15 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG: section 63    Low Level Memory Pool Management
  * AUTHOR: Alex Rousskov, Andres Kroonmaa
@@ -1,6 +1,6 @@
 
 /*
- * $Id: Profiler.c,v 1.1 2002/10/02 11:06:30 robertc Exp $
+ * $Id: Profiler.c,v 1.2 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG: section 81     CPU Profiling Routines
  * AUTHOR: Andres Kroonmaa, Sep.2000
@@ -1,5 +1,5 @@
 /*
- * $Id: base64.c,v 1.20 2002/04/19 21:03:48 hno Exp $
+ * $Id: base64.c,v 1.21 2003/01/23 00:37:01 robertc Exp $
  */
 
 #include "config.h"
@@ -1,5 +1,5 @@
 /*
- * $Id: dlmalloc.c,v 1.4 2001/02/23 20:05:16 hno Exp $
+ * $Id: dlmalloc.c,v 1.5 2003/01/23 00:37:01 robertc Exp $
  */
 
 /* ---------- To make a malloc.h, start cutting here ------------ */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: getfullhostname.c,v 1.19 2001/01/12 00:37:12 wessels Exp $
+ * $Id: getfullhostname.c,v 1.20 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG: 
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: hash.c,v 1.14 2002/10/15 09:25:32 robertc Exp $
+ * $Id: hash.c,v 1.15 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG: section 0     Hash Tables
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: heap.c,v 1.8 2001/02/07 18:56:50 hno Exp $
+ * $Id: heap.c,v 1.9 2003/01/23 00:37:01 robertc Exp $
  *
  * AUTHOR: John Dilley, Hewlett Packard
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: html_quote.c,v 1.4 2001/10/17 19:46:43 hno Exp $
+ * $Id: html_quote.c,v 1.5 2003/01/23 00:37:01 robertc Exp $
  * 
  * DEBUG:
  * AUTHOR: Robert Collins
@@ -1,5 +1,5 @@
 /*
- * $Id: iso3307.c,v 1.5 2001/02/07 18:56:50 hno Exp $
+ * $Id: iso3307.c,v 1.6 2003/01/23 00:37:01 robertc Exp $
  */
 
 #include "config.h"
@@ -1,5 +1,5 @@
 /*
- * $Id: md5-test.c,v 1.2 1998/09/23 17:16:11 wessels Exp $
+ * $Id: md5-test.c,v 1.3 2003/01/23 00:37:01 robertc Exp $
  */
 
 /*
@@ -1,5 +1,5 @@
 /*
- * $Id: md5.c,v 1.15 2002/08/09 10:57:42 robertc Exp $
+ * $Id: md5.c,v 1.16 2003/01/23 00:37:01 robertc Exp $
  */
 
 /* taken from RFC-1321/Appendix A.3 */
@@ -1,5 +1,5 @@
 /*
- * $Id: ntlmauth.c,v 1.7 2002/07/22 02:05:00 hno Exp $
+ * $Id: ntlmauth.c,v 1.8 2003/01/23 00:37:01 robertc Exp $
  *
  * * * * * * * * Legal stuff * * * * * * *
  *
@@ -1,5 +1,5 @@
 /*
- * $Id: radix.c,v 1.18 2002/10/18 22:42:00 hno Exp $
+ * $Id: radix.c,v 1.19 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG: section 53     Radix tree data structure implementation
  * AUTHOR: NetBSD Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: rfc1035.c,v 1.28 2002/10/18 22:42:00 hno Exp $
+ * $Id: rfc1035.c,v 1.29 2003/01/23 00:37:01 robertc Exp $
  *
  * Low level DNS protocol routines
  * AUTHOR: Duane Wessels
@@ -1,6 +1,6 @@
 
 /*
- * $Id: rfc1123.c,v 1.30 2002/10/06 02:05:22 robertc Exp $
+ * $Id: rfc1123.c,v 1.31 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG: 
  * AUTHOR: Harvest Derived
@@ -1,5 +1,5 @@
 /*
- * $Id: rfc1738.c,v 1.23 2001/02/07 18:56:51 hno Exp $
+ * $Id: rfc1738.c,v 1.24 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG: 
  * AUTHOR: Harvest Derived
@@ -13,7 +13,7 @@
 
 
 /*
- * $Id: rfc2617.c,v 1.6 2002/10/18 22:42:00 hno Exp $
+ * $Id: rfc2617.c,v 1.7 2003/01/23 00:37:01 robertc Exp $
  *
  * DEBUG:
  * AUTHOR: RFC 2617 & Robert Collins
@@ -1,6 +1,6 @@
 
 /*
- * $Id: safe_inet_addr.c,v 1.12 2001/02/07 18:56:51 hno Exp $
+ * $Id: safe_inet_addr.c,v 1.13 2003/01/23 00:37:01 robertc Exp $
  */
 
 #include "config.h"
@@ -1,5 +1,5 @@
 /*
- * $Id: snprintf.c,v 1.18 2001/01/07 10:57:14 hno Exp $
+ * $Id: snprintf.c,v 1.19 2003/01/23 00:37:01 robertc Exp $
  */
 
 /* ====================================================================
@@ -1,5 +1,5 @@
 /*
- * $Id: splay.c,v 1.14 2002/10/18 22:42:00 hno Exp $
+ * $Id: splay.c,v 1.15 2003/01/23 00:37:01 robertc Exp $
  *
  * based on ftp://ftp.cs.cmu.edu/user/sleator/splaying/top-down-splay.c
  * http://bobo.link.cs.cmu.edu/cgi-bin/splay/splay-cgi.pl
@@ -1,5 +1,5 @@
 /*
- * $Id: strerror.c,v 1.6 2001/01/12 00:37:13 wessels Exp $
+ * $Id: strerror.c,v 1.7 2003/01/23 00:37:02 robertc Exp $
  *
  * DEBUG: 
  * AUTHOR: Duane Wessels
@@ -1,5 +1,5 @@
 /*
- * $Id: stub_memaccount.c,v 1.5 2001/02/07 18:56:51 hno Exp $
+ * $Id: stub_memaccount.c,v 1.6 2003/01/23 00:37:02 robertc Exp $
  */
 
 /* Stub function for programs not implementing statMemoryAccounted */
@@ -1,5 +1,5 @@
 /*
- * $Id: tempnam.c,v 1.10 1998/09/23 17:14:24 wessels Exp $
+ * $Id: tempnam.c,v 1.11 2003/01/23 00:37:02 robertc Exp $
  */
 
 /* A reasonably functional tmpnam. */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: util.c,v 1.88 2002/10/18 22:42:00 hno Exp $
+ * $Id: util.c,v 1.89 2003/01/23 00:37:02 robertc Exp $
  *
  * DEBUG: 
  * AUTHOR: Harvest Derived
@@ -1,5 +1,5 @@
 /*
- * $Id: uudecode.c,v 1.9 1998/09/23 17:16:13 wessels Exp $
+ * $Id: uudecode.c,v 1.10 2003/01/23 00:37:02 robertc Exp $
  */
 
 #include "config.h"
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -17,7 +18,6 @@
 #  This file is a Makefile for compiling and installing Cache Manager. 
 #  Cache Manager is a manager program for Internet Object Cache.
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +48,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +66,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +87,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +99,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +115,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -139,54 +146,55 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  scripts/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 RunCache: $(top_builddir)/config.status RunCache.in
-	cd $(top_builddir) && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= CONFIG_LINKS= $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@
 RunAccel: $(top_builddir)/config.status RunAccel.in
-	cd $(top_builddir) && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= CONFIG_LINKS= $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@
+binSCRIPT_INSTALL = $(INSTALL_SCRIPT)
 install-binSCRIPTS: $(bin_SCRIPTS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(bindir)
 	@list='$(bin_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
-	  if test -f $$p; then \
-	    echo " $(INSTALL_SCRIPT) $$p $(DESTDIR)$(bindir)/$$f"; \
-	    $(INSTALL_SCRIPT) $$p $(DESTDIR)$(bindir)/$$f; \
-	  elif test -f $(srcdir)/$$p; then \
-	    echo " $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(bindir)/$$f"; \
-	    $(INSTALL_SCRIPT) $(srcdir)/$$p $(DESTDIR)$(bindir)/$$f; \
+	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
+	  if test -f $$d$$p; then \
+	    f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
+	    echo " $(binSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(bindir)/$$f"; \
+	    $(binSCRIPT_INSTALL) $$d$$p $(DESTDIR)$(bindir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-binSCRIPTS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(bin_SCRIPTS)'; for p in $$list; do \
-	  f="`echo $$p|sed '$(transform)'`"; \
+	  f=`echo "$$p" | sed 's|^.*/||;$(transform)'`; \
 	  echo " rm -f $(DESTDIR)$(bindir)/$$f"; \
 	  rm -f $(DESTDIR)$(bindir)/$$f; \
 	done
 uninstall-info-am:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -211,14 +219,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,6 @@
 #!/bin/sh
 #
-#  $Id: RunAccel.in,v 1.6 2003/01/09 11:39:53 hno Exp $
+#  $Id: RunAccel.in,v 1.7 2003/01/23 00:37:06 robertc Exp $
 
 # enable HTTP requests on port 80
 port="-a 80"
@@ -1,6 +1,6 @@
 #!/bin/sh
 #
-#  $Id: RunCache.in,v 1.10 2003/01/09 11:39:53 hno Exp $
+#  $Id: RunCache.in,v 1.11 2003/01/23 00:37:06 robertc Exp $
 
 prefix=@prefix@
 exec_prefix=@exec_prefix@
@@ -8,7 +8,7 @@
 # Check the Squid-1.1.x cache directory for stale objects - i.e. those
 # which exist on disk but aren't listed in cached's log file.
 
-# $Id: check_cache.pl,v 1.4 1997/02/03 23:42:21 wessels Exp $
+# $Id: check_cache.pl,v 1.5 2003/01/23 00:37:06 robertc Exp $
 
 require "getopts.pl";
 &Getopts("c:drt:vh");
@@ -1,6 +1,6 @@
 #!/usr/bin/perl -w
 
-# $Id: fileno-to-pathname.pl,v 1.3 2002/04/07 02:33:40 hno Exp $
+# $Id: fileno-to-pathname.pl,v 1.4 2003/01/23 00:37:06 robertc Exp $
 # Convert hexadecimal cache file numbers (from swap log) into full pathnames.  
 # Duane Wessels 6/30/97
 
@@ -6,7 +6,7 @@
 # - i.e. those for which there is a "Content-length:" HTTP header,
 #   and this does not match the size of the cached object
 
-# $Id: flag_truncs.pl,v 1.1 1996/02/22 06:23:57 wessels Exp $
+# $Id: flag_truncs.pl,v 1.2 2003/01/23 00:37:06 robertc Exp $
 
 require "getopts.pl";
 require "stat.pl";
@@ -1,6 +1,6 @@
 #!/usr/local/bin/perl
 
-# $Id: upgrade-1.0-store.pl,v 1.2 1996/10/11 19:56:06 wessels Exp $
+# $Id: upgrade-1.0-store.pl,v 1.3 2003/01/23 00:37:06 robertc Exp $
 
 select(STDERR); $|=1;
 select(STDOUT); $|=1;
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -12,7 +13,6 @@
 # PARTICULAR PURPOSE.
 
 @SET_MAKE@
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -43,9 +43,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -57,6 +61,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -74,7 +82,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -87,7 +94,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -104,16 +110,16 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
+
+VERSION = 3.4
 XTRA_LIBS = @XTRA_LIBS@
 XTRA_OBJS = @XTRA_OBJS@
 am__include = @am__include@
 am__quote = @am__quote@
 install_sh = @install_sh@
 makesnmplib = @makesnmplib@
-
-VERSION = 3.4
-
 noinst_LIBRARIES = libsnmp.a
 libsnmp_a_SOURCES = asn1.c parse.c snmp_vars.c \
 	coexistance.c snmp_api.c snmp_error.c  \
@@ -141,12 +147,14 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/asn1.Po $(DEPDIR)/coexistance.Po \
-@AMDEP_TRUE@	$(DEPDIR)/mib.Po $(DEPDIR)/parse.Po \
-@AMDEP_TRUE@	$(DEPDIR)/snmp_api.Po $(DEPDIR)/snmp_api_error.Po \
-@AMDEP_TRUE@	$(DEPDIR)/snmp_error.Po $(DEPDIR)/snmp_msg.Po \
-@AMDEP_TRUE@	$(DEPDIR)/snmp_pdu.Po $(DEPDIR)/snmp_vars.Po \
-@AMDEP_TRUE@	$(DEPDIR)/snmplib_debug.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/asn1.Po ./$(DEPDIR)/coexistance.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/mib.Po ./$(DEPDIR)/parse.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/snmp_api.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/snmp_api_error.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/snmp_error.Po ./$(DEPDIR)/snmp_msg.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/snmp_pdu.Po ./$(DEPDIR)/snmp_vars.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/snmplib_debug.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -164,11 +172,7 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  snmplib/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
-
-AR = ar
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 
 clean-noinstLIBRARIES:
 	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
@@ -183,26 +187,26 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/asn1.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/coexistance.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/mib.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/parse.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_api.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_api_error.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_error.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_msg.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_pdu.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_vars.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmplib_debug.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/asn1.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/coexistance.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mib.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/parse.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_api.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_api_error.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_error.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_msg.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_pdu.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_vars.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmplib_debug.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -212,53 +216,61 @@ distclean-depend:
 CCDEPMODE = @CCDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -282,14 +294,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,6 @@
 
 /*
- * $Id: CacheDigest.cc,v 1.34 2002/10/13 20:34:56 robertc Exp $
+ * $Id: CacheDigest.cc,v 1.35 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 70    Cache Digest
  * AUTHOR: Alex Rousskov
@@ -1,6 +1,6 @@
 
 /*
- * $Id: Debug.h,v 1.1 2003/01/17 05:14:29 robertc Exp $
+ * $Id: Debug.h,v 1.2 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 0     Debug Routines
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: ETag.cc,v 1.8 2001/01/12 00:37:13 wessels Exp $
+ * $Id: ETag.cc,v 1.9 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: none          ETag parsing support
  * AUTHOR: Alex Rousskov
@@ -1,6 +1,6 @@
 
 /*
- * $Id: Generic.h,v 1.2 2002/10/25 03:57:30 robertc Exp $
+ * $Id: Generic.h,v 1.3 2003/01/23 00:37:12 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpBody.cc,v 1.18 2001/01/12 00:37:13 wessels Exp $
+ * $Id: HttpBody.cc,v 1.19 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 56    HTTP Message Body
  * AUTHOR: Alex Rousskov
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpHdrCc.cc,v 1.23 2002/10/13 20:34:56 robertc Exp $
+ * $Id: HttpHdrCc.cc,v 1.24 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 65    HTTP Cache Control Header
  * AUTHOR: Alex Rousskov
@@ -123,12 +123,12 @@ httpHdrCcParseInit(HttpHdrCc * cc, const String * str)
 	type = (http_hdr_cc_type ) httpHeaderIdByName(item, ilen,
 	    CcFieldsInfo, CC_ENUM_END);
 	if (type < 0) {
-	    debug(65, 2) ("hdr cc: unknown cache-directive: near '%s' in '%s'\n", item, strBuf(*str));
+	    debug(65, 2) ("hdr cc: unknown cache-directive: near '%s' in '%s'\n", item, str->buf());
 	    type = CC_OTHER;
 	}
 	if (EBIT_TEST(cc->mask, type)) {
 	    if (type != CC_OTHER)
-		debug(65, 2) ("hdr cc: ignoring duplicate cache-directive: near '%s' in '%s'\n", item, strBuf(*str));
+		debug(65, 2) ("hdr cc: ignoring duplicate cache-directive: near '%s' in '%s'\n", item, str->buf());
 	    CcFieldsInfo[type].stat.repCount++;
 	    continue;
 	}
@@ -194,7 +194,7 @@ httpHdrCcPackInto(const HttpHdrCc * cc, Packer * p)
 	if (EBIT_TEST(cc->mask, flag) && flag != CC_OTHER) {
 
 	    /* print option name */
-	    packerPrintf(p, (pcount ? ", %s" : "%s"), strBuf(CcFieldsInfo[flag].name));
+	    packerPrintf(p, (pcount ? ", %s" : "%s"), CcFieldsInfo[flag].name.buf());
 
 	    /* handle options with values */
 	    if (flag == CC_MAX_AGE)
@@ -264,7 +264,7 @@ httpHdrCcStatDumper(StoreEntry * sentry, int idx, double val, double size, int c
     extern const HttpHeaderStat *dump_stat;	/* argh! */
     const int id = (int) val;
     const int valid_id = id >= 0 && id < CC_ENUM_END;
-    const char *name = valid_id ? strBuf(CcFieldsInfo[id].name) : "INVALID";
+    const char *name = valid_id ? CcFieldsInfo[id].name.buf() : "INVALID";
     if (count || valid_id)
 	storeAppendPrintf(sentry, "%2d\t %-20s\t %5d\t %6.2f\n",
 	    id, name, count, xdiv(count, dump_stat->ccParsedCount));
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpHdrContRange.cc,v 1.15 2002/10/13 20:34:56 robertc Exp $
+ * $Id: HttpHdrContRange.cc,v 1.16 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 68    HTTP Content-Range Header
  * AUTHOR: Alex Rousskov
@@ -34,6 +34,7 @@
  */
 
 #include "squid.h"
+#include "HttpHdrContRange.h"
 
 /*
  *    Currently only byte ranges are supported
@@ -90,7 +91,7 @@ httpHdrRangeRespSpecParseInit(HttpHdrRangeSpec * spec, const char *field, int fl
     assert (spec->length >= 0);
 	   
     /* we managed to parse, check if the result makes sence */
-    if (known_spec((size_t)spec->length) && spec->length != 0) {
+    if (known_spec((size_t)spec->length) && spec->length == 0) {
 	debug(68, 2) ("invalid range (%ld += %ld) in resp-range-spec near: '%s'\n",
 	    (long int) spec->offset, (long int) spec->length, field);
 	return 0;
@@ -0,0 +1,57 @@
+
+/*
+ * $Id: HttpHdrContRange.h,v 1.1 2003/01/23 00:37:12 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_HTTPHDRCONTRANGE_H
+#define SQUID_HTTPHDRCONTRANGE_H
+
+#include "HttpHeaderRange.h"
+
+/* http content-range header field */
+class HttpHdrContRange {
+public:
+    HttpHdrRangeSpec spec;
+    ssize_t elength;		/* entity length, not content length */
+};
+
+/* Http Content Range Header Field */
+SQUIDCEXTERN HttpHdrContRange *httpHdrContRangeCreate(void);
+SQUIDCEXTERN HttpHdrContRange *httpHdrContRangeParseCreate(const char *crange_spec);
+/* returns true if range is valid; inits HttpHdrContRange */
+SQUIDCEXTERN int httpHdrContRangeParseInit(HttpHdrContRange * crange, const char *crange_spec);
+SQUIDCEXTERN void httpHdrContRangeDestroy(HttpHdrContRange * crange);
+SQUIDCEXTERN HttpHdrContRange *httpHdrContRangeDup(const HttpHdrContRange * crange);
+SQUIDCEXTERN void httpHdrContRangePackInto(const HttpHdrContRange * crange, Packer * p);
+/* inits with given spec */
+SQUIDCEXTERN void httpHdrContRangeSet(HttpHdrContRange *, HttpHdrRangeSpec, ssize_t);
+;
+#endif /* SQUID_HTTPHDRCONTRANGE_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpHdrExtField.cc,v 1.9 2001/01/12 00:37:13 wessels Exp $
+ * $Id: HttpHdrExtField.cc,v 1.10 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 69    HTTP Header: Extension Field
  * AUTHOR: Alex Rousskov
@@ -85,8 +85,8 @@ void
 httpHdrExtFieldDestroy(HttpHdrExtField * f)
 {
     assert(f);
-    stringClean(&f->name);
-    stringClean(&f->value);
+    f->name.clean();
+    f->value.clean();
     xfree(f);
 }
 
@@ -95,6 +95,6 @@ httpHdrExtFieldDup(HttpHdrExtField * f)
 {
     assert(f);
     return httpHdrExtFieldDoCreate(
-	strBuf(f->name), strLen(f->name),
-	strBuf(f->value), strLen(f->value));
+	f->name.buf(), f->name.size(),
+	f->value.buf(), f->value.size());
 }
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpHdrRange.cc,v 1.29 2003/01/22 10:05:43 robertc Exp $
+ * $Id: HttpHdrRange.cc,v 1.30 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 64    HTTP Range Header
  * AUTHOR: Alex Rousskov
@@ -35,6 +35,8 @@
 
 #include "squid.h"
 #include "Store.h"
+#include "HttpHeaderRange.h"
+#include "client_side_request.h"
 
 /*
  *    Currently only byte ranges are supported
@@ -48,146 +50,157 @@
  *
  *    When Range field is parsed, we have no clue about the content
  *    length of the document. Thus, we simply code an "absent" part
- *    using range_spec_unknown constant.
+ *    using HttpHdrRangeSpec::UnknownPosition constant.
  *
  *    Note: when response length becomes known, we convert any range
  *    spec into type one above. (Canonization process).
  */
 
 
-/* local constants */
-#define range_spec_unknown ((ssize_t)-1)
-
 /* local routines */
-#define known_spec(s) ((s) != range_spec_unknown)
-#define size_min(a,b) ((a) <= (b) ? (a) : (b))
-#define size_diff(a,b) ((a) >= (b) ? ((a)-(b)) : 0)
-static HttpHdrRangeSpec *httpHdrRangeSpecDup(const HttpHdrRangeSpec * spec);
-static int httpHdrRangeSpecCanonize(HttpHdrRangeSpec * spec, size_t clen);
-static void httpHdrRangeSpecPackInto(const HttpHdrRangeSpec * spec, Packer * p);
+#define known_spec(s) ((s) > HttpHdrRangeSpec::UnknownPosition)
 
 /* globals */
-static int RangeParsedCount = 0;
+size_t HttpHdrRange::ParsedCount = 0;
+ssize_t const HttpHdrRangeSpec::UnknownPosition = -1;
 
 /*
  * Range-Spec
  */
 
-static HttpHdrRangeSpec *
-httpHdrRangeSpecCreate(void)
+MemPool *HttpHdrRangeSpec::Pool = NULL;
+
+void *
+HttpHdrRangeSpec::operator new(size_t size)
+{
+    assert (size == sizeof (HttpHdrRangeSpec));
+    if (!Pool)
+	Pool = memPoolCreate ("HttpHdrRangeSpec", sizeof (HttpHdrRangeSpec));
+    return memPoolAlloc(Pool);
+}
+
+void
+HttpHdrRangeSpec::operator delete (void *spec)
 {
-    return (HttpHdrRangeSpec *)memAllocate(MEM_HTTP_HDR_RANGE_SPEC);
+    memPoolFree(Pool, spec);
 }
 
+void
+HttpHdrRangeSpec::deleteSelf() const
+{
+    delete this;
+}
+    
+HttpHdrRangeSpec::HttpHdrRangeSpec() : offset(UnknownPosition), length(UnknownPosition){}
+
 /* parses range-spec and returns new object on success */
-static HttpHdrRangeSpec *
-httpHdrRangeSpecParseCreate(const char *field, int flen)
+HttpHdrRangeSpec *
+HttpHdrRangeSpec::Create(const char *field, int flen)
+{
+    HttpHdrRangeSpec spec;
+    if (!spec.parseInit(field, flen))
+	return NULL;
+    return new HttpHdrRangeSpec(spec);
+}
+
+bool
+HttpHdrRangeSpec::parseInit(const char *field, int flen)
 {
-    HttpHdrRangeSpec spec =
-    {range_spec_unknown, range_spec_unknown};
     const char *p;
     if (flen < 2)
-	return NULL;
+	return false;
     /* is it a suffix-byte-range-spec ? */
     if (*field == '-') {
-	if (!httpHeaderParseSize(field + 1, &spec.length))
-	    return NULL;
+	if (!httpHeaderParseSize(field + 1, &length))
+	    return false;
     } else
 	/* must have a '-' somewhere in _this_ field */
     if (!((p = strchr(field, '-')) || (p - field >= flen))) {
 	debug(64, 2) ("ignoring invalid (missing '-') range-spec near: '%s'\n", field);
-	return NULL;
+	return false;
     } else {
-	if (!httpHeaderParseSize(field, &spec.offset))
-	    return NULL;
+	if (!httpHeaderParseSize(field, &offset))
+	    return false;
 	p++;
 	/* do we have last-pos ? */
 	if (p - field < flen) {
 	    ssize_t last_pos;
 	    if (!httpHeaderParseSize(p, &last_pos))
-		return NULL;
-	    spec.length = size_diff(last_pos + 1, spec.offset);
+		return false;
+	    HttpHdrRangeSpec::HttpRange aSpec (offset, last_pos + 1);
+	    length = aSpec.size();
 	}
     }
     /* we managed to parse, check if the result makes sence */
-    if (known_spec(spec.length) && !spec.length) {
+    if (length == 0) {
 	debug(64, 2) ("ignoring invalid (zero length) range-spec near: '%s'\n", field);
-	return NULL;
+	return false;
     }
-    return httpHdrRangeSpecDup(&spec);
-}
-
-static void
-httpHdrRangeSpecDestroy(HttpHdrRangeSpec * spec)
-{
-    memFree(spec, MEM_HTTP_HDR_RANGE_SPEC);
+    return true;
 }
 
-
-static HttpHdrRangeSpec *
-httpHdrRangeSpecDup(const HttpHdrRangeSpec * spec)
+void
+HttpHdrRangeSpec::packInto(Packer * packer) const
 {
-    HttpHdrRangeSpec *dup = httpHdrRangeSpecCreate();
-    dup->offset = spec->offset;
-    dup->length = spec->length;
-    return dup;
+    if (!known_spec(offset))	/* suffix */
+	packerPrintf(packer, "-%ld", (long int) length);
+    else if (!known_spec(length))		/* trailer */
+	packerPrintf(packer, "%ld-", (long int) offset);
+    else			/* range */
+	packerPrintf(packer, "%ld-%ld",
+	    (long int) offset, (long int) offset + length - 1);
 }
 
-static void
-httpHdrRangeSpecPackInto(const HttpHdrRangeSpec * spec, Packer * p)
+void
+HttpHdrRangeSpec::outputInfo( char const *note) const
 {
-    if (!known_spec(spec->offset))	/* suffix */
-	packerPrintf(p, "-%ld", (long int) spec->length);
-    else if (!known_spec(spec->length))		/* trailer */
-	packerPrintf(p, "%ld-", (long int) spec->offset);
-    else			/* range */
-	packerPrintf(p, "%ld-%ld",
-	    (long int) spec->offset, (long int) spec->offset + spec->length - 1);
+    debug(64, 5) ("HttpHdrRangeSpec::canonize: %s: [%ld, %ld) len: %ld\n",
+	note, (long int) offset, (long int) offset + length, (long int) length);
 }
 
 /* fills "absent" positions in range specification based on response body size 
  * returns true if the range is still valid
  * range is valid if its intersection with [0,length-1] is not empty
  */
-static int
-httpHdrRangeSpecCanonize(HttpHdrRangeSpec * spec, size_t clen)
-{
-    debug(64, 5) ("httpHdrRangeSpecCanonize: have: [%ld, %ld) len: %ld\n",
-	(long int) spec->offset, (long int) spec->offset + spec->length, (long int) spec->length);
-    /* ensure the type casts are safe */
-    assert (spec->length >= 0);
-    assert (spec->offset >= 0);
-    if (!known_spec(spec->offset))	/* suffix */
-	spec->offset = size_diff(clen, (size_t)spec->length);
-    else if (!known_spec(spec->length))		/* trailer */
-	spec->length = size_diff(clen, (size_t)spec->offset);
+int
+HttpHdrRangeSpec::canonize(size_t clen)
+{
+    outputInfo ("have");
+    HttpRange object(0, clen);
+    if (!known_spec(offset))	/* suffix */ {
+	assert(known_spec(length));
+	offset = object.intersection(HttpRange (clen - length, clen)).start;
+    } else if (!known_spec(length))		/* trailer */ {
+	assert(known_spec(offset));
+	HttpRange newRange = object.intersection(HttpRange (offset, clen));
+	length = newRange.size();
+    }
     /* we have a "range" now, adjust length if needed */
-    assert(known_spec(spec->length));
-    assert(known_spec(spec->offset));
-    spec->length = size_min(size_diff(clen, (size_t)spec->offset), (size_t)spec->length);
-    /* check range validity */
-    debug(64, 5) ("httpHdrRangeSpecCanonize: done: [%ld, %ld) len: %ld\n",
-	(long int) spec->offset, (long int) spec->offset + (long int) spec->length, (long int) spec->length);
-    return spec->length > 0;
+    assert(known_spec(length));
+    assert(known_spec(offset));
+    HttpRange newRange = object.intersection (HttpRange (offset, offset + length));
+    length = newRange.size();
+    outputInfo ("done");
+    return length > 0;
 }
 
 /* merges recepient with donor if possible; returns true on success 
  * both specs must be canonized prior to merger, of course */
-static int
-httpHdrRangeSpecMergeWith(HttpHdrRangeSpec * recep, const HttpHdrRangeSpec * donor)
+bool 
+HttpHdrRangeSpec::mergeWith(const HttpHdrRangeSpec * donor)
 {
-    int merged = 0;
+    bool merged (false);
 #if MERGING_BREAKS_NOTHING
     /* Note: this code works, but some clients may not like its effects */
-    size_t rhs = recep->offset + recep->length;		/* no -1 ! */
+    size_t rhs = offset + length;		/* no -1 ! */
     const size_t donor_rhs = donor->offset + donor->length;	/* no -1 ! */
-    assert(known_spec(recep->offset));
+    assert(known_spec(offset));
     assert(known_spec(donor->offset));
-    assert(recep->length > 0);
+    assert(length > 0);
     assert(donor->length > 0);
     /* do we have a left hand side overlap? */
-    if (donor->offset < recep->offset && recep->offset <= donor_rhs) {
-	recep->offset = donor->offset;	/* decrease left offset */
+    if (donor->offset < offset && offset <= donor_rhs) {
+	offset = donor->offset;	/* decrease left offset */
 	merged = 1;
     }
     /* do we have a right hand side overlap? */
@@ -197,12 +210,12 @@ httpHdrRangeSpecMergeWith(HttpHdrRangeSpec * recep, const HttpHdrRangeSpec * don
     }
     /* adjust length if offsets have been changed */
     if (merged) {
-	assert(rhs > recep->offset);
-	recep->length = rhs - recep->offset;
+	assert(rhs > offset);
+	length = rhs - offset;
     } else {
 	/* does recepient contain donor? */
 	merged =
-	    recep->offset <= donor->offset && donor->offset < rhs;
+	    offset <= donor->offset && donor->offset < rhs;
     }
 #endif
     return merged;
@@ -212,93 +225,165 @@ httpHdrRangeSpecMergeWith(HttpHdrRangeSpec * recep, const HttpHdrRangeSpec * don
  * Range
  */
 
-static HttpHdrRange *
-httpHdrRangeCreate(void)
+MemPool *HttpHdrRange::Pool = NULL;
+
+void *
+HttpHdrRange::operator new(size_t size)
+{
+    assert (size == sizeof (HttpHdrRange));
+    if (!Pool)
+	Pool = memPoolCreate ("HttpHdrRange", sizeof (HttpHdrRange));
+    return memPoolAlloc(Pool);
+}
+
+void
+HttpHdrRange::operator delete (void *address)
+{
+    memPoolFree(Pool, address);
+}
+
+void
+HttpHdrRange::deleteSelf() const
+{
+    delete this;
+}
+ 
+HttpHdrRange::HttpHdrRange () : clen (HttpHdrRangeSpec::UnknownPosition)
 {
-    HttpHdrRange *r = (HttpHdrRange *)memAllocate(MEM_HTTP_HDR_RANGE);
-    stackInit(&r->specs);
-    return r;
 }
 
 HttpHdrRange *
-httpHdrRangeParseCreate(const String * str)
+HttpHdrRange::ParseCreate(const String * range_spec)
 {
-    HttpHdrRange *r = httpHdrRangeCreate();
-    if (!httpHdrRangeParseInit(r, str)) {
-	httpHdrRangeDestroy(r);
+    HttpHdrRange *r = new HttpHdrRange;
+    if (!r->parseInit(range_spec)) {
+	r->deleteSelf();
 	r = NULL;
     }
     return r;
 }
 
 /* returns true if ranges are valid; inits HttpHdrRange */
-int
-httpHdrRangeParseInit(HttpHdrRange * range, const String * str)
+bool
+HttpHdrRange::parseInit(const String * range_spec)
 {
     const char *item;
     const char *pos = NULL;
     int ilen;
     int count = 0;
-    assert(range && str);
-    RangeParsedCount++;
-    debug(64, 8) ("parsing range field: '%s'\n", strBuf(*str));
+    assert(this && range_spec);
+    ++ParsedCount;
+    debug(64, 8) ("parsing range field: '%s'\n", range_spec->buf());
     /* check range type */
-    if (strNCaseCmp(*str, "bytes=", 6))
+    if (range_spec->nCaseCmp("bytes=", 6))
 	return 0;
     /* skip "bytes="; hack! */
-    pos = strBuf(*str) + 5;
+    pos = range_spec->buf() + 5;
     /* iterate through comma separated list */
-    while (strListGetItem(str, ',', &item, &ilen, &pos)) {
-	HttpHdrRangeSpec *spec = httpHdrRangeSpecParseCreate(item, ilen);
+    while (strListGetItem(range_spec, ',', &item, &ilen, &pos)) {
+	HttpHdrRangeSpec *spec = HttpHdrRangeSpec::Create(item, ilen);
 	/*
 	 * HTTP/1.1 draft says we must ignore the whole header field if one spec
 	 * is invalid. However, RFC 2068 just says that we must ignore that spec.
 	 */
 	if (spec)
-	    stackPush(&range->specs, spec);
-	count++;
+	    specs.push_back(spec);
+	++count;
     }
-    debug(64, 8) ("parsed range range count: %d\n", range->specs.count);
-    return range->specs.count;
+    debug(64, 8) ("parsed range range count: %d, kept %d\n", count, specs.size());
+    return specs.count != 0;
+}
+
+HttpHdrRange::~HttpHdrRange()
+{
+    while (specs.size())
+	specs.pop_back()->deleteSelf();
+}
+
+HttpHdrRange::HttpHdrRange(HttpHdrRange const &old) : specs()
+{
+    specs.reserve(old.specs.size());
+    for (const_iterator i = old.begin(); i != old.end(); ++i)
+	specs.push_back(new HttpHdrRangeSpec ( **i));
+    assert(old.specs.size() == specs.size());
+}
+
+HttpHdrRange::iterator
+HttpHdrRange::begin()
+{
+    return specs.begin();
+}
+
+HttpHdrRange::iterator
+HttpHdrRange::end()
+{
+    return specs.end();
+}
+
+HttpHdrRange::const_iterator
+HttpHdrRange::begin() const
+{
+    return specs.begin();
+}
+
+HttpHdrRange::const_iterator
+HttpHdrRange::end() const
+{
+    return specs.end();
 }
 
 void
-httpHdrRangeDestroy(HttpHdrRange * range)
+HttpHdrRange::packInto(Packer * packer) const
 {
-    assert(range);
-    while (range->specs.count)
-	httpHdrRangeSpecDestroy((HttpHdrRangeSpec *)stackPop(&range->specs));
-    stackClean(&range->specs);
-    memFree(range, MEM_HTTP_HDR_RANGE);
+    const_iterator pos = begin();
+    assert(this);
+    while (pos != end()) {
+	if (pos != begin())
+	    packerAppend(packer, ",", 1);
+	(*pos)->packInto(packer);
+	++pos;
+    }
 }
 
-HttpHdrRange *
-httpHdrRangeDup(const HttpHdrRange * range)
+void
+HttpHdrRange::merge (Vector<HttpHdrRangeSpec *> &basis)
 {
-    HttpHdrRange *dup;
-    size_t i;
-    assert(range);
-    dup = httpHdrRangeCreate();
-    stackPrePush(&dup->specs, range->specs.count);
-    for (i = 0; i < range->specs.count; i++)
-	stackPush(&dup->specs, httpHdrRangeSpecDup((HttpHdrRangeSpec *)range->specs.items[i]));
-    assert(range->specs.count == dup->specs.count);
-    return dup;
+    /* reset old array */
+    specs.clean();
+    /* merge specs:
+     * take one spec from "goods" and merge it with specs from 
+     * "specs" (if any) until there is no overlap */
+    iterator i = basis.begin();
+    while (i != basis.end()) {
+	if (specs.size() && (*i)->mergeWith(specs.back())) {
+	    /* merged with current so get rid of the prev one */
+	    specs.pop_back()->deleteSelf();
+	    continue;	/* re-iterate */
+	}
+	specs.push_back (*i);
+	++i;			/* progress */
+    }
+    debug(64, 3) ("HttpHdrRange::merge: had %d specs, merged %d specs\n",
+	basis.size(), basis.size() - specs.size());
 }
 
+
 void
-httpHdrRangePackInto(const HttpHdrRange * range, Packer * p)
-{
-    HttpHdrRangePos pos = HttpHdrRangeInitPos;
-    const HttpHdrRangeSpec *spec;
-    assert(range);
-    while ((spec = httpHdrRangeGetSpec(range, &pos))) {
-	if (pos != HttpHdrRangeInitPos)
-	    packerAppend(p, ",", 1);
-	httpHdrRangeSpecPackInto(spec, p);
+HttpHdrRange::getCanonizedSpecs (Vector<HttpHdrRangeSpec *> &copy)
+{
+    /* canonize each entry and destroy bad ones if any */
+    for (iterator pos (begin()); pos != end(); ++pos) {
+	if ((*pos)->canonize(clen))
+	    copy.push_back (*pos);
+	else
+	    (*pos)->deleteSelf();
     }
+    debug(64, 3) ("HttpHdrRange::getCanonizedSpecs: found %d bad specs\n",
+	specs.size() - copy.size());
 }
 
+#include "HttpHdrContRange.h"
+
 /*
  * canonizes all range specs within a set preserving the order
  * returns true if the set is valid after canonization; 
@@ -307,132 +392,89 @@ httpHdrRangePackInto(const HttpHdrRange * range, Packer * p)
  *   - there is at least one range spec
  */
 int
-httpHdrRangeCanonize(HttpHdrRange * range, ssize_t clen)
+HttpHdrRange::canonize(HttpReply *rep)
 {
-    size_t i;
-    HttpHdrRangeSpec *spec;
-    HttpHdrRangePos pos = HttpHdrRangeInitPos;
-    Stack goods;
-    assert(range);
-    assert(clen >= 0);
-    stackInit(&goods);
-    debug(64, 3) ("httpHdrRangeCanonize: started with %d specs, clen: %ld\n", range->specs.count, (long int) clen);
-
-    /* canonize each entry and destroy bad ones if any */
-    while ((spec = httpHdrRangeGetSpec(range, &pos))) {
-	if (httpHdrRangeSpecCanonize(spec, clen))
-	    stackPush(&goods, spec);
-	else
-	    httpHdrRangeSpecDestroy(spec);
-    }
-    debug(64, 3) ("httpHdrRangeCanonize: found %d bad specs\n",
-	range->specs.count - goods.count);
-    /* reset old array */
-    stackClean(&range->specs);
-    stackInit(&range->specs);
-    spec = NULL;
-    /* merge specs:
-     * take one spec from "goods" and merge it with specs from 
-     * "range->specs" (if any) until there is no overlap */
-    for (i = 0; i < goods.count;) {
-	HttpHdrRangeSpec *prev_spec = (HttpHdrRangeSpec *)stackTop(&range->specs);
-	spec = (HttpHdrRangeSpec *)goods.items[i];
-	if (prev_spec) {
-	    if (httpHdrRangeSpecMergeWith(spec, prev_spec)) {
-		/* merged with current so get rid of the prev one */
-		assert(prev_spec == stackPop(&range->specs));
-		httpHdrRangeSpecDestroy(prev_spec);
-		continue;	/* re-iterate */
-	    }
-	}
-	stackPush(&range->specs, spec);
-	spec = NULL;
-	i++;			/* progress */
-    }
-    if (spec)			/* last "merge" may not be pushed yet */
-	stackPush(&range->specs, spec);
-    debug(64, 3) ("httpHdrRangeCanonize: had %d specs, merged %d specs\n",
-	goods.count, goods.count - range->specs.count);
-    debug(64, 3) ("httpHdrRangeCanonize: finished with %d specs\n",
-	range->specs.count);
-    stackClean(&goods);
-    return range->specs.count > 0;
+    assert(this && rep);
+    if (rep->content_range)
+	clen = rep->content_range->elength;
+    else
+	clen = rep->content_length;
+    return canonize (clen);
 }
 
-/* searches for next range, returns true if found */
-HttpHdrRangeSpec *
-httpHdrRangeGetSpec(const HttpHdrRange * range, HttpHdrRangePos * pos)
+int
+HttpHdrRange::canonize (size_t newClen)
 {
-    assert(range);
-    assert(pos && *pos >= -1 && *pos < (ssize_t)range->specs.count);
-    (*pos)++;
-    if (*pos < (ssize_t)range->specs.count)
-	return (HttpHdrRangeSpec *) range->specs.items[*pos];
-    else
-	return NULL;
+    clen = newClen;
+    debug(64, 3) ("HttpHdrRange::canonize: started with %d specs, clen: %ld\n", specs.count, (long int) clen);
+    Vector<HttpHdrRangeSpec*> goods;
+    getCanonizedSpecs(goods);
+    merge (goods);
+    debug(64, 3) ("HttpHdrRange::canonize: finished with %d specs\n",
+	specs.count);
+    return specs.count > 0;
 }
 
 /* hack: returns true if range specs are too "complex" for Squid to handle */
 /* requires that specs are "canonized" first! */
-int
-httpHdrRangeIsComplex(const HttpHdrRange * range)
+bool
+HttpHdrRange::isComplex() const
 {
-    HttpHdrRangePos pos = HttpHdrRangeInitPos;
-    const HttpHdrRangeSpec *spec;
     size_t offset = 0;
-    assert(range);
+    assert(this);
     /* check that all rangers are in "strong" order */
-    while ((spec = httpHdrRangeGetSpec(range, &pos))) {
+    const_iterator pos (begin());
+    while (pos != end()) {
 	/* Ensure typecasts is safe */
-	assert (spec->offset >= 0);
-	if ((unsigned int)spec->offset < offset)
+	assert ((*pos)->offset >= 0);
+	if ((unsigned int)(*pos)->offset < offset)
 	    return 1;
-	offset = spec->offset + spec->length;
+	offset = (*pos)->offset + (*pos)->length;
+	++pos;
     }
     return 0;
 }
 
 /*
  * hack: returns true if range specs may be too "complex" when "canonized".
- * see also: httpHdrRangeIsComplex.
+ * see also: HttpHdrRange::isComplex.
  */
-int
-httpHdrRangeWillBeComplex(const HttpHdrRange * range)
+bool
+HttpHdrRange::willBeComplex() const
 {
-    HttpHdrRangePos pos = HttpHdrRangeInitPos;
-    const HttpHdrRangeSpec *spec;
-    size_t offset = 0;
-    assert(range);
+    assert(this);
     /* check that all rangers are in "strong" order, */
     /* as far as we can tell without the content length */
-    while ((spec = httpHdrRangeGetSpec(range, &pos))) {
-	if (!known_spec(spec->offset))	/* ignore unknowns */
+    size_t offset = 0;
+    for (const_iterator pos (begin()); pos != end(); ++pos) {
+	if (!known_spec((*pos)->offset))	/* ignore unknowns */
 	    continue;
 	/* Ensure typecasts is safe */
-	assert (spec->offset >= 0);
-	if ((size_t) spec->offset < offset)
-	    return 1;
-	offset = spec->offset;
-	if (known_spec(spec->length))	/* avoid  unknowns */
-	    offset += spec->length;
+	assert ((*pos)->offset >= 0);
+	if ((size_t) (*pos)->offset < offset)
+	    return true;
+	offset = (*pos)->offset;
+	if (known_spec((*pos)->length))	/* avoid  unknowns */
+	    offset += (*pos)->length;
     }
-    return 0;
+    return false;
 }
 
 /*
- * Returns lowest known offset in range spec(s), or range_spec_unknown
+ * Returns lowest known offset in range spec(s),
+ * or HttpHdrRangeSpec::UnknownPosition
  * this is used for size limiting
  */
 ssize_t
-httpHdrRangeFirstOffset(const HttpHdrRange * range)
-{
-    ssize_t offset = range_spec_unknown;
-    HttpHdrRangePos pos = HttpHdrRangeInitPos;
-    const HttpHdrRangeSpec *spec;
-    assert(range);
-    while ((spec = httpHdrRangeGetSpec(range, &pos))) {
-	if (spec->offset < offset || !known_spec(offset))
-	    offset = spec->offset;
+HttpHdrRange::firstOffset() const
+{
+    ssize_t offset = HttpHdrRangeSpec::UnknownPosition;
+    assert(this);
+    const_iterator pos = begin();
+    while (pos != end()) {
+	if ((*pos)->offset < offset || !known_spec(offset))
+	    offset = (*pos)->offset;
+	++pos;
     }
     return offset;
 }
@@ -444,56 +486,72 @@ httpHdrRangeFirstOffset(const HttpHdrRange * range)
  * Use 0 for size if unknown
  */
 ssize_t
-httpHdrRangeLowestOffset(const HttpHdrRange * range, ssize_t size)
-{
-    ssize_t offset = range_spec_unknown;
-    ssize_t current;
-    HttpHdrRangePos pos = HttpHdrRangeInitPos;
-    const HttpHdrRangeSpec *spec;
-    assert(range);
-    while ((spec = httpHdrRangeGetSpec(range, &pos))) {
-	current = spec->offset;
+HttpHdrRange::lowestOffset(ssize_t size) const
+{
+    ssize_t offset = HttpHdrRangeSpec::UnknownPosition;
+    const_iterator pos = begin();
+    assert(this);
+    while (pos != end()) {
+	ssize_t current = (*pos)->offset;
 	if (!known_spec(current)) {
-	    if (spec->length > size || !known_spec(spec->length))
+	    if ((*pos)->length > size || !known_spec((*pos)->length))
 		return 0;	/* Unknown. Assume start of file */
-	    current = size - spec->length;
+	    current = size - (*pos)->length;
 	}
 	if (current < offset || !known_spec(offset))
 	    offset = current;
+	++pos;
     }
     return known_spec(offset) ? offset : 0;
 }
 
-/* generates a "unique" boundary string for multipart responses
- * the caller is responsible for cleaning the string */
-String
-httpHdrRangeBoundaryStr(clientHttpRequest * http)
-{
-    const char *key;
-    String b = StringNull;
-    assert(http);
-    stringAppend(&b, full_appname_string, strlen(full_appname_string));
-    stringAppend(&b, ":", 1);
-    key = http->entry->getMD5Text();
-    stringAppend(&b, key, strlen(key));
-    return b;
-}
-
 /*  
  * Return true if the first range offset is larger than the configured
  * limit.
  */
-int
-httpHdrRangeOffsetLimit(HttpHdrRange * range)
+bool
+HttpHdrRange::offsetLimitExceeded() const
 {
-    if (NULL == range)
+    if (NULL == this)
 	/* not a range request */
-	return 0;
+	return false;
     if (-1 == (ssize_t)Config.rangeOffsetLimit)
 	/* disabled */
-	return 0;
-    if ((ssize_t)Config.rangeOffsetLimit >= httpHdrRangeFirstOffset(range))
+	return false;
+    if ((ssize_t)Config.rangeOffsetLimit >= firstOffset())
 	/* below the limit */
-	return 0;
-    return 1;
+	return false;
+    return true;
+}
+
+const HttpHdrRangeSpec *
+HttpHdrRangeIter::currentSpec() const
+{
+    if (pos.incrementable())
+	return *pos;
+    return NULL;
+}
+
+void
+HttpHdrRangeIter::updateSpec()
+{
+    assert (debt_size == 0);
+    if (pos.incrementable()) {
+	debt(currentSpec()->length);
+    }
+}
+
+ssize_t
+HttpHdrRangeIter::debt() const
+{
+    debug(64, 3) ("HttpHdrRangeIter::debt: debt is %d\n",
+	(int)debt_size);
+    return debt_size;
+}
+
+void HttpHdrRangeIter::debt(ssize_t newDebt)
+{
+    debug(64, 3) ("HttpHdrRangeIter::debt: was %d now %d\n",
+	(int)debt_size, (int)newDebt);
+    debt_size = newDebt;
 }
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpHeader.cc,v 1.83 2003/01/22 10:05:43 robertc Exp $
+ * $Id: HttpHeader.cc,v 1.84 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 55    HTTP Header
  * AUTHOR: Alex Rousskov
@@ -36,6 +36,7 @@
 #include "squid.h"
 #include "Store.h"
 #include "HttpHeader.h"
+#include "HttpHdrContRange.h"
 
 /*
  * On naming conventions:
@@ -381,7 +382,7 @@ httpHeaderUpdate(HttpHeader * old, const HttpHeader * fresh, const HttpHeaderMas
 	/* deny bad guys (ok to check for HDR_OTHER) here */
 	if (denied_mask && CBIT_TEST(*denied_mask, e->id))
 	    continue;
-	httpHeaderDelByName(old, strBuf(e->name));
+	httpHeaderDelByName(old, e->name.buf());
 	httpHeaderAddEntry(old, httpHeaderEntryClone(e));
     }
 }
@@ -574,7 +575,7 @@ httpHeaderDelAt(HttpHeader * hdr, HttpHeaderPos pos)
     e = (HttpHeaderEntry*)hdr->entries.items[pos];
     hdr->entries.items[pos] = NULL;
     /* decrement header length, allow for ": " and crlf */
-    hdr->len -= strLen(e->name) + 2 + strLen(e->value) + 2;
+    hdr->len -= e->name.size() + 2 + e->value.size() + 2;
     assert(hdr->len >= 0);
     httpHeaderEntryDestroy(e);
 }
@@ -597,7 +598,7 @@ httpHeaderAddEntry(HttpHeader * hdr, HttpHeaderEntry * e)
 	CBIT_SET(hdr->mask, e->id);
     arrayAppend(&hdr->entries, e);
     /* increment header length, allow for ": " and crlf */
-    hdr->len += strLen(e->name) + 2 + strLen(e->value) + 2;
+    hdr->len += e->name.size() + 2 + e->value.size() + 2;
 }
 
 /* return a list of entries with the same id separated by ',' and ws */
@@ -614,17 +615,17 @@ httpHeaderGetList(const HttpHeader * hdr, http_hdr_type id)
 	return s;
     while ((e = httpHeaderGetEntry(hdr, &pos))) {
 	if (e->id == id)
-	    strListAdd(&s, strBuf(e->value), ',');
+	    strListAdd(&s, e->value.buf(), ',');
     }
     /*
      * note: we might get an empty (len==0) string if there was an "empty"
      * header; we must not get a NULL string though.
      */
-    assert(strBuf(s));
+    assert(s.buf());
     /* temporary warning: remove it! @?@ @?@ @?@ */
-    if (!strLen(s))
-	debug(55, 3) ("empty list header: %s (%d)\n", strBuf(Headers[id].name), id);
-    debug(55, 6) ("%p: joined for id %d: %s\n", hdr, id, strBuf(s));
+    if (!s.size())
+	debug(55, 3) ("empty list header: %s (%d)\n", Headers[id].name.buf(), id);
+    debug(55, 6) ("%p: joined for id %d: %s\n", hdr, id, s.buf());
     return s;
 }
 
@@ -636,12 +637,9 @@ httpHeaderGetStrOrList(const HttpHeader * hdr, http_hdr_type id)
 
     if (CBIT_TEST(ListHeadersMask, id))
 	return httpHeaderGetList(hdr, id);
-    if ((e = httpHeaderFindEntry(hdr, id))) {
-	String s;
-	stringInit(&s, strBuf(e->value));
-	return s;
-    }
-    return StringNull;
+    if ((e = httpHeaderFindEntry(hdr, id)))
+	return e->value;
+    return String::Null;
 }
 
 /*
@@ -666,7 +664,7 @@ httpHeaderGetByName(const HttpHeader * hdr, const char *name)
     /* Sorry, an unknown header name. Do linear search */
     while ((e = httpHeaderGetEntry(hdr, &pos))) {
 	if (e->id == HDR_OTHER && strCaseCmp(e->name, name) == 0) {
-	    strListAdd(&result, strBuf(e->value), ',');
+	    strListAdd(&result, e->value.buf(), ',');
 	}
     }
     return result;
@@ -692,7 +690,7 @@ httpHeaderGetByNameListMember(const HttpHeader * hdr, const char *name, const ch
 
     while (strListGetItem(&header, separator, &item, &ilen, &pos)) {
 	if (strncmp(item, member, mlen) == 0 && item[mlen] == '=') {
-	    stringAppend(&result, item + mlen + 1, ilen - mlen - 1);
+	    result.append(item + mlen + 1, ilen - mlen - 1);
 	    break;
 	}
     }
@@ -719,11 +717,11 @@ httpHeaderGetListMember(const HttpHeader * hdr, http_hdr_type id, const char *me
 
     while (strListGetItem(&header, separator, &item, &ilen, &pos)) {
 	if (strncmp(item, member, mlen) == 0 && item[mlen] == '=') {
-	    stringAppend(&result, item + mlen + 1, ilen - mlen - 1);
+	    result.append(item + mlen + 1, ilen - mlen - 1);
 	    break;
 	}
     }
-    stringClean(&header);
+    header.clean();
     return result;
 }
 
@@ -821,7 +819,7 @@ httpHeaderPutRange(HttpHeader * hdr, const HttpHdrRange * range)
     /* pack into mb */
     memBufDefInit(&mb);
     packerToMemInit(&p, &mb);
-    httpHdrRangePackInto(range, &p);
+    range->packInto(&p);
     /* put */
     httpHeaderAddEntry(hdr, httpHeaderEntryCreate(HDR_RANGE, NULL, mb.buf));
     /* cleanup */
@@ -839,18 +837,30 @@ httpHeaderPutExt(HttpHeader * hdr, const char *name, const char *value)
 }
 
 int
-httpHeaderGetInt(const HttpHeader * hdr, http_hdr_type id)
+httpHeaderEntryGetInt (const HttpHeaderEntry * e)
 {
-    HttpHeaderEntry *e;
     int value = -1;
     int ok;
+    assert (e);
+    assert_eid (e->id);
+    assert (Headers[e->id].type == ftInt);
+    ok = httpHeaderParseInt(e->value.buf(), &value);
+    httpHeaderNoteParsedEntry(e->id, e->value, !ok);
+    /* XXX: Should we check ok - ie
+     * return ok ? -1 : value;
+     */
+    return value;
+}
+
+int
+httpHeaderGetInt(const HttpHeader * hdr, http_hdr_type id)
+{
     assert_eid(id);
     assert(Headers[id].type == ftInt);	/* must be of an appropriate type */
-    if ((e = httpHeaderFindEntry(hdr, id))) {
-	ok = httpHeaderParseInt(strBuf(e->value), &value);
-	httpHeaderNoteParsedEntry(e->id, e->value, !ok);
-    }
-    return value;
+    HttpHeaderEntry *e;
+    if ((e = httpHeaderFindEntry(hdr, id)))
+	return httpHeaderEntryGetInt (e);
+    return -1;
 }
 
 time_t
@@ -861,7 +871,7 @@ httpHeaderGetTime(const HttpHeader * hdr, http_hdr_type id)
     assert_eid(id);
     assert(Headers[id].type == ftDate_1123);	/* must be of an appropriate type */
     if ((e = httpHeaderFindEntry(hdr, id))) {
-	value = parse_rfc1123(strBuf(e->value));
+	value = parse_rfc1123(e->value.buf());
 	httpHeaderNoteParsedEntry(e->id, e->value, value < 0);
     }
     return value;
@@ -876,7 +886,7 @@ httpHeaderGetStr(const HttpHeader * hdr, http_hdr_type id)
     assert(Headers[id].type == ftStr);	/* must be of an appropriate type */
     if ((e = httpHeaderFindEntry(hdr, id))) {
 	httpHeaderNoteParsedEntry(e->id, e->value, 0);	/* no errors are possible */
-	return strBuf(e->value);
+	return e->value.buf();
     }
     return NULL;
 }
@@ -890,7 +900,7 @@ httpHeaderGetLastStr(const HttpHeader * hdr, http_hdr_type id)
     assert(Headers[id].type == ftStr);	/* must be of an appropriate type */
     if ((e = httpHeaderFindLastEntry(hdr, id))) {
 	httpHeaderNoteParsedEntry(e->id, e->value, 0);	/* no errors are possible */
-	return strBuf(e->value);
+	return e->value.buf();
     }
     return NULL;
 }
@@ -908,7 +918,7 @@ httpHeaderGetCc(const HttpHeader * hdr)
     if (cc)
 	httpHdrCcUpdateStats(cc, &HttpHeaderStats[hdr->owner].ccTypeDistr);
     httpHeaderNoteParsedEntry(HDR_CACHE_CONTROL, s, !cc);
-    stringClean(&s);
+    s.clean();
     return cc;
 }
 
@@ -923,7 +933,7 @@ httpHeaderGetRange(const HttpHeader * hdr)
      * hopefully no clients send mismatched headers! */
     if ((e = httpHeaderFindEntry(hdr, HDR_RANGE)) ||
 	(e = httpHeaderFindEntry(hdr, HDR_REQUEST_RANGE))) {
-	r = httpHdrRangeParseCreate(&e->value);
+	r = HttpHdrRange::ParseCreate(&e->value);
 	httpHeaderNoteParsedEntry(e->id, e->value, !r);
     }
     return r;
@@ -935,7 +945,7 @@ httpHeaderGetContRange(const HttpHeader * hdr)
     HttpHdrContRange *cr = NULL;
     HttpHeaderEntry *e;
     if ((e = httpHeaderFindEntry(hdr, HDR_CONTENT_RANGE))) {
-	cr = httpHdrContRangeParseCreate(strBuf(e->value));
+	cr = httpHdrContRangeParseCreate(e->value.buf());
 	httpHeaderNoteParsedEntry(e->id, e->value, !cr);
     }
     return cr;
@@ -971,7 +981,7 @@ httpHeaderGetETag(const HttpHeader * hdr, http_hdr_type id)
     HttpHeaderEntry *e;
     assert(Headers[id].type == ftETag);		/* must be of an appropriate type */
     if ((e = httpHeaderFindEntry(hdr, id)))
-	etagParseInit(&etag, strBuf(e->value));
+	etagParseInit(&etag, e->value.buf());
     return etag;
 }
 
@@ -983,7 +993,7 @@ httpHeaderGetTimeOrTag(const HttpHeader * hdr, http_hdr_type id)
     assert(Headers[id].type == ftDate_1123_or_ETag);	/* must be of an appropriate type */
     memset(&tot, 0, sizeof(tot));
     if ((e = httpHeaderFindEntry(hdr, id))) {
-	const char *str = strBuf(e->value);
+	const char *str = e->value.buf();
 	/* try as an ETag */
 	if (etagParseInit(&tot.tag, str)) {
 	    tot.valid = tot.tag.str != NULL;
@@ -1013,10 +1023,10 @@ httpHeaderEntryCreate(http_hdr_type id, const char *name, const char *value)
     if (id != HDR_OTHER)
 	e->name = Headers[id].name;
     else
-	stringInit(&e->name, name);
-    stringInit(&e->value, value);
+	e->name = name;
+    e->value = value;
     Headers[id].stat.aliveCount++;
-    debug(55, 9) ("created entry %p: '%s: %s'\n", e, strBuf(e->name), strBuf(e->value));
+    debug(55, 9) ("created entry %p: '%s: %s'\n", e, e->name.buf(), e->value.buf());
     return e;
 }
 
@@ -1025,11 +1035,11 @@ httpHeaderEntryDestroy(HttpHeaderEntry * e)
 {
     assert(e);
     assert_eid(e->id);
-    debug(55, 9) ("destroying entry %p: '%s: %s'\n", e, strBuf(e->name), strBuf(e->value));
+    debug(55, 9) ("destroying entry %p: '%s: %s'\n", e, e->name.buf(), e->value.buf());
     /* clean name if needed */
     if (e->id == HDR_OTHER)
-	stringClean(&e->name);
-    stringClean(&e->value);
+	e->name.clean();
+    e->value.clean();
     assert(Headers[e->id].stat.aliveCount);
     Headers[e->id].stat.aliveCount--;
     e->id = HDR_BAD_HDR;
@@ -1069,7 +1079,7 @@ httpHeaderEntryParseCreate(const char *field_start, const char *field_end)
     e->id = id;
     /* set field name */
     if (id == HDR_OTHER)
-	stringLimitInit(&e->name, field_start, name_len);
+	e->name.limitInit(field_start, name_len);
     else
 	e->name = Headers[id].name;
     /* trim field value */
@@ -1078,33 +1088,33 @@ httpHeaderEntryParseCreate(const char *field_start, const char *field_end)
     if (field_end - value_start > 65536) {
 	/* String has a 64K limit */
 	debug(55, 1) ("WARNING: ignoring '%s' header of %d bytes\n",
-	    strBuf(e->name), (int) (field_end - value_start));
+	    e->name.buf(), (int) (field_end - value_start));
 	if (e->id == HDR_OTHER)
-	    stringClean(&e->name);
+	    e->name.clean();
 	memFree(e, MEM_HTTP_HDR_ENTRY);
 	return NULL;
     }
     /* set field value */
-    stringLimitInit(&e->value, value_start, field_end - value_start);
+    e->value.limitInit(value_start, field_end - value_start);
     Headers[id].stat.seenCount++;
     Headers[id].stat.aliveCount++;
-    debug(55, 9) ("created entry %p: '%s: %s'\n", e, strBuf(e->name), strBuf(e->value));
+    debug(55, 9) ("created entry %p: '%s: %s'\n", e, e->name.buf(), e->value.buf());
     return e;
 }
 
 HttpHeaderEntry *
 httpHeaderEntryClone(const HttpHeaderEntry * e)
 {
-    return httpHeaderEntryCreate(e->id, strBuf(e->name), strBuf(e->value));
+    return httpHeaderEntryCreate(e->id, e->name.buf(), e->value.buf());
 }
 
 void
 httpHeaderEntryPackInto(const HttpHeaderEntry * e, Packer * p)
 {
     assert(e && p);
-    packerAppend(p, strBuf(e->name), strLen(e->name));
+    packerAppend(p, e->name.buf(), e->name.size());
     packerAppend(p, ": ", 2);
-    packerAppend(p, strBuf(e->value), strLen(e->value));
+    packerAppend(p, e->value.buf(), e->value.size());
     packerAppend(p, "\r\n", 2);
 }
 
@@ -1115,7 +1125,7 @@ httpHeaderNoteParsedEntry(http_hdr_type id, String context, int error)
     if (error) {
 	Headers[id].stat.errCount++;
 	debug(55, 2) ("cannot parse hdr field: '%s: %s'\n",
-	    strBuf(Headers[id].name), strBuf(context));
+	    Headers[id].name.buf(), context.buf());
     }
 }
 
@@ -1132,7 +1142,7 @@ httpHeaderFieldStatDumper(StoreEntry * sentry, int idx, double val, double size,
 {
     const int id = (int) val;
     const int valid_id = id >= 0 && id < HDR_ENUM_END;
-    const char *name = valid_id ? strBuf(Headers[id].name) : "INVALID";
+    const char *name = valid_id ? Headers[id].name.buf() : "INVALID";
     int visible = count > 0;
     /* for entries with zero count, list only those that belong to current type of message */
     if (!visible && valid_id && dump_stat->owner_mask)
@@ -1201,7 +1211,7 @@ httpHeaderStoreReport(StoreEntry * e)
     for (ht = (http_hdr_type)0; ht < HDR_ENUM_END; ++ht) {
 	HttpHeaderFieldInfo *f = Headers + ht;
 	storeAppendPrintf(e, "%2d\t %-20s\t %5d\t %6.3f\t %6.3f\n",
-	    f->id, strBuf(f->name), f->stat.aliveCount,
+	    f->id, f->name.buf(), f->stat.aliveCount,
 	    xpercent(f->stat.errCount, f->stat.parsCount),
 	    xpercent(f->stat.repCount, f->stat.seenCount));
     }
@@ -1217,10 +1227,10 @@ httpHeaderIdByName(const char *name, int name_len, const HttpHeaderFieldInfo * i
 {
     int i;
     for (i = 0; i < end; ++i) {
-	if (name_len >= 0 && name_len != strLen(info[i].name))
+	if (name_len >= 0 && name_len != info[i].name.size())
 	    continue;
-	if (!strncasecmp(name, strBuf(info[i].name),
-		name_len < 0 ? strLen(info[i].name) + 1 : name_len))
+	if (!strncasecmp(name, info[i].name.buf(),
+		name_len < 0 ? info[i].name.size() + 1 : name_len))
 	    return info[i].id;
     }
     return HDR_BAD_HDR;
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpHeader.h,v 1.1 2002/10/13 20:34:56 robertc Exp $
+ * $Id: HttpHeader.h,v 1.2 2003/01/23 00:37:12 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -34,8 +34,8 @@
 #ifndef SQUID_HTTPHEADER_H
 #define SQUID_HTTPHEADER_H
 
-#ifdef __cplusplus
-#endif
+/* because we pass a spec by value */
+#include "HttpHeaderRange.h"
 
 /* constant attributes of http header fields */
 struct _HttpHeaderFieldAttrs {
@@ -44,4 +44,6 @@ struct _HttpHeaderFieldAttrs {
     field_type type;
 };
 
+SQUIDCEXTERN void httpHeaderAddContRange(HttpHeader *, HttpHdrRangeSpec, ssize_t);
+
 #endif /* SQUID_HTTPHEADER_H */
@@ -0,0 +1,121 @@
+
+/*
+ * $Id: HttpHeaderRange.h,v 1.1 2003/01/23 00:37:12 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_HTTPHEADERRANGE_H
+#define SQUID_HTTPHEADERRANGE_H
+
+#include "Range.h"
+
+typedef struct _HttpReply HttpReply;
+/* http byte-range-spec */
+class HttpHdrRangeSpec {
+  public:
+    void *operator new(size_t);
+    void operator delete (void *);
+    void deleteSelf() const;
+    typedef Range<ssize_t> HttpRange;
+    static ssize_t const UnknownPosition;
+    
+    HttpHdrRangeSpec();
+    static HttpHdrRangeSpec *Create(const char *field, int fieldLen);
+
+    bool parseInit(const char *field, int flen);
+    int canonize(size_t clen);
+    void outputInfo( char const *note) const;
+    void packInto(Packer * p) const;
+    bool mergeWith(const HttpHdrRangeSpec * donor);
+    ssize_t offset;
+    ssize_t length;
+private:
+    static MemPool *Pool;
+};
+
+/* There may be more than one byte range specified in the request.
+ * This object holds all range specs in order of their appearence
+ * in the request because we SHOULD preserve that order.
+ */
+class HttpHdrRange {
+public:
+    void *operator new(size_t);
+    void operator delete (void *);
+    void deleteSelf() const;
+
+    static size_t ParsedCount;
+    /* Http Range Header Field */
+    static HttpHdrRange *ParseCreate(const String * range_spec);
+
+    HttpHdrRange();
+    HttpHdrRange(HttpHdrRange const &);
+    ~HttpHdrRange();
+    HttpHdrRange &operator= (HttpHdrRange const &);
+
+    typedef Vector<HttpHdrRangeSpec *>::iterator iterator;
+    typedef Vector<HttpHdrRangeSpec *>::const_iterator const_iterator;
+    iterator begin();
+    const_iterator begin () const;
+    iterator end();
+    const_iterator end() const;
+    
+    /* adjust specs after the length is known */
+    int canonize(size_t);
+    int canonize(HttpReply *rep);
+    /* returns true if ranges are valid; inits HttpHdrRange */
+    bool parseInit(const String * range_spec);
+    void packInto(Packer * p) const;
+    /* other */
+    bool isComplex() const;
+    bool willBeComplex() const;
+    ssize_t firstOffset() const;
+    ssize_t lowestOffset(ssize_t) const;
+    bool offsetLimitExceeded() const;
+    Vector<HttpHdrRangeSpec *> specs;
+private:
+    static MemPool *Pool;
+    void getCanonizedSpecs (Vector<HttpHdrRangeSpec *> &copy);
+    void merge (Vector<HttpHdrRangeSpec *> &basis);
+    ssize_t clen;
+};
+
+/* data for iterating thru range specs */
+class HttpHdrRangeIter {
+  public:
+    HttpHdrRange::iterator pos;
+    const HttpHdrRangeSpec *currentSpec() const;
+    void updateSpec();
+    ssize_t debt() const;
+    void debt(ssize_t);
+    ssize_t debt_size;		/* bytes left to send from the current spec */
+    String boundary;		/* boundary for multipart responses */
+    bool valid;
+};
+#endif /* SQUID_HTTPHEADERRANGE_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpHeaderTools.cc,v 1.34 2003/01/17 05:14:29 robertc Exp $
+ * $Id: HttpHeaderTools.cc,v 1.35 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 66    HTTP Header Tools
  * AUTHOR: Alex Rousskov
@@ -35,6 +35,7 @@
 
 #include "squid.h"
 #include "HttpHeader.h"
+#include "HttpHdrContRange.h"
 
 #if UNUSED_CODE
 static int httpHeaderStrCmp(const char *h1, const char *h2, int len);
@@ -62,8 +63,8 @@ httpHeaderBuildFieldsInfo(const HttpHeaderFieldAttrs * attrs, int count)
 	/* copy and init fields */
 	info->id = id;
 	info->type = attrs[i].type;
-	stringInit(&info->name, attrs[i].name);
-	assert(strLen(info->name));
+	info->name = attrs[i].name;
+	assert(info->name.size());
 	/* init stats */
 	memset(&info->stat, 0, sizeof(info->stat));
     }
@@ -75,7 +76,7 @@ httpHeaderDestroyFieldsInfo(HttpHeaderFieldInfo * table, int count)
 {
     int i;
     for (i = 0; i < count; ++i)
-	stringClean(&table[i].name);
+	table[i].name.clean();
     xfree(table);
 }
 
@@ -170,7 +171,7 @@ httpHeaderHasConnDir(const HttpHeader * hdr, const char *directive)
 
     list = httpHeaderGetList(hdr, ht);
     res = strListIsMember(&list, directive, ',');
-    stringClean(&list);
+    list.clean();
     return res;
 }
 
@@ -223,14 +224,14 @@ void
 strListAdd(String * str, const char *item, char del)
 {
     assert(str && item);
-    if (strLen(*str)) {
+    if (str->size()) {
 	char buf[3];
 	buf[0] = del;
 	buf[1] = ' ';
 	buf[2] = '\0';
-	stringAppend(str, buf, 2);
+	str->append(buf, 2);
     }
-    stringAppend(str, item, strlen(item));
+    str->append(item, strlen(item));
 }
 
 /*
@@ -252,7 +253,7 @@ strListGetItem(const String * str, char del, const char **item, int *ilen, const
 	else
 	    (*pos)++;
     } else {
-	*pos = strBuf(*str);
+	*pos = str->buf();
 	if (!*pos)
 	    return 0;
     }
@@ -425,7 +426,7 @@ httpHdrMangle(HttpHeaderEntry * e, request_t * request)
 	 * header on the fly, and return that the new header
 	 * is allowed.
 	 */
-	stringReset(&e->value, hm->replacement);
+	e->value = hm->replacement;
 	retval = 1;
     }
 
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpMsg.cc,v 1.10 2001/01/12 00:37:14 wessels Exp $
+ * $Id: HttpMsg.cc,v 1.11 2003/01/23 00:37:12 robertc Exp $
  *
  * DEBUG: section 74    HTTP Message
  * AUTHOR: Alex Rousskov
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpReply.cc,v 1.50 2002/10/13 20:34:57 robertc Exp $
+ * $Id: HttpReply.cc,v 1.51 2003/01/23 00:37:13 robertc Exp $
  *
  * DEBUG: section 58    HTTP Reply (Response)
  * AUTHOR: Alex Rousskov
@@ -33,7 +33,11 @@
  *
  */
 
+#include "HttpReply.h"
 #include "squid.h"
+#include "Store.h"
+#include "HttpHeader.h"
+#include "HttpHdrContRange.h"
 
 
 /* local constants */
@@ -130,6 +134,7 @@ httpReplyAbsorb(HttpReply * rep, HttpReply * new_rep)
     assert(rep && new_rep);
     httpReplyClean(rep);
     *rep = *new_rep;
+    new_rep->header.entries.clean();
     /* cannot use Clean() on new reply now! */
     httpReplyDoDestroy(new_rep);
 }
@@ -165,12 +170,18 @@ httpReplyParse(HttpReply * rep, const char *buf, ssize_t end)
 }
 
 void
-httpReplyPackInto(const HttpReply * rep, Packer * p)
+httpReplyPackHeadersInto(const HttpReply * rep, Packer * p)
 {
     assert(rep);
     httpStatusLinePackInto(&rep->sline, p);
     httpHeaderPackInto(&rep->header, p);
     packerAppend(p, "\r\n", 2);
+}
+
+void
+httpReplyPackInto(const HttpReply * rep, Packer * p)
+{
+    httpReplyPackHeadersInto(rep, p);
     httpBodyPackInto(&rep->body, p);
 }
 
@@ -189,16 +200,15 @@ httpReplyPack(const HttpReply * rep)
     return mb;
 }
 
-/* swap: create swap-based packer, pack, destroy packer */
+/* swap: create swap-based packer, pack, destroy packer
+ * This eats the reply.
+ */
 void
-httpReplySwapOut(const HttpReply * rep, StoreEntry * e)
+httpReplySwapOut(HttpReply * rep, StoreEntry * e)
 {
-    Packer p;
     assert(rep && e);
 
-    packerToStoreInit(&p, e);
-    httpReplyPackInto(rep, &p);
-    packerClean(&p);
+    storeEntryReplaceObject(e, rep);
 }
 
 MemBuf
@@ -213,26 +223,48 @@ httpPackedReply(http_version_t ver, http_status status, const char *ctype,
     return mb;
 }
 
-MemBuf
-httpPacked304Reply(const HttpReply * rep)
+HttpReply *
+httpReplyMake304 (const HttpReply * rep)
 {
     static const http_hdr_type ImsEntries[] =
-    {HDR_DATE, HDR_CONTENT_TYPE, HDR_EXPIRES, HDR_LAST_MODIFIED, /* eof */ HDR_OTHER};
+      {HDR_DATE, HDR_CONTENT_TYPE, HDR_EXPIRES, HDR_LAST_MODIFIED, /* eof */ HDR_OTHER};
+    HttpReply *rv;
     int t;
-    MemBuf mb;
-    Packer p;
     HttpHeaderEntry *e;
+    http_version_t ver;
     assert(rep);
 
-    memBufDefInit(&mb);
-    packerToMemInit(&p, &mb);
-    memBufPrintf(&mb, "%s", "HTTP/1.0 304 Not Modified\r\n");
+    rv = httpReplyCreate ();
+    /* rv->content_length; */
+    rv->date = rep->date;
+    rv->last_modified = rep->last_modified;
+    rv->expires = rep->expires;
+    rv->content_type = rep->content_type;
+    /* rv->cache_control */
+    /* rv->content_range */
+    /* rv->keep_alive */
+    httpBuildVersion(&ver, 1, 0);
+    httpStatusLineSet(&rv->sline, ver,
+        HTTP_NOT_MODIFIED, "");
     for (t = 0; ImsEntries[t] != HDR_OTHER; ++t)
-	if ((e = httpHeaderFindEntry(&rep->header, ImsEntries[t])))
-	    httpHeaderEntryPackInto(e, &p);
-    memBufAppend(&mb, "\r\n", 2);
-    packerClean(&p);
-    return mb;
+	if ((e = httpHeaderFindEntry(&rep->header, ImsEntries[t])))httpHeaderAddEntry(&rv->header, httpHeaderEntryClone(e));
+    /* rv->body */
+    return rv;
+}
+
+MemBuf
+httpPacked304Reply(const HttpReply * rep)
+{
+    /* Not as efficient as skipping the header duplication,
+     * but easier to maintain
+     */
+    HttpReply *temp;
+    MemBuf rv;
+    assert (rep);
+    temp = httpReplyMake304 (rep);
+    rv = httpReplyPack(temp);
+    httpReplyDestroy (temp);
+    return rv;
 }
 
 void
@@ -248,7 +280,7 @@ httpReplySetHeaders(HttpReply * reply, http_version_t ver, http_status status, c
     httpHeaderPutTime(hdr, HDR_DATE, squid_curtime);
     if (ctype) {
 	httpHeaderPutStr(hdr, HDR_CONTENT_TYPE, ctype);
-	stringInit(&reply->content_type, ctype);
+	reply->content_type = ctype;
     } else
 	reply->content_type = StringNull;
     if (clen >= 0)
@@ -280,10 +312,49 @@ httpRedirectReply(HttpReply * reply, http_status status, const char *loc)
     reply->content_length = 0;
 }
 
+/* compare the validators of two replies.
+ * 1 = they match
+ * 0 = they do not match
+ */
+int
+httpReplyValidatorsMatch(HttpReply const * rep, HttpReply const * otherRep) {
+    String one,two;
+    assert (rep && otherRep);
+    /* Numbers first - easiest to check */
+    /* Content-Length */
+    /* TODO: remove -1 bypass */
+    if (rep->content_length != otherRep->content_length
+       && rep->content_length > -1 &&
+       otherRep->content_length > -1)
+       return 0;
+    /* ETag */
+    one = httpHeaderGetStrOrList(&rep->header, HDR_ETAG);
+    two = httpHeaderGetStrOrList(&otherRep->header, HDR_ETAG);
+    if (!one.buf() || !two.buf() || strcasecmp (one.buf(), two.buf())) {
+       one.clean();
+       two.clean();
+       return 0;
+    }
+    if (rep->last_modified != otherRep->last_modified)
+       return 0;
+    /* MD5 */
+    one = httpHeaderGetStrOrList(&rep->header, HDR_CONTENT_MD5);
+    two = httpHeaderGetStrOrList(&otherRep->header, HDR_CONTENT_MD5);
+    if (strcasecmp (one.buf(), two.buf())) {
+       one.clean();
+       two.clean();
+       return 0;
+    }
+    return 1;
+}
+
+
 void
-httpReplyUpdateOnNotModified(HttpReply * rep, HttpReply * freshRep)
+httpReplyUpdateOnNotModified(HttpReply * rep, HttpReply const * freshRep)
 {
     assert(rep && freshRep);
+    /* Can not update modified headers that don't match! */
+    assert (httpReplyValidatorsMatch(rep, freshRep));
     /* clean cache */
     httpReplyHdrCacheClean(rep);
     /* update raw headers */
@@ -354,7 +425,7 @@ httpReplyHdrCacheInit(HttpReply * rep)
     rep->last_modified = httpHeaderGetTime(hdr, HDR_LAST_MODIFIED);
     str = httpHeaderGetStr(hdr, HDR_CONTENT_TYPE);
     if (str)
-	stringLimitInit(&rep->content_type, str, strcspn(str, ";\t "));
+	rep->content_type.limitInit(str, strcspn(str, ";\t "));
     else
 	rep->content_type = StringNull;
     rep->cache_control = httpHeaderGetCc(hdr);
@@ -368,7 +439,7 @@ httpReplyHdrCacheInit(HttpReply * rep)
 static void
 httpReplyHdrCacheClean(HttpReply * rep)
 {
-    stringClean(&rep->content_type);
+    rep->content_type.clean();
     if (rep->cache_control)
 	httpHdrCcDestroy(rep->cache_control);
     if (rep->content_range)
@@ -378,7 +449,7 @@ httpReplyHdrCacheClean(HttpReply * rep)
 /*
  * parses a 0-terminating buffer into HttpReply. 
  * Returns:
- *      +1 -- success 
+ *      1 -- success 
  *       0 -- need more data (partial parse)
  *      -1 -- parse error
  */
@@ -457,7 +528,7 @@ httpReplyIsolateStart(const char **parse_start, const char **blk_start, const ch
  * Returns the body size of a HTTP response
  */
 int
-httpReplyBodySize(method_t method, HttpReply * reply)
+httpReplyBodySize(method_t method, HttpReply const * reply)
 {
     if (METHOD_HEAD == method)
 	return 0;
@@ -0,0 +1,79 @@
+
+/*
+ * $Id: HttpReply.h,v 1.1 2003/01/23 00:37:13 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_HTTPREPLY_H
+#define SQUID_HTTPREPLY_H
+
+#include "typedefs.h"
+
+/* Http Reply */
+extern void httpReplyInitModule(void);
+/* create/destroy */
+extern HttpReply *httpReplyCreate(void);
+extern void httpReplyDestroy(HttpReply * rep);
+/* reset: clean, then init */
+extern void httpReplyReset(HttpReply * rep);
+/* absorb: copy the contents of a new reply to the old one, destroy new one */
+extern void httpReplyAbsorb(HttpReply * rep, HttpReply * new_rep);
+/* parse returns -1,0,+1 on error,need-more-data,success */
+extern int httpReplyParse(HttpReply * rep, const char *buf, ssize_t);
+extern void httpReplyPackHeadersInto(const HttpReply * rep, Packer * p);
+extern void httpReplyPackInto(const HttpReply * rep, Packer * p);
+/* ez-routines */
+/* mem-pack: returns a ready to use mem buffer with a packed reply */
+extern MemBuf httpReplyPack(const HttpReply * rep);
+/* swap: create swap-based packer, pack, destroy packer */
+extern void httpReplySwapOut(HttpReply * rep, StoreEntry * e);
+/* set commonly used info with one call */
+extern void httpReplySetHeaders(HttpReply * rep, http_version_t ver, http_status status,
+    const char *reason, const char *ctype, int clen, time_t lmt, time_t expires);
+/* do everything in one call: init, set, pack, clean, return MemBuf */
+extern MemBuf httpPackedReply(http_version_t ver, http_status status, const char *ctype,
+    int clen, time_t lmt, time_t expires);
+/* construct 304 reply and pack it into MemBuf, return MemBuf */
+extern MemBuf httpPacked304Reply(const HttpReply * rep);
+/* construct a 304 reply and return it */
+extern HttpReply *httpReplyMake304(const HttpReply *rep);
+/* update when 304 reply is received for a cached object */
+extern void httpReplyUpdateOnNotModified(HttpReply * rep, HttpReply const * freshRep);
+/* header manipulation */
+extern int httpReplyContentLen(const HttpReply * rep);
+extern const char *httpReplyContentType(const HttpReply * rep);
+extern time_t httpReplyExpires(const HttpReply * rep);
+extern int httpReplyHasCc(const HttpReply * rep, http_hdr_cc_type type);
+extern void httpRedirectReply(HttpReply *, http_status, const char *);
+extern int httpReplyBodySize(method_t, HttpReply const *);
+extern void httpReplyBodyBuildSize(request_t *, HttpReply *, dlink_list *);
+extern int httpReplyValidatorsMatch (HttpReply const *, HttpReply const *);
+
+#endif /* SQUID_HTTPREPLY_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpRequest.cc,v 1.32 2002/10/25 07:36:31 robertc Exp $
+ * $Id: HttpRequest.cc,v 1.33 2003/01/23 00:37:13 robertc Exp $
  *
  * DEBUG: section 73    HTTP Request
  * AUTHOR: Duane Wessels
@@ -33,22 +33,27 @@
  *
  */
 
+#include "HttpRequest.h"
 #include "squid.h"
 #include "authenticate.h"
+#include "HttpHeaderRange.h"
+
+static void httpRequestHdrCacheInit(request_t * req);
 
 request_t *
-requestCreate(method_t method, protocol_t protocol, const char *urlpath)
+requestCreate(method_t method, protocol_t protocol, const char *aUrlpath)
 {
     request_t *req = static_cast<request_t *>(memAllocate(MEM_REQUEST_T));
     req->method = method;
     req->protocol = protocol;
-    if (urlpath)
-	stringReset(&req->urlpath, urlpath);
+    if (aUrlpath)
+	req->urlpath = aUrlpath;
     req->max_forwards = -1;
     req->lastmod = -1;
     req->client_addr = no_addr;
     req->my_addr = no_addr;
     httpHeaderInit(&req->header, hoRequest);
+    httpRequestHdrCacheInit(req);
     return req;
 }
 
@@ -62,12 +67,12 @@ requestDestroy(request_t * req)
 	authenticateAuthUserRequestUnlock(req->auth_user_request);
     safe_free(req->canonical);
     safe_free(req->vary_headers);
-    stringClean(&req->urlpath);
+    req->urlpath.clean();
     httpHeaderClean(&req->header);
     if (req->cache_control)
 	httpHdrCcDestroy(req->cache_control);
     if (req->range)
-	httpHdrRangeDestroy(req->range);
+	req->range->deleteSelf();
     memFree(req, MEM_REQUEST_T);
 }
 
@@ -96,7 +101,10 @@ httpRequestParseHeader(request_t * req, const char *parse_start)
     const char *blk_start, *blk_end;
     if (!httpMsgIsolateHeaders(&parse_start, &blk_start, &blk_end))
 	return 0;
-    return httpHeaderParse(&req->header, blk_start, blk_end);
+    int result = httpHeaderParse(&req->header, blk_start, blk_end);
+    if (result)
+	httpRequestHdrCacheInit(req);
+    return result;
 }
 
 /* swaps out request using httpRequestPack */
@@ -117,7 +125,7 @@ httpRequestPack(const request_t * req, Packer * p)
     assert(req && p);
     /* pack request-line */
     packerPrintf(p, "%s %s HTTP/1.0\r\n",
-	RequestMethodStr[req->method], strBuf(req->urlpath));
+	RequestMethodStr[req->method], req->urlpath.buf());
     /* headers */
     httpHeaderPackInto(&req->header, p);
     /* trailer */
@@ -141,7 +149,7 @@ httpRequestPrefixLen(const request_t * req)
 {
     assert(req);
     return strlen(RequestMethodStr[req->method]) + 1 +
-	strLen(req->urlpath) + 1 +
+	req->urlpath.size() + 1 +
 	4 + 1 + 3 + 2 +
 	req->header.len + 2;
 }
@@ -155,11 +163,38 @@ httpRequestHdrAllowed(const HttpHeaderEntry * e, String * strConn)
 {
     assert(e);
     /* check connection header */
-    if (strConn && strListIsMember(strConn, strBuf(e->name), ','))
+    if (strConn && strListIsMember(strConn, e->name.buf(), ','))
 	return 0;
     return 1;
 }
 
+/* sync this routine when you update request_t struct */
+static void
+httpRequestHdrCacheInit(request_t * req)
+{
+    const HttpHeader *hdr = &req->header;
+/*  const char *str; */
+    req->content_length = httpHeaderGetInt(hdr, HDR_CONTENT_LENGTH);
+    /* TODO: canonicalise these into an HttpEntity */
+#if 0
+    req->date = httpHeaderGetTime(hdr, HDR_DATE);
+    req->last_modified = httpHeaderGetTime(hdr, HDR_LAST_MODIFIED);
+    str = httpHeaderGetStr(hdr, HDR_CONTENT_TYPE);
+    if (str)
+       stringLimitInit(&req->content_type, str, strcspn(str, ";\t "));
+    else
+       req->content_type = StringNull;
+#endif
+    req->cache_control = httpHeaderGetCc(hdr);
+    req->range = httpHeaderGetRange(hdr);
+#if 0
+    req->keep_alive = httpMsgIsPersistent(req->http_ver, &req->header);
+
+    /* be sure to set expires after date and cache-control */
+    req->expires = httpReplyHdrExpirationTime(req);
+#endif
+}
+
 /* request_flags */
 bool
 request_flags::resetTCP() const
@@ -180,3 +215,9 @@ request_flags::clearResetTCP()
     debug(73, 9) ("request_flags::clearResetTCP\n");
     reset_tcp = 0;
 }
+
+bool
+request_t::multipartRangeRequest() const
+{
+    return (range && range->specs.count > 1);
+}
@@ -0,0 +1,51 @@
+
+/*
+ * $Id: HttpRequest.h,v 1.1 2003/01/23 00:37:13 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_HTTPREQUEST_H
+#define SQUID_HTTPREQUEST_H
+
+#include "typedefs.h"
+
+/*  Http Request */
+extern request_t *requestCreate(method_t, protocol_t, const char *urlpath);
+extern void requestDestroy(request_t *);
+extern request_t *requestLink(request_t *);
+extern void requestUnlink(request_t *);
+extern int httpRequestParseHeader(request_t * req, const char *parse_start);
+extern void httpRequestSwapOut(const request_t * req, StoreEntry * e);
+extern void httpRequestPack(const request_t * req, Packer * p);
+extern int httpRequestPrefixLen(const request_t * req);
+extern int httpRequestHdrAllowed(const HttpHeaderEntry * e, String * strConnection);
+extern int httpRequestHdrAllowedByName(http_hdr_type id);
+
+#endif /* SQUID_HTTPREQUEST_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: HttpStatusLine.cc,v 1.25 2002/09/23 04:01:51 wessels Exp $
+ * $Id: HttpStatusLine.cc,v 1.26 2003/01/23 00:37:13 robertc Exp $
  *
  * DEBUG: section 57    HTTP Status-line
  * AUTHOR: Alex Rousskov
@@ -1,6 +1,6 @@
 
 /*
- * $Id: ICP.h,v 1.2 2002/10/21 14:00:01 adrian Exp $
+ * $Id: ICP.h,v 1.3 2003/01/23 00:37:13 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -36,9 +36,6 @@
 
 #include "StoreClient.h"
 
-#ifdef __cplusplus
-#endif
-
 /* This struct is the wire-level header.
  * DO NOT add ore move fields on pain of breakage.
  * DO NOT add virtual methods.
@@ -1,6 +1,6 @@
 
 /*
- * $Id: IPInterception.cc,v 1.3 2002/09/27 11:21:10 robertc Exp $
+ * $Id: IPInterception.cc,v 1.4 2003/01/23 00:37:13 robertc Exp $
  *
  * DEBUG: section 89    NAT / IP Interception 
  * AUTHOR: Robert Collins
@@ -1,6 +1,6 @@
 
 /*
- * $Id: IPInterception.h,v 1.3 2002/10/13 20:34:57 robertc Exp $
+ * $Id: IPInterception.h,v 1.4 2003/01/23 00:37:13 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -1,7 +1,7 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.47 2003/01/17 05:37:24 robertc Exp $
+#  $Id: Makefile.am,v 1.48 2003/01/23 00:37:13 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
@@ -79,7 +79,8 @@ EXTRA_PROGRAMS = \
 	unlinkd \
 	pinger \
 	dnsserver \
-	recv-announce
+	recv-announce \
+	ufsdump
 
 noinst_PROGRAMS = \
 	cf_gen
@@ -90,6 +91,7 @@ sbin_PROGRAMS = \
 bin_PROGRAMS = \
 	squidclient
 
+
 libexec_PROGRAMS = \
 	$(PINGER) \
 	$(DNSSERVER) \
@@ -152,6 +154,8 @@ squid_SOURCES = \
 	event.cc \
 	external_acl.cc \
 	fd.cc \
+	fde.cc \
+	fde.h \
 	filemap.cc \
 	forward.cc \
 	fqdncache.cc \
@@ -189,7 +193,11 @@ squid_SOURCES = \
 	logfile.cc \
 	main.cc \
 	mem.cc \
+	mem_node.cc \
+	mem_node.h \
 	MemBuf.cc \
+	MemObject.cc \
+	MemObject.h \
 	mime.cc \
 	multicast.cc \
 	neighbors.cc \
@@ -228,6 +236,18 @@ squid_SOURCES = \
 	store_swapin.cc \
 	store_swapmeta.cc \
 	store_swapout.cc \
+	StoreMeta.cc \
+	StoreMeta.h \
+	StoreMetaMD5.cc \
+	StoreMetaMD5.h \
+	StoreMetaSTD.cc \
+	StoreMetaSTD.h \
+	StoreMetaUnpacker.cc \
+	StoreMetaUnpacker.h \
+	StoreMetaURL.cc \
+	StoreMetaURL.h \
+	StoreMetaVary.cc \
+	StoreMetaVary.h \
 	structs.h \
 	SwapDir.cc \
 	SwapDir.h \
@@ -244,6 +264,13 @@ squid_SOURCES = \
 	whois.cc \
 	$(WIN32SOURCE)
 
+noinst_HEADERS = MemBuf.cci \
+	MemBuf.h \
+	Store.cci \
+	String.cci \
+	String.h \
+	ufscommon.cci 
+
 nodist_squid_SOURCES = \
 	repl_modules.cc \
 	auth_modules.cc \
@@ -277,6 +304,161 @@ pinger_SOURCES = \
 dnsserver_SOURCES = dnsserver.cc
 recv_announce_SOURCES = recv-announce.cc
 
+ufsdump_SOURCES = debug.cc \
+	int.cc \
+	ufsdump.cc \
+	store.cc \
+	StoreMeta.cc \
+	StoreMeta.h \
+	StoreMetaMD5.cc \
+	StoreMetaMD5.h \
+	StoreMetaSTD.cc \
+	StoreMetaSTD.h \
+	StoreMetaUnpacker.cc \
+	StoreMetaUnpacker.h \
+	StoreMetaURL.cc \
+	StoreMetaURL.h \
+	StoreMetaVary.cc \
+	StoreMetaVary.h \
+	access_log.cc \
+	acl.cc \
+	asn.cc \
+	authenticate.cc \
+	cache_cf.cc \
+	CacheDigest.cc \
+	cache_manager.cc \
+	carp.cc \
+	cbdata.cc \
+	client_db.cc \
+	client_side.cc \
+	client_side_reply.cc \
+	client_side_request.cc \
+	client_side_request.h \
+	clientStream.cc \
+	clientStream.h \
+	comm.cc \
+	comm.h \
+	comm_select.cc \
+	comm_poll.cc \
+	comm_kqueue.cc \
+	defines.h \
+	$(DELAY_POOL_SOURCE) \
+	disk.cc \
+	$(DNSSOURCE) \
+	enums.h \
+	errorpage.cc \
+	ETag.cc \
+	event.cc \
+	external_acl.cc \
+	fd.cc \
+	fde.cc \
+	fde.h \
+	filemap.cc \
+	forward.cc \
+	fqdncache.cc \
+	ftp.cc \
+	gopher.cc \
+	helper.cc \
+	$(HTCPSOURCE) \
+	http.cc \
+	HttpStatusLine.cc \
+	HttpHdrCc.cc \
+	HttpHdrRange.cc \
+	HttpHdrContRange.cc \
+	HttpHeader.cc \
+	HttpHeaderTools.cc \
+	HttpBody.cc \
+	HttpMsg.cc \
+	HttpReply.cc \
+	HttpRequest.cc \
+	icmp.cc \
+	icp_v2.cc \
+	icp_v3.cc \
+	ident.cc \
+	internal.cc \
+	ipc.cc \
+	ipcache.cc \
+	IPInterception.cc \
+	IPInterception.h \
+	$(LEAKFINDERSOURCE) \
+	logfile.cc \
+	mem.cc \
+	mem_node.cc \
+	mem_node.h \
+	MemBuf.cc \
+	MemObject.cc \
+	MemObject.h \
+	mime.cc \
+	multicast.cc \
+	neighbors.cc \
+	net_db.cc \
+	Packer.cc \
+	$(XPROF_STATS_SOURCE) \
+	pconn.cc \
+	peer_digest.cc \
+	peer_select.cc \
+	protos.h \
+	redirect.cc \
+	referer.cc \
+	refresh.cc \
+	send-announce.cc \
+	$(SNMPSOURCE) \
+	squid.h \
+	ssl.cc \
+	$(SSLSOURCE) \
+	stat.cc \
+	StatHist.cc \
+	String.cc \
+	stmem.cc \
+	store_io.cc \
+	StoreIOBuffer.h \
+	StoreIOState.cc \
+	store_client.cc \
+	StoreClient.h \
+	store_digest.cc \
+	store_dir.cc \
+	store_key_md5.cc \
+	store_log.cc \
+	store_rebuild.cc \
+	store_swapin.cc \
+	store_swapmeta.cc \
+	store_swapout.cc \
+	structs.h \
+	SwapDir.cc \
+	tools.cc \
+	typedefs.h \
+	ufscommon.cc \
+	ufscommon.h \
+	$(UNLINKDSOURCE) \
+	url.cc \
+	urn.cc \
+	useragent.cc \
+	wais.cc \
+	wccp.cc \
+	whois.cc \
+	$(WIN32SOURCE)
+ufsdump_LDADD = \
+	-L../lib \
+	@XTRA_OBJS@ \
+	@REPL_OBJS@ \
+	@STORE_OBJS@ \
+	@AUTH_OBJS@ \
+	@CRYPTLIB@ \
+	@REGEXLIB@ \
+	@SNMPLIB@ \
+	@LIB_MALLOC@ \
+	@SSLLIB@ \
+	-lmiscutil \
+	@XTRA_LIBS@
+ufsdump_DEPENDENCIES = $(top_builddir)/lib/libmiscutil.a
+nodist_ufsdump_SOURCES = \
+	repl_modules.cc \
+	auth_modules.cc \
+	store_modules.cc \
+	cf_parser.h \
+	globals.cc \
+	string_arrays.c
+
 nodist_pinger_SOURCES = \
 	globals.cc
 
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -16,11 +17,10 @@
 #
 #  Makefile for the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.267 2003/01/17 05:39:14 robertc Exp $
+#  $Id: Makefile.in,v 1.268 2003/01/23 00:37:13 robertc Exp $
 #
 #  Uncomment and customize the following to suit your needs:
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -51,9 +51,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -65,6 +69,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -82,7 +90,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -95,7 +102,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -112,6 +118,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -169,7 +176,8 @@ EXTRA_PROGRAMS = \
 
 
 noinst_PROGRAMS = \
-	cf_gen
+	cf_gen \
+	ufsdump
 
 
 sbin_PROGRAMS = \
@@ -243,6 +251,8 @@ squid_SOURCES = \
 	event.cc \
 	external_acl.cc \
 	fd.cc \
+	fde.cc \
+	fde.h \
 	filemap.cc \
 	forward.cc \
 	fqdncache.cc \
@@ -280,7 +290,11 @@ squid_SOURCES = \
 	logfile.cc \
 	main.cc \
 	mem.cc \
+	mem_node.cc \
+	mem_node.h \
 	MemBuf.cc \
+	MemObject.cc \
+	MemObject.h \
 	mime.cc \
 	multicast.cc \
 	neighbors.cc \
@@ -319,6 +333,18 @@ squid_SOURCES = \
 	store_swapin.cc \
 	store_swapmeta.cc \
 	store_swapout.cc \
+	StoreMeta.cc \
+	StoreMeta.h \
+	StoreMetaMD5.cc \
+	StoreMetaMD5.h \
+	StoreMetaSTD.cc \
+	StoreMetaSTD.h \
+	StoreMetaUnpacker.cc \
+	StoreMetaUnpacker.h \
+	StoreMetaURL.cc \
+	StoreMetaURL.h \
+	StoreMetaVary.cc \
+	StoreMetaVary.h \
 	structs.h \
 	SwapDir.cc \
 	SwapDir.h \
@@ -336,6 +362,14 @@ squid_SOURCES = \
 	$(WIN32SOURCE)
 
 
+noinst_HEADERS = MemBuf.cci \
+	MemBuf.h \
+	Store.cci \
+	String.cci \
+	String.h \
+	ufscommon.cci 
+
+
 nodist_squid_SOURCES = \
 	repl_modules.cc \
 	auth_modules.cc \
@@ -372,6 +406,164 @@ pinger_SOURCES = \
 dnsserver_SOURCES = dnsserver.cc
 recv_announce_SOURCES = recv-announce.cc
 
+ufsdump_SOURCES = debug.cc \
+	int.cc \
+	ufsdump.cc \
+	store.cc \
+	StoreMeta.cc \
+	StoreMeta.h \
+	StoreMetaMD5.cc \
+	StoreMetaMD5.h \
+	StoreMetaSTD.cc \
+	StoreMetaSTD.h \
+	StoreMetaUnpacker.cc \
+	StoreMetaUnpacker.h \
+	StoreMetaURL.cc \
+	StoreMetaURL.h \
+	StoreMetaVary.cc \
+	StoreMetaVary.h \
+	access_log.cc \
+	acl.cc \
+	asn.cc \
+	authenticate.cc \
+	cache_cf.cc \
+	CacheDigest.cc \
+	cache_manager.cc \
+	carp.cc \
+	cbdata.cc \
+	client_db.cc \
+	client_side.cc \
+	client_side_reply.cc \
+	client_side_request.cc \
+	client_side_request.h \
+	clientStream.cc \
+	clientStream.h \
+	comm.cc \
+	comm.h \
+	comm_select.cc \
+	comm_poll.cc \
+	comm_kqueue.cc \
+	defines.h \
+	$(DELAY_POOL_SOURCE) \
+	disk.cc \
+	$(DNSSOURCE) \
+	enums.h \
+	errorpage.cc \
+	ETag.cc \
+	event.cc \
+	external_acl.cc \
+	fd.cc \
+	fde.cc \
+	fde.h \
+	filemap.cc \
+	forward.cc \
+	fqdncache.cc \
+	ftp.cc \
+	gopher.cc \
+	helper.cc \
+	$(HTCPSOURCE) \
+	http.cc \
+	HttpStatusLine.cc \
+	HttpHdrCc.cc \
+	HttpHdrRange.cc \
+	HttpHdrContRange.cc \
+	HttpHeader.cc \
+	HttpHeaderTools.cc \
+	HttpBody.cc \
+	HttpMsg.cc \
+	HttpReply.cc \
+	HttpRequest.cc \
+	icmp.cc \
+	icp_v2.cc \
+	icp_v3.cc \
+	ident.cc \
+	internal.cc \
+	ipc.cc \
+	ipcache.cc \
+	IPInterception.cc \
+	IPInterception.h \
+	$(LEAKFINDERSOURCE) \
+	logfile.cc \
+	mem.cc \
+	mem_node.cc \
+	mem_node.h \
+	MemBuf.cc \
+	MemObject.cc \
+	MemObject.h \
+	mime.cc \
+	multicast.cc \
+	neighbors.cc \
+	net_db.cc \
+	Packer.cc \
+	$(XPROF_STATS_SOURCE) \
+	pconn.cc \
+	peer_digest.cc \
+	peer_select.cc \
+	protos.h \
+	redirect.cc \
+	referer.cc \
+	refresh.cc \
+	send-announce.cc \
+	$(SNMPSOURCE) \
+	squid.h \
+	ssl.cc \
+	$(SSLSOURCE) \
+	stat.cc \
+	StatHist.cc \
+	String.cc \
+	stmem.cc \
+	store_io.cc \
+	StoreIOBuffer.h \
+	StoreIOState.cc \
+	store_client.cc \
+	StoreClient.h \
+	store_digest.cc \
+	store_dir.cc \
+	store_key_md5.cc \
+	store_log.cc \
+	store_rebuild.cc \
+	store_swapin.cc \
+	store_swapmeta.cc \
+	store_swapout.cc \
+	structs.h \
+	SwapDir.cc \
+	tools.cc \
+	typedefs.h \
+	ufscommon.cc \
+	ufscommon.h \
+	$(UNLINKDSOURCE) \
+	url.cc \
+	urn.cc \
+	useragent.cc \
+	wais.cc \
+	wccp.cc \
+	whois.cc \
+	$(WIN32SOURCE)
+
+ufsdump_LDADD = \
+	-L../lib \
+	@XTRA_OBJS@ \
+	@REPL_OBJS@ \
+	@STORE_OBJS@ \
+	@AUTH_OBJS@ \
+	@CRYPTLIB@ \
+	@REGEXLIB@ \
+	@SNMPLIB@ \
+	@LIB_MALLOC@ \
+	@SSLLIB@ \
+	-lmiscutil \
+	@XTRA_LIBS@
+
+ufsdump_DEPENDENCIES = $(top_builddir)/lib/libmiscutil.a
+nodist_ufsdump_SOURCES = \
+	repl_modules.cc \
+	auth_modules.cc \
+	store_modules.cc \
+	cf_parser.h \
+	globals.cc \
+	string_arrays.c
+
+
 nodist_pinger_SOURCES = \
 	globals.cc
 
@@ -473,7 +665,7 @@ bin_PROGRAMS = squidclient$(EXEEXT)
 @ENABLE_PINGER_TRUE@@ENABLE_UNLINKD_TRUE@@USE_DNSSERVER_FALSE@	pinger$(EXEEXT) \
 @ENABLE_PINGER_TRUE@@ENABLE_UNLINKD_TRUE@@USE_DNSSERVER_FALSE@	unlinkd$(EXEEXT) \
 @ENABLE_PINGER_TRUE@@ENABLE_UNLINKD_TRUE@@USE_DNSSERVER_FALSE@	cachemgr$(CGIEXT)$(EXEEXT)
-noinst_PROGRAMS = cf_gen$(EXEEXT)
+noinst_PROGRAMS = cf_gen$(EXEEXT) ufsdump$(EXEEXT)
 sbin_PROGRAMS = squid$(EXEEXT)
 PROGRAMS = $(bin_PROGRAMS) $(libexec_PROGRAMS) $(noinst_PROGRAMS) \
 	$(sbin_PROGRAMS)
@@ -504,59 +696,63 @@ recv_announce_OBJECTS = $(am_recv_announce_OBJECTS)
 recv_announce_LDADD = $(LDADD)
 recv_announce_DEPENDENCIES =
 recv_announce_LDFLAGS =
-@USE_DELAY_POOLS_FALSE@am__objects_4 =
-@USE_DELAY_POOLS_TRUE@am__objects_4 = delay_pools.$(OBJEXT)
-@USE_DNSSERVER_FALSE@am__objects_5 = dns_internal.$(OBJEXT)
-@USE_DNSSERVER_TRUE@am__objects_5 = dns.$(OBJEXT)
-@ENABLE_HTCP_TRUE@am__objects_6 = htcp.$(OBJEXT)
-@MAKE_LEAKFINDER_TRUE@am__objects_7 = leakfinder.$(OBJEXT)
-@MAKE_LEAKFINDER_FALSE@am__objects_7 =
-@ENABLE_XPROF_STATS_TRUE@am__objects_3 = ProfStats.$(OBJEXT)
-@ENABLE_XPROF_STATS_FALSE@am__objects_3 =
-@USE_SNMP_TRUE@am__objects_8 = snmp_core.$(OBJEXT) snmp_agent.$(OBJEXT)
-@USE_SNMP_FALSE@am__objects_8 =
-@ENABLE_SSL_FALSE@am__objects_9 =
-@ENABLE_SSL_TRUE@am__objects_9 = ssl_support.$(OBJEXT)
-@ENABLE_UNLINKD_TRUE@am__objects_10 = unlinkd.$(OBJEXT)
-@ENABLE_UNLINKD_FALSE@am__objects_10 =
-@ENABLE_WIN32SPECIFIC_FALSE@am__objects_11 =
-@ENABLE_WIN32SPECIFIC_TRUE@am__objects_11 = win32.$(OBJEXT)
+@USE_DELAY_POOLS_TRUE@am__objects_1 = delay_pools.$(OBJEXT)
+@USE_DELAY_POOLS_FALSE@am__objects_1 =
+@USE_DNSSERVER_TRUE@am__objects_2 = dns.$(OBJEXT)
+@USE_DNSSERVER_FALSE@am__objects_2 = dns_internal.$(OBJEXT)
+@ENABLE_HTCP_TRUE@am__objects_3 = htcp.$(OBJEXT)
+@MAKE_LEAKFINDER_TRUE@am__objects_4 = leakfinder.$(OBJEXT)
+@MAKE_LEAKFINDER_FALSE@am__objects_4 =
+@ENABLE_XPROF_STATS_TRUE@am__objects_5 = ProfStats.$(OBJEXT)
+@ENABLE_XPROF_STATS_FALSE@am__objects_5 =
+@USE_SNMP_TRUE@am__objects_6 = snmp_core.$(OBJEXT) snmp_agent.$(OBJEXT)
+@USE_SNMP_FALSE@am__objects_6 =
+@ENABLE_SSL_TRUE@am__objects_7 = ssl_support.$(OBJEXT)
+@ENABLE_SSL_FALSE@am__objects_7 =
+@ENABLE_UNLINKD_TRUE@am__objects_8 = unlinkd.$(OBJEXT)
+@ENABLE_UNLINKD_FALSE@am__objects_8 =
+@ENABLE_WIN32SPECIFIC_TRUE@am__objects_9 = win32.$(OBJEXT)
+@ENABLE_WIN32SPECIFIC_FALSE@am__objects_9 =
 am_squid_OBJECTS = access_log.$(OBJEXT) acl.$(OBJEXT) asn.$(OBJEXT) \
 	authenticate.$(OBJEXT) cache_cf.$(OBJEXT) CacheDigest.$(OBJEXT) \
 	cache_manager.$(OBJEXT) carp.$(OBJEXT) cbdata.$(OBJEXT) \
 	client_db.$(OBJEXT) client_side.$(OBJEXT) \
 	client_side_reply.$(OBJEXT) client_side_request.$(OBJEXT) \
 	clientStream.$(OBJEXT) comm.$(OBJEXT) comm_select.$(OBJEXT) \
 	comm_poll.$(OBJEXT) comm_kqueue.$(OBJEXT) debug.$(OBJEXT) \
-	$(am__objects_4) disk.$(OBJEXT) $(am__objects_5) \
+	$(am__objects_1) disk.$(OBJEXT) $(am__objects_2) \
 	errorpage.$(OBJEXT) ETag.$(OBJEXT) event.$(OBJEXT) \
-	external_acl.$(OBJEXT) fd.$(OBJEXT) filemap.$(OBJEXT) \
-	forward.$(OBJEXT) fqdncache.$(OBJEXT) ftp.$(OBJEXT) \
-	gopher.$(OBJEXT) helper.$(OBJEXT) $(am__objects_6) \
-	http.$(OBJEXT) HttpStatusLine.$(OBJEXT) HttpHdrCc.$(OBJEXT) \
-	HttpHdrRange.$(OBJEXT) HttpHdrContRange.$(OBJEXT) \
-	HttpHeader.$(OBJEXT) HttpHeaderTools.$(OBJEXT) \
-	HttpBody.$(OBJEXT) HttpMsg.$(OBJEXT) HttpReply.$(OBJEXT) \
-	HttpRequest.$(OBJEXT) icmp.$(OBJEXT) icp_v2.$(OBJEXT) \
-	icp_v3.$(OBJEXT) ident.$(OBJEXT) int.$(OBJEXT) \
+	external_acl.$(OBJEXT) fd.$(OBJEXT) fde.$(OBJEXT) \
+	filemap.$(OBJEXT) forward.$(OBJEXT) fqdncache.$(OBJEXT) \
+	ftp.$(OBJEXT) gopher.$(OBJEXT) helper.$(OBJEXT) \
+	$(am__objects_3) http.$(OBJEXT) HttpStatusLine.$(OBJEXT) \
+	HttpHdrCc.$(OBJEXT) HttpHdrRange.$(OBJEXT) \
+	HttpHdrContRange.$(OBJEXT) HttpHeader.$(OBJEXT) \
+	HttpHeaderTools.$(OBJEXT) HttpBody.$(OBJEXT) HttpMsg.$(OBJEXT) \
+	HttpReply.$(OBJEXT) HttpRequest.$(OBJEXT) icmp.$(OBJEXT) \
+	icp_v2.$(OBJEXT) icp_v3.$(OBJEXT) ident.$(OBJEXT) int.$(OBJEXT) \
 	internal.$(OBJEXT) ipc.$(OBJEXT) ipcache.$(OBJEXT) \
-	IPInterception.$(OBJEXT) $(am__objects_7) logfile.$(OBJEXT) \
-	main.$(OBJEXT) mem.$(OBJEXT) MemBuf.$(OBJEXT) mime.$(OBJEXT) \
+	IPInterception.$(OBJEXT) $(am__objects_4) logfile.$(OBJEXT) \
+	main.$(OBJEXT) mem.$(OBJEXT) mem_node.$(OBJEXT) \
+	MemBuf.$(OBJEXT) MemObject.$(OBJEXT) mime.$(OBJEXT) \
 	multicast.$(OBJEXT) neighbors.$(OBJEXT) net_db.$(OBJEXT) \
-	Packer.$(OBJEXT) $(am__objects_3) pconn.$(OBJEXT) \
+	Packer.$(OBJEXT) $(am__objects_5) pconn.$(OBJEXT) \
 	peer_digest.$(OBJEXT) peer_select.$(OBJEXT) redirect.$(OBJEXT) \
 	referer.$(OBJEXT) refresh.$(OBJEXT) send-announce.$(OBJEXT) \
-	$(am__objects_8) ssl.$(OBJEXT) $(am__objects_9) stat.$(OBJEXT) \
+	$(am__objects_6) ssl.$(OBJEXT) $(am__objects_7) stat.$(OBJEXT) \
 	StatHist.$(OBJEXT) String.$(OBJEXT) stmem.$(OBJEXT) \
 	store.$(OBJEXT) store_io.$(OBJEXT) StoreIOState.$(OBJEXT) \
 	store_client.$(OBJEXT) store_digest.$(OBJEXT) \
 	store_dir.$(OBJEXT) store_key_md5.$(OBJEXT) store_log.$(OBJEXT) \
 	store_rebuild.$(OBJEXT) store_swapin.$(OBJEXT) \
 	store_swapmeta.$(OBJEXT) store_swapout.$(OBJEXT) \
+	StoreMeta.$(OBJEXT) StoreMetaMD5.$(OBJEXT) \
+	StoreMetaSTD.$(OBJEXT) StoreMetaUnpacker.$(OBJEXT) \
+	StoreMetaURL.$(OBJEXT) StoreMetaVary.$(OBJEXT) \
 	SwapDir.$(OBJEXT) tools.$(OBJEXT) ufscommon.$(OBJEXT) \
-	$(am__objects_10) url.$(OBJEXT) urn.$(OBJEXT) \
+	$(am__objects_8) url.$(OBJEXT) urn.$(OBJEXT) \
 	useragent.$(OBJEXT) wais.$(OBJEXT) wccp.$(OBJEXT) \
-	whois.$(OBJEXT) $(am__objects_11)
+	whois.$(OBJEXT) $(am__objects_9)
 nodist_squid_OBJECTS = repl_modules.$(OBJEXT) auth_modules.$(OBJEXT) \
 	store_modules.$(OBJEXT) globals.$(OBJEXT) \
 	string_arrays.$(OBJEXT)
@@ -567,6 +763,52 @@ squidclient_OBJECTS = $(am_squidclient_OBJECTS)
 squidclient_LDADD = $(LDADD)
 squidclient_DEPENDENCIES =
 squidclient_LDFLAGS =
+am_ufsdump_OBJECTS = debug.$(OBJEXT) int.$(OBJEXT) ufsdump.$(OBJEXT) \
+	store.$(OBJEXT) StoreMeta.$(OBJEXT) StoreMetaMD5.$(OBJEXT) \
+	StoreMetaSTD.$(OBJEXT) StoreMetaUnpacker.$(OBJEXT) \
+	StoreMetaURL.$(OBJEXT) StoreMetaVary.$(OBJEXT) \
+	access_log.$(OBJEXT) acl.$(OBJEXT) asn.$(OBJEXT) \
+	authenticate.$(OBJEXT) cache_cf.$(OBJEXT) CacheDigest.$(OBJEXT) \
+	cache_manager.$(OBJEXT) carp.$(OBJEXT) cbdata.$(OBJEXT) \
+	client_db.$(OBJEXT) client_side.$(OBJEXT) \
+	client_side_reply.$(OBJEXT) client_side_request.$(OBJEXT) \
+	clientStream.$(OBJEXT) comm.$(OBJEXT) comm_select.$(OBJEXT) \
+	comm_poll.$(OBJEXT) comm_kqueue.$(OBJEXT) $(am__objects_1) \
+	disk.$(OBJEXT) $(am__objects_2) errorpage.$(OBJEXT) \
+	ETag.$(OBJEXT) event.$(OBJEXT) external_acl.$(OBJEXT) \
+	fd.$(OBJEXT) fde.$(OBJEXT) filemap.$(OBJEXT) forward.$(OBJEXT) \
+	fqdncache.$(OBJEXT) ftp.$(OBJEXT) gopher.$(OBJEXT) \
+	helper.$(OBJEXT) $(am__objects_3) http.$(OBJEXT) \
+	HttpStatusLine.$(OBJEXT) HttpHdrCc.$(OBJEXT) \
+	HttpHdrRange.$(OBJEXT) HttpHdrContRange.$(OBJEXT) \
+	HttpHeader.$(OBJEXT) HttpHeaderTools.$(OBJEXT) \
+	HttpBody.$(OBJEXT) HttpMsg.$(OBJEXT) HttpReply.$(OBJEXT) \
+	HttpRequest.$(OBJEXT) icmp.$(OBJEXT) icp_v2.$(OBJEXT) \
+	icp_v3.$(OBJEXT) ident.$(OBJEXT) internal.$(OBJEXT) \
+	ipc.$(OBJEXT) ipcache.$(OBJEXT) IPInterception.$(OBJEXT) \
+	$(am__objects_4) logfile.$(OBJEXT) mem.$(OBJEXT) \
+	mem_node.$(OBJEXT) MemBuf.$(OBJEXT) MemObject.$(OBJEXT) \
+	mime.$(OBJEXT) multicast.$(OBJEXT) neighbors.$(OBJEXT) \
+	net_db.$(OBJEXT) Packer.$(OBJEXT) $(am__objects_5) \
+	pconn.$(OBJEXT) peer_digest.$(OBJEXT) peer_select.$(OBJEXT) \
+	redirect.$(OBJEXT) referer.$(OBJEXT) refresh.$(OBJEXT) \
+	send-announce.$(OBJEXT) $(am__objects_6) ssl.$(OBJEXT) \
+	$(am__objects_7) stat.$(OBJEXT) StatHist.$(OBJEXT) \
+	String.$(OBJEXT) stmem.$(OBJEXT) store_io.$(OBJEXT) \
+	StoreIOState.$(OBJEXT) store_client.$(OBJEXT) \
+	store_digest.$(OBJEXT) store_dir.$(OBJEXT) \
+	store_key_md5.$(OBJEXT) store_log.$(OBJEXT) \
+	store_rebuild.$(OBJEXT) store_swapin.$(OBJEXT) \
+	store_swapmeta.$(OBJEXT) store_swapout.$(OBJEXT) \
+	SwapDir.$(OBJEXT) tools.$(OBJEXT) ufscommon.$(OBJEXT) \
+	$(am__objects_8) url.$(OBJEXT) urn.$(OBJEXT) \
+	useragent.$(OBJEXT) wais.$(OBJEXT) wccp.$(OBJEXT) \
+	whois.$(OBJEXT) $(am__objects_9)
+nodist_ufsdump_OBJECTS = repl_modules.$(OBJEXT) auth_modules.$(OBJEXT) \
+	store_modules.$(OBJEXT) globals.$(OBJEXT) \
+	string_arrays.$(OBJEXT)
+ufsdump_OBJECTS = $(am_ufsdump_OBJECTS) $(nodist_ufsdump_OBJECTS)
+ufsdump_LDFLAGS =
 am_unlinkd_OBJECTS = unlinkd-unlinkd.$(OBJEXT)
 unlinkd_OBJECTS = $(am_unlinkd_OBJECTS)
 unlinkd_LDADD = $(LDADD)
@@ -577,69 +819,84 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/CacheDigest.Po $(DEPDIR)/ETag.Po \
-@AMDEP_TRUE@	$(DEPDIR)/HttpBody.Po $(DEPDIR)/HttpHdrCc.Po \
-@AMDEP_TRUE@	$(DEPDIR)/HttpHdrContRange.Po \
-@AMDEP_TRUE@	$(DEPDIR)/HttpHdrRange.Po $(DEPDIR)/HttpHeader.Po \
-@AMDEP_TRUE@	$(DEPDIR)/HttpHeaderTools.Po $(DEPDIR)/HttpMsg.Po \
-@AMDEP_TRUE@	$(DEPDIR)/HttpReply.Po $(DEPDIR)/HttpRequest.Po \
-@AMDEP_TRUE@	$(DEPDIR)/HttpStatusLine.Po \
-@AMDEP_TRUE@	$(DEPDIR)/IPInterception.Po $(DEPDIR)/MemBuf.Po \
-@AMDEP_TRUE@	$(DEPDIR)/Packer.Po $(DEPDIR)/ProfStats.Po \
-@AMDEP_TRUE@	$(DEPDIR)/StatHist.Po $(DEPDIR)/StoreIOState.Po \
-@AMDEP_TRUE@	$(DEPDIR)/String.Po $(DEPDIR)/SwapDir.Po \
-@AMDEP_TRUE@	$(DEPDIR)/access_log.Po $(DEPDIR)/acl.Po \
-@AMDEP_TRUE@	$(DEPDIR)/asn.Po $(DEPDIR)/auth_modules.Po \
-@AMDEP_TRUE@	$(DEPDIR)/authenticate.Po $(DEPDIR)/cache_cf.Po \
-@AMDEP_TRUE@	$(DEPDIR)/cache_manager.Po $(DEPDIR)/cachemgr.Po \
-@AMDEP_TRUE@	$(DEPDIR)/carp.Po $(DEPDIR)/cbdata.Po \
-@AMDEP_TRUE@	$(DEPDIR)/cf_gen.Po $(DEPDIR)/client.Po \
-@AMDEP_TRUE@	$(DEPDIR)/clientStream.Po $(DEPDIR)/client_db.Po \
-@AMDEP_TRUE@	$(DEPDIR)/client_side.Po \
-@AMDEP_TRUE@	$(DEPDIR)/client_side_reply.Po \
-@AMDEP_TRUE@	$(DEPDIR)/client_side_request.Po $(DEPDIR)/comm.Po \
-@AMDEP_TRUE@	$(DEPDIR)/comm_kqueue.Po $(DEPDIR)/comm_poll.Po \
-@AMDEP_TRUE@	$(DEPDIR)/comm_select.Po $(DEPDIR)/debug.Po \
-@AMDEP_TRUE@	$(DEPDIR)/delay_pools.Po $(DEPDIR)/disk.Po \
-@AMDEP_TRUE@	$(DEPDIR)/dns.Po $(DEPDIR)/dns_internal.Po \
-@AMDEP_TRUE@	$(DEPDIR)/dnsserver.Po $(DEPDIR)/errorpage.Po \
-@AMDEP_TRUE@	$(DEPDIR)/event.Po $(DEPDIR)/external_acl.Po \
-@AMDEP_TRUE@	$(DEPDIR)/fd.Po $(DEPDIR)/filemap.Po \
-@AMDEP_TRUE@	$(DEPDIR)/forward.Po $(DEPDIR)/fqdncache.Po \
-@AMDEP_TRUE@	$(DEPDIR)/ftp.Po $(DEPDIR)/globals.Po \
-@AMDEP_TRUE@	$(DEPDIR)/gopher.Po $(DEPDIR)/helper.Po \
-@AMDEP_TRUE@	$(DEPDIR)/htcp.Po $(DEPDIR)/http.Po \
-@AMDEP_TRUE@	$(DEPDIR)/icmp.Po $(DEPDIR)/icp_v2.Po \
-@AMDEP_TRUE@	$(DEPDIR)/icp_v3.Po $(DEPDIR)/ident.Po \
-@AMDEP_TRUE@	$(DEPDIR)/int.Po $(DEPDIR)/internal.Po \
-@AMDEP_TRUE@	$(DEPDIR)/ipc.Po $(DEPDIR)/ipcache.Po \
-@AMDEP_TRUE@	$(DEPDIR)/leakfinder.Po $(DEPDIR)/logfile.Po \
-@AMDEP_TRUE@	$(DEPDIR)/main.Po $(DEPDIR)/mem.Po \
-@AMDEP_TRUE@	$(DEPDIR)/mime.Po $(DEPDIR)/multicast.Po \
-@AMDEP_TRUE@	$(DEPDIR)/neighbors.Po $(DEPDIR)/net_db.Po \
-@AMDEP_TRUE@	$(DEPDIR)/pconn.Po $(DEPDIR)/peer_digest.Po \
-@AMDEP_TRUE@	$(DEPDIR)/peer_select.Po $(DEPDIR)/pinger.Po \
-@AMDEP_TRUE@	$(DEPDIR)/recv-announce.Po $(DEPDIR)/redirect.Po \
-@AMDEP_TRUE@	$(DEPDIR)/referer.Po $(DEPDIR)/refresh.Po \
-@AMDEP_TRUE@	$(DEPDIR)/repl_modules.Po \
-@AMDEP_TRUE@	$(DEPDIR)/send-announce.Po $(DEPDIR)/snmp_agent.Po \
-@AMDEP_TRUE@	$(DEPDIR)/snmp_core.Po $(DEPDIR)/ssl.Po \
-@AMDEP_TRUE@	$(DEPDIR)/ssl_support.Po $(DEPDIR)/stat.Po \
-@AMDEP_TRUE@	$(DEPDIR)/stmem.Po $(DEPDIR)/store.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_client.Po $(DEPDIR)/store_digest.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_dir.Po $(DEPDIR)/store_io.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_key_md5.Po $(DEPDIR)/store_log.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_modules.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_rebuild.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_swapin.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_swapmeta.Po \
-@AMDEP_TRUE@	$(DEPDIR)/store_swapout.Po \
-@AMDEP_TRUE@	$(DEPDIR)/string_arrays.Po $(DEPDIR)/tools.Po \
-@AMDEP_TRUE@	$(DEPDIR)/ufscommon.Po $(DEPDIR)/unlinkd-unlinkd.Po \
-@AMDEP_TRUE@	$(DEPDIR)/unlinkd.Po $(DEPDIR)/url.Po \
-@AMDEP_TRUE@	$(DEPDIR)/urn.Po $(DEPDIR)/useragent.Po \
-@AMDEP_TRUE@	$(DEPDIR)/wais.Po $(DEPDIR)/wccp.Po \
-@AMDEP_TRUE@	$(DEPDIR)/whois.Po $(DEPDIR)/win32.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/CacheDigest.Po ./$(DEPDIR)/ETag.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpBody.Po ./$(DEPDIR)/HttpHdrCc.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpHdrContRange.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpHdrRange.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpHeader.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpHeaderTools.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpMsg.Po ./$(DEPDIR)/HttpReply.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpRequest.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/HttpStatusLine.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/IPInterception.Po ./$(DEPDIR)/MemBuf.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/MemObject.Po ./$(DEPDIR)/Packer.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ProfStats.Po ./$(DEPDIR)/StatHist.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/StoreIOState.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/StoreMeta.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/StoreMetaMD5.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/StoreMetaSTD.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/StoreMetaURL.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/StoreMetaUnpacker.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/StoreMetaVary.Po ./$(DEPDIR)/String.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/SwapDir.Po ./$(DEPDIR)/access_log.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/acl.Po ./$(DEPDIR)/asn.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/auth_modules.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/authenticate.Po ./$(DEPDIR)/cache_cf.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/cache_manager.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/cachemgr.Po ./$(DEPDIR)/carp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/cbdata.Po ./$(DEPDIR)/cf_gen.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/client.Po ./$(DEPDIR)/clientStream.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/client_db.Po ./$(DEPDIR)/client_side.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/client_side_reply.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/client_side_request.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/comm.Po ./$(DEPDIR)/comm_kqueue.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/comm_poll.Po ./$(DEPDIR)/comm_select.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/debug.Po ./$(DEPDIR)/delay_pools.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/disk.Po ./$(DEPDIR)/dns.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/dns_internal.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/dnsserver.Po ./$(DEPDIR)/errorpage.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/event.Po ./$(DEPDIR)/external_acl.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/fd.Po ./$(DEPDIR)/fde.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/filemap.Po ./$(DEPDIR)/forward.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/fqdncache.Po ./$(DEPDIR)/ftp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/globals.Po ./$(DEPDIR)/gopher.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/helper.Po ./$(DEPDIR)/htcp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/http.Po ./$(DEPDIR)/icmp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/icp_v2.Po ./$(DEPDIR)/icp_v3.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ident.Po ./$(DEPDIR)/int.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/internal.Po ./$(DEPDIR)/ipc.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ipcache.Po ./$(DEPDIR)/leakfinder.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/logfile.Po ./$(DEPDIR)/main.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/mem.Po ./$(DEPDIR)/mem_node.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/mime.Po ./$(DEPDIR)/multicast.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/neighbors.Po ./$(DEPDIR)/net_db.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/pconn.Po ./$(DEPDIR)/peer_digest.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/peer_select.Po ./$(DEPDIR)/pinger.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/recv-announce.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/redirect.Po ./$(DEPDIR)/referer.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/refresh.Po ./$(DEPDIR)/repl_modules.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/send-announce.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/snmp_agent.Po ./$(DEPDIR)/snmp_core.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ssl.Po ./$(DEPDIR)/ssl_support.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/stat.Po ./$(DEPDIR)/stmem.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store.Po ./$(DEPDIR)/store_client.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_digest.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_dir.Po ./$(DEPDIR)/store_io.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_key_md5.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_log.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_modules.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_rebuild.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_swapin.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_swapmeta.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/store_swapout.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/string_arrays.Po ./$(DEPDIR)/tools.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ufscommon.Po ./$(DEPDIR)/ufsdump.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/unlinkd-unlinkd.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/unlinkd.Po ./$(DEPDIR)/url.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/urn.Po ./$(DEPDIR)/useragent.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/wais.Po ./$(DEPDIR)/wccp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/whois.Po ./$(DEPDIR)/win32.Po
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
@@ -654,17 +911,19 @@ CXXFLAGS = @CXXFLAGS@
 DIST_SOURCES = $(cachemgr__CGIEXT__SOURCES) $(cf_gen_SOURCES) \
 	$(dnsserver_SOURCES) $(pinger_SOURCES) $(recv_announce_SOURCES) \
 	$(squid_SOURCES) $(EXTRA_squid_SOURCES) $(squidclient_SOURCES) \
-	$(unlinkd_SOURCES)
+	$(ufsdump_SOURCES) $(unlinkd_SOURCES)
 DATA = $(data_DATA) $(sysconf_DATA)
 
+HEADERS = $(noinst_HEADERS)
+
 
 RECURSIVE_TARGETS = info-recursive dvi-recursive install-info-recursive \
 	uninstall-info-recursive all-recursive install-data-recursive \
 	install-exec-recursive installdirs-recursive install-recursive \
 	uninstall-recursive check-recursive installcheck-recursive
-DIST_COMMON = Makefile.am Makefile.in
+DIST_COMMON = $(noinst_HEADERS) Makefile.am Makefile.in
 DIST_SUBDIRS = $(SUBDIRS)
-SOURCES = $(cachemgr__CGIEXT__SOURCES) $(cf_gen_SOURCES) $(dnsserver_SOURCES) $(pinger_SOURCES) $(nodist_pinger_SOURCES) $(recv_announce_SOURCES) $(squid_SOURCES) $(EXTRA_squid_SOURCES) $(nodist_squid_SOURCES) $(squidclient_SOURCES) $(unlinkd_SOURCES)
+SOURCES = $(cachemgr__CGIEXT__SOURCES) $(cf_gen_SOURCES) $(dnsserver_SOURCES) $(pinger_SOURCES) $(nodist_pinger_SOURCES) $(recv_announce_SOURCES) $(squid_SOURCES) $(EXTRA_squid_SOURCES) $(nodist_squid_SOURCES) $(squidclient_SOURCES) $(ufsdump_SOURCES) $(nodist_ufsdump_SOURCES) $(unlinkd_SOURCES)
 
 all: $(BUILT_SOURCES)
 	$(MAKE) $(AM_MAKEFLAGS) all-recursive
@@ -675,49 +934,49 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  src/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(bindir)
 	@list='$(bin_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) $$p $(DESTDIR)$(bindir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) $$p $(DESTDIR)$(bindir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-binPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(bin_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(bindir)/$$f"; \
 	  rm -f $(DESTDIR)$(bindir)/$$f; \
 	done
 
 clean-binPROGRAMS:
 	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
+libexecPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libexecdir)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(libexecdir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(libexecPROGRAMS_INSTALL) $$p $(DESTDIR)$(libexecdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libexecPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(libexec_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(libexecdir)/$$f"; \
 	  rm -f $(DESTDIR)$(libexecdir)/$$f; \
 	done
@@ -727,23 +986,24 @@ clean-libexecPROGRAMS:
 
 clean-noinstPROGRAMS:
 	-test -z "$(noinst_PROGRAMS)" || rm -f $(noinst_PROGRAMS)
+sbinPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-sbinPROGRAMS: $(sbin_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(sbindir)
 	@list='$(sbin_PROGRAMS)'; for p in $$list; do \
 	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
 	  if test -f $$p \
 	  ; then \
-	    f=`echo $$p1|sed '$(transform);s/$$/$(EXEEXT)/'`; \
-	   echo " $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(sbindir)/$$f"; \
-	   $(INSTALL_PROGRAM_ENV) $(INSTALL_PROGRAM) $$p $(DESTDIR)$(sbindir)/$$f; \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(sbinPROGRAMS_INSTALL) $$p $(DESTDIR)$(sbindir)/$$f"; \
+	   $(INSTALL_PROGRAM_ENV) $(sbinPROGRAMS_INSTALL) $$p $(DESTDIR)$(sbindir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-sbinPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(sbin_PROGRAMS)'; for p in $$list; do \
-	  f=`echo $$p|sed 's/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
 	  echo " rm -f $(DESTDIR)$(sbindir)/$$f"; \
 	  rm -f $(DESTDIR)$(sbindir)/$$f; \
 	done
@@ -771,6 +1031,9 @@ squid$(EXEEXT): $(squid_OBJECTS) $(squid_DEPENDENCIES)
 squidclient$(EXEEXT): $(squidclient_OBJECTS) $(squidclient_DEPENDENCIES) 
 	@rm -f squidclient$(EXEEXT)
 	$(CXXLINK) $(squidclient_LDFLAGS) $(squidclient_OBJECTS) $(squidclient_LDADD) $(LIBS)
+ufsdump$(EXEEXT): $(ufsdump_OBJECTS) $(ufsdump_DEPENDENCIES) 
+	@rm -f ufsdump$(EXEEXT)
+	$(CXXLINK) $(ufsdump_LDFLAGS) $(ufsdump_OBJECTS) $(ufsdump_LDADD) $(LIBS)
 unlinkd-unlinkd.$(OBJEXT): unlinkd.cc
 unlinkd$(EXEEXT): $(unlinkd_OBJECTS) $(unlinkd_DEPENDENCIES) 
 	@rm -f unlinkd$(EXEEXT)
@@ -782,131 +1045,141 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/CacheDigest.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ETag.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpBody.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpHdrCc.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpHdrContRange.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpHdrRange.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpHeader.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpHeaderTools.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpMsg.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpReply.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpRequest.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/HttpStatusLine.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/IPInterception.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/MemBuf.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/Packer.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ProfStats.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/StatHist.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/StoreIOState.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/String.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/SwapDir.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/access_log.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/acl.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/asn.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/auth_modules.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/authenticate.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/cache_cf.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/cache_manager.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/cachemgr.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/carp.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/cbdata.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/cf_gen.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/client.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/clientStream.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/client_db.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/client_side.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/client_side_reply.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/client_side_request.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/comm.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/comm_kqueue.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/comm_poll.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/comm_select.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/debug.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/delay_pools.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/disk.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/dns.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/dns_internal.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/dnsserver.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/errorpage.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/event.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/external_acl.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/fd.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/filemap.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/forward.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/fqdncache.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ftp.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/globals.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/gopher.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/helper.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/htcp.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/http.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/icmp.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/icp_v2.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/icp_v3.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ident.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/int.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/internal.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ipc.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ipcache.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/leakfinder.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/logfile.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/main.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/mem.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/mime.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/multicast.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/neighbors.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/net_db.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/pconn.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/peer_digest.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/peer_select.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/pinger.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/recv-announce.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/redirect.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/referer.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/refresh.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/repl_modules.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/send-announce.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_agent.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/snmp_core.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ssl.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ssl_support.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/stat.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/stmem.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_client.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_digest.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_dir.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_io.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_key_md5.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_log.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_modules.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_rebuild.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_swapin.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_swapmeta.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/store_swapout.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/string_arrays.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/tools.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ufscommon.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/unlinkd-unlinkd.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/unlinkd.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/url.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/urn.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/useragent.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wais.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/wccp.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/whois.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/win32.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/CacheDigest.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ETag.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpBody.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpHdrCc.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpHdrContRange.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpHdrRange.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpHeader.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpHeaderTools.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpMsg.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpReply.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpRequest.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/HttpStatusLine.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/IPInterception.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/MemBuf.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/MemObject.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/Packer.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ProfStats.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StatHist.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StoreIOState.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StoreMeta.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StoreMetaMD5.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StoreMetaSTD.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StoreMetaURL.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StoreMetaUnpacker.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/StoreMetaVary.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/String.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/SwapDir.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/access_log.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/acl.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/asn.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/auth_modules.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/authenticate.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cache_cf.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cache_manager.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cachemgr.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/carp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cbdata.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cf_gen.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/client.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/clientStream.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/client_db.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/client_side.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/client_side_reply.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/client_side_request.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/comm.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/comm_kqueue.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/comm_poll.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/comm_select.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/debug.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/delay_pools.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/disk.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dns.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dns_internal.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dnsserver.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/errorpage.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/event.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/external_acl.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fde.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/filemap.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/forward.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fqdncache.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ftp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/globals.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/gopher.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/helper.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/htcp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/http.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/icmp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/icp_v2.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/icp_v3.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ident.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/int.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/internal.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ipc.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ipcache.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/leakfinder.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/logfile.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/main.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mem.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mem_node.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mime.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/multicast.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/neighbors.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/net_db.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pconn.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/peer_digest.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/peer_select.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pinger.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/recv-announce.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/redirect.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/referer.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/refresh.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/repl_modules.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/send-announce.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_agent.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/snmp_core.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ssl.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ssl_support.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/stat.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/stmem.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_client.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_digest.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_dir.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_key_md5.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_log.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_modules.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_rebuild.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_swapin.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_swapmeta.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/store_swapout.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/string_arrays.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/tools.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ufscommon.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ufsdump.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/unlinkd-unlinkd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/unlinkd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/url.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/urn.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/useragent.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wais.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wccp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/whois.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/win32.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf ./$(DEPDIR)
 
 .c.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
+	$(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<
 
 .c.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -919,7 +1192,7 @@ CCDEPMODE = @CCDEPMODE@
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXXCOMPILE) -c -o $@ `test -f $< || echo '$(srcdir)/'`$<
+	$(CXXCOMPILE) -c -o $@ `test -f '$<' || echo '$(srcdir)/'`$<
 
 .cc.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -931,7 +1204,7 @@ unlinkd-unlinkd.o: unlinkd.cc
 @AMDEP_TRUE@	source='unlinkd.cc' object='unlinkd-unlinkd.o' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/unlinkd-unlinkd.Po' tmpdepfile='$(DEPDIR)/unlinkd-unlinkd.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(unlinkd_CXXFLAGS) $(CXXFLAGS) -c -o unlinkd-unlinkd.o `test -f unlinkd.cc || echo '$(srcdir)/'`unlinkd.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(unlinkd_CXXFLAGS) $(CXXFLAGS) -c -o unlinkd-unlinkd.o `test -f 'unlinkd.cc' || echo '$(srcdir)/'`unlinkd.cc
 
 unlinkd-unlinkd.obj: unlinkd.cc
 @AMDEP_TRUE@	source='unlinkd.cc' object='unlinkd-unlinkd.obj' libtool=no @AMDEPBACKSLASH@
@@ -940,14 +1213,15 @@ unlinkd-unlinkd.obj: unlinkd.cc
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(unlinkd_CXXFLAGS) $(CXXFLAGS) -c -o unlinkd-unlinkd.obj `cygpath -w unlinkd.cc`
 CXXDEPMODE = @CXXDEPMODE@
 uninstall-info-am:
+dataDATA_INSTALL = $(INSTALL_DATA)
 install-dataDATA: $(data_DATA)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(datadir)
 	@list='$(data_DATA)'; for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  f="`echo $$p | sed -e 's|^.*/||'`"; \
-	  echo " $(INSTALL_DATA) $$d$$p $(DESTDIR)$(datadir)/$$f"; \
-	  $(INSTALL_DATA) $$d$$p $(DESTDIR)$(datadir)/$$f; \
+	  echo " $(dataDATA_INSTALL) $$d$$p $(DESTDIR)$(datadir)/$$f"; \
+	  $(dataDATA_INSTALL) $$d$$p $(DESTDIR)$(datadir)/$$f; \
 	done
 
 uninstall-dataDATA:
@@ -957,14 +1231,15 @@ uninstall-dataDATA:
 	  echo " rm -f $(DESTDIR)$(datadir)/$$f"; \
 	  rm -f $(DESTDIR)$(datadir)/$$f; \
 	done
+sysconfDATA_INSTALL = $(INSTALL_DATA)
 install-sysconfDATA: $(sysconf_DATA)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)
 	@list='$(sysconf_DATA)'; for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  f="`echo $$p | sed -e 's|^.*/||'`"; \
-	  echo " $(INSTALL_DATA) $$d$$p $(DESTDIR)$(sysconfdir)/$$f"; \
-	  $(INSTALL_DATA) $$d$$p $(DESTDIR)$(sysconfdir)/$$f; \
+	  echo " $(sysconfDATA_INSTALL) $$d$$p $(DESTDIR)$(sysconfdir)/$$f"; \
+	  $(sysconfDATA_INSTALL) $$d$$p $(DESTDIR)$(sysconfdir)/$$f; \
 	done
 
 uninstall-sysconfDATA:
@@ -982,7 +1257,7 @@ uninstall-sysconfDATA:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -1002,7 +1277,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -1030,16 +1305,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -1050,45 +1328,50 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -1103,7 +1386,7 @@ distdir: $(DISTFILES)
 	done
 check-am: all-am
 check: check-recursive
-all-am: Makefile $(PROGRAMS) $(DATA)
+all-am: Makefile $(PROGRAMS) $(DATA) $(HEADERS)
 installdirs: installdirs-recursive
 installdirs-am:
 	$(mkinstalldirs) $(DESTDIR)$(bindir) $(DESTDIR)$(libexecdir) $(DESTDIR)$(sbindir) $(DESTDIR)$(datadir) $(DESTDIR)$(sysconfdir)
@@ -1119,14 +1402,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
 
 maintainer-clean-generic:
@@ -0,0 +1,48 @@
+
+/*
+ * $Id: Mem.h,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ * DEBUG: section 13    High Level Memory Pool Management
+ * AUTHOR: Harvest Derived
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_MEM
+#define SQUID_MEM
+
+class Mem {
+public:
+  static void Init();
+  static void Stats(StoreEntry *);
+  static void CleanIdlePools(void *unused);
+  static void Report(StoreEntry *);
+  static void PoolReport(const MemPoolStats * mp_st, const MemPoolMeter * AllMeter, StoreEntry * e);
+};
+
+#endif /* SQUID_MEM */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: MemBuf.cc,v 1.32 2002/10/13 20:34:57 robertc Exp $
+ * $Id: MemBuf.cc,v 1.33 2003/01/23 00:37:14 robertc Exp $
  *
  * DEBUG: section 59    auto-growing Memory Buffer with printf
  * AUTHOR: Alex Rousskov
@@ -320,3 +320,7 @@ memBufReport(MemBuf * mb)
     assert(mb);
     memBufPrintf(mb, "memBufReport is not yet implemented @?@\n");
 }
+
+#ifndef _USE_INLINE_
+#include "MemBuf.cci"
+#endif
@@ -0,0 +1,38 @@
+
+/*
+ * $Id: MemBuf.cci,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ * DEBUG: section 59    auto-growing Memory Buffer with printf
+ * AUTHOR: Robert Collins
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+MemBuf::MemBuf() : buf (NULL), size (0), max_capacity (0), capacity(0), stolen(0)
+{
+}
@@ -0,0 +1,88 @@
+
+/*
+ * $Id: MemBuf.h,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_MEMBUF_H
+#define SQUID_MEMBUF_H
+
+/* auto-growing memory-resident buffer with printf interface */
+/* note: when updating this struct, update MemBufNULL #define */
+class MemBuf {
+  public:
+    _SQUID_INLINE_ MemBuf();
+    /* public, read-only */
+    char *buf;
+    mb_size_t size;		/* used space, does not count 0-terminator */
+
+    /* private, stay away; use interface function instead */
+    mb_size_t max_capacity;	/* when grows: assert(new_capacity <= max_capacity) */
+    mb_size_t capacity;		/* allocated space */
+    unsigned stolen:1;		/* the buffer has been stolen for use by someone else */
+};
+
+/* to initialize static variables (see also MemBufNull) */
+#define MemBufNULL MemBuf();
+
+#ifdef _USE_INLINE_
+#include "MemBuf.cci"
+#endif
+
+/* MemBuf */
+/* init with specific sizes */
+SQUIDCEXTERN void memBufInit(MemBuf * mb, mb_size_t szInit, mb_size_t szMax);
+/* init with defaults */
+SQUIDCEXTERN void memBufDefInit(MemBuf * mb);
+/* cleans mb; last function to call if you do not give .buf away */
+SQUIDCEXTERN void memBufClean(MemBuf * mb);
+/* resets mb preserving (or initializing if needed) memory buffer */
+SQUIDCEXTERN void memBufReset(MemBuf * mb);
+/* unfirtunate hack to test if the buffer has been Init()ialized */
+SQUIDCEXTERN int memBufIsNull(MemBuf * mb);
+/* calls memcpy, appends exactly size bytes, extends buffer if needed */
+SQUIDCEXTERN void memBufAppend(MemBuf * mb, const char *buf, mb_size_t size);
+/* calls snprintf, extends buffer if needed */
+#if STDC_HEADERS
+SQUIDCEXTERN void
+memBufPrintf(MemBuf * mb, const char *fmt,...) PRINTF_FORMAT_ARG2;
+#else
+SQUIDCEXTERN void memBufPrintf();
+#endif
+/* vprintf for other printf()'s to use */
+SQUIDCEXTERN void memBufVPrintf(MemBuf * mb, const char *fmt, va_list ap);
+/* returns free() function to be used, _freezes_ the object! */
+SQUIDCEXTERN FREE *memBufFreeFunc(MemBuf * mb);
+/* puts report on MemBuf _module_ usage into mb */
+SQUIDCEXTERN void memBufReport(MemBuf * mb);
+
+#define MemBufNull MemBuf();
+
+#endif /* SQUID_MEM_H */
@@ -0,0 +1,360 @@
+
+/*
+ * $Id: MemObject.cc,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ * DEBUG: section 19    Store Memory Primitives
+ * AUTHOR: Robert Collins
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "MemObject.h"
+#include "HttpRequest.h"
+#include "HttpReply.h"
+#include "Store.h"
+#include "StoreClient.h"
+#include "Generic.h"
+
+/* TODO: make this global or private */
+#if URL_CHECKSUM_DEBUG
+static unsigned int url_checksum(const char *url);
+unsigned int
+url_checksum(const char *url)
+{
+    unsigned int ck;
+    MD5_CTX M;
+    static unsigned char digest[16];
+    MD5Init(&M);
+    MD5Update(&M, (unsigned char *) url, strlen(url));
+    MD5Final(digest, &M);
+    xmemcpy(&ck, digest, sizeof(ck));
+    return ck;
+}
+#endif
+
+MemPool *MemObject::pool = NULL;
+
+void *
+MemObject::operator new (size_t byteCount)
+{
+    /* derived classes with different sizes must implement their own new */
+    assert (byteCount == sizeof (MemObject));
+    if (!pool)
+	pool = memPoolCreate("MemObject", sizeof (MemObject));
+    return memPoolAlloc(pool);
+}
+
+void
+MemObject::operator delete (void *address)
+{
+    memPoolFree(pool, address);
+}
+
+size_t
+MemObject::inUseCount()
+{
+    if (!pool)
+	return 0;
+    MemPoolStats stats;
+    memPoolGetStats (&stats, pool);
+    return stats.items_inuse;
+}
+
+MemObject::MemObject(char const *aUrl, char const *aLog_url) :
+_reply (httpReplyCreate())
+{
+    url = xstrdup(aUrl);
+#if URL_CHECKSUM_DEBUG
+    chksum = url_checksum(url);
+#endif
+    log_url = xstrdup(aLog_url);
+    object_sz = -1;
+    fd = -1;
+    /* XXX account log_url */
+    debug(20, 3) ("MemObject::MemObject: initialized %p\n", this);
+}
+
+MemObject::~MemObject()
+{
+    const Ctx ctx = ctx_enter(url);
+    debug(20, 3) ("destroy_MemObject: destroying %p\n", this);
+#if URL_CHECKSUM_DEBUG
+    assert(chksum == url_checksum(url));
+#endif
+    if (!shutting_down)
+        assert(swapout.sio == NULL);
+    data_hdr.freeContent();
+    /*
+     * There is no way to abort FD-less clients, so they might
+     * still have mem->clients set if mem->fd == -1
+     */
+    assert(fd == -1 || clients.head == NULL);
+    httpReplyDestroy((HttpReply *)_reply);
+    requestUnlink(request);
+    request = NULL;
+    ctx_exit(ctx);              /* must exit before we free mem->url */
+    safe_free(url);
+    safe_free(log_url);    /* XXX account log_url */
+    safe_free(vary_headers);
+}
+
+void
+MemObject::unlinkRequest()
+{
+    /* XXX Should we assert(request)? */
+    requestUnlink(request);
+    request = NULL;
+}
+
+void
+MemObject::write ( StoreIOBuffer writeBuffer, STMCB *callback, void *callbackData)
+{
+    debug(19, 6) ("memWrite: offset %lu len %d\n", writeBuffer.offset, writeBuffer.length);
+
+    /* the offset is into the content, not the headers */
+    writeBuffer.offset += (_reply ? _reply->hdr_sz : 0);
+
+    /* We don't separate out mime headers yet, so ensure that the first
+     * write is at offset 0 - where they start 
+     */
+    assert (data_hdr.endOffset() || writeBuffer.offset == 0);
+
+    assert (data_hdr.write (writeBuffer));
+    callback (callbackData, writeBuffer);
+}
+
+void
+MemObject::dump() const
+{
+    debug(20, 1) ("MemObject->data.head: %p\n",
+	data_hdr.head);
+    debug(20, 1) ("MemObject->data.tail: %p\n",
+	data_hdr.tail);
+#if 0
+    /* do we want this one? */
+    debug(20, 1) ("MemObject->data.origin_offset: %d\n",
+	data_hdr.head ? data_hdr.head->nodeBuffer.offset : 0);
+#endif
+    debug(20, 1) ("MemObject->start_ping: %d.%06d\n",
+	(int) start_ping.tv_sec,
+	(int) start_ping.tv_usec);
+    debug(20, 1) ("MemObject->inmem_hi: %d\n",
+	(int) data_hdr.endOffset());
+    debug(20, 1) ("MemObject->inmem_lo: %d\n",
+	(int) inmem_lo);
+    debug(20, 1) ("MemObject->nclients: %d\n",
+	nclients);
+    debug(20, 1) ("MemObject->reply: %p\n",
+	_reply);
+    debug(20, 1) ("MemObject->request: %p\n",
+	request);
+    debug(20, 1) ("MemObject->log_url: %p %s\n",
+	log_url,
+	checkNullString(log_url));
+}
+
+HttpReply const *
+MemObject::getReply() const
+{
+    return _reply;
+}
+
+struct LowestMemReader : public unary_function<store_client, void>
+{
+    LowestMemReader(off_t seed):current(seed){}
+    void operator() (store_client const &x) 
+      { 
+	if (x.memReaderHasLowerOffset(current))
+	    current = x.copyInto.offset; }
+    off_t current;
+};
+
+struct StoreClientStats : public unary_function<store_client, void>
+{
+    StoreClientStats(StoreEntry *anEntry):where(anEntry),index(0){}
+    void operator()(store_client const &x) {
+	x.dumpStats(where, index++);
+    }
+    StoreEntry *where;
+    size_t index;
+};
+
+void
+MemObject::stat (StoreEntry *s) const
+{
+    storeAppendPrintf(s, "\t%s %s\n",
+	RequestMethodStr[method], log_url);
+    storeAppendPrintf(s, "\tinmem_lo: %d\n", (int) inmem_lo);
+    storeAppendPrintf(s, "\tinmem_hi: %d\n", (int) data_hdr.endOffset());
+    storeAppendPrintf(s, "\tswapout: %d bytes queued\n",
+	(int) swapout.queue_offset);
+    if (swapout.sio.getRaw())
+	storeAppendPrintf(s, "\tswapout: %d bytes written\n",
+	    (int) swapout.sio->offset());
+    StoreClientStats statsVisitor(s);
+    for_each(clients, statsVisitor);
+}
+
+off_t
+MemObject::endOffset () const
+{
+    return data_hdr.endOffset();
+}
+
+size_t
+MemObject::size() const
+{
+    if (object_sz < 0) 
+	return endOffset();
+    return object_sz;
+}
+
+void
+MemObject::reset()
+{
+    assert(swapout.sio == NULL);
+    data_hdr.freeContent();
+    inmem_lo = 0;
+    /* Should we check for clients? */
+}
+
+
+off_t
+MemObject::lowestMemReaderOffset() const
+{
+    LowestMemReader lowest (endOffset() + 1);
+
+    for_each (clients, lowest);
+    
+    return lowest.current;
+}
+
+/* XXX: This is wrong. It breaks *badly* on range combining */
+bool
+MemObject::readAheadPolicyCanRead() const
+{
+    return (size_t)endOffset() - getReply()->hdr_sz < lowestMemReaderOffset() + Config.readAheadGap;
+}
+
+void
+MemObject::addClient(store_client *aClient)
+{
+    ++nclients;
+    dlinkAdd(aClient, &aClient->node, &clients);
+}
+
+#if URL_CHECKSUM_DEBUG
+void
+MemObject::checkUrlChecksum () const
+{
+    assert(chksum == url_checksum(url));
+}
+#endif
+
+/*
+ * How much of the object data is on the disk?
+ */
+size_t
+MemObject::objectBytesOnDisk() const
+{
+    /*
+     * NOTE: storeOffset() represents the disk file size,
+     * not the amount of object data on disk.
+     * 
+     * If we don't have at least 'swap_hdr_sz' bytes
+     * then none of the object data is on disk.
+     *
+     * This should still be safe if swap_hdr_sz == 0,
+     * meaning we haven't even opened the swapout file
+     * yet.
+     */
+    if (swapout.sio.getRaw() == NULL)
+	return 0;
+    off_t nwritten = swapout.sio->offset();
+    if (nwritten <= (off_t)swap_hdr_sz)
+	return 0;
+    return (size_t) (nwritten - swap_hdr_sz);
+}
+
+off_t
+MemObject::policyLowestOffsetToKeep() const
+{
+    /*
+     * Careful.  lowest_offset can be greater than endOffset(), such
+     * as in the case of a range request.
+     */
+    off_t lowest_offset = lowestMemReaderOffset();
+    if (endOffset() < lowest_offset ||
+	endOffset() - inmem_lo > (ssize_t)Config.Store.maxInMemObjSize)
+	return lowest_offset;
+    
+    return inmem_lo;
+}
+
+void
+MemObject::trimSwappable()
+{
+    off_t new_mem_lo = policyLowestOffsetToKeep();
+    /*
+     * We should only free up to what we know has been written
+     * to disk, not what has been queued for writing.  Otherwise
+     * there will be a chunk of the data which is not in memory
+     * and is not yet on disk.
+     * The -1 makes sure the page isn't freed until storeSwapOut has
+     * walked to the next page. (mem->swapout.memnode)
+     */
+    off_t on_disk;
+    if ((on_disk = objectBytesOnDisk()) - 1 < new_mem_lo)
+	new_mem_lo = on_disk - 1;
+    if (new_mem_lo == -1)
+	new_mem_lo = 0;	/* the above might become -1 */
+    data_hdr.freeDataUpto(new_mem_lo);
+    inmem_lo = new_mem_lo;
+}
+
+void
+MemObject::trimUnSwappable()
+{
+    off_t new_mem_lo = policyLowestOffsetToKeep();
+    assert (new_mem_lo > 0);
+
+    data_hdr.freeDataUpto(new_mem_lo);
+    inmem_lo = new_mem_lo;
+}
+
+
+bool
+MemObject::isContiguous() const
+{
+    bool result = data_hdr.hasContigousContentRange (inmem_lo, endOffset());
+    /* XXX : make this higher level */
+    debug (19, result ? 2 : 1) ("MemObject::isContiguous: Returning %s\n",
+				result ? "true" : "false");
+    return result;
+}
@@ -0,0 +1,117 @@
+
+/*
+ * $Id: MemObject.h,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_MEMOBJECT_H
+#define SQUID_MEMOBJECT_H
+
+#include "StoreIOBuffer.h"
+#include "stmem.h"
+
+typedef void STMCB (void *data, StoreIOBuffer wroteBuffer);
+
+class store_client;
+
+class MemObject {
+public:
+    static size_t inUseCount();
+  
+    void dump() const;
+    void *operator new (size_t);
+    void operator delete (void *);
+    MemObject(char const *, char const *);
+    ~MemObject();
+
+    void write(StoreIOBuffer, STMCB *, void *);
+    void unlinkRequest();
+    HttpReply const *getReply() const;
+    void stat (StoreEntry *s) const;
+    off_t endOffset () const;
+    size_t size() const;   
+    void reset();
+    off_t lowestMemReaderOffset() const;
+    bool readAheadPolicyCanRead() const;
+    void addClient(store_client *);
+    /* XXX belongs in MemObject::swapout, once swaphdrsz is managed 
+     * better
+     */
+    size_t objectBytesOnDisk() const;
+    off_t policyLowestOffsetToKeep() const;
+    void trimSwappable();
+    void trimUnSwappable();
+    bool isContiguous() const;
+
+
+#if URL_CHECKSUM_DEBUG
+    void checkUrlChecksum() const;
+#endif
+
+    method_t method;
+    char *url;
+    mem_hdr data_hdr;
+    off_t inmem_lo;
+    dlink_list clients;
+    int nclients;
+    struct {
+        off_t queue_offset;     /* relative to in-mem data */
+        mem_node *memnode;      /* which node we're currently paging out */
+	StoreIOState::Pointer sio;
+    } swapout;
+    /* Read only - this reply must be preserved by store clients */
+    /* The original reply. possibly with updated metadata. */
+    request_t *request;
+    struct timeval start_ping;
+    IRCB *ping_reply_callback;
+    void *ircb_data;
+    int fd;                     /* FD of client creating this entry */
+    struct {
+        STABH *callback;
+        void *data;
+    } abort;
+    char *log_url;
+    RemovalPolicyNode repl;
+    int id;
+    ssize_t object_sz;
+    size_t swap_hdr_sz;
+#if URL_CHECKSUM_DEBUG
+    unsigned int chksum;
+#endif
+    const char *vary_headers;
+private:
+    static MemPool *pool;
+
+    /* Read only - this reply must be preserved by store clients */
+    /* The original reply. possibly with updated metadata. */
+    HttpReply const *_reply;
+};
+
+#endif /* SQUID_MEMOBJECT_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: Packer.cc,v 1.14 2002/10/13 20:34:57 robertc Exp $
+ * $Id: Packer.cc,v 1.15 2003/01/23 00:37:14 robertc Exp $
  *
  * DEBUG: section 60    Packer: A uniform interface to store-like modules
  * AUTHOR: Alex Rousskov
@@ -1,6 +1,6 @@
 
 /*
- * $Id: ProfStats.cc,v 1.2 2002/10/13 20:34:57 robertc Exp $
+ * $Id: ProfStats.cc,v 1.3 2003/01/23 00:37:14 robertc Exp $
  *
  * DEBUG: section 81     CPU Profiling Routines
  * AUTHOR: Andres Kroonmaa
@@ -1,6 +1,6 @@
 
 /*
- * $Id: StatHist.cc,v 1.28 2002/10/14 09:04:25 hno Exp $
+ * $Id: StatHist.cc,v 1.29 2003/01/23 00:37:14 robertc Exp $
  *
  * DEBUG: section 62    Generic Histogram
  * AUTHOR: Duane Wessels
@@ -0,0 +1,61 @@
+
+/*
+ * $Id: Store.cci,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ * DEBUG: section 20    Storage Manager
+ * AUTHOR: Harvest Derived
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+// #include "squid.h"
+#if 0
+#include "StoreClient.h"
+#include "stmem.h"
+#include "HttpReply.h"
+#include "HttpRequest.h"
+#endif
+#include "MemObject.h"
+#if 0
+#include "mem_node.h"
+#include "StoreMeta.h"
+#include "SwapDir.h"
+#endif
+
+bool
+StoreEntry::isEmpty () const
+{
+    assert (mem_obj);
+    return mem_obj->endOffset() == 0;
+}
+
+HttpReply const *
+NullStoreEntry::getReply() const
+{
+  return NULL;
+}
@@ -1,6 +1,6 @@
 
 /*
- * $Id: Store.h,v 1.5 2003/01/17 05:49:35 robertc Exp $
+ * $Id: Store.h,v 1.6 2003/01/23 00:37:14 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -34,14 +34,28 @@
 #ifndef SQUID_STORE_H
 #define SQUID_STORE_H
 
-#ifdef __cplusplus
+#include "StoreIOBuffer.h"
+
 class StoreClient;
-#endif
+class MemObject;
 
+typedef void STSETUP(storefs_entry_t *);
 class StoreEntry : public hash_link {
 public:
-    virtual const char *getMD5Text() const;
+    static int CheckDeferRead(int fd, void *data);
+    static void FsAdd(const char *, STSETUP *);
   
+    virtual const char *getMD5Text() const;
+    virtual HttpReply const *getReply() const;
+    virtual void write (StoreIOBuffer);
+    virtual _SQUID_INLINE_ bool isEmpty() const;
+    virtual int checkDeferRead(int fd) const;
+    virtual void complete();
+    virtual store_client_t storeClientType() const;
+    virtual char const *getSerialisedMetaData();
+    virtual bool swapoutPossible();
+    virtual void trimMemory();
+
     MemObject *mem_obj;
     RemovalPolicyNode repl;
     /* START OF ON-DISK STORE_META_STD TLV field */
@@ -60,23 +74,23 @@ class StoreEntry : public hash_link {
     ping_status_t ping_status:3;
     store_status_t store_status:3;
     swap_status_t swap_status:3;
-#ifdef __cplusplus
 public:
     static size_t inUseCount();
     static void getPublicByRequestMethod(StoreClient * aClient, request_t * request, const method_t method);
     static void getPublicByRequest(StoreClient * aClient, request_t * request);
     static void getPublic(StoreClient * aClient, const char *uri, const method_t method);
+
     virtual bool isNull() {
 	return false;
     }
     void *operator new(size_t byteCount);
     void operator delete(void *address);
 private:
     static MemPool *pool;
-#endif
+
+    bool validLength() const;
 };
 
-#ifdef __cplusplus
 class NullStoreEntry:public StoreEntry
 {
 public:
@@ -85,16 +99,26 @@ class NullStoreEntry:public StoreEntry
 	return true;
     }
     const char *getMD5Text() const;
+    _SQUID_INLINE_ HttpReply const *getReply() const;
+    void write (StoreIOBuffer){}
+    bool isEmpty () const {return true;}
+    int checkDeferRead(int fd) const {return 1;}
     void operator delete(void *address);
+    void complete(){}
          private:
+    store_client_t storeClientType() const{return STORE_MEM_CLIENT;}
+    char const *getSerialisedMetaData();
+    bool swapoutPossible() {return false;}
+    void trimMemory() {}
+
+    
     static NullStoreEntry _instance;
 };
 
-#endif
-
-SQUIDCEXTERN size_t storeEntryInUse();
+SQUIDCEXTERN off_t storeLowestMemReaderOffset(const StoreEntry * entry);
 SQUIDCEXTERN const char *storeEntryFlags(const StoreEntry *);
 SQUIDCEXTERN int storeEntryLocked(const StoreEntry *);
+extern void storeEntryReplaceObject(StoreEntry *, HttpReply *);
 
 SQUIDCEXTERN StoreEntry *new_StoreEntry(int, const char *, const char *);
 SQUIDCEXTERN StoreEntry *storeGet(const cache_key *);
@@ -103,7 +127,7 @@ SQUIDCEXTERN StoreEntry *storeGetPublicByRequest(request_t * request);
 SQUIDCEXTERN StoreEntry *storeGetPublicByRequestMethod(request_t * request, const method_t method);
 SQUIDCEXTERN StoreEntry *storeCreateEntry(const char *, const char *, request_flags, method_t);
 SQUIDCEXTERN void storeSetPublicKey(StoreEntry *);
-SQUIDCEXTERN void storeComplete(StoreEntry *);
+SQUIDCEXTERN void storeCreateMemObject(StoreEntry *, const char *, const char *);
 SQUIDCEXTERN void storeInit(void);
 SQUIDCEXTERN void storeAbort(StoreEntry *);
 SQUIDCEXTERN void storeAppend(StoreEntry *, const char *, int);
@@ -122,11 +146,8 @@ SQUIDCEXTERN int storeEntryValidToSend(StoreEntry *);
 SQUIDCEXTERN void storeTimestampsSet(StoreEntry *);
 SQUIDCEXTERN void storeRegisterAbort(StoreEntry * e, STABH * cb, void *);
 SQUIDCEXTERN void storeUnregisterAbort(StoreEntry * e);
-SQUIDCEXTERN void storeMemObjectDump(MemObject * mem);
 SQUIDCEXTERN void storeEntryDump(const StoreEntry * e, int debug_lvl);
 SQUIDCEXTERN const char *storeUrl(const StoreEntry *);
-SQUIDCEXTERN void storeCreateMemObject(StoreEntry *, const char *, const char *);
-SQUIDCEXTERN void storeCopyNotModifiedReplyHeaders(MemObject * O, MemObject * N);
 SQUIDCEXTERN void storeBuffer(StoreEntry *);
 SQUIDCEXTERN void storeBufferFlush(StoreEntry *);
 SQUIDCEXTERN void storeHashInsert(StoreEntry * e, const cache_key *);
@@ -142,18 +163,20 @@ SQUIDCEXTERN int storeCheckCachable(StoreEntry * e);
 SQUIDCEXTERN void storeSetPrivateKey(StoreEntry *);
 SQUIDCEXTERN ssize_t objectLen(const StoreEntry * e);
 SQUIDCEXTERN int contentLen(const StoreEntry * e);
-SQUIDCEXTERN HttpReply *storeEntryReply(StoreEntry *);
 SQUIDCEXTERN int storeTooManyDiskFilesOpen(void);
 SQUIDCEXTERN void storeEntryReset(StoreEntry *);
 SQUIDCEXTERN void storeHeapPositionUpdate(StoreEntry *, SwapDir *);
 SQUIDCEXTERN void storeSwapFileNumberSet(StoreEntry * e, sfileno filn);
 SQUIDCEXTERN void storeFsInit(void);
 SQUIDCEXTERN void storeFsDone(void);
 typedef void STSETUP(storefs_entry_t *);
-SQUIDCEXTERN void storeFsAdd(const char *, STSETUP *);
 SQUIDCEXTERN void storeReplAdd(const char *, REMOVALPOLICYCREATE *);
 
 /* store_modules.c */
 SQUIDCEXTERN void storeFsSetup(void);
 
+#ifdef _USE_INLINE_
+#include "Store.cci"
+#endif
+
 #endif /* SQUID_STORE_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: StoreClient.h,v 1.5 2003/01/17 05:49:35 robertc Exp $
+ * $Id: StoreClient.h,v 1.6 2003/01/23 00:37:14 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -38,24 +38,31 @@
 
 typedef void STCB(void *, StoreIOBuffer);	/* store callback */
 
-#ifdef __cplusplus
 class StoreEntry;
-#endif
 
-#ifdef __cplusplus
 class StoreClient {
 public:
   virtual ~StoreClient () {}
   virtual void created (StoreEntry *newEntry) = 0;
 };
-#endif
 
 /* keep track each client receiving data from that particular StoreEntry */
-struct _store_client {
-    int type;
+class store_client {
+public:
+    void *operator new (size_t);
+    void operator delete(void *);
+    store_client(StoreEntry *);
+    bool memReaderHasLowerOffset(off_t) const;
+    int getType() const;
+    void fail();
+    void callback(ssize_t len, bool error = false);
+    void doCopy (StoreEntry *e);
+    void readHeader(const char *buf, ssize_t len);
+    bool callbackPending() const;
+    void copy(StoreEntry *, StoreIOBuffer, STCB *, void *);
+    void dumpStats(StoreEntry * output, int clientNumber) const;
+
     off_t cmp_offset;
-    STCB *callback;
-    void *callback_data;
 #if STORE_CLIENT_LIST_DEBUG
     void *owner;
 #endif
@@ -72,11 +79,23 @@ struct _store_client {
     dlink_node node;
     /* Below here is private - do no alter outside storeClient calls */
     StoreIOBuffer copyInto;
-#ifdef __cplusplus
-#endif
+private:
+    static MemPool *pool;
+
+    void fileRead();
+    void unpackHeader(char const *buf, ssize_t len);
+    
+    int type;
+    bool object_ok;
+    struct Callback {
+	Callback ():callback_handler(NULL), callback_data(NULL){}
+	Callback (STCB *, void *);
+	STCB *callback_handler;
+	void *callback_data;
+    } _callback;
 };
 
 SQUIDCEXTERN void storeClientCopy(store_client *, StoreEntry *, StoreIOBuffer, STCB *, void *);
-SQUIDCEXTERN void storeClientDumpStats(store_client * thisClient, StoreEntry * output, int clientNumber);
+
 
 #endif /* SQUID_STORECLIENT_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: StoreIOBuffer.h,v 1.1 2002/09/24 10:46:43 robertc Exp $
+ * $Id: StoreIOBuffer.h,v 1.2 2003/01/23 00:37:14 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -34,9 +34,14 @@
 #ifndef SQUID_STOREIORESULT_H
 #define SQUID_STOREIORESULT_H
 
-typedef struct _StoreIOBuffer StoreIOBuffer;
-
-struct _StoreIOBuffer {
+class StoreIOBuffer {
+public:
+    StoreIOBuffer():length(0), offset (0), data (NULL){flags.error = 0;}
+    StoreIOBuffer(size_t aLength, off_t anOffset, char *someData) :
+      length (aLength), offset (anOffset), data (someData)
+      {
+	flags.error = 0;
+      }
     struct {
 	int error:1;
     } flags;
@@ -45,6 +50,4 @@ struct _StoreIOBuffer {
     char *data;
 };
 
-#define EMPTYIOBUFFER {{0},0,0,NULL}
-
 #endif /* SQUID_STOREIORESULT_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: StoreIOState.cc,v 1.1 2002/12/27 10:26:33 robertc Exp $
+ * $Id: StoreIOState.cc,v 1.2 2003/01/23 00:37:14 robertc Exp $
  *
  * DEBUG: section ??    Swap Dir base object
  * AUTHOR: Robert Collins
@@ -1,6 +1,6 @@
 
 /*
- * $Id: StoreIOState.h,v 1.2 2002/12/27 12:37:52 robertc Exp $
+ * $Id: StoreIOState.h,v 1.3 2003/01/23 00:37:14 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -49,7 +49,7 @@ class storeIOState : public RefCountable{
     off_t offset() const;
 
     virtual void read_(char *buf, size_t size, off_t offset, STRCB * callback, void *callback_data) = 0;
-    virtual void write(char *buf, size_t size, off_t offset, FREE * free_func) = 0;
+    virtual void write(char const *buf, size_t size, off_t offset, FREE * free_func) = 0;
     virtual void close() = 0;
     
     sdirno swap_dirn;
@@ -0,0 +1,174 @@
+
+/*
+ * $Id: StoreMeta.cc,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ * DEBUG: section 20    Storage Manager Swapfile Metadata
+ * AUTHOR: Kostas Anagnostakis
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "StoreMeta.h"
+#include "Store.h"
+#include "MemObject.h"
+#include "StoreMetaMD5.h"
+#include "StoreMetaURL.h"
+#include "StoreMetaSTD.h"
+#include "StoreMetaVary.h"
+
+bool
+StoreMeta::validType(char type)
+{
+    /* VOID is reserved, and new types have to be added as classes */
+    if (type <= STORE_META_VOID || type >= STORE_META_END) {
+	debug(20, 0) ("storeSwapMetaUnpack: bad type (%d)!\n", type);
+	return false;
+    }
+    /* Unused in any current squid code */
+    if (type == STORE_META_KEY_URL ||
+	type == STORE_META_KEY_SHA ||
+	type == STORE_META_HITMETERING || 
+	type == STORE_META_VALID) {
+	debug (20,0)("Obsolete and unused type (%d) in disk metadata\n", type);
+	return false;
+    }
+    return true;
+}
+
+class IntRange{
+public:
+    IntRange (int minimum, int maximum) : _min (minimum), _max (maximum) 
+      {
+	if (_min > _max) {
+	    int temp = _min;
+	    _min = _max;
+	    _max = temp;
+	}
+      }
+    bool includes (int anInt) const
+      {
+	if (anInt < _min || anInt > _max)
+	    return false;
+	return true;
+      }
+private:
+    int _min;
+    int _max;
+};
+
+const int StoreMeta::MinimumTLVLength = 0;
+const int StoreMeta::MaximumTLVLength = 1 << 16;
+
+bool
+StoreMeta::validLength(int length) const
+{
+    if (!IntRange (MinimumTLVLength, MaximumTLVLength).includes(length)){
+	debug(20, 0) ("storeSwapMetaUnpack: insane length (%d)!\n", length);
+	return false;
+    }
+    return true;
+}
+
+
+StoreMeta *
+StoreMeta::Factory (char type, size_t len, void const *value)
+{
+    if (!validType(type))
+        return NULL;
+    StoreMeta *result;
+    switch (type) {
+      case STORE_META_KEY:
+      result = new StoreMetaMD5;
+      break;
+      case STORE_META_URL:
+      result = new StoreMetaURL;
+      break;
+      case STORE_META_STD:
+      result = new StoreMetaSTD;
+      break;
+      case STORE_META_VARY_HEADERS:
+      result = new StoreMetaVary;
+      break;
+      default:
+      debug (20,0)("Attempt to create unknown concrete StoreMeta\n");
+      return NULL;
+    }
+    if (!result->validLength(len)) {
+	result->deleteSelf();
+	return NULL;
+    }
+    result->length = len;
+    result->value = xmalloc(len);
+    xmemcpy(result->value, value, len);
+    return result;
+}
+
+void
+StoreMeta::FreeList(StoreMeta **head)
+{
+    StoreMeta *node;
+    while ((node = *head) != NULL) {
+	*head = node->next;
+	xfree(node->value);
+	node->deleteSelf();
+    }
+}
+
+StoreMeta **
+StoreMeta::Add(StoreMeta **tail, StoreMeta *aNode)
+{
+    assert (*tail == NULL);
+    *tail = aNode;
+    return &aNode->next;		/* return new tail pointer */
+}
+
+bool 
+StoreMeta::checkConsistency(StoreEntry *e) const
+{
+    switch (getType())
+      {
+	case STORE_META_KEY:
+	case STORE_META_URL:
+	case STORE_META_VARY_HEADERS:
+	    assert(0);
+	    break;
+	case STORE_META_STD:
+	    break;
+	default:
+	    debug(20, 1) ("WARNING: got unused STORE_META type %d\n", getType());
+	    break;
+	}
+    return true;
+}
+
+void
+StoreMeta::deleteSelf()
+{
+    delete this;
+}
@@ -0,0 +1,67 @@
+
+/*
+ * $Id: StoreMeta.h,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_TYPELENGTHVALUE_H
+#define SQUID_TYPELENGTHVALUE_H
+
+class StoreEntry;
+typedef class StoreMeta tlv;
+class StoreMeta {
+public:
+    virtual void deleteSelf() = 0;
+    static bool validType(char);
+    static int const MaximumTLVLength;
+    static int const MinimumTLVLength;
+    static StoreMeta *Factory (char type, size_t len, void const *value);
+    static StoreMeta **Add(StoreMeta **tail, StoreMeta *aNode);
+    static void FreeList (StoreMeta **head);
+    
+    virtual char getType() const = 0;
+    virtual bool validLength(int) const;
+    virtual bool checkConsistency(StoreEntry *) const;
+    virtual ~StoreMeta(){}
+    
+    int length;
+    void *value;
+    tlv *next;
+private:
+};
+
+/*
+ * store_swapmeta.c
+ */
+SQUIDCEXTERN char *storeSwapMetaPack(tlv * tlv_list, int *length);
+SQUIDCEXTERN tlv *storeSwapMetaBuild(StoreEntry * e);
+SQUIDCEXTERN void storeSwapTLVFree(tlv * n);
+
+#endif /* SQUID_TYPELENGTHVALUE_H */
@@ -0,0 +1,89 @@
+
+/*
+ * $Id: StoreMetaMD5.cc,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ * DEBUG: section 20    Storage Manager Swapfile Metadata
+ * AUTHOR: Kostas Anagnostakis
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "StoreMetaMD5.h"
+#include "Store.h"
+#include "MemObject.h"
+
+MemPool *StoreMetaMD5::pool = NULL;
+
+void *
+StoreMetaMD5::operator new (size_t byteCount)
+{
+    /* derived classes with different sizes must implement their own new */
+    assert (byteCount == sizeof (StoreMetaMD5));
+    if (!pool)
+	pool = memPoolCreate("StoreMetaMD5", sizeof (StoreMetaMD5));
+    return memPoolAlloc(pool);
+}
+
+void
+StoreMetaMD5::operator delete (void *address)
+{
+    memPoolFree(pool, address);
+}
+
+void
+StoreMetaMD5::deleteSelf()
+{
+    delete this;
+}
+
+bool 
+StoreMetaMD5::validLength(int len) const
+{
+    return len == MD5_DIGEST_CHARS;
+}
+
+int StoreMetaMD5::md5_mismatches = 0;
+
+bool 
+StoreMetaMD5::checkConsistency(StoreEntry *e) const
+{
+    assert (getType() == STORE_META_KEY_MD5);
+    assert(length == MD5_DIGEST_CHARS);
+    if (!EBIT_TEST(e->flags, KEY_PRIVATE) &&
+	memcmp(value, e->key, MD5_DIGEST_CHARS)) {
+	debug(20, 2) ("storeClientReadHeader: swapin MD5 mismatch\n");
+//	debug(20, 2) ("\t%s\n", storeKeyText((const cache_key *)value));
+	debug(20, 2) ("\t%s\n", e->getMD5Text());
+	if (isPowTen(++md5_mismatches))
+	    debug(20, 1) ("WARNING: %d swapin MD5 mismatches\n",
+			  md5_mismatches);
+	return false;
+    }
+    return true;
+}
@@ -0,0 +1,54 @@
+
+/*
+ * $Id: StoreMetaMD5.h,v 1.1 2003/01/23 00:37:14 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_STOREMETAMD5_H
+#define SQUID_STOREMETAMD5_H
+
+#include "StoreMeta.h"
+
+class StoreMetaMD5 : public StoreMeta {
+public:
+    void *operator new (size_t);
+    void operator delete (void *);
+    void deleteSelf();
+    
+    char getType() const {return STORE_META_KEY_MD5;}
+    bool validLength(int) const;
+    bool checkConsistency(StoreEntry *) const;
+    
+private:
+    static MemPool *pool;
+    static int md5_mismatches;
+};
+
+#endif /* SQUID_STOREMETAMD5_H */
@@ -0,0 +1,69 @@
+
+/*
+ * $Id: StoreMetaSTD.cc,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ * DEBUG: section 20    Storage Manager Swapfile Metadata
+ * AUTHOR: Kostas Anagnostakis
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "StoreMetaSTD.h"
+#include "Store.h"
+#include "MemObject.h"
+
+MemPool *StoreMetaSTD::pool = NULL;
+
+void *
+StoreMetaSTD::operator new (size_t byteCount)
+{
+    /* derived classes with different sizes must implement their own new */
+    assert (byteCount == sizeof (StoreMetaSTD));
+    if (!pool)
+	pool = memPoolCreate("StoreMetaSTD", sizeof (StoreMetaSTD));
+    return memPoolAlloc(pool);
+}
+
+void
+StoreMetaSTD::operator delete (void *address)
+{
+    memPoolFree(pool, address);
+}
+
+void
+StoreMetaSTD::deleteSelf()
+{
+    delete this;
+}
+
+bool
+StoreMetaSTD::validLength(int len) const
+{
+    return len == STORE_HDR_METASIZE;
+}
@@ -0,0 +1,53 @@
+
+/*
+ * $Id: StoreMetaSTD.h,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_STOREMETASTD_H
+#define SQUID_STOREMETASTD_H
+
+#include "StoreMeta.h"
+
+class StoreMetaSTD : public StoreMeta {
+public:
+    void *operator new (size_t);
+    void operator delete (void *);
+    void deleteSelf();
+    
+    char getType() const {return STORE_META_STD;}
+    bool validLength(int) const;
+//    bool checkConsistency(StoreEntry *) const;
+    
+private:
+    static MemPool *pool;
+};
+
+#endif /* SQUID_STOREMETASTD_H */
@@ -0,0 +1,77 @@
+
+/*
+ * $Id: StoreMetaURL.cc,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ * DEBUG: section 20    Storage Manager Swapfile Metadata
+ * AUTHOR: Kostas Anagnostakis
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "StoreMetaURL.h"
+#include "Store.h"
+#include "MemObject.h"
+
+MemPool *StoreMetaURL::pool = NULL;
+
+void *
+StoreMetaURL::operator new (size_t byteCount)
+{
+    /* derived classes with different sizes must implement their own new */
+    assert (byteCount == sizeof (StoreMetaURL));
+    if (!pool)
+	pool = memPoolCreate("StoreMetaURL", sizeof (StoreMetaURL));
+    return memPoolAlloc(pool);
+}
+
+void
+StoreMetaURL::operator delete (void *address)
+{
+    memPoolFree(pool, address);
+}
+
+void
+StoreMetaURL::deleteSelf()
+{
+    delete this;
+}
+
+bool 
+StoreMetaURL::checkConsistency(StoreEntry *e) const
+{
+    assert (getType() == STORE_META_URL);
+    if (!e->mem_obj->url)
+	return true;
+    if (strcasecmp(e->mem_obj->url, (char *)value)) {
+	debug(20, 1) ("storeClientReadHeader: URL mismatch\n");
+	debug(20, 1) ("\t{%s} != {%s}\n", (char *) value, e->mem_obj->url);
+	return false;
+    }
+    return true;
+}
@@ -0,0 +1,52 @@
+
+/*
+ * $Id: StoreMetaURL.h,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_STOREMETAURL_H
+#define SQUID_STOREMETAURL_H
+
+#include "StoreMeta.h"
+
+class StoreMetaURL : public StoreMeta {
+public:
+    void *operator new (size_t);
+    void operator delete (void *);
+    void deleteSelf();
+    
+    char getType() const {return STORE_META_URL;}
+    bool checkConsistency(StoreEntry *) const;
+    
+private:
+    static MemPool *pool;
+};
+
+#endif /* SQUID_STOREMETAURL_H */
@@ -0,0 +1,123 @@
+
+/*
+ * $Id: StoreMetaUnpacker.cc,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ * DEBUG: section 20    Storage Manager Swapfile Unpacker
+ * AUTHOR: Robert Collins
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "StoreMetaUnpacker.h"
+#include "StoreMeta.h"
+
+off_t const StoreMetaUnpacker::MinimumBufferLength = sizeof(char) + sizeof(int);
+
+bool
+StoreMetaUnpacker::isBufferSane()
+{
+    if (buf[0] != (char) STORE_META_OK)
+	return false;
+    /*
+     * sanity check on 'buflen' value.  It should be at least big
+     * enough to hold one type and one length.
+     */
+    getBufferLength();
+    if (*hdr_len <= MinimumBufferLength)
+	return false;
+    if (*hdr_len > buflen)
+	return false;
+    return true;
+}
+
+void
+StoreMetaUnpacker::getBufferLength()
+{
+    xmemcpy(hdr_len, &buf[1], sizeof(int));
+}
+
+StoreMetaUnpacker::StoreMetaUnpacker (char const *aBuffer, ssize_t aLen, int *anInt) : buf (aBuffer), buflen(aLen), hdr_len(anInt), position(1 + sizeof(int))
+{
+    assert (aBuffer != NULL);
+}
+
+void
+StoreMetaUnpacker::getType()
+{
+    type = buf[position++];
+}
+
+void
+StoreMetaUnpacker::getLength()
+{
+    xmemcpy(&length, &buf[position], sizeof(int));
+    position += sizeof(int);
+}
+
+bool
+StoreMetaUnpacker::doOneEntry()
+{
+    getType();
+    getLength();
+    if (position + length > *hdr_len) {
+        debug(20, 0) ("storeSwapMetaUnpack: overflow!\n");
+        debug(20, 0) ("\ttype=%d, length=%d, *hdr_len=%d, offset=%d\n",
+            type, length, *hdr_len, (int) position);
+        return false;
+    }
+    StoreMeta *newNode = StoreMeta::Factory(type, length, &buf[position]);
+    if (!newNode)
+	return false;
+    tail = StoreMeta::Add (tail, newNode);
+    position += length;
+    return true;
+}
+
+bool
+StoreMetaUnpacker::moreToProcess() const
+{
+    return *hdr_len - position - MinimumBufferLength > 0;
+}
+
+StoreMeta *
+StoreMetaUnpacker::createStoreMeta ()
+{
+    tlv *TLV = NULL;
+    tail = &TLV;
+    assert(hdr_len != NULL);
+    if (!isBufferSane())
+	return NULL;
+    getBufferLength();
+    assert (position == 1 + sizeof(int));
+    while (moreToProcess()) {
+	if (!doOneEntry())
+	    break;
+    }
+    return TLV;
+}
@@ -0,0 +1,71 @@
+
+/*
+ * $Id: StoreMetaUnpacker.h,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_TYPELENGTHVALUEUNPACKER_H
+#define SQUID_TYPELENGTHVALUEUNPACKER_H
+
+class StoreMeta;
+class StoreMetaUnpacker {
+public:
+    StoreMetaUnpacker (const char *buf, ssize_t bufferLength, int *hdrlen);
+    StoreMeta *createStoreMeta();
+    bool isBufferSane();
+private:
+    static off_t const MinimumBufferLength;
+    
+    void getBufferLength();
+    void getType();
+    void getLength();
+    void getTLV();
+    bool doOneEntry();
+    bool moreToProcess() const;
+
+    char const * const buf;
+    ssize_t buflen;
+    int *hdr_len;
+    off_t position;
+    char type;
+    int length;
+    StoreMeta **tail;
+};
+
+/*
+ * store_swapmeta.c
+ */
+SQUIDCEXTERN char *storeSwapMetaPack(StoreMeta * tlv_list, int *length);
+SQUIDCEXTERN StoreMeta *storeSwapMetaBuild(StoreEntry * e);
+SQUIDCEXTERN StoreMeta *storeSwapMetaUnpack(const char *buf, int *hdrlen);
+SQUIDCEXTERN void storeSwapTLVFree(StoreMeta * n);
+StoreMeta ** storeSwapTLVAdd(int type, const void *ptr, size_t len, StoreMeta ** tail);
+
+#endif /* SQUID_TYPELENGTHVALUEUNPACKER_H */
@@ -0,0 +1,78 @@
+
+/*
+ * $Id: StoreMetaVary.cc,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ * DEBUG: section 20    Storage Manager Swapfile Metadata
+ * AUTHOR: Kostas Anagnostakis
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "StoreMetaVary.h"
+#include "Store.h"
+#include "MemObject.h"
+
+MemPool *StoreMetaVary::pool = NULL;
+
+void *
+StoreMetaVary::operator new (size_t byteCount)
+{
+    /* derived classes with different sizes must implement their own new */
+    assert (byteCount == sizeof (StoreMetaVary));
+    if (!pool)
+	pool = memPoolCreate("StoreMetaVary", sizeof (StoreMetaVary));
+    return memPoolAlloc(pool);
+}
+
+void
+StoreMetaVary::operator delete (void *address)
+{
+    memPoolFree(pool, address);
+}
+
+void
+StoreMetaVary::deleteSelf()
+{
+    delete this;
+}
+
+bool 
+StoreMetaVary::checkConsistency(StoreEntry *e) const
+{
+    assert (getType() == STORE_META_VARY_HEADERS);
+    if (!e->mem_obj->vary_headers) {
+	/* XXX separate this mutator from the query */
+	/* Assume the object is OK.. remember the vary request headers */
+	e->mem_obj->vary_headers = xstrdup((char *)value);
+	return true;
+    }
+    if (strcmp(e->mem_obj->vary_headers, (char *)value) != 0)
+	return false;
+    return true;
+}
@@ -0,0 +1,52 @@
+
+/*
+ * $Id: StoreMetaVary.h,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_STOREMETAVARY_H
+#define SQUID_STOREMETAVARY_H
+
+#include "StoreMeta.h"
+
+class StoreMetaVary : public StoreMeta {
+public:
+    void *operator new (size_t);
+    void operator delete (void *);
+    void deleteSelf();
+    
+    char getType() const {return STORE_META_VARY_HEADERS;}
+    bool checkConsistency(StoreEntry *) const;
+    
+private:
+    static MemPool *pool;
+};
+
+#endif /* SQUID_STOREMETAVARY_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: String.cc,v 1.11 2002/10/13 20:34:57 robertc Exp $
+ * $Id: String.cc,v 1.12 2003/01/23 00:37:15 robertc Exp $
  *
  * DEBUG: section 67    String
  * AUTHOR: Duane Wessels
@@ -35,77 +35,132 @@
 
 #include "squid.h"
 
-static void
-stringInitBuf(String * s, size_t sz)
+String const String::Null;
+
+void
+String::initBuf(size_t sz)
 {
-    s->buf = (char *)memAllocString(sz, &sz);
+    buf_ = (char *)memAllocString(sz, &sz);
     assert(sz < 65536);
-    s->size = sz;
+    size_ = sz;
 }
 
 void
-stringInit(String * s, const char *str)
+String::init(char const *str)
 {
-    assert(s);
+    assert(this);
     if (str)
-	stringLimitInit(s, str, strlen(str));
+	limitInit(str, strlen(str));
     else
-	*s = StringNull;
+	clean();
 }
 
+String::String (char const *aString) : size_(0), len_(0), buf_(NULL)
+{
+    init (aString);
+}
+
+String &
+String::operator =(char const *aString)
+{
+    clean();
+    init (aString);
+    return *this;
+}
+
+String &
+String::operator = (String const &old)
+{
+    clean ();
+    if (old.len_)
+	limitInit (old.buf_, old.len_);
+    return *this;
+}
+  
 void
-stringLimitInit(String * s, const char *str, int len)
+String::limitInit(const char *str, int len)
 {
-    assert(s && str);
-    stringInitBuf(s, len + 1);
-    s->len = len;
-    xmemcpy(s->buf, str, len);
-    s->buf[len] = '\0';
+    assert(this && str);
+    initBuf(len + 1);
+    len_ = len;
+    xmemcpy(buf_, str, len);
+    buf_[len] = '\0';
 }
 
-String
-stringDup(const String * s)
+String::String (String const &old) : size_(0), len_(0), buf_(NULL)
 {
-    String dup;
-    assert(s);
-    stringInit(&dup, s->buf);
-    return dup;
+    init (old.buf_);
 }
 
 void
-stringClean(String * s)
+String::clean()
+{
+    assert(this);
+    if (buf_)
+	memFreeString(size_, buf_);
+    len_ = 0;
+    size_ = 0;
+    buf_ = NULL;
+}
+
+String::~String()
 {
-    assert(s);
-    if (s->buf)
-	memFreeString(s->size, s->buf);
-    *s = StringNull;
+    clean();
 }
 
 void
-stringReset(String * s, const char *str)
+String::reset(const char *str)
 {
-    stringClean(s);
-    stringInit(s, str);
+    clean();
+    init(str);
 }
 
 void
-stringAppend(String * s, const char *str, int len)
+String::append(const char *str, int len)
 {
-    assert(s);
+    assert(this);
     assert(str && len >= 0);
-    if (s->len + len < s->size) {
-	strncat(s->buf, str, len);
-	s->len += len;
+    if (len_ + len < size_) {
+	strncat(buf_, str, len);
+	len_ += len;
     } else {
-	String snew = StringNull;
-	snew.len = s->len + len;
-	stringInitBuf(&snew, snew.len + 1);
-	if (s->buf)
-	    xmemcpy(snew.buf, s->buf, s->len);
+	String snew;
+	snew.len_ = len_ + len;
+	snew.initBuf(snew.len_ + 1);
+	if (buf_)
+	    xmemcpy(snew.buf_, buf_, len_);
 	if (len)
-	    xmemcpy(snew.buf + s->len, str, len);
-	snew.buf[snew.len] = '\0';
-	stringClean(s);
-	*s = snew;
+	    xmemcpy(snew.buf_ + len_, str, len);
+	snew.buf_[snew.len_] = '\0';
+	absorb(snew);
     }
 }
+
+void
+String::append(char const *str)
+{
+    assert (str);
+    append (str, strlen(str));
+}
+
+void
+String::append(String const &old)
+{
+    append (old.buf_, old.len_);
+}
+
+void
+String::absorb(String &old)
+{
+    clean();
+    size_ = old.size_;
+    buf_ = old.buf_;
+    len_ = old.len_;
+    old.size_ = 0;
+    old.buf_ = NULL;
+    old.len_ = 0;
+}
+
+#ifndef _USE_INLINE_
+#include "String.cci"
+#endif
@@ -0,0 +1,56 @@
+
+/*
+ * $Id: String.cci,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ * DEBUG: section 67    String
+ * AUTHOR: Duane Wessels
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+String::String() : size_(0), len_(0), buf_ (NULL)
+{
+}
+
+int
+String::size() const
+{
+    return len_;
+}
+
+char const *
+String::buf() const
+{
+    return buf_;
+}
+
+int
+String::nCaseCmp (char const *aString, int aLen) const
+{
+    return strncasecmp(buf(), aString, aLen);
+}
@@ -0,0 +1,87 @@
+
+/*
+ * $Id: String.h,v 1.1 2003/01/23 00:37:15 robertc Exp $
+ *
+ * DEBUG: section 67    String
+ * AUTHOR: Duane Wessels
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_STRING_H
+#define SQUID_STRING_H
+
+class String {
+public:
+    static const String Null;
+    _SQUID_INLINE_ String();
+    String (char const *);
+    String (String const &);
+    ~String();
+    
+    String &operator =(char const *);
+    String &operator =(String const &);
+    
+    _SQUID_INLINE_ int size() const;
+    _SQUID_INLINE_ char const * buf() const;
+    void init (char const *);
+    void initBuf(size_t sz);
+    void limitInit(const char *str, int len);
+    void clean();
+    void reset(char const *str);
+    void append(char const *buf, int len);
+    void append(char const *buf);
+    void append (String const &);
+    void absorb(String &old);
+    _SQUID_INLINE_ int nCaseCmp (char const *aString, int aLen) const;
+private:
+    /* never reference these directly! */
+    unsigned short int size_;	/* buffer size; 64K limit */
+public:
+    unsigned short int len_;	/* current length  */
+    char *buf_;
+};
+
+#define StringNull String::Null;
+/* String */
+#define strChr(s,ch)  ((const char*)strchr((s).buf(), (ch)))
+#define strRChr(s,ch) ((const char*)strrchr((s).buf(), (ch)))
+#define strStr(s,str) ((const char*)strstr((s).buf(), (str)))
+#define strCmp(s,str)     strcmp((s).buf(), (str))
+#define strNCmp(s,str,n)     strncmp((s).buf(), (str), (n))
+#define strCaseCmp(s,str) strcasecmp((s).buf(), (str))
+#define strSet(s,ptr,ch) (s).buf_[ptr-(s).buf_] = (ch)
+#define strCut(s,pos) (((s).len_ = pos) , ((s).buf_[pos] = '\0'))
+#define strCutPtr(s,ptr) (((s).len_ = (ptr)-(s).buf_) , ((s).buf_[(s).len_] = '\0'))
+
+#ifdef _USE_INLINE_
+#include "String.cci"
+#endif
+
+#endif /* SQUID_STRING_H */
+
@@ -1,6 +1,6 @@
 
 /*
- * $Id: SwapDir.cc,v 1.1 2002/12/27 10:26:33 robertc Exp $
+ * $Id: SwapDir.cc,v 1.2 2003/01/23 00:37:15 robertc Exp $
  *
  * DEBUG: section ??    Swap Dir base object
  * AUTHOR: Robert Collins
@@ -1,6 +1,6 @@
 
 /*
- * $Id: SwapDir.h,v 1.1 2002/12/27 10:26:33 robertc Exp $
+ * $Id: SwapDir.h,v 1.2 2003/01/23 00:37:15 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -97,5 +97,4 @@ struct SwapDir {
 	int blksize;
     } fs;
 };
-
 #endif /* SQUID_SWAPDIR_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: access_log.cc,v 1.78 2002/12/06 23:19:13 hno Exp $
+ * $Id: access_log.cc,v 1.79 2003/01/23 00:37:15 robertc Exp $
  *
  * DEBUG: section 46    Access Log
  * AUTHOR: Duane Wessels
@@ -1,5 +1,5 @@
 /*
- * $Id: acl.cc,v 1.294 2002/12/11 11:57:38 robertc Exp $
+ * $Id: acl.cc,v 1.295 2003/01/23 00:37:15 robertc Exp $
  *
  * DEBUG: section 28    Access Control
  * AUTHOR: Duane Wessels
@@ -34,6 +34,7 @@
 
 #include "squid.h"
 #include "splay.h"
+#include "HttpRequest.h"
 #include "authenticate.h"
 
 static void aclParseDomainList(void *curlist);
@@ -1662,7 +1663,7 @@ aclMatchAcl(acl * ae, aclCheck_t * checklist)
 	return aclMatchTime((acl_time_data *)ae->data, squid_curtime);
 	/* NOTREACHED */
     case ACL_URLPATH_REGEX:
-	esc_buf = xstrdup(strBuf(r->urlpath));
+	esc_buf = xstrdup(r->urlpath.buf());
 	rfc1738_unescape(esc_buf);
 	k = aclMatchRegex((relist *)ae->data, esc_buf);
 	safe_free(esc_buf);
@@ -1,6 +1,6 @@
 
 /*
- * $Id: asn.cc,v 1.87 2003/01/17 08:21:51 robertc Exp $
+ * $Id: asn.cc,v 1.88 2003/01/23 00:37:16 robertc Exp $
  *
  * DEBUG: section 53    AS Number handling
  * AUTHOR: Duane Wessels, Kostas Anagnostakis
@@ -35,6 +35,7 @@
 
 #include "squid.h"
 #include "radix.h"
+#include "HttpRequest.h"
 #include "StoreClient.h"
 #include "Store.h"
 
@@ -73,6 +74,7 @@ struct _ASState {
     off_t offset;
     int reqofs;
     char reqbuf[AS_REQBUF_SZ];
+    bool dataRead;
 };
 
 typedef struct _ASState ASState;
@@ -193,8 +195,8 @@ asnCacheStart(int as)
     StoreEntry *e;
     request_t *req;
     ASState *asState;
-    StoreIOBuffer readBuffer = EMPTYIOBUFFER;
     asState = cbdataAlloc(ASState);
+    asState->dataRead = 0;
     debug(53, 3) ("asnCacheStart: AS %d\n", as);
     snprintf(asres, 4096, "whois://%s/!gAS%d", Config.as_whois_server, as);
     asState->as_number = as;
@@ -212,9 +214,7 @@ asnCacheStart(int as)
     asState->entry = e;
     asState->offset = 0;
     asState->reqofs = 0;
-    readBuffer.offset = asState->offset;
-    readBuffer.length = AS_REQBUF_SZ;
-    readBuffer.data = asState->reqbuf;
+    StoreIOBuffer readBuffer (AS_REQBUF_SZ, asState->offset, asState->reqbuf);
     storeClientCopy(asState->sc,
 	e,
 	readBuffer,
@@ -240,14 +240,15 @@ asHandleReply(void *data, StoreIOBuffer result)
 	asStateFree(asState);
 	return;
     }
-    if (result.length == 0 && e->mem_obj->inmem_hi > 0) {
+    if (result.length == 0 && asState->dataRead) {
+	debug(53, 3) ("asHandleReply: Done: %s\n", storeUrl(e));
 	asStateFree(asState);
 	return;
     } else if (result.flags.error) {
 	debug(53, 1) ("asHandleReply: Called with Error set and size=%u\n", (unsigned int) result.length);
 	asStateFree(asState);
 	return;
-    } else if (HTTP_OK != e->mem_obj->reply->sline.status) {
+    } else if (HTTP_OK != e->getReply()->sline.status) {
 	debug(53, 1) ("WARNING: AS %d whois request failed\n",
 	    asState->as_number);
 	asStateFree(asState);
@@ -273,6 +274,7 @@ asHandleReply(void *data, StoreIOBuffer result)
 	debug(53, 3) ("asHandleReply: AS# %s (%d)\n", s, asState->as_number);
 	asnAddNet(s, asState->as_number);
 	s = t + 1;
+	asState->dataRead = 1;
     }
 
     /*
@@ -296,19 +298,18 @@ asHandleReply(void *data, StoreIOBuffer result)
     asState->reqofs = leftoversz;
     debug(53, 3) ("asState->offset = %ld\n", (long int) asState->offset);
     if (e->store_status == STORE_PENDING) {
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
 	debug(53, 3) ("asHandleReply: store_status == STORE_PENDING: %s\n", storeUrl(e));
-	tempBuffer.offset = asState->offset;
-	tempBuffer.length = AS_REQBUF_SZ - asState->reqofs;
-	tempBuffer.data = asState->reqbuf + asState->reqofs;
+	StoreIOBuffer tempBuffer (AS_REQBUF_SZ - asState->reqofs,
+				  asState->offset, 
+				  asState->reqbuf + asState->reqofs);
 	storeClientCopy(asState->sc,
 	    e,
 	    tempBuffer,
 	    asHandleReply,
 	    asState);
-    } else if (asState->offset < e->mem_obj->inmem_hi) {
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
-	debug(53, 3) ("asHandleReply: asState->offset < e->mem_obj->inmem_hi %s\n", storeUrl(e));
+    } else {
+	StoreIOBuffer tempBuffer;
+	debug(53, 3) ("asHandleReply: store complete, but data recieved %s\n", storeUrl(e));
 	tempBuffer.offset = asState->offset;
 	tempBuffer.length = AS_REQBUF_SZ - asState->reqofs;
 	tempBuffer.data = asState->reqbuf + asState->reqofs;
@@ -317,9 +318,6 @@ asHandleReply(void *data, StoreIOBuffer result)
 	    tempBuffer,
 	    asHandleReply,
 	    asState);
-    } else {
-	debug(53, 3) ("asHandleReply: Done: %s\n", storeUrl(e));
-	asStateFree(asState);
     }
 }
 
@@ -1,6 +1,6 @@
 #  Makefile for authentication modules in the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.2 2002/10/13 20:35:16 robertc Exp $
+#  $Id: Makefile.am,v 1.3 2003/01/23 00:37:50 robertc Exp $
 #
 AUTOMAKE_OPTIONS = subdir-objects
 AM_CXXFLAGS = -Werror -Wall
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -12,12 +13,6 @@
 # PARTICULAR PURPOSE.
 
 @SET_MAKE@
-
-#  Makefile for authentication modules in the Squid Object Cache server
-#
-#  $Id: Makefile.in,v 1.23 2002/10/25 03:48:57 robertc Exp $
-#
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +43,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +61,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +82,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +94,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +110,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -118,6 +120,10 @@ am__quote = @am__quote@
 install_sh = @install_sh@
 makesnmplib = @makesnmplib@
 
+#  Makefile for authentication modules in the Squid Object Cache server
+#
+#  $Id: Makefile.in,v 1.24 2003/01/23 00:37:50 robertc Exp $
+#
 AUTOMAKE_OPTIONS = subdir-objects
 AM_CXXFLAGS = -Werror -Wall
 
@@ -156,9 +162,10 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/basic/auth_basic.Po \
-@AMDEP_TRUE@	$(DEPDIR)/digest/auth_digest.Po \
-@AMDEP_TRUE@	$(DEPDIR)/ntlm/auth_ntlm.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = basic/$(DEPDIR)/auth_basic.Po \
+@AMDEP_TRUE@	digest/$(DEPDIR)/auth_digest.Po \
+@AMDEP_TRUE@	ntlm/$(DEPDIR)/auth_ntlm.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
@@ -183,46 +190,42 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  src/auth/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
-
-AR = ar
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 
 clean-noinstLIBRARIES:
 	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
 basic/.dirstamp:
 	@$(mkinstalldirs) basic
 	@: > basic/.dirstamp
-$(DEPDIR)/basic/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/basic
-	@: > $(DEPDIR)/basic/.dirstamp
+basic/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) basic/$(DEPDIR)
+	@: > basic/$(DEPDIR)/.dirstamp
 basic/auth_basic.$(OBJEXT): basic/auth_basic.cc basic/.dirstamp \
-	$(DEPDIR)/basic/.dirstamp
+	basic/$(DEPDIR)/.dirstamp
 libbasic.a: $(libbasic_a_OBJECTS) $(libbasic_a_DEPENDENCIES) 
 	-rm -f libbasic.a
 	$(libbasic_a_AR) libbasic.a $(libbasic_a_OBJECTS) $(libbasic_a_LIBADD)
 	$(RANLIB) libbasic.a
 digest/.dirstamp:
 	@$(mkinstalldirs) digest
 	@: > digest/.dirstamp
-$(DEPDIR)/digest/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/digest
-	@: > $(DEPDIR)/digest/.dirstamp
+digest/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) digest/$(DEPDIR)
+	@: > digest/$(DEPDIR)/.dirstamp
 digest/auth_digest.$(OBJEXT): digest/auth_digest.cc digest/.dirstamp \
-	$(DEPDIR)/digest/.dirstamp
+	digest/$(DEPDIR)/.dirstamp
 libdigest.a: $(libdigest_a_OBJECTS) $(libdigest_a_DEPENDENCIES) 
 	-rm -f libdigest.a
 	$(libdigest_a_AR) libdigest.a $(libdigest_a_OBJECTS) $(libdigest_a_LIBADD)
 	$(RANLIB) libdigest.a
 ntlm/.dirstamp:
 	@$(mkinstalldirs) ntlm
 	@: > ntlm/.dirstamp
-$(DEPDIR)/ntlm/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/ntlm
-	@: > $(DEPDIR)/ntlm/.dirstamp
+ntlm/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) ntlm/$(DEPDIR)
+	@: > ntlm/$(DEPDIR)/.dirstamp
 ntlm/auth_ntlm.$(OBJEXT): ntlm/auth_ntlm.cc ntlm/.dirstamp \
-	$(DEPDIR)/ntlm/.dirstamp
+	ntlm/$(DEPDIR)/.dirstamp
 libntlm.a: $(libntlm_a_OBJECTS) $(libntlm_a_DEPENDENCIES) 
 	-rm -f libntlm.a
 	$(libntlm_a_AR) libntlm.a $(libntlm_a_OBJECTS) $(libntlm_a_LIBADD)
@@ -236,25 +239,25 @@ mostlyclean-compile:
 
 distclean-compile:
 	-rm -f *.tab.c
-	-rm -f $(DEPDIR)/basic/.dirstamp
-	-rm -f $(DEPDIR)/digest/.dirstamp
-	-rm -f $(DEPDIR)/ntlm/.dirstamp
+	-rm -f basic/$(DEPDIR)/.dirstamp
 	-rm -f basic/.dirstamp
+	-rm -f digest/$(DEPDIR)/.dirstamp
 	-rm -f digest/.dirstamp
+	-rm -f ntlm/$(DEPDIR)/.dirstamp
 	-rm -f ntlm/.dirstamp
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/basic/auth_basic.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/digest/auth_digest.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ntlm/auth_ntlm.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@basic/$(DEPDIR)/auth_basic.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@digest/$(DEPDIR)/auth_digest.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@ntlm/$(DEPDIR)/auth_ntlm.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf basic/$(DEPDIR) digest/$(DEPDIR) ntlm/$(DEPDIR)
 
 .cc.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXXCOMPILE) -c -o $@ `test -f $< || echo '$(srcdir)/'`$<
+	$(CXXCOMPILE) -c -o $@ `test -f '$<' || echo '$(srcdir)/'`$<
 
 .cc.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -264,89 +267,97 @@ distclean-depend:
 
 basic/auth_basic.o: basic/auth_basic.cc
 @AMDEP_TRUE@	source='basic/auth_basic.cc' object='basic/auth_basic.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/basic/auth_basic.Po' tmpdepfile='$(DEPDIR)/basic/auth_basic.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='basic/$(DEPDIR)/auth_basic.Po' tmpdepfile='basic/$(DEPDIR)/auth_basic.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o basic/auth_basic.o `test -f basic/auth_basic.cc || echo '$(srcdir)/'`basic/auth_basic.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o basic/auth_basic.o `test -f 'basic/auth_basic.cc' || echo '$(srcdir)/'`basic/auth_basic.cc
 
 basic/auth_basic.obj: basic/auth_basic.cc
 @AMDEP_TRUE@	source='basic/auth_basic.cc' object='basic/auth_basic.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/basic/auth_basic.Po' tmpdepfile='$(DEPDIR)/basic/auth_basic.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='basic/$(DEPDIR)/auth_basic.Po' tmpdepfile='basic/$(DEPDIR)/auth_basic.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o basic/auth_basic.obj `cygpath -w basic/auth_basic.cc`
 
 digest/auth_digest.o: digest/auth_digest.cc
 @AMDEP_TRUE@	source='digest/auth_digest.cc' object='digest/auth_digest.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/digest/auth_digest.Po' tmpdepfile='$(DEPDIR)/digest/auth_digest.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='digest/$(DEPDIR)/auth_digest.Po' tmpdepfile='digest/$(DEPDIR)/auth_digest.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o digest/auth_digest.o `test -f digest/auth_digest.cc || echo '$(srcdir)/'`digest/auth_digest.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o digest/auth_digest.o `test -f 'digest/auth_digest.cc' || echo '$(srcdir)/'`digest/auth_digest.cc
 
 digest/auth_digest.obj: digest/auth_digest.cc
 @AMDEP_TRUE@	source='digest/auth_digest.cc' object='digest/auth_digest.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/digest/auth_digest.Po' tmpdepfile='$(DEPDIR)/digest/auth_digest.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='digest/$(DEPDIR)/auth_digest.Po' tmpdepfile='digest/$(DEPDIR)/auth_digest.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o digest/auth_digest.obj `cygpath -w digest/auth_digest.cc`
 
 ntlm/auth_ntlm.o: ntlm/auth_ntlm.cc
 @AMDEP_TRUE@	source='ntlm/auth_ntlm.cc' object='ntlm/auth_ntlm.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/ntlm/auth_ntlm.Po' tmpdepfile='$(DEPDIR)/ntlm/auth_ntlm.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='ntlm/$(DEPDIR)/auth_ntlm.Po' tmpdepfile='ntlm/$(DEPDIR)/auth_ntlm.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ntlm/auth_ntlm.o `test -f ntlm/auth_ntlm.cc || echo '$(srcdir)/'`ntlm/auth_ntlm.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ntlm/auth_ntlm.o `test -f 'ntlm/auth_ntlm.cc' || echo '$(srcdir)/'`ntlm/auth_ntlm.cc
 
 ntlm/auth_ntlm.obj: ntlm/auth_ntlm.cc
 @AMDEP_TRUE@	source='ntlm/auth_ntlm.cc' object='ntlm/auth_ntlm.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/ntlm/auth_ntlm.Po' tmpdepfile='$(DEPDIR)/ntlm/auth_ntlm.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='ntlm/$(DEPDIR)/auth_ntlm.Po' tmpdepfile='ntlm/$(DEPDIR)/auth_ntlm.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ntlm/auth_ntlm.obj `cygpath -w ntlm/auth_ntlm.cc`
 CXXDEPMODE = @CXXDEPMODE@
 uninstall-info-am:
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -370,14 +381,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,5 +1,5 @@
 /*
- * $Id: auth_basic.cc,v 1.21 2003/01/09 11:44:05 hno Exp $
+ * $Id: auth_basic.cc,v 1.22 2003/01/23 00:37:52 robertc Exp $
  *
  * DEBUG: section 29    Authenticator
  * AUTHOR: Duane Wessels
@@ -1,6 +1,6 @@
 
 /*
- * $Id: auth_digest.cc,v 1.18 2003/01/09 11:44:08 hno Exp $
+ * $Id: auth_digest.cc,v 1.19 2003/01/23 00:38:00 robertc Exp $
  *
  * DEBUG: section 29    Authenticator
  * AUTHOR: Robert Collins
@@ -1060,7 +1060,6 @@ authDigestLogUsername(auth_user_request_t * auth_user_request, char *username)
 static void
 authenticateDigestDecodeAuth(auth_user_request_t * auth_user_request, const char *proxy_auth)
 {
-    String temp;
     const char *item;
     const char *p;
     const char *pos = NULL;
@@ -1085,7 +1084,7 @@ authenticateDigestDecodeAuth(auth_user_request_t * auth_user_request, const char
     while (xisspace(*proxy_auth))
 	proxy_auth++;
 
-    stringInit(&temp, proxy_auth);
+    String temp (proxy_auth);
     while (strListGetItem(&temp, ',', &item, &ilen, &pos)) {
 	if ((p = strchr(item, '=')) && (p - item < ilen))
 	    ilen = p++ - item;
@@ -1163,7 +1162,7 @@ authenticateDigestDecodeAuth(auth_user_request_t * auth_user_request, const char
 	    debug(29, 9) ("authDigestDecodeAuth: Found response '%s'\n", digest_request->response);
 	}
     }
-    stringClean(&temp);
+    temp.clean();
 
 
     /* now we validate the data given to us */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: auth_ntlm.cc,v 1.25 2003/01/09 11:38:59 hno Exp $
+ * $Id: auth_ntlm.cc,v 1.26 2003/01/23 00:38:04 robertc Exp $
  *
  * DEBUG: section 29    NTLM Authenticator
  * AUTHOR: Robert Collins
@@ -1,6 +1,6 @@
 
 /*
- * $Id: authenticate.cc,v 1.48 2003/01/09 07:55:13 robertc Exp $
+ * $Id: authenticate.cc,v 1.49 2003/01/23 00:37:16 robertc Exp $
  *
  * DEBUG: section 29    Authenticator
  * AUTHOR:  Robert Collins
@@ -1,6 +1,6 @@
 
 /*
- * $Id: authenticate.h,v 1.3 2002/10/15 09:25:33 robertc Exp $
+ * $Id: authenticate.h,v 1.4 2003/01/23 00:37:16 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -1,6 +1,6 @@
 
 /*
- * $Id: cache_cf.cc,v 1.425 2003/01/09 11:49:04 hno Exp $
+ * $Id: cache_cf.cc,v 1.426 2003/01/23 00:37:16 robertc Exp $
  *
  * DEBUG: section 3     Configuration File Parsing
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: cache_diff.cc,v 1.16 2002/09/01 15:16:33 hno Exp $
+ * $Id: cache_diff.cc,v 1.17 2003/01/23 00:37:16 robertc Exp $
  *
  * AUTHOR: Alex Rousskov
  *
@@ -1,6 +1,6 @@
 
 /*
- * $Id: cache_manager.cc,v 1.27 2002/10/13 20:34:59 robertc Exp $
+ * $Id: cache_manager.cc,v 1.28 2003/01/23 00:37:16 robertc Exp $
  *
  * DEBUG: section 16    Cache Manager Objects
  * AUTHOR: Duane Wessels
@@ -34,7 +34,10 @@
  */
 
 #include "squid.h"
+#include "HttpReply.h"
+#include "HttpRequest.h"
 #include "Store.h"
+#include "fde.h"
 
 #define MGR_PASSWD_SZ 128
 
@@ -78,6 +81,7 @@ cachemgrRegister(const char *action, const char *desc, OBJH * handler, int pw_re
 	debug(16, 3) ("cachemgrRegister: Duplicate '%s'\n", action);
 	return;
     }
+    assert (strstr (" ", action) == NULL);
     a = (action_table *)xcalloc(1, sizeof(action_table));
     a->action = xstrdup(action);
     a->desc = xstrdup(desc);
@@ -236,12 +240,10 @@ cachemgrStart(int fd, request_t * request, StoreEntry * entry)
 	 * password depends on action
 	 */
 	httpHeaderPutAuth(&rep->header, "Basic", mgr->action);
-	/* move info to the mem_obj->reply */
-	httpReplyAbsorb(entry->mem_obj->reply, rep);
 	/* store the reply */
-	httpReplySwapOut(entry->mem_obj->reply, entry);
+	httpReplySwapOut(rep, entry);
 	entry->expires = squid_curtime;
-	storeComplete(entry);
+	entry->complete();
 	cachemgrStateFree(mgr);
 	return;
     }
@@ -255,9 +257,7 @@ cachemgrStart(int fd, request_t * request, StoreEntry * entry)
 	storeBuffer(entry);
     {
 	http_version_t version;
-	HttpReply *rep = entry->mem_obj->reply;
-	/* prove there are no previous reply headers around */
-	assert(0 == rep->sline.status);
+	HttpReply *rep = httpReplyCreate();
 	httpBuildVersion(&version, 1, 0);
 	httpReplySetHeaders(rep,
 	    version,
@@ -272,7 +272,7 @@ cachemgrStart(int fd, request_t * request, StoreEntry * entry)
     a->handler(entry);
     if (a->flags.atomic) {
 	storeBufferFlush(entry);
-	storeComplete(entry);
+	entry->complete();
     }
     cachemgrStateFree(mgr);
 }
@@ -1,6 +1,6 @@
 
 /*
- * $Id: cachemgr.cc,v 1.101 2002/11/15 13:10:18 hno Exp $
+ * $Id: cachemgr.cc,v 1.102 2003/01/23 00:37:16 robertc Exp $
  *
  * DEBUG: section 0     CGI Cache Manager
  * AUTHOR: Duane Wessels
@@ -1,6 +1,6 @@
 
 /*
- * $Id: carp.cc,v 1.21 2002/11/10 04:22:03 hno Exp $
+ * $Id: carp.cc,v 1.22 2003/01/23 00:37:17 robertc Exp $
  *
  * DEBUG: section 39    Cache Array Routing Protocol
  * AUTHOR: Henrik Nordstrom
@@ -1,6 +1,6 @@
 
 /*
- * $Id: cbdata.cc,v 1.50 2003/01/22 10:05:43 robertc Exp $
+ * $Id: cbdata.cc,v 1.51 2003/01/23 00:37:17 robertc Exp $
  *
  * DEBUG: section 45    Callback Data Registry
  * ORIGINAL AUTHOR: Duane Wessels
@@ -173,7 +173,6 @@ cbdataInit(void)
      */
     CREATE_CBDATA(acl_access);
     CREATE_CBDATA(aclCheck_t);
-    CREATE_CBDATA(clientHttpRequest);
     CREATE_CBDATA(ConnStateData);
     CREATE_CBDATA(ErrorState);
     CREATE_CBDATA(FwdState);
@@ -1,6 +1,6 @@
 
 #
-# $Id: cf.data.pre,v 1.294 2003/01/18 02:08:59 hno Exp $
+# $Id: cf.data.pre,v 1.295 2003/01/23 00:37:17 robertc Exp $
 #
 #
 # SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -1,6 +1,6 @@
 
 /*
- * $Id: cf_gen.cc,v 1.48 2002/12/01 21:47:43 robertc Exp $
+ * $Id: cf_gen.cc,v 1.49 2003/01/23 00:37:17 robertc Exp $
  *
  * DEBUG: none          Generate squid.conf.default and cf_parser.h
  * AUTHOR: Max Okumoto
@@ -1,6 +1,6 @@
 
 /*
- * $Id: client.cc,v 1.102 2003/01/09 11:40:40 hno Exp $
+ * $Id: client.cc,v 1.103 2003/01/23 00:37:17 robertc Exp $
  *
  * DEBUG: section 0     WWW Client
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: clientStream.cc,v 1.3 2002/10/13 20:34:59 robertc Exp $
+ * $Id: clientStream.cc,v 1.4 2003/01/23 00:37:17 robertc Exp $
  *
  * DEBUG: section 87    Client-side Stream routines.
  * AUTHOR: Robert Collins
@@ -56,6 +56,9 @@
 
 #include "squid.h"
 #include "clientStream.h"
+#include "HttpReply.h"
+#include "HttpRequest.h"
+#include "client_side_request.h"
 
 CBDATA_TYPE(clientStreamNode);
 
@@ -1,6 +1,6 @@
 
 /*
- * $Id: clientStream.h,v 1.2 2002/10/13 20:34:59 robertc Exp $
+ * $Id: clientStream.h,v 1.3 2003/01/23 00:37:17 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -37,13 +37,14 @@
 #include "StoreIOBuffer.h"
 
 typedef struct _clientStreamNode clientStreamNode;
+class ClientHttpRequest;
 /* client stream read callback */
-typedef void CSCB(clientStreamNode *, clientHttpRequest *, HttpReply *, StoreIOBuffer);
+typedef void CSCB(clientStreamNode *, ClientHttpRequest *, HttpReply *, StoreIOBuffer);
 /* client stream read */
-typedef void CSR(clientStreamNode *, clientHttpRequest *);
+typedef void CSR(clientStreamNode *, ClientHttpRequest *);
 /* client stream detach */
-typedef void CSD(clientStreamNode *, clientHttpRequest *);
-typedef clientStream_status_t CSS(clientStreamNode *, clientHttpRequest *);
+typedef void CSD(clientStreamNode *, ClientHttpRequest *);
+typedef clientStream_status_t CSS(clientStreamNode *, ClientHttpRequest *);
 
 
 struct _clientStreamNode {
@@ -66,10 +67,10 @@ struct _clientStreamNode {
 SQUIDCEXTERN void clientStreamInit(dlink_list *, CSR *, CSD *, CSS *, void *, CSCB *, CSD *, void *, StoreIOBuffer tailBuffer);
 SQUIDCEXTERN void clientStreamInsertHead(dlink_list *, CSR *, CSCB *, CSD *, CSS *, void *);
 SQUIDCEXTERN clientStreamNode *clientStreamNew(CSR *, CSCB *, CSD *, CSS *, void *);
-SQUIDCEXTERN void clientStreamCallback(clientStreamNode *, clientHttpRequest *, HttpReply *, StoreIOBuffer replyBuffer);
-SQUIDCEXTERN void clientStreamRead(clientStreamNode *, clientHttpRequest *, StoreIOBuffer readBuffer);
-SQUIDCEXTERN void clientStreamDetach(clientStreamNode *, clientHttpRequest *);
-SQUIDCEXTERN void clientStreamAbort(clientStreamNode *, clientHttpRequest *);
-SQUIDCEXTERN clientStream_status_t clientStreamStatus(clientStreamNode *, clientHttpRequest *);
+SQUIDCEXTERN void clientStreamCallback(clientStreamNode *, ClientHttpRequest *, HttpReply *, StoreIOBuffer replyBuffer);
+SQUIDCEXTERN void clientStreamRead(clientStreamNode *, ClientHttpRequest *, StoreIOBuffer readBuffer);
+SQUIDCEXTERN void clientStreamDetach(clientStreamNode *, ClientHttpRequest *);
+SQUIDCEXTERN void clientStreamAbort(clientStreamNode *, ClientHttpRequest *);
+SQUIDCEXTERN clientStream_status_t clientStreamStatus(clientStreamNode *, ClientHttpRequest *);
 
 #endif /* SQUID_CLIENTSTREAM_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: client_db.cc,v 1.55 2002/10/13 20:34:59 robertc Exp $
+ * $Id: client_db.cc,v 1.56 2003/01/23 00:37:17 robertc Exp $
  *
  * DEBUG: section 0     Client Database
  * AUTHOR: Duane Wessels
@@ -1,6 +1,6 @@
 
 /*
- * $Id: client_side.cc,v 1.611 2002/12/20 05:47:22 robertc Exp $
+ * $Id: client_side.cc,v 1.612 2003/01/23 00:37:17 robertc Exp $
  *
  * DEBUG: section 33    Client-side Routines
  * AUTHOR: Duane Wessels
@@ -61,14 +61,16 @@
 #include "authenticate.h"
 #include "Store.h"
 #include "comm.h"
-
+#include "HttpReply.h"
+#include "HttpRequest.h"
+#include "MemObject.h"
+#include "fde.h"
+#include "client_side_request.h"
 
 #if LINGERING_CLOSE
 #define comm_close comm_lingering_close
 #endif
 
-#define FAILURE_MODE_TIME 300
-
 /* Persistent connection logic:
  *
  * requests (httpClientRequest structs) get added to the connection
@@ -86,7 +88,6 @@
  * data flow.
  */
 
-typedef class ClientSocketContext clientSocketContext;
 /* our socket-related context */
 class ClientSocketContext {
 public:
@@ -108,29 +109,47 @@ class ClientSocketContext {
 	StoreIOBuffer queuedBuffer;
     } deferredparams;
     off_t writtenToSocket;
+    void pullData();
+    off_t getNextRangeOffset() const;
+    bool canPackMoreRanges() const;
+    clientStream_status_t socketState();
+    void sendBody(HttpReply * rep, StoreIOBuffer bodyData);
+    void sendStartOfMessage(HttpReply * rep, StoreIOBuffer bodyData);
+    size_t lengthToSend(size_t maximum);
+    void noteSentBodyBytes(size_t);
+    void buildRangeHeader(HttpReply * rep);
+    int fd() const;
+    clientStreamNode * getTail() const;
+    clientStreamNode * getClientReplyContext() const;
+    void removeFromConnectionList(ConnStateData * conn);
+    void deferRecipientForLater(clientStreamNode * node, HttpReply * rep, StoreIOBuffer recievedData);
+    bool multipartRangeRequest() const;
+    void packRange(const char **buf,
+    size_t size,
+    MemBuf * mb);
 private:
+    void prepareReply(HttpReply * rep);
     bool mayUseConnection_; /* This request may use the connection -
 			     * don't read anymore requests for now
 			     */
 };
 
-CBDATA_TYPE(clientSocketContext);
+CBDATA_TYPE(ClientSocketContext);
 
 /* Local functions */
-/* clientSocketContext */
-static FREE clientSocketContextFree;
-static clientSocketContext *clientSocketContextNew(clientHttpRequest *);
+/* ClientSocketContext */
+static FREE ClientSocketContextFree;
+static ClientSocketContext *ClientSocketContextNew(clientHttpRequest *);
 /* other */
 static CWCB clientWriteComplete;
 static IOWCB clientWriteBodyComplete;
 static IOCB clientReadRequest;
 static PF connStateFree;
 static PF requestTimeout;
 static PF clientLifetimeTimeout;
-static void checkFailureRatio(err_type, hier_code);
-static clientSocketContext *parseHttpRequestAbort(ConnStateData * conn,
+static ClientSocketContext *parseHttpRequestAbort(ConnStateData * conn,
     const char *uri);
-static clientSocketContext *parseHttpRequest(ConnStateData *, method_t *,
+static ClientSocketContext *parseHttpRequest(ConnStateData *, method_t *,
     char **, size_t *);
 #if USE_IDENT
 static IDCB clientIdentDone;
@@ -143,63 +162,60 @@ static DEFER httpAcceptDefer;
 static int clientIsRequestBodyValid(int bodyLength);
 static int clientIsRequestBodyTooLargeForPolicy(size_t bodyLength);
 static void clientProcessBody(ConnStateData * conn);
-static clientStreamNode *getTail(clientSocketContext *);
-static void clientSocketRemoveThisFromConnectionList(clientSocketContext *,
-    ConnStateData *);
 static void clientUpdateStatHistCounters(log_type logType, int svc_time);
 static void clientUpdateStatCounters(log_type logType);
 static void clientUpdateHierCounters(HierarchyLogEntry *);
-static int clientPingHasFinished(ping_data const *aPing);
-static MemObject *clientGetMemObject(clientHttpRequest * http);
+static bool clientPingHasFinished(ping_data const *aPing);
 static void clientPrepareLogWithRequestDetails(request_t *, AccessLogEntry *);
-static void clientLogRequest(clientHttpRequest *);
-static void httpRequestFreeResources(clientHttpRequest *);
 static int connIsUsable(ConnStateData * conn);
-static clientSocketContext *connGetCurrentContext(ConnStateData * conn);
-static void contextDeferRecipientForLater(clientSocketContext * context, clientStreamNode * node, HttpReply * rep, StoreIOBuffer recievedData);
-static int responseFinishedOrFailed(HttpReply * rep, StoreIOBuffer recievedData);
-static int contextStartOfOutput(clientSocketContext * context);
-static void contextSendBody(clientSocketContext * context, HttpReply * rep, StoreIOBuffer bodyData);
-static void contextSendStartOfMessage(clientSocketContext * context, HttpReply * rep, StoreIOBuffer bodyData);
+static ClientSocketContext *connGetCurrentContext(ConnStateData * conn);
+static int responseFinishedOrFailed(HttpReply * rep, StoreIOBuffer const &recievedData);
+static int contextStartOfOutput(ClientSocketContext * context);
 static void connReadNextRequest(ConnStateData * conn);
-static void clientSocketContextPushDeferredIfNeeded(clientSocketContext * deferredRequest, ConnStateData * conn);
+static void ClientSocketContextPushDeferredIfNeeded(ClientSocketContext * deferredRequest, ConnStateData * conn);
 static void clientUpdateSocketStats(log_type logType, size_t size);
 
-static clientSocketContext *clientCheckRequestLineIsParseable(char *inbuf, size_t req_sz, ConnStateData * conn);
-static clientSocketContext *clientParseRequestMethod(char *inbuf, method_t * method_p, ConnStateData * conn);
+static ClientSocketContext *clientCheckRequestLineIsParseable(char *inbuf, size_t req_sz, ConnStateData * conn);
+static ClientSocketContext *clientParseRequestMethod(char *inbuf, method_t * method_p, ConnStateData * conn);
 static char *skipLeadingSpace(char *aString);
 static char *findTrailingHTTPVersion(char *uriAndHTTPVersion);
 static void trimTrailingSpaces(char *aString, size_t len);
-static clientSocketContext *parseURIandHTTPVersion(char **url_p, http_version_t * http_ver_p, ConnStateData * conn);
+static ClientSocketContext *parseURIandHTTPVersion(char **url_p, http_version_t * http_ver_p, ConnStateData * conn);
 static void setLogUri(clientHttpRequest * http, char const *uri);
 static void prepareInternalUrl(clientHttpRequest * http, char *url);
 static void prepareForwardProxyUrl(clientHttpRequest * http, char *url);
 static void prepareAcceleratedUrl(clientHttpRequest * http, char *url, char *req_hdr);
 static int connGetAvailableBufferLength(ConnStateData const *conn);
 static void connMakeSpaceAvailable(ConnStateData * conn);
-static void connAddContextToQueue(ConnStateData * conn, clientSocketContext * context);
+static void connAddContextToQueue(ConnStateData * conn, ClientSocketContext * context);
 static int connGetConcurrentRequestCount(ConnStateData * conn);
 static int connReadWasError(ConnStateData * conn, comm_err_t, int size);
 static int connFinishedWithConn(ConnStateData * conn, int size);
 static void connNoteUseOfBuffer(ConnStateData * conn, size_t byteCount);
 static int connKeepReadingIncompleteRequest(ConnStateData * conn);
 static void connCancelIncompleteRequests(ConnStateData * conn);
 static ConnStateData *connStateCreate(struct sockaddr_in *peer, struct sockaddr_in *me, int fd);
-static clientStreamNode *getClientReplyContext(clientSocketContext * context);
 static int connAreAllContextsForThisConnection(ConnStateData * connState);
 static void connFreeAllContexts(ConnStateData * connState);
-static void clientPullData(clientSocketContext * context);
+
+int
+ClientSocketContext::fd() const
+{
+    assert (http);
+    assert (http->conn);
+    return http->conn->fd;
+}
 
 clientStreamNode *
-getTail(clientSocketContext * context)
+ClientSocketContext::getTail() const
 {
-    return (clientStreamNode *)context->http->client_stream.tail->data;
+    return (clientStreamNode *)http->client_stream.tail->data;
 }
 
 clientStreamNode *
-getClientReplyContext(clientSocketContext * context)
+ClientSocketContext::getClientReplyContext() const
 {
-    return (clientStreamNode *)context->http->client_stream.tail->prev->data;
+    return (clientStreamNode *)http->client_stream.tail->prev->data;
 }
 
 /*
@@ -227,47 +243,46 @@ clientReadSomeData(ConnStateData *conn)
       
 
 void
-clientSocketRemoveThisFromConnectionList(clientSocketContext * context,
-    ConnStateData * conn)
+ClientSocketContext::removeFromConnectionList(ConnStateData * conn)
 {
-    clientSocketContext **tempContextPointer;
+    ClientSocketContext **tempContextPointer;
     assert(conn);
     assert(connGetCurrentContext(conn) != NULL);
     /* Unlink us from the connection request list */
-    tempContextPointer = (clientSocketContext **) & conn->currentobject;
+    tempContextPointer = (ClientSocketContext **) & conn->currentobject;
     while (*tempContextPointer) {
-	if (*tempContextPointer == context)
+	if (*tempContextPointer == this)
 	    break;
 	tempContextPointer = &(*tempContextPointer)->next;
     }
     assert(*tempContextPointer != NULL);
-    *tempContextPointer = context->next;
-    context->next = NULL;
+    *tempContextPointer = next;
+    next = NULL;
 }
 
 void
-clientSocketContextFree(void *data)
+ClientSocketContextFree(void *data)
 {
-    clientSocketContext *context = (clientSocketContext *)data;
+    ClientSocketContext *context = (ClientSocketContext *)data;
     ConnStateData *conn = context->http->conn;
-    clientStreamNode *node = getTail(context);
+    clientStreamNode *node = context->getTail();
     /* We are *always* the tail - prevent recursive free */
     assert(context == node->data);
     node->data = NULL;
     httpRequestFree(context->http);
     /* clean up connection links to us */
     assert(context != context->next);
     if (conn)
-	clientSocketRemoveThisFromConnectionList(context, conn);
+	context->removeFromConnectionList(conn);
 }
 
-clientSocketContext *
-clientSocketContextNew(clientHttpRequest * http)
+ClientSocketContext *
+ClientSocketContextNew(clientHttpRequest * http)
 {
-    clientSocketContext *newContext;
+    ClientSocketContext *newContext;
     assert(http != NULL);
-    CBDATA_INIT_TYPE_FREECB(clientSocketContext, clientSocketContextFree);
-    newContext = cbdataAlloc(clientSocketContext);
+    CBDATA_INIT_TYPE_FREECB(ClientSocketContext, ClientSocketContextFree);
+    newContext = cbdataAlloc(ClientSocketContext);
     newContext->http = http;
     return newContext;
 }
@@ -326,12 +341,12 @@ clientUpdateStatHistCounters(log_type logType, int svc_time)
     }
 }
 
-int
+bool
 clientPingHasFinished(ping_data const *aPing)
 {
     if (0 != aPing->stop.tv_sec && 0 != aPing->start.tv_sec)
-	return -1;
-    return 0;
+	return true;
+    return false;
 }
 
 void
@@ -359,22 +374,22 @@ clientUpdateHierCounters(HierarchyLogEntry * someEntry)
     }
 }
 
-static void
-clientUpdateCounters(clientHttpRequest * http)
+void
+ClientHttpRequest::updateCounters()
 {
-    clientUpdateStatCounters(http->logType);
-    if (http->request->errType != ERR_NONE)
+    clientUpdateStatCounters(logType);
+    if (request->errType != ERR_NONE)
 	statCounter.client_http.errors++;
-    clientUpdateStatHistCounters(http->logType,
-	tvSubMsec(http->start, current_time));
-    clientUpdateHierCounters(&http->request->hier);
+    clientUpdateStatHistCounters(logType,
+	tvSubMsec(start, current_time));
+    clientUpdateHierCounters(&request->hier);
 }
 
 MemObject *
-clientGetMemObject(clientHttpRequest * http)
+ClientHttpRequest::memObject() const
 {
-    if (http->entry)
-	return http->entry->mem_obj;
+    if (entry)
+	return entry->mem_obj;
     return NULL;
 }
 
@@ -404,79 +419,61 @@ clientPrepareLogWithRequestDetails(request_t * request, AccessLogEntry * aLogEnt
 }
 
 void
-clientLogRequest(clientHttpRequest * http)
-{
-    if (http->out.size || http->logType) {
-	http->al.icp.opcode = ICP_INVALID;
-	http->al.url = http->log_uri;
-	debug(33, 9) ("clientLogRequest: al.url='%s'\n", http->al.url);
-	if (clientGetMemObject(http)) {
-	    http->al.http.code = clientGetMemObject(http)->reply->sline.status;
-	    http->al.http.content_type = strBuf(clientGetMemObject(http)->reply->content_type);
+ClientHttpRequest::logRequest()
+{
+    if (out.size || logType) {
+	al.icp.opcode = ICP_INVALID;
+	al.url = log_uri;
+	debug(33, 9) ("clientLogRequest: al.url='%s'\n", al.url);
+	if (memObject()) {
+	    al.http.code = memObject()->getReply()->sline.status;
+	    al.http.content_type = memObject()->getReply()->content_type.buf();
 	}
-	http->al.cache.caddr = http->conn ? http->conn->log_addr : no_addr;
-	http->al.cache.size = http->out.size;
-	http->al.cache.code = http->logType;
-	http->al.cache.msec = tvSubMsec(http->start, current_time);
-	if (http->request)
-	    clientPrepareLogWithRequestDetails(http->request, &http->al);
-	if (http->conn && http->conn->rfc931[0])
-	    http->al.cache.rfc931 = http->conn->rfc931;
+	al.cache.caddr = conn ? conn->log_addr : no_addr;
+	al.cache.size = out.size;
+	al.cache.code = logType;
+	al.cache.msec = tvSubMsec(start, current_time);
+	if (request)
+	    clientPrepareLogWithRequestDetails(request, &al);
+	if (conn && conn->rfc931[0])
+	    al.cache.rfc931 = conn->rfc931;
 #if USE_SSL
-	if (http->conn)
-	    http->al.cache.ssluser = sslGetUserEmail(fd_table[http->conn->fd].ssl);
+	if (conn)
+	    al.cache.ssluser = sslGetUserEmail(fd_table[conn->fd].ssl);
 #endif
-	accessLogLog(&http->al);
-	accessLogFreeMemory(&http->al);
-	clientUpdateCounters(http);
-	if (http->conn)
-	    clientdbUpdate(http->conn->peer.sin_addr, http->logType, PROTO_HTTP,
-		http->out.size);
+	accessLogLog(&al);
+	accessLogFreeMemory(&al);
+	updateCounters();
+	if (conn)
+	    clientdbUpdate(conn->peer.sin_addr, logType, PROTO_HTTP, out.size);
     }
 }
 
 void
-httpRequestFreeResources(clientHttpRequest * http)
+ClientHttpRequest::freeResources()
 {
-    safe_free(http->uri);
-    safe_free(http->log_uri);
-    safe_free(http->redirect.location);
-    requestUnlink(http->request);
-    http->request = NULL;
-    if (http->client_stream.tail)
-	clientStreamAbort((clientStreamNode *)http->client_stream.tail->data, http);
+    safe_free(uri);
+    safe_free(log_uri);
+    safe_free(redirect.location);
+    range_iter.boundary.clean();
+    requestUnlink(request);
+    request = NULL;
+    if (client_stream.tail)
+	clientStreamAbort((clientStreamNode *)client_stream.tail->data, this);
 }
 
 void
 httpRequestFree(void *data)
 {
     clientHttpRequest *http = (clientHttpRequest *)data;
-    request_t *request = NULL;
     assert(http != NULL);
-    request = http->request;
-    debug(33, 3) ("httpRequestFree: %s\n", http->uri);
-    /* if body_connection !NULL, then ProcessBody has not
-     * found the end of the body yet
-     */
-    if (request && request->body_connection)
-	clientAbortBody(request);	/* abort body transter */
-    /* the ICP check here was erroneous
-     * - storeReleaseRequest was always called if entry was valid 
-     */
-    assert(http->logType < LOG_TYPE_MAX);
-    clientLogRequest(http);
-    if (request)
-	checkFailureRatio(request->errType, http->al.hier.code);
-    httpRequestFreeResources(http);
-    /* moving to the next connection is handled by the context free */
-    dlinkDelete(&http->active, &ClientActiveRequests);
-    cbdataFree(http);
+    delete http;
 }
 
 int
 connAreAllContextsForThisConnection(ConnStateData * connState)
 {
-    clientSocketContext *context;
+    ClientSocketContext *context;
     assert(connState != NULL);
     context = connGetCurrentContext(connState);
     while (context) {
@@ -490,7 +487,7 @@ connAreAllContextsForThisConnection(ConnStateData * connState)
 void
 connFreeAllContexts(ConnStateData * connState)
 {
-    clientSocketContext *context;
+    ClientSocketContext *context;
     while ((context = connGetCurrentContext(connState)) != NULL) {
 	assert(connGetCurrentContext(connState) !=
 	    connGetCurrentContext(connState)->next);
@@ -588,74 +585,403 @@ connIsUsable(ConnStateData * conn)
     return 1;
 }
 
-clientSocketContext *
+ClientSocketContext *
 connGetCurrentContext(ConnStateData * conn)
 {
     assert(conn);
-    return (clientSocketContext *)conn->currentobject;
+    return (ClientSocketContext *)conn->currentobject;
 }
 
 void
-contextDeferRecipientForLater(clientSocketContext * context, clientStreamNode * node, HttpReply * rep, StoreIOBuffer recievedData)
-{
-    debug(33, 2) ("clientSocketRecipient: Deferring %s\n", context->http->uri);
-    assert(context->flags.deferred == 0);
-    context->flags.deferred = 1;
-    context->deferredparams.node = node;
-    context->deferredparams.rep = rep;
-    context->deferredparams.queuedBuffer = recievedData;
+ClientSocketContext::deferRecipientForLater(clientStreamNode * node, HttpReply * rep, StoreIOBuffer recievedData)
+{
+    debug(33, 2) ("clientSocketRecipient: Deferring %s\n", http->uri);
+    assert(flags.deferred == 0);
+    flags.deferred = 1;
+    deferredparams.node = node;
+    deferredparams.rep = rep;
+    deferredparams.queuedBuffer = recievedData;
     return;
 }
 
 int
-responseFinishedOrFailed(HttpReply * rep, StoreIOBuffer recievedData)
+responseFinishedOrFailed(HttpReply * rep, StoreIOBuffer const & recievedData)
 {
     if (rep == NULL && recievedData.data == NULL && recievedData.length == 0)
 	return 1;
     return 0;
 }
 
 int
-contextStartOfOutput(clientSocketContext * context)
+contextStartOfOutput(ClientSocketContext * context)
 {
     return context->http->out.size == 0 ? 1 : 0;
 }
 
+size_t
+ClientSocketContext::lengthToSend(size_t maximum)
+{
+    if (!http->request->range)
+	return maximum;
+    assert (canPackMoreRanges());
+    if (http->range_iter.debt() == -1)
+	return maximum;
+    assert (http->range_iter.debt() > 0);
+    return XMIN(http->range_iter.debt(), (ssize_t)maximum);
+}
+
 void
-contextSendBody(clientSocketContext * context, HttpReply * rep, StoreIOBuffer bodyData)
+ClientSocketContext::noteSentBodyBytes(size_t bytes)
+{
+    http->out.offset += bytes;
+    if (!http->request->range)
+	return;
+    if (http->range_iter.debt() != -1) {
+	http->range_iter.debt(http->range_iter.debt() - bytes);
+	assert (http->range_iter.debt() >= 0);
+    }
+    assert (http->range_iter.debt() == -1 ||
+	    http->range_iter.debt() >= 0);
+}
+ 
+bool
+ClientHttpRequest::multipartRangeRequest() const
+{
+    return request->multipartRangeRequest();
+}
+
+bool
+ClientSocketContext::multipartRangeRequest() const
+{
+    return http->multipartRangeRequest();
+}
+
+void
+ClientSocketContext::sendBody(HttpReply * rep, StoreIOBuffer bodyData)
 {
     assert(rep == NULL);
-    context->http->out.offset += bodyData.length;
-    comm_write(context->http->conn->fd, bodyData.data, bodyData.length,
-	clientWriteBodyComplete, context);
+
+    if (!multipartRangeRequest()) {
+	size_t length = lengthToSend(bodyData.length);
+	noteSentBodyBytes (length);
+	comm_write(fd(), bodyData.data, length,
+		   clientWriteBodyComplete, this);
+	return;
+    }
+
+    MemBuf mb;
+    memBufDefInit(&mb);
+    char const *t = bodyData.data;
+    packRange(&t, bodyData.length, &mb);
+    /* write */
+    comm_old_write_mbuf(fd(), mb, clientWriteComplete, this);
     return;
 }
 
+/* put terminating boundary for multiparts */
+static void
+clientPackTermBound(String boundary, MemBuf * mb)
+{
+    memBufPrintf(mb, "\r\n--%s--\r\n", boundary.buf());
+    debug(33, 6) ("clientPackTermBound: buf offset: %ld\n", (long int) mb->size);
+}
+
+/* appends a "part" HTTP header (as in a multi-part/range reply) to the buffer */
+static void
+clientPackRangeHdr(const HttpReply * rep, const HttpHdrRangeSpec * spec, String boundary, MemBuf * mb)
+{
+    HttpHeader hdr;
+    Packer p;
+    assert(rep);
+    assert(spec);
+
+    /* put boundary */
+    debug(33, 5) ("clientPackRangeHdr: appending boundary: %s\n", boundary.buf());
+    /* rfc2046 requires to _prepend_ boundary with <crlf>! */
+    memBufPrintf(mb, "\r\n--%s\r\n", boundary.buf());
+
+    /* stuff the header with required entries and pack it */
+    httpHeaderInit(&hdr, hoReply);
+    if (httpHeaderHas(&rep->header, HDR_CONTENT_TYPE))
+	httpHeaderPutStr(&hdr, HDR_CONTENT_TYPE, httpHeaderGetStr(&rep->header, HDR_CONTENT_TYPE));
+    httpHeaderAddContRange(&hdr, *spec, rep->content_length);
+    packerToMemInit(&p, mb);
+    httpHeaderPackInto(&hdr, &p);
+    packerClean(&p);
+    httpHeaderClean(&hdr);
+
+    /* append <crlf> (we packed a header, not a reply) */
+    memBufPrintf(mb, "\r\n");
+}
+
+/*
+ * extracts a "range" from *buf and appends them to mb, updating
+ * all offsets and such.
+ */
 void
-contextSendStartOfMessage(clientSocketContext * context, HttpReply * rep, StoreIOBuffer bodyData)
+ClientSocketContext::packRange(const char **buf,
+    size_t size,
+    MemBuf * mb)
+{
+    HttpHdrRangeIter * i = &http->range_iter;
+    size_t available = size;
+    while (i->currentSpec() && available) {
+	const size_t copy_sz = lengthToSend(available);
+	/*
+	 * intersection of "have" and "need" ranges must not be empty
+	 */
+	assert(http->out.offset < i->currentSpec()->offset + i->currentSpec()->length);
+	assert(http->out.offset + available > (size_t)i->currentSpec()->offset);
+
+	/*
+	 * put boundary and headers at the beginning of a range in a
+	 * multi-range
+	 */
+	if (http->multipartRangeRequest() && i->debt() == i->currentSpec()->length) {
+	    assert(http->entry->mem_obj);
+	    clientPackRangeHdr(
+		http->entry->mem_obj->getReply(),	/* original reply */
+		i->currentSpec(),		/* current range */
+		i->boundary,	/* boundary, the same for all */
+		mb);
+	}
+	/*
+	 * append content
+	 */
+	debug(33, 3) ("clientPackRange: appending %ld bytes\n", (long int) copy_sz);
+	noteSentBodyBytes (copy_sz);
+	memBufAppend(mb, *buf, copy_sz);
+	/*
+	 * update offsets
+	 */
+	available -= copy_sz;
+	//body_off += copy_sz;
+	*buf += copy_sz;
+	/*
+	 * paranoid check
+	 */
+	assert(available >= 0 && i->debt() >= 0 || i->debt() == -1);
+	if (i->debt() == 0)
+	    /* put terminating boundary for multiparts */
+	    clientPackTermBound(i->boundary, mb);
+	if (!canPackMoreRanges())
+	    return;
+	off_t next = getNextRangeOffset();
+	assert (next >= http->out.offset);
+	size_t skip = next - http->out.offset;
+	if (available <= skip)
+	    return;
+	available -= skip;
+	*buf += skip;
+    }
+}
+
+/* returns expected content length for multi-range replies
+ * note: assumes that httpHdrRangeCanonize has already been called
+ * warning: assumes that HTTP headers for individual ranges at the
+ *          time of the actuall assembly will be exactly the same as
+ *          the headers when clientMRangeCLen() is called */
+int
+ClientHttpRequest::mRangeCLen()
 {
+    int clen = 0;
     MemBuf mb;
-    /* write headers and/or body if any */
-    assert(rep || (bodyData.data && bodyData.length));
-    /* init mb; put status line and headers if any */
-    if (rep) {
-	mb = httpReplyPack(rep);
-	/* Save length of headers for persistent conn checks */
-	context->http->out.headers_sz = mb.size;
-#if HEADERS_LOG
-	headersLog(0, 0, context->http->request->method, rep);
+
+    assert(entry->mem_obj);
+
+    memBufDefInit(&mb);
+    HttpHdrRange::iterator pos = request->range->begin();
+    while (pos != request->range->end()) {
+	/* account for headers for this range */
+	memBufReset(&mb);
+	clientPackRangeHdr(entry->mem_obj->getReply(),
+	    *pos, range_iter.boundary, &mb);
+	clen += mb.size;
+
+	/* account for range content */
+	clen += (*pos)->length;
+
+	debug(33, 6) ("clientMRangeCLen: (clen += %ld + %ld) == %d\n",
+	    (long int) mb.size, (long int) (*pos)->length, clen);
+	++pos;
+    }
+    /* account for the terminating boundary */
+    memBufReset(&mb);
+    clientPackTermBound(range_iter.boundary, &mb);
+    clen += mb.size;
+
+    memBufClean(&mb);
+    return clen;
+}
+
+/*
+ * returns true if If-Range specs match reply, false otherwise
+ */
+static int
+clientIfRangeMatch(clientHttpRequest * http, HttpReply * rep)
+{
+    const TimeOrTag spec = httpHeaderGetTimeOrTag(&http->request->header, HDR_IF_RANGE);
+    /* check for parsing falure */
+    if (!spec.valid)
+	return 0;
+    /* got an ETag? */
+    if (spec.tag.str) {
+	ETag rep_tag = httpHeaderGetETag(&rep->header, HDR_ETAG);
+	debug(33, 3) ("clientIfRangeMatch: ETags: %s and %s\n",
+	    spec.tag.str, rep_tag.str ? rep_tag.str : "<none>");
+	if (!rep_tag.str)
+	    return 0;		/* entity has no etag to compare with! */
+	if (spec.tag.weak || rep_tag.weak) {
+	    debug(33, 1) ("clientIfRangeMatch: Weak ETags are not allowed in If-Range: %s ? %s\n",
+		spec.tag.str, rep_tag.str);
+	    return 0;		/* must use strong validator for sub-range requests */
+	}
+	return etagIsEqual(&rep_tag, &spec.tag);
+    }
+    /* got modification time? */
+    if (spec.time >= 0) {
+	return http->entry->lastmod <= spec.time;
+    }
+    assert(0);			/* should not happen */
+    return 0;
+}
+
+/* generates a "unique" boundary string for multipart responses
+ * the caller is responsible for cleaning the string */
+String
+ClientHttpRequest::rangeBoundaryStr() const
+{
+    assert(this);
+    const char *key;
+    String b (full_appname_string);
+    b.append (":",1);
+    key = entry->getMD5Text();
+    b.append(key, strlen(key));
+    return b;
+}
+
+/* adds appropriate Range headers if needed */
+void
+ClientSocketContext::buildRangeHeader(HttpReply * rep)
+{
+    HttpHeader *hdr = rep ? &rep->header : 0;
+    const char *range_err = NULL;
+    request_t *request = http->request;
+    assert(request->range);
+    /* check if we still want to do ranges */
+    if (!rep)
+	range_err = "no [parse-able] reply";
+    else if ((rep->sline.status != HTTP_OK) && (rep->sline.status != HTTP_PARTIAL_CONTENT))
+	range_err = "wrong status code";
+#if 0
+    else if (httpHeaderHas(hdr, HDR_CONTENT_RANGE))
+	range_err = "origin server does ranges";
+#endif
+    else if (rep->content_length < 0)
+	range_err = "unknown length";
+    else if (rep->content_length != http->entry->mem_obj->getReply()->content_length)
+	range_err = "INCONSISTENT length";	/* a bug? */
+    else if (httpHeaderHas(&http->request->header, HDR_IF_RANGE) && !clientIfRangeMatch(http, rep))
+	range_err = "If-Range match failed";
+    else if (!http->request->range->canonize(rep))
+	range_err = "canonization failed";
+    else if (http->request->range->isComplex())
+	range_err = "too complex range header";
+    else if (!request->flags.cachable)	/* from we_do_ranges in http.c */
+	range_err = "non-cachable request";
+#if 0
+    else if (!logTypeIsATcpHit(http->logType); && http->request->range->offsetLimitExceeded())
+	range_err = "range outside range_offset_limit";
 #endif
-	httpReplyDestroy(rep);
-	rep = NULL;
+    /* get rid of our range specs on error */
+    if (range_err) {
+	/* XXX Why do we do this here, and not when parsing the request ? */
+	debug(33, 3) ("clientBuildRangeHeader: will not do ranges: %s.\n", range_err);
+	http->request->range->deleteSelf();
+	http->request->range = NULL;
     } else {
-	memBufDefInit(&mb);
+	const int spec_count = http->request->range->specs.count;
+	int actual_clen = -1;
+
+	debug(33, 3) ("clientBuildRangeHeader: range spec count: %d virgin clen: %d\n",
+	    spec_count, rep->content_length);
+	assert(spec_count > 0);
+	/* ETags should not be returned with Partial Content replies? */
+	httpHeaderDelById(hdr, HDR_ETAG);
+	/* append appropriate header(s) */
+	if (spec_count == 1) {
+	    HttpHdrRange::iterator pos = http->request->range->begin();
+	    assert(*pos);
+	    /* append Content-Range */
+	    if (!httpHeaderHas(hdr, HDR_CONTENT_RANGE)) {
+		/* No content range, so this was a full object we are 
+		 * sending parts of.
+		 */
+		httpHeaderAddContRange(hdr, **pos, rep->content_length);
+	    }
+	    /* set new Content-Length to the actual number of bytes
+	     * transmitted in the message-body */
+	    actual_clen = (*pos)->length;
+	} else {
+	    /* multipart! */
+	    /* generate boundary string */
+	    http->range_iter.boundary = http->rangeBoundaryStr();
+	    /* delete old Content-Type, add ours */
+	    httpHeaderDelById(hdr, HDR_CONTENT_TYPE);
+	    httpHeaderPutStrf(hdr, HDR_CONTENT_TYPE,
+		"multipart/byteranges; boundary=\"%s\"",
+		http->range_iter.boundary.buf());
+	    /* Content-Length is not required in multipart responses
+	     * but it is always nice to have one */
+	    actual_clen = http->mRangeCLen();
+	}
+
+	/* replace Content-Length header */
+	assert(actual_clen >= 0);
+	httpHeaderDelById(hdr, HDR_CONTENT_LENGTH);
+	httpHeaderPutInt(hdr, HDR_CONTENT_LENGTH, actual_clen);
+	debug(33, 3) ("clientBuildRangeHeader: actual content length: %d\n", actual_clen);
+	/* And start the range iter off */
+	http->range_iter.updateSpec();
     }
+}
+
+void
+ClientSocketContext::prepareReply(HttpReply * rep)
+{
+    if (http->request->range)
+	buildRangeHeader(rep);
+}
+
+void
+ClientSocketContext::sendStartOfMessage(HttpReply * rep, StoreIOBuffer bodyData)
+{
+    prepareReply(rep);
+    /* init mb; put status line and headers if any */
+    assert (rep);
+    MemBuf mb = httpReplyPack(rep);
+    /* Save length of headers for persistent conn checks */
+    http->out.headers_sz = mb.size;
+#if HEADERS_LOG
+    headersLog(0, 0, http->request->method, rep);
+#endif
+    httpReplyDestroy(rep);
+    rep = NULL;
     if (bodyData.data && bodyData.length) {
-	context->http->out.offset += bodyData.length;
-	memBufAppend(&mb, bodyData.data, bodyData.length);
+	if (!multipartRangeRequest()) {
+	    size_t length = lengthToSend(bodyData.length);
+	    noteSentBodyBytes (length);
+	    
+	    memBufAppend(&mb, bodyData.data, length);
+	} else {
+	    char const *t = bodyData.data;
+	    packRange(&t,
+			    bodyData.length,
+			    &mb);
+	}
     }
     /* write */
-    comm_old_write_mbuf(context->http->conn->fd, mb, clientWriteComplete, context);
+    comm_old_write_mbuf(fd(), mb, clientWriteComplete, this);
     /* if we don't do it, who will? */
 }
 
@@ -672,7 +998,7 @@ clientSocketRecipient(clientStreamNode * node, clientHttpRequest * http,
     HttpReply * rep, StoreIOBuffer recievedData)
 {
     int fd;
-    clientSocketContext *context;
+    ClientSocketContext *context;
     /* Test preconditions */
     assert(node != NULL);
     /* TODO: handle this rather than asserting 
@@ -683,21 +1009,22 @@ clientSocketRecipient(clientStreamNode * node, clientHttpRequest * http,
     assert(cbdataReferenceValid(node));
     assert(node->data != NULL);
     assert(node->node.next == NULL);
-    context = (clientSocketContext *)node->data;
+    context = (ClientSocketContext *)node->data;
     assert(connIsUsable(http->conn));
     fd = http->conn->fd;
+    /* TODO: check offset is what we asked for */
     if (connGetCurrentContext(http->conn) != context) {
-	contextDeferRecipientForLater(context, node, rep, recievedData);
+	context->deferRecipientForLater(node, rep, recievedData);
 	return;
     }
     if (responseFinishedOrFailed(rep, recievedData)) {
 	clientWriteComplete(fd, NULL, 0, COMM_OK, context);
 	return;
     }
     if (!contextStartOfOutput(context))
-	contextSendBody(context, rep, recievedData);
+	context->sendBody(rep, recievedData);
     else
-	contextSendStartOfMessage(context, rep, recievedData);
+	context->sendStartOfMessage(rep, recievedData);
 }
 
 /* Called when a downstream node is no longer interested in 
@@ -707,7 +1034,7 @@ clientSocketRecipient(clientStreamNode * node, clientHttpRequest * http,
 void
 clientSocketDetach(clientStreamNode * node, clientHttpRequest * http)
 {
-    clientSocketContext *context;
+    ClientSocketContext *context;
     /* Test preconditions */
     assert(node != NULL);
     /* TODO: handle this rather than asserting 
@@ -719,7 +1046,7 @@ clientSocketDetach(clientStreamNode * node, clientHttpRequest * http)
     /* Set null by ContextFree */
     assert(node->data == NULL);
     assert(node->node.next == NULL);
-    context = (clientSocketContext *)node->data;
+    context = (ClientSocketContext *)node->data;
     /* We are only called when the client socket shutsdown.
      * Tell the prev pipeline member we're finished
      */
@@ -749,9 +1076,9 @@ connReadNextRequest(ConnStateData * conn)
 }
 
 void
-clientSocketContextPushDeferredIfNeeded(clientSocketContext * deferredRequest, ConnStateData * conn)
+ClientSocketContextPushDeferredIfNeeded(ClientSocketContext * deferredRequest, ConnStateData * conn)
 {
-    debug(33, 2) ("clientSocketContextPushDeferredIfNeeded: FD %d Sending next\n",
+    debug(33, 2) ("ClientSocketContextPushDeferredIfNeeded: FD %d Sending next\n",
 	conn->fd);
     /* If the client stream is waiting on a socket write to occur, then */
     if (deferredRequest->flags.deferred) {
@@ -768,18 +1095,18 @@ clientSocketContextPushDeferredIfNeeded(clientSocketContext * deferredRequest, C
 }
 
 static void
-clientKeepaliveNextRequest(clientSocketContext * context)
+clientKeepaliveNextRequest(ClientSocketContext * context)
 {
     clientHttpRequest *http = context->http;
     ConnStateData *conn = http->conn;
-    clientSocketContext *deferredRequest;
+    ClientSocketContext *deferredRequest;
 
     debug(33, 3) ("clientKeepaliveNextRequest: FD %d\n", conn->fd);
     cbdataFree(context);
     if ((deferredRequest = connGetCurrentContext(conn)) == NULL)
 	connReadNextRequest(conn);
     else
-	clientSocketContextPushDeferredIfNeeded(deferredRequest, conn);
+	ClientSocketContextPushDeferredIfNeeded(deferredRequest, conn);
 }
 
 void
@@ -792,15 +1119,101 @@ clientUpdateSocketStats(log_type logType, size_t size)
 	kb_incr(&statCounter.client_http.hit_kbytes_out, size);
 }
 
+/* returns true if there is still data available to pack more ranges
+ * increments iterator "i"
+ * used by clientPackMoreRanges */
+bool
+ClientSocketContext::canPackMoreRanges() const
+{
+    /* first update "i" if needed */
+    if (!http->range_iter.debt()) {
+	debug (33,5)("ClientSocketContext::canPackMoreRanges: At end of current range spec for fd %d\n",fd());
+	if (http->range_iter.pos.incrementable())
+	    ++http->range_iter.pos;
+	http->range_iter.updateSpec();
+    }
+    assert(!http->range_iter.debt() == !http->range_iter.currentSpec());
+    /* paranoid sync condition */
+    /* continue condition: need_more_data */
+    debug (33,5)("ClientSocketContext::canPackMoreRanges: returning %d\n", http->range_iter.currentSpec() ? true : false);
+    return http->range_iter.currentSpec() ? true : false;
+}
+
+off_t
+ClientSocketContext::getNextRangeOffset() const
+{
+    if (http->request->range) {
+	/* offset in range specs does not count the prefix of an http msg */
+	debug (0,0) ("ClientSocketContext::getNextRangeOffset: http offset %lu\n", http->out.offset);
+	/* check: reply was parsed and range iterator was initialized */
+	assert(http->range_iter.valid);
+	/* filter out data according to range specs */
+	assert (canPackMoreRanges());
+	  {
+	    off_t start;		/* offset of still missing data */
+	    assert(http->range_iter.currentSpec());
+	    start = http->range_iter.currentSpec()->offset + http->range_iter.currentSpec()->length - http->range_iter.debt();
+	    debug(33, 3) ("clientPackMoreRanges: in:  offset: %ld\n",
+			  (long int) http->out.offset);
+	    debug(33, 3) ("clientPackMoreRanges: out: start: %ld spec[%ld]: [%ld, %ld), len: %ld debt: %ld\n",
+			  (long int) start, (long int) (http->range_iter.pos - http->request->range->begin()), (long int) http->range_iter.currentSpec()->offset, (long int) (http->range_iter.currentSpec()->offset + http->range_iter.currentSpec()->length), (long int) http->range_iter.currentSpec()->length, (long int) http->range_iter.debt());
+	    if (http->range_iter.currentSpec()->length != -1)
+	    assert(http->out.offset <= start);	/* we did not miss it */
+	    return start;
+	}
+#if 0
+    } else if (http->request->range->specs.count > 1) {
+	/* put terminating boundary for multiparts */
+	clientPackTermBound(i->boundary, mb);
+#endif
+    }
+
+    return http->out.offset;
+}
+
 void
-clientPullData(clientSocketContext * context)
+ClientSocketContext::pullData()
 {
+    debug (33,5)("ClientSocketContext::pullData: FD %d attempting to pull upstream data\n", fd());
     /* More data will be coming from the stream. */
-    StoreIOBuffer readBuffer = EMPTYIOBUFFER;
-    readBuffer.offset = context->http->out.offset;
+    StoreIOBuffer readBuffer;
+    /* XXX: Next requested byte in the range sequence */
+    /* XXX: length = getmaximumrangelenfgth */
+    readBuffer.offset = getNextRangeOffset();
     readBuffer.length = HTTP_REQBUF_SZ;
-    readBuffer.data = context->reqbuf;
-    clientStreamRead(getTail(context), context->http, readBuffer);
+    readBuffer.data = reqbuf;
+    /* we may note we have reached the end of the wanted ranges */
+    clientStreamRead(getTail(), http, readBuffer);
+}
+
+clientStream_status_t 
+ClientSocketContext::socketState()
+{
+    switch (clientStreamStatus(getTail(), http)) {
+      case STREAM_NONE:
+        /* check for range support ending */
+        if (http->request->range) {
+	    /* check: reply was parsed and range iterator was initialized */
+	    assert(http->range_iter.valid);
+	    /* filter out data according to range specs */
+	    if (!canPackMoreRanges()) {
+		debug (33,5)("ClientSocketContext::socketState: Range request has hit end of returnable range sequence on fd %d\n", fd());
+		if (http->request->flags.proxy_keepalive)
+		    return STREAM_COMPLETE;
+	        else
+		    return STREAM_UNPLANNED_COMPLETE;
+	    }
+	}
+	return STREAM_NONE;
+      case STREAM_COMPLETE:
+        return STREAM_COMPLETE;
+      case STREAM_UNPLANNED_COMPLETE:
+	return STREAM_UNPLANNED_COMPLETE;
+      case STREAM_FAILED:
+	return STREAM_FAILED;
+    }
+    fatal ("unreachable code\n");
+    return STREAM_NONE;
 }
 
 /* A write has just completed to the client, or we have just realised there is
@@ -809,23 +1222,23 @@ clientPullData(clientSocketContext * context)
 void
 clientWriteComplete(int fd, char *bufnotused, size_t size, comm_err_t errflag, void *data)
 {
-    clientSocketContext *context = (clientSocketContext *)data;
+    ClientSocketContext *context = (ClientSocketContext *)data;
     clientHttpRequest *http = context->http;
     StoreEntry *entry = http->entry;
-    clientStreamNode *node = getTail(context);
     http->out.size += size;
     assert(fd > -1);
     debug(33, 5) ("clientWriteComplete: FD %d, sz %ld, err %d, off %ld, len %d\n",
 	fd, (long int) size, errflag, (long int) http->out.size, entry ? objectLen(entry) : 0);
     clientUpdateSocketStats(http->logType, size);
     if (errflag || clientHttpRequestStatus(fd, http)) {
+	debug (33,5)("clientWriteComplete: FD %d, closing connection due to failure, or true requeststatus\n", fd);
 	comm_close(fd);
 	/* Do we leak here ? */
 	return;
     }
-    switch (clientStreamStatus(node, http)) {
+    switch (context->socketState()) {
     case STREAM_NONE:
-	clientPullData(context);
+	context->pullData();
 	break;
     case STREAM_COMPLETE:
 	debug(33, 5) ("clientWriteComplete: FD %d Keeping Alive\n", fd);
@@ -845,19 +1258,18 @@ extern "C" CSR clientGetMoreData;
 extern "C" CSS clientReplyStatus;
 extern "C" CSD clientReplyDetach;
 
-static clientSocketContext *
+static ClientSocketContext *
 parseHttpRequestAbort(ConnStateData * conn, const char *uri)
 {
     clientHttpRequest *http;
-    clientSocketContext *context;
-    StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
-    http = cbdataAlloc(clientHttpRequest);
+    ClientSocketContext *context;
+    StoreIOBuffer tempBuffer;
+    http = new ClientHttpRequest;
     http->conn = conn;
-    http->start = current_time;
     http->req_sz = conn->in.notYetUsed;
     http->uri = xstrdup(uri);
     setLogUri (http, uri);
-    context = clientSocketContextNew(http);
+    context = ClientSocketContextNew(http);
     tempBuffer.data = context->reqbuf;
     tempBuffer.length = HTTP_REQBUF_SZ;
     clientStreamInit(&http->client_stream, clientGetMoreData, clientReplyDetach,
@@ -867,7 +1279,7 @@ parseHttpRequestAbort(ConnStateData * conn, const char *uri)
     return context;
 }
 
-clientSocketContext *
+ClientSocketContext *
 clientCheckRequestLineIsParseable(char *inbuf, size_t req_sz, ConnStateData * conn)
 {
     if (strlen(inbuf) != req_sz) {
@@ -877,7 +1289,7 @@ clientCheckRequestLineIsParseable(char *inbuf, size_t req_sz, ConnStateData * co
     return NULL;
 }
 
-clientSocketContext *
+ClientSocketContext *
 clientParseRequestMethod(char *inbuf, method_t * method_p, ConnStateData * conn)
 {
     char *mstr = NULL;
@@ -924,7 +1336,7 @@ trimTrailingSpaces(char *aString, size_t len)
 	*(endPointer--) = '\0';
 }
 
-clientSocketContext *
+ClientSocketContext *
 parseURIandHTTPVersion(char **url_p, http_version_t * http_ver_p,
     ConnStateData * conn)
 {
@@ -961,11 +1373,11 @@ parseURIandHTTPVersion(char **url_p, http_version_t * http_ver_p,
 }
 
 /* Utility function to perform part of request parsing */
-static clientSocketContext *
+static ClientSocketContext *
 clientParseHttpRequestLine(char *inbuf, size_t req_sz, ConnStateData * conn,
     method_t * method_p, char **url_p, http_version_t * http_ver_p)
 {
-    clientSocketContext *result = NULL;
+    ClientSocketContext *result = NULL;
     if ((result = clientCheckRequestLineIsParseable(inbuf, req_sz, conn))
 	|| (result = clientParseRequestMethod(inbuf, method_p, conn))
 	|| (result = parseURIandHTTPVersion(url_p, http_ver_p, conn)))
@@ -1069,11 +1481,11 @@ prepareAcceleratedUrl(clientHttpRequest * http, char *url, char *req_hdr)
  * 
  *  Returns
  *  NULL on incomplete requests
- *  a clientSocketContext structure on success or failure.
+ *  a ClientSocketContext structure on success or failure.
  *  Sets result->flags.parsed_ok to 0 if failed to parse the request.
  *  Sets result->flags.parsed_ok to 1 if we have a good request.
  */
-static clientSocketContext *
+static ClientSocketContext *
 parseHttpRequest(ConnStateData * conn, method_t * method_p,
     char **prefix_p, size_t * req_line_sz_p)
 {
@@ -1086,8 +1498,8 @@ parseHttpRequest(ConnStateData * conn, method_t * method_p,
     size_t prefix_sz;		/* size of whole request (req-line + headers) */
     size_t req_sz;
     clientHttpRequest *http;
-    clientSocketContext *result;
-    StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+    ClientSocketContext *result;
+    StoreIOBuffer tempBuffer;
 
     /* pre-set these values to make aborting simpler */
     *prefix_p = NULL;
@@ -1134,12 +1546,11 @@ parseHttpRequest(ConnStateData * conn, method_t * method_p,
     assert(prefix_sz <= conn->in.notYetUsed);
 
     /* Ok, all headers are received */
-    http = cbdataAlloc(clientHttpRequest);
+    http = new ClientHttpRequest;
     http->http_ver = http_ver;
     http->conn = conn;
-    http->start = current_time;
     http->req_sz = prefix_sz;
-    result = clientSocketContextNew(http);
+    result = ClientSocketContextNew(http);
     tempBuffer.data = result->reqbuf;
     tempBuffer.length = HTTP_REQBUF_SZ;
     clientStreamInit(&http->client_stream, clientGetMoreData, clientReplyDetach,
@@ -1199,10 +1610,10 @@ connMakeSpaceAvailable(ConnStateData * conn)
 }
 
 void
-connAddContextToQueue(ConnStateData * conn, clientSocketContext * context)
+connAddContextToQueue(ConnStateData * conn, ClientSocketContext * context)
 {
-    clientSocketContext **S;
-    for (S = (clientSocketContext **) & conn->currentobject; *S;
+    ClientSocketContext **S;
+    for (S = (ClientSocketContext **) & conn->currentobject; *S;
 	S = &(*S)->next);
     *S = context;
     ++conn->nrequests;
@@ -1212,8 +1623,8 @@ int
 connGetConcurrentRequestCount(ConnStateData * conn)
 {
     int result = 0;
-    clientSocketContext **T;
-    for (T = (clientSocketContext **) & conn->currentobject;
+    ClientSocketContext **T;
+    for (T = (ClientSocketContext **) & conn->currentobject;
 	*T; T = &(*T)->next, ++result);
     return result;
 }
@@ -1278,8 +1689,8 @@ connKeepReadingIncompleteRequest(ConnStateData * conn)
 void
 connCancelIncompleteRequests(ConnStateData * conn)
 {
-    clientSocketContext *context = parseHttpRequestAbort(conn, "error:request-too-large");
-    clientStreamNode *node = getClientReplyContext(context);
+    ClientSocketContext *context = parseHttpRequestAbort(conn, "error:request-too-large");
+    clientStreamNode *node = context->getClientReplyContext();
     assert(!connKeepReadingIncompleteRequest(conn));
     debug(33, 1) ("Request header is too large (%u bytes)\n",
 	(unsigned) conn->in.notYetUsed);
@@ -1289,7 +1700,7 @@ connCancelIncompleteRequests(ConnStateData * conn)
 	HTTP_REQUEST_ENTITY_TOO_LARGE, METHOD_NONE, NULL,
 	&conn->peer.sin_addr, NULL, NULL, NULL);
     connAddContextToQueue(conn, context);
-    clientPullData(context);
+    context->pullData();
 }
 
 static void
@@ -1308,8 +1719,8 @@ clientAfterReadingRequests(int fd, ConnStateData *conn, int do_next_read)
 
     /* Check if a half-closed connection was aborted in the middle */
     if (F->flags.socket_eof) {
-       if (conn->in.notYetUsed != conn->body.size_left) {      /* != 0 when no
-request body */
+       if (conn->in.notYetUsed != conn->body.size_left) {
+	   /* != 0 when no request body */
            /* Partial request received. Abort client connection! */
            debug(33, 3) ("clientReadRequest: FD %d aborted, partial request\n",+                         fd);
            comm_close(fd);
@@ -1322,7 +1733,7 @@ request body */
 
 
 static void
-clientProcessRequest(ConnStateData *conn, clientSocketContext *context, method_t method, char *prefix, size_t req_line_sz)
+clientProcessRequest(ConnStateData *conn, ClientSocketContext *context, method_t method, char *prefix, size_t req_line_sz)
 {
     clientHttpRequest *http = context->http;
     request_t *request = NULL;
@@ -1333,44 +1744,43 @@ clientProcessRequest(ConnStateData *conn, clientSocketContext *context, method_t
     connAddContextToQueue(conn, context);
 
     if (context->flags.parsed_ok == 0) {
-       clientStreamNode *node = getClientReplyContext(context);
+       clientStreamNode *node = context->getClientReplyContext();
        debug(33, 1) ("clientReadRequest: Invalid Request\n");
        clientSetReplyToError(node->data,
                              ERR_INVALID_REQ, HTTP_BAD_REQUEST, method, NULL,
                              &conn->peer.sin_addr, NULL, conn->in.buf, NULL);
        assert(context->http->out.offset == 0);
-       clientPullData(context);
+       context->pullData();
        conn->flags.readMoreRequests = 0;
        return;
     }
 
     if ((request = urlParse(method, http->uri)) == NULL) {
-       clientStreamNode *node = getClientReplyContext(context);
+       clientStreamNode *node = context->getClientReplyContext();
        debug(33, 5) ("Invalid URL: %s\n", http->uri);
        clientSetReplyToError(node->data,
                              ERR_INVALID_URL, HTTP_BAD_REQUEST, method, http->uri,
                              &conn->peer.sin_addr, NULL, NULL, NULL);
        assert(context->http->out.offset == 0);
-       clientPullData(context);
+       context->pullData();
        conn->flags.readMoreRequests = 0;
        return;
-    } else {
+    } 
 
-       /* compile headers */
-       /* we should skip request line! */
-       if (!httpRequestParseHeader(request, prefix + req_line_sz))
-           debug(33, 1) ("Failed to parse request headers: %s\n%s\n",
-                         http->uri, prefix);
-       /* continue anyway? */
-    }
+    /* compile headers */
+    /* we should skip request line! */
+    if (!httpRequestParseHeader(request, prefix + req_line_sz))
+        debug(33, 1) ("Failed to parse request headers: %s\n%s\n",
+                      http->uri, prefix);
+    /* continue anyway? */
 
     request->flags.accelerated = http->flags.accel;
     if (!http->flags.internal) {
-       if (internalCheck(strBuf(request->urlpath))) {
+       if (internalCheck(request->urlpath.buf())) {
            if (internalHostnameIs(request->host) &&
                request->port == getMyPort()) {
                http->flags.internal = 1;
-           } else if (internalStaticCheck(strBuf(request->urlpath))) {
+           } else if (internalStaticCheck(request->urlpath.buf())) {
                xstrncpy(request->host, internalHostname(),
                         SQUIDHOSTNAMELEN);
                request->port = getMyPort();
@@ -1379,11 +1789,6 @@ clientProcessRequest(ConnStateData *conn, clientSocketContext *context, method_t
        }
     }
 
-    /*
-     *  cache the Content-length value in request_t.
-     */
-    request->content_length = httpHeaderGetInt(&request->header,
-                                              HDR_CONTENT_LENGTH);
     request->flags.internal = http->flags.internal;
     setLogUri (http, urlCanonicalClean(request));
     request->client_addr = conn->peer.sin_addr;
@@ -1392,24 +1797,24 @@ clientProcessRequest(ConnStateData *conn, clientSocketContext *context, method_t
     request->http_ver = http->http_ver;
     if (!urlCheckRequest(request) ||
        httpHeaderHas(&request->header, HDR_TRANSFER_ENCODING)) {
-       clientStreamNode *node = getClientReplyContext(context);
+       clientStreamNode *node = context->getClientReplyContext();
        clientSetReplyToError(node->data, ERR_UNSUP_REQ,
                              HTTP_NOT_IMPLEMENTED, request->method, NULL,
                              &conn->peer.sin_addr, request, NULL, NULL);
        assert(context->http->out.offset == 0);
-       clientPullData(context);
+       context->pullData();
        conn->flags.readMoreRequests = 0;
        return;
     }
 
 
     if (!clientIsContentLengthValid(request)) {
-       clientStreamNode *node = getClientReplyContext(context);
+       clientStreamNode *node = context->getClientReplyContext();
        clientSetReplyToError(node->data, ERR_INVALID_REQ,
                              HTTP_LENGTH_REQUIRED, request->method, NULL,
                              &conn->peer.sin_addr, request, NULL, NULL);
        assert(context->http->out.offset == 0);
-       clientPullData(context);
+       context->pullData();
        conn->flags.readMoreRequests = 0;
        return;
     }
@@ -1423,12 +1828,12 @@ clientProcessRequest(ConnStateData *conn, clientSocketContext *context, method_t
        /* Is it too large? */
        if (!clientIsRequestBodyValid(request->content_length) ||
            clientIsRequestBodyTooLargeForPolicy(request->content_length)) {
-           clientStreamNode *node = getClientReplyContext(context);
+           clientStreamNode *node = context->getClientReplyContext();
            clientSetReplyToError(node->data, ERR_TOO_BIG,
                                  HTTP_REQUEST_ENTITY_TOO_LARGE, METHOD_NONE, NULL,
                                  &conn->peer.sin_addr, http->request, NULL, NULL);
            assert(context->http->out.offset == 0);
-           clientPullData(context);
+           context->pullData();
            conn->flags.readMoreRequests = 0;
            return;
        }
@@ -1479,7 +1884,7 @@ void *data)
     conn->reading = false;
     method_t method;
     char *prefix = NULL;
-    clientSocketContext *context;
+    ClientSocketContext *context;
     int do_next_read = 1; /* the default _is_ to read data! - adrian */
 
     assert (fd == conn->fd);
@@ -1962,49 +2367,6 @@ httpsAccept(int sock, int newfd, struct sockaddr_in *me, struct sockaddr_in *pee
 
 #endif /* USE_SSL */
 
-/*
- * This function is designed to serve a fairly specific purpose.
- * Occasionally our vBNS-connected caches can talk to each other, but not
- * the rest of the world.  Here we try to detect frequent failures which
- * make the cache unusable (e.g. DNS lookup and connect() failures).  If
- * the failure:success ratio goes above 1.0 then we go into "hit only"
- * mode where we only return UDP_HIT or UDP_MISS_NOFETCH.  Neighbors
- * will only fetch HITs from us if they are using the ICP protocol.  We
- * stay in this mode for 5 minutes.
- * 
- * Duane W., Sept 16, 1996
- */
-
-static void
-checkFailureRatio(err_type etype, hier_code hcode)
-{
-    static double magic_factor = 100.0;
-    double n_good;
-    double n_bad;
-    if (hcode == HIER_NONE)
-	return;
-    n_good = magic_factor / (1.0 + request_failure_ratio);
-    n_bad = magic_factor - n_good;
-    switch (etype) {
-    case ERR_DNS_FAIL:
-    case ERR_CONNECT_FAIL:
-    case ERR_READ_ERROR:
-	n_bad++;
-	break;
-    default:
-	n_good++;
-    }
-    request_failure_ratio = n_bad / n_good;
-    if (hit_only_mode_until > squid_curtime)
-	return;
-    if (request_failure_ratio < 1.0)
-	return;
-    debug(33, 0) ("Failure Ratio at %4.2f\n", request_failure_ratio);
-    debug(33, 0) ("Going into hit-only-mode for %d minutes...\n",
-	FAILURE_MODE_TIME / 60);
-    hit_only_mode_until = squid_curtime + FAILURE_MODE_TIME;
-    request_failure_ratio = 0.8;	/* reset to something less than 1.0 */
-}
 
 static void
 clientHttpConnectionsOpen(void)
@@ -2102,10 +2464,10 @@ int
 varyEvaluateMatch(StoreEntry * entry, request_t * request)
 {
     const char *vary = request->vary_headers;
-    int has_vary = httpHeaderHas(&entry->mem_obj->reply->header, HDR_VARY);
+    int has_vary = httpHeaderHas(&entry->getReply()->header, HDR_VARY);
 #if X_ACCELERATOR_VARY
     has_vary |=
-	httpHeaderHas(&entry->mem_obj->reply->header, HDR_X_ACCELERATOR_VARY);
+	httpHeaderHas(&entry->getReply()->header, HDR_X_ACCELERATOR_VARY);
 #endif
     if (!has_vary || !entry->mem_obj->vary_headers) {
 	if (vary) {
@@ -2124,7 +2486,7 @@ varyEvaluateMatch(StoreEntry * entry, request_t * request)
 	/* virtual "vary" object found. Calculate the vary key and
 	 * continue the search
 	 */
-	vary = httpMakeVaryMark(request, entry->mem_obj->reply);
+	vary = httpMakeVaryMark(request, entry->getReply());
 	if (vary) {
 	    request->vary_headers = xstrdup(vary);
 	    return VARY_OTHER;
@@ -2135,7 +2497,7 @@ varyEvaluateMatch(StoreEntry * entry, request_t * request)
 	}
     } else {
 	if (!vary) {
-	    vary = httpMakeVaryMark(request, entry->mem_obj->reply);
+	    vary = httpMakeVaryMark(request, entry->getReply());
 	    if (vary)
 		request->vary_headers = xstrdup(vary);
 	}
@@ -1,6 +1,6 @@
 
 /*
- * $Id: client_side_reply.cc,v 1.30 2003/01/17 05:49:34 robertc Exp $
+ * $Id: client_side_reply.cc,v 1.31 2003/01/23 00:37:18 robertc Exp $
  *
  * DEBUG: section 88    Client-side Reply Routines
  * AUTHOR: Robert Collins (Originally Duane Wessels in client_side.c)
@@ -36,10 +36,16 @@
 #include "squid.h"
 #include "StoreClient.h"
 #include "Store.h"
+#include "HttpReply.h"
+#include "HttpRequest.h"
 
 #include "clientStream.h"
 #include "authenticate.h"
+#include "MemObject.h"
+#include "client_side_request.h"
 
+static STCB clientHandleIMSReply;
+static STCB clientSendMoreData;
 class clientReplyContext : public StoreClient {
 public:
     void *operator new (size_t byteCount);
@@ -53,6 +59,7 @@ class clientReplyContext : public StoreClient {
     void purgeFoundGet(StoreEntry *newEntry);
     void purgeFoundHead(StoreEntry *newEntry);
     void purgeFoundObject(StoreEntry *entry);
+    void sendClientUpstreamResponse();
     void purgeDoPurgeGet(StoreEntry *entry);
     void purgeDoPurgeHead(StoreEntry *entry);
     void doGetMoreData();
@@ -82,40 +89,53 @@ class clientReplyContext : public StoreClient {
     struct {
 	int storelogiccomplete:1;
 	int complete:1;		/* we have read all we can from upstream */
-	int headersSent:1;
+	bool headersSent;
     } flags;
     clientStreamNode *ourNode;	/* This will go away if/when this file gets refactored some more */
 private:
-    clientStreamNode *getNextNode();
+    friend void clientSendMoreData(void *data, StoreIOBuffer result);
+    friend void clientHandleIMSReply(void *data, StoreIOBuffer result);
+    static STCB clientSendMoreData;
+    clientStreamNode *getNextNode() const;
+    void sendMoreData (StoreIOBuffer result);
+    void makeThisHead();
+    bool errorInStream(StoreIOBuffer const &result, size_t const &sizeToProcess)const ;
+    void sendStreamError(StoreIOBuffer const &result);
+    void pushStreamData(StoreIOBuffer const &result, char *source);
+    void waitForMoreData (StoreIOBuffer const &result);
+    clientStreamNode * next() const;
+    void startSendProcess();
+
 };
 
 CBDATA_TYPE(clientReplyContext);
 
 /* Local functions */
 static int clientGotNotEnough(clientHttpRequest const *);
-static int clientReplyBodyTooLarge(HttpReply *, ssize_t);
+static int clientReplyBodyTooLarge(HttpReply const *, ssize_t);
 static int clientOnlyIfCached(clientHttpRequest * http);
 static void clientProcessExpired(clientReplyContext *);
 static void clientProcessMiss(clientReplyContext *);
 static STCB clientCacheHit;
 static void clientProcessOnlyIfCachedMiss(clientReplyContext *);
 static int clientGetsOldEntry(StoreEntry *, StoreEntry * old,
     request_t * request);
-static STCB clientHandleIMSReply;
+
 static int modifiedSince(StoreEntry *, request_t *);
 static void clientTraceReply(clientStreamNode *, clientReplyContext *);
 static StoreEntry *clientCreateStoreEntry(clientReplyContext *, method_t,
     request_flags);
-static STCB clientSendMoreData;
+
 static void clientRemoveStoreReference(clientReplyContext *, store_client **,
     StoreEntry **);
 extern "C" CSS clientReplyStatus;
 extern ErrorState *clientBuildError(err_type, http_status, char const *,
     struct in_addr *, request_t *);
 
 static void startError(clientReplyContext * context, clientHttpRequest * http, ErrorState * err);
-static void triggerStoreReadWithClientParameters(clientReplyContext * context, clientHttpRequest * http);
+static void triggerInitialStoreReadWithClientParameters(clientReplyContext * context, clientHttpRequest * http);
 static int clientCheckTransferDone(clientReplyContext * context);
+static void clientObeyConnectionHeader(clientHttpRequest * http, HttpReply * rep);
 
 /* The clientReply clean interface */
 /* privates */
@@ -204,7 +224,7 @@ void
 clientReplyContext::saveState(clientHttpRequest * http)
 {
     assert(old_sc == NULL);
-    debug(88, 1) ("clientReplyContext::saveState: saving store context\n");
+    debug(88, 1)("clientReplyContext::saveState: saving store context");
     http->old_entry = http->entry;
     old_sc = sc;
     old_reqsize = reqsize;
@@ -220,7 +240,7 @@ void
 clientReplyContext::restoreState(clientHttpRequest * http)
 {
     assert(old_sc != NULL);
-    debug(88, 1) ("clientReplyContext::restoreState: Restoring store context\n");
+    debug(88, 1)("clientReplyContext::restoreState: Restoring store context");
     http->entry = http->old_entry;
     sc = old_sc;
     reqsize = old_reqsize;
@@ -236,24 +256,31 @@ void
 startError(clientReplyContext * context, clientHttpRequest * http, ErrorState * err)
 {
     http->entry = clientCreateStoreEntry(context, http->request->method, request_flags());
-    triggerStoreReadWithClientParameters(context, http);
+    triggerInitialStoreReadWithClientParameters(context, http);
     errorAppendEntry(http->entry, err);
 }
 
 clientStreamNode *
-clientReplyContext::getNextNode()
+clientReplyContext::getNextNode() const
 {
     return (clientStreamNode *)ourNode->node.next->data; 
 }
 
+/* This function is wrong - the client parameters don't include the 
+ * header offset
+ */
 void
-triggerStoreReadWithClientParameters(clientReplyContext * context, clientHttpRequest * http)
+triggerInitialStoreReadWithClientParameters(clientReplyContext * context, clientHttpRequest * http)
 {
     clientStreamNode *next = (clientStreamNode *)http->client_stream.head->next->data;
-    StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+    StoreIOBuffer tempBuffer;
     /* collapse this to one object if we never tickle the assert */
     assert(context->http == http);
-    tempBuffer.offset = next->readBuffer.offset;
+    /* when confident, 0 becomes context->reqofs, and then this factors into
+     * startSendProcess 
+     */
+    assert(context->reqofs == 0);
+    tempBuffer.offset = 0;
     tempBuffer.length = next->readBuffer.length;
     tempBuffer.data = next->readBuffer.data;
     storeClientCopy(context->sc, http->entry, tempBuffer, clientSendMoreData, context);
@@ -268,7 +295,7 @@ clientProcessExpired(clientReplyContext * context)
     clientHttpRequest *http = context->http;
     char *url = http->uri;
     StoreEntry *entry = NULL;
-    debug(88, 3) ("clientProcessExpired: '%s'\n", http->uri);
+    debug(88, 3)("clientProcessExpired: '%s'", http->uri);
     assert(http->entry->lastmod >= 0);
     /*
      * check if we are allowed to contact other servers
@@ -296,16 +323,16 @@ clientProcessExpired(clientReplyContext * context)
     delaySetStoreClient(context->sc, delayClient(http));
 #endif
     http->request->lastmod = http->old_entry->lastmod;
-    debug(88, 5) ("clientProcessExpired: lastmod %ld\n",
+    debug(88, 5)("clientProcessExpired : lastmod %ld",
 	(long int) entry->lastmod);
     http->entry = entry;
     assert(http->out.offset == 0);
     fwdStart(http->conn ? http->conn->fd : -1, http->entry, http->request);
     /* Register with storage manager to receive updates when data comes in. */
     if (EBIT_TEST(entry->flags, ENTRY_ABORTED))
-	debug(88, 0) ("clientProcessExpired: found ENTRY_ABORTED object\n");
+	debug(88, 0) ("clientProcessExpired: Found ENTRY_ABORTED object");
     {
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+	StoreIOBuffer tempBuffer;
 	/* start counting the length from 0 */
 	tempBuffer.offset = 0;
 	tempBuffer.length = HTTP_REQBUF_SZ;
@@ -319,7 +346,6 @@ int
 modifiedSince(StoreEntry * entry, request_t * request)
 {
     int object_length;
-    MemObject *mem = entry->mem_obj;
     time_t mod_time = entry->lastmod;
     debug(88, 3) ("modifiedSince: '%s'\n", storeUrl(entry));
     if (mod_time < 0)
@@ -328,7 +354,7 @@ modifiedSince(StoreEntry * entry, request_t * request)
     if (mod_time < 0)
 	return 1;
     /* Find size of the object */
-    object_length = mem->reply->content_length;
+    object_length = entry->getReply()->content_length;
     if (object_length < 0)
 	object_length = contentLen(entry);
     if (mod_time > request->ims) {
@@ -353,7 +379,7 @@ static int
 clientGetsOldEntry(StoreEntry * new_entry, StoreEntry * old_entry,
     request_t * request)
 {
-    const http_status status = new_entry->mem_obj->reply->sline.status;
+    const http_status status = new_entry->getReply()->sline.status;
     if (0 == status) {
 	debug(88, 5) ("clientGetsOldEntry: YES, broken HTTP reply\n");
 	return 1;
@@ -370,6 +396,20 @@ clientGetsOldEntry(StoreEntry * new_entry, StoreEntry * old_entry,
 	debug(88, 5) ("clientGetsOldEntry: NO, reply=%d\n", status);
 	return 0;
     }
+    /* If key metadata in the reply are not consistent with the
+     * old entry, we must use the new reply.
+     * Note: this means that the server is sending garbage replies 
+     * in that it has sent an IMS that is incompatible with our request!?
+     */
+    /* This is a duplicate call through the HandleIMS code path.
+     * Can we guarantee we don't need it elsewhere?
+     */
+    if (!httpReplyValidatorsMatch(new_entry->getReply(),
+                                 old_entry->getReply())) {
+       debug(88, 5) ("clientGetsOldEntry: NO, Old object has invalidated"
+                     "by the new one\n");
+       return 0;
+    }
     /* If the client did not send IMS in the request, then it
      * must get the old object, not this "Not Modified" reply */
     if (!request->flags.ims) {
@@ -387,13 +427,31 @@ clientGetsOldEntry(StoreEntry * new_entry, StoreEntry * old_entry,
     return 0;
 }
 
+void
+clientReplyContext::sendClientUpstreamResponse()
+{
+    StoreIOBuffer tempresult;
+    http->logType = LOG_TCP_REFRESH_MISS;
+    clientRemoveStoreReference(this, &old_sc, &http->old_entry);
+    /* here the data to send is the data we just recieved */
+    tempBuffer.offset = 0;
+    old_reqsize = 0;
+    /* clientSendMoreData tracks the offset as well.
+     * Force it back to zero */
+    reqofs = 0;
+    assert(!EBIT_TEST(http->entry->flags, ENTRY_ABORTED));
+    /* TODO: provide SendMoreData with the ready parsed reply */
+    tempresult.length = reqsize;
+    tempresult.data = tempbuf;
+    clientSendMoreData(this, tempresult);
+}
+
 void
 clientHandleIMSReply(void *data, StoreIOBuffer result)
 {
     clientReplyContext *context = (clientReplyContext *)data;
     clientHttpRequest *http = context->http;
     StoreEntry *entry = http->entry;
-    MemObject *mem;
     const char *url = storeUrl(entry);
     int unlink_request = 0;
     StoreEntry *oldentry;
@@ -408,9 +466,7 @@ clientHandleIMSReply(void *data, StoreIOBuffer result)
     }
     /* update size of the request */
     context->reqsize = result.length + context->reqofs;
-    context->reqofs = context->reqsize;
-    mem = entry->mem_obj;
-    status = mem->reply->sline.status;
+    status = entry->getReply()->sline.status;
     if (EBIT_TEST(entry->flags, ENTRY_ABORTED)) {
 	debug(88, 3) ("clientHandleIMSReply: ABORTED '%s'\n", url);
 	/* We have an existing entry, but failed to validate it */
@@ -426,7 +482,7 @@ clientHandleIMSReply(void *data, StoreIOBuffer result)
 	/* more headers needed to decide */
 	debug(88, 3) ("clientHandleIMSReply: Incomplete headers for '%s'\n",
 	    url);
-	if (result.length + context->reqofs >= HTTP_REQBUF_SZ) {
+	if (result.length + context->reqsize >= HTTP_REQBUF_SZ) {
 	    /* will not get any bigger than that */
 	    debug(88, 3)
 		("clientHandleIMSReply: Reply is too large '%s', using old entry\n",
@@ -439,33 +495,28 @@ clientHandleIMSReply(void *data, StoreIOBuffer result)
 	    context->restoreState(http);
 	    entry = http->entry;
 	} else {
-	    StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
-	    tempBuffer.offset = context->reqofs;
-	    tempBuffer.length = HTTP_REQBUF_SZ - context->reqofs;
-	    tempBuffer.data = context->tempbuf + context->reqofs;
-	    storeClientCopy(context->sc, entry,
-		tempBuffer,
-		clientHandleIMSReply, context);
+	    context->waitForMoreData(result);
 	}
 	return;
     }
     if (clientGetsOldEntry(entry, http->old_entry, http->request)) {
-	/* We initiated the IMS request, the client is not expecting
+	/* We initiated the IMS request and the IMS is compatible with
+	 * our object. As the client is not expecting
 	 * 304, so put the good one back.  First, make sure the old entry
 	 * headers have been loaded from disk. */
 	clientStreamNode *next = (clientStreamNode *)context->http->client_stream.head->next->data;
-	StoreIOBuffer tempresult = EMPTYIOBUFFER;
+	StoreIOBuffer tempresult;
 	oldentry = http->old_entry;
 	http->logType = LOG_TCP_REFRESH_HIT;
 	if (oldentry->mem_obj->request == NULL) {
-	    oldentry->mem_obj->request = requestLink(mem->request);
+	    oldentry->mem_obj->request = requestLink(entry->mem_obj->request);
 	    unlink_request = 1;
 	}
 	/* Don't memcpy() the whole reply structure here.  For example,
 	 * www.thegist.com (Netscape/1.13) returns a content-length for
 	 * 304's which seems to be the length of the 304 HEADERS!!! and
 	 * not the body they refer to.  */
-	httpReplyUpdateOnNotModified(oldentry->mem_obj->reply, mem->reply);
+	httpReplyUpdateOnNotModified((HttpReply *)oldentry->getReply(), entry->getReply());
 	storeTimestampsSet(oldentry);
 	clientRemoveStoreReference(context, &context->sc, &entry);
 	oldentry->timestamp = squid_curtime;
@@ -482,15 +533,31 @@ clientHandleIMSReply(void *data, StoreIOBuffer result)
 	tempresult.data = next->readBuffer.data;
 	clientSendMoreData(context, tempresult);
 	return;
-    }
-    debug(88, 3) ("clientHandleIMSReply: Sending client the IMS reply for '%s'\n", url);
-    {
-	/* the client can handle this reply, whatever it is */
-	StoreIOBuffer tempresult = EMPTYIOBUFFER;
+    } else {
+	/* The client gets the new entry,
+	 * either as a 304 (they initiated the IMS) or
+	 * as a full request from the upstream
+	 * The new entry is *not* a 304 reply, or
+	 * is a 304 that is incompatible with our cached entities.
+	 */
+	if (http->request->flags.ims) {
+	    /* The client asked for a IMS, and can deal
+	     * with any reply
+	     * XXX TODO: invalidate our object if it's not valid any more.
+	     * Send the IMS reply to the client.
+	     */
+	    context->sendClientUpstreamResponse();
+	} else if (httpReplyValidatorsMatch (entry->getReply(),
+	    http->old_entry->getReply())) {
+	    /* Our object is usable once updated */
+	    /* the client did not ask for IMS, send the whole object
+	     */
+	    /* the client needs to get this reply */
+	StoreIOBuffer tempresult;
 	http->logType = LOG_TCP_REFRESH_MISS;
-	if (HTTP_NOT_MODIFIED == mem->reply->sline.status) {
-	    httpReplyUpdateOnNotModified(http->old_entry->mem_obj->reply,
-		mem->reply);
+	if (HTTP_NOT_MODIFIED == entry->getReply()->sline.status) {
+	    httpReplyUpdateOnNotModified((HttpReply *)http->old_entry->getReply(),
+		entry->getReply());
 	    storeTimestampsSet(http->old_entry);
 	    http->logType = LOG_TCP_REFRESH_HIT;
 	}
@@ -506,7 +573,22 @@ clientHandleIMSReply(void *data, StoreIOBuffer result)
 	tempresult.length = context->reqsize;
 	tempresult.data = context->tempbuf;
 	clientSendMoreData(context, tempresult);
-	return;
+       } else {
+	   /* the client asked for the whole object, and 
+	    * 1) our object was stale
+	    * 2) our internally generated IMS failed to validate
+	    * 3) the server sent incompatible headers in it's reply
+	    */
+	   http->logType = LOG_TCP_REFRESH_MISS;
+	   clientProcessMiss(context);
+           /* We start over for everything except IMS because:
+            * 1) HEAD requests will go straight through now
+            * 2) GET requests will go straight through now
+            * 3) IMS requests are a corner case. If the server
+            * decided to give us different data, we should give
+            * that to the client, which means returning our IMS request.
+            */
+       }
     }
 }
 
@@ -526,7 +608,6 @@ clientCacheHit(void *data, StoreIOBuffer result)
     clientReplyContext *context = (clientReplyContext *)data;
     clientHttpRequest *http = context->http;
     StoreEntry *e = http->entry;
-    MemObject *mem;
     request_t *r = http->request;
     debug(88, 3) ("clientCacheHit: %s, %ud bytes\n", http->uri, (unsigned int)result.length);
     if (http->entry == NULL) {
@@ -549,11 +630,10 @@ clientCacheHit(void *data, StoreIOBuffer result)
 	clientProcessMiss(context);
 	return;
     }
-    mem = e->mem_obj;
     assert(!EBIT_TEST(e->flags, ENTRY_ABORTED));
     /* update size of the request */
     context->reqsize = result.length + context->reqofs;
-    if (mem->reply->sline.status == 0) {
+    if (e->getReply()->sline.status == 0) {
 	/*
 	 * we don't have full reply headers yet; either wait for more or
 	 * punt to clientProcessMiss.
@@ -565,7 +645,7 @@ clientCacheHit(void *data, StoreIOBuffer result)
 	    clientProcessMiss(context);
 	} else {
 	    clientStreamNode *next;
-	    StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+	    StoreIOBuffer tempBuffer;
 	    debug(88, 3) ("clientCacheHit: waiting for HTTP reply headers\n");
 	    context->reqofs += result.length;
 	    assert(context->reqofs <= HTTP_REQBUF_SZ);
@@ -620,15 +700,6 @@ clientCacheHit(void *data, StoreIOBuffer result)
     if (storeCheckNegativeHit(e)) {
 	http->logType = LOG_TCP_NEGATIVE_HIT;
 	clientSendMoreData(context, result);
-    } else if (r->method == METHOD_HEAD) {
-	/*
-	 * RFC 2068 seems to indicate there is no "conditional HEAD"
-	 * request.  We cannot validate a cached object for a HEAD
-	 * request, nor can we return 304.
-	 */
-	if (e->mem_status == IN_MEMORY)
-	    http->logType = LOG_TCP_MEM_HIT;
-	clientSendMoreData(context, result);
     } else if (!Config.onoff.offline && refreshCheckHTTP(e, r) && !http->flags.internal) {
 	debug(88, 5) ("clientCacheHit: in refreshCheck() block\n");
 	/*
@@ -675,17 +746,17 @@ clientCacheHit(void *data, StoreIOBuffer result)
 	/*
 	 * Handle If-Modified-Since requests from the client
 	 */
-	if (mem->reply->sline.status != HTTP_OK) {
+	if (e->getReply()->sline.status != HTTP_OK) {
 	    debug(88, 4) ("clientCacheHit: Reply code %d != 200\n",
-		mem->reply->sline.status);
+		e->getReply()->sline.status);
 	    http->logType = LOG_TCP_MISS;
 	    clientProcessMiss(context);
 	} else if (modifiedSince(e, http->request)) {
 	    http->logType = LOG_TCP_IMS_HIT;
 	    clientSendMoreData(context, result);
 	} else {
 	    time_t timestamp = e->timestamp;
-	    MemBuf mb = httpPacked304Reply(e->mem_obj->reply);
+	    HttpReply *temprep = httpReplyMake304 (e->getReply());
 	    http->logType = LOG_TCP_IMS_HIT;
 	    clientRemoveStoreReference(context, &context->sc, &http->entry);
 	    http->entry = e =
@@ -696,15 +767,13 @@ clientCacheHit(void *data, StoreIOBuffer result)
 	     * reply has a meaningful Age: header.
 	     */
 	    e->timestamp = timestamp;
-	    httpReplyParse(e->mem_obj->reply, mb.buf, mb.size);
-	    storeAppend(e, mb.buf, mb.size);
-	    memBufClean(&mb);
-	    storeComplete(e);
+	    httpReplySwapOut (temprep, e);
+	    e->complete();
 	    /* TODO: why put this in the store and then serialise it and then parse it again.
 	     * Simply mark the request complete in our context and
 	     * write the reply struct to the client side
 	     */
-	    triggerStoreReadWithClientParameters(context, http);
+	    triggerInitialStoreReadWithClientParameters(context, http);
 	}
     } else {
 	/*
@@ -762,12 +831,12 @@ clientProcessMiss(clientReplyContext * context)
 	http->entry =
 	    clientCreateStoreEntry(context, r->method, request_flags());
 	errorAppendEntry(http->entry, err);
-	triggerStoreReadWithClientParameters(context, http);
+	triggerInitialStoreReadWithClientParameters(context, http);
 	return;
     } else {
 	assert(http->out.offset == 0);
 	http->entry = clientCreateStoreEntry(context, r->method, r->flags);
-	triggerStoreReadWithClientParameters(context, http);
+	triggerInitialStoreReadWithClientParameters(context, http);
 	if (http->redirect.status) {
 	    HttpReply *rep = httpReplyCreate();
 #if LOG_TCP_REDIRECTS
@@ -777,8 +846,7 @@ clientProcessMiss(clientReplyContext * context)
 	    httpRedirectReply(rep, http->redirect.status,
 		http->redirect.location);
 	    httpReplySwapOut(rep, http->entry);
-	    httpReplyDestroy(rep);
-	    storeComplete(http->entry);
+	    http->entry->complete();
 	    return;
 	}
 	if (http->flags.internal)
@@ -856,7 +924,7 @@ void
 clientReplyContext::purgeFoundObject(StoreEntry *entry)
 {
     assert (entry && !entry->isNull());
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+	StoreIOBuffer tempBuffer;
 	/* Swap in the metadata */
 	http->entry = entry;
 	storeLockObject(http->entry);
@@ -953,15 +1021,18 @@ clientReplyContext::purgeDoPurgeHead(StoreEntry *newEntry)
      * Make a new entry to hold the reply to be written
      * to the client.
      */
+    /* FIXME: This doesn't need to go through the store. Simply
+     * push down the client chain
+     */
     http->entry =
 	clientCreateStoreEntry(this, http->request->method,
 	request_flags());
-    triggerStoreReadWithClientParameters(this, http);
-    httpReplyReset(r = http->entry->mem_obj->reply);
+    triggerInitialStoreReadWithClientParameters(this, http);
+    r = httpReplyCreate();
     httpBuildVersion(&version, 1, 0);
     httpReplySetHeaders(r, version, purgeStatus, NULL, NULL, 0, 0, -1);
     httpReplySwapOut(r, http->entry);
-    storeComplete(http->entry);
+    http->entry->complete();
 }
 
 void
@@ -970,7 +1041,7 @@ clientTraceReply(clientStreamNode * node, clientReplyContext * context)
     HttpReply *rep;
     http_version_t version;
     clientStreamNode *next = (clientStreamNode *)node->node.next->data;
-    StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+    StoreIOBuffer tempBuffer;
     assert(context->http->request->max_forwards == 0);
     context->http->entry =
 	clientCreateStoreEntry(context, context->http->request->method,
@@ -987,9 +1058,8 @@ clientTraceReply(clientStreamNode * node, clientReplyContext * context)
     httpReplySetHeaders(rep, version, HTTP_OK, NULL, "text/plain",
 	httpRequestPrefixLen(context->http->request), 0, squid_curtime);
     httpReplySwapOut(rep, context->http->entry);
-    httpReplyDestroy(rep);
     httpRequestSwapOut(context->http->request, context->http->entry);
-    storeComplete(context->http->entry);
+    context->http->entry->complete();
 }
 
 #define SENDING_BODY 0
@@ -1037,7 +1107,7 @@ clientReplyContext::storeNotOKTransferDone() const
     assert(mem != NULL);
     assert(http->request != NULL);
     /* mem->reply was wrong because it uses the UPSTREAM header length!!! */
-    http_reply *reply = mem->reply;
+    http_reply const *reply = mem->getReply();
     if (headers_sz == 0)
 	/* haven't found end of headers yet */
 	return 0;
@@ -1069,7 +1139,7 @@ int
 clientGotNotEnough(clientHttpRequest const *http)
 {
     int cl =
-    httpReplyBodySize(http->request->method, http->entry->mem_obj->reply);
+    httpReplyBodySize(http->request->method, http->entry->mem_obj->getReply());
     assert(cl >= 0);
     if (http->out.offset < cl)
 	return 1;
@@ -1139,7 +1209,7 @@ clientReplyStatus(clientStreamNode * aNode, clientHttpRequest * http)
 	debug(88, 5) ("clientReplyStatus: transfer is DONE\n");
 	/* Ok we're finished, but how? */
 	if (httpReplyBodySize(http->request->method,
-		http->entry->mem_obj->reply) < 0) {
+		http->entry->getReply()) < 0) {
 	    debug(88, 5) ("clientReplyStatus: closing, content_length < 0\n");
 	    return STREAM_FAILED;
 	}
@@ -1158,7 +1228,7 @@ clientReplyStatus(clientStreamNode * aNode, clientHttpRequest * http)
 	debug(88, 5) ("clientReplyStatus: stream was not expected to complete!\n");
 	return STREAM_UNPLANNED_COMPLETE;
     }
-    if (clientReplyBodyTooLarge(http->entry->mem_obj->reply, http->out.offset)) {
+    if (clientReplyBodyTooLarge(http->entry->getReply(), http->out.offset)) {
 	debug(88, 5) ("clientReplyStatus: client reply body is too large\n");
 	return STREAM_FAILED;
     }
@@ -1191,6 +1261,32 @@ clientAlwaysAllowResponse(http_status sline)
     }
 }
 
+void
+clientObeyConnectionHeader(clientHttpRequest * http, HttpReply * rep)
+{
+    HttpHeader *hdr = &rep->header;
+    if (httpHeaderHas(hdr, HDR_CONNECTION)) {
+       /* anything that matches Connection list member will be deleted */
+       String strConnection = httpHeaderGetList(hdr, HDR_CONNECTION);
+       const HttpHeaderEntry *e;
+       HttpHeaderPos pos = HttpHeaderInitPos;
+       /*
+        * think: on-average-best nesting of the two loops (hdrEntry
+        * and strListItem) @?@
+        */
+       /*
+        * maybe we should delete standard stuff ("keep-alive","close")
+        * from strConnection first?
+        */
+       while ((e = httpHeaderGetEntry(hdr, &pos))) {
+           if (strListIsMember(&strConnection, e->name.buf(), ','))
+               httpHeaderDelAt(hdr, pos);
+       }
+       httpHeaderDelById(hdr, HDR_CONNECTION);
+       strConnection.clean();
+    }
+}
+
 /*
  * filters out unwanted entries from original reply header
  * adds extra entries if we have more info than origin server
@@ -1214,27 +1310,9 @@ clientBuildReplyHeader(clientReplyContext *context, HttpReply * rep)
     /* remove Set-Cookie if a hit */
     if (is_hit)
 	httpHeaderDelById(hdr, HDR_SET_COOKIE);
-    /* handle Connection header */
-    if (httpHeaderHas(hdr, HDR_CONNECTION)) {
-	/* anything that matches Connection list member will be deleted */
-	String strConnection = httpHeaderGetList(hdr, HDR_CONNECTION);
-	const HttpHeaderEntry *e;
-	HttpHeaderPos pos = HttpHeaderInitPos;
-	/*
-	 * think: on-average-best nesting of the two loops (hdrEntry
-	 * and strListItem) @?@
-	 */
-	/*
-	 * maybe we should delete standard stuff ("keep-alive","close")
-	 * from strConnection first?
-	 */
-	while ((e = httpHeaderGetEntry(hdr, &pos))) {
-	    if (strListIsMember(&strConnection, strBuf(e->name), ','))
-		httpHeaderDelAt(hdr, pos);
-	}
-	httpHeaderDelById(hdr, HDR_CONNECTION);
-	stringClean(&strConnection);
-    }
+    clientObeyConnectionHeader(http, rep);
+//    if (request->range)
+//      clientBuildRangeHeader(http, rep);
     /*
      * Add a estimated Age header on cache hits.
      */
@@ -1260,9 +1338,26 @@ clientBuildReplyHeader(clientReplyContext *context, HttpReply * rep)
 	    (void) 0;
 	else if (http->entry->timestamp < 0)
 	    (void) 0;
-	else if (http->entry->timestamp < squid_curtime)
+	else if (http->entry->timestamp < squid_curtime) {
 	    httpHeaderPutInt(hdr, HDR_AGE,
 		squid_curtime - http->entry->timestamp);
+           /* Signal old objects.  NB: rfc 2616 is not clear,
+            * by implication, on whether we should do this to all
+            * responses, or only cache hits.
+            * 14.46 states it ONLY applys for heuristically caclulated
+            * freshness values, 13.2.4 doesn't specify the same limitation.
+            * We interpret RFC 2616 under the combination.
+            */
+           /* TODO: if maxage or s-maxage is present, don't do this */
+           if (squid_curtime - http->entry->timestamp >= 86400) {
+               char tempbuf[512];
+               snprintf (tempbuf, sizeof(tempbuf), "%s %s %s",
+                         "113", ThisCache,
+                         "This cache hit is still fresh and more than 1 day old");
+               httpHeaderPutStr(hdr, HDR_WARNING, tempbuf);
+           }
+       }
+
     }
     /* Filter unproxyable authentication types */
     if (http->logType != LOG_TCP_DENIED &&
@@ -1271,7 +1366,7 @@ clientBuildReplyHeader(clientReplyContext *context, HttpReply * rep)
 	HttpHeaderEntry *e;
 	while ((e = httpHeaderGetEntry(hdr, &pos))) {
 	    if (e->id == HDR_WWW_AUTHENTICATE || e->id == HDR_PROXY_AUTHENTICATE) {
-		const char *value = strBuf(e->value);
+		const char *value = e->value.buf();
 		if ((strncasecmp(value, "NTLM", 4) == 0 &&
 			(value[4] == '\0' || value[4] == ' '))
 		    ||
@@ -1310,8 +1405,8 @@ clientBuildReplyHeader(clientReplyContext *context, HttpReply * rep)
 	    ThisCache);
 	strListAdd(&strVia, bbuf, ',');
 	httpHeaderDelById(hdr, HDR_VIA);
-	httpHeaderPutStr(hdr, HDR_VIA, strBuf(strVia));
-	stringClean(&strVia);
+	httpHeaderPutStr(hdr, HDR_VIA, strVia.buf());
+	strVia.clean();
     }
     /* Signal keep-alive if needed */
     httpHeaderPutStr(hdr,
@@ -1345,6 +1440,13 @@ clientBuildReply(clientReplyContext *context, const char *buf, size_t size)
 	/* parsing failure, get rid of the invalid reply */
 	httpReplyDestroy(rep);
 	rep = NULL;
+       /* This is wrong. httpReplyDestroy should to the rep
+        * for us, and we can destroy our own range info
+        */
+       if (context->http->request->range) {
+           /* this will fail and destroy request->range */
+//          clientBuildRangeHeader(context->http, rep);
+       }
     }
     return rep;
 }
@@ -1370,6 +1472,7 @@ clientReplyContext::identifyFoundObject(StoreEntry *newEntry)
     } else {
 	http->entry = e;
     }
+    e = http->entry;
     /* Release negatively cached IP-cache entries on reload */
     if (r->flags.nocache)
 	ipcacheInvalidate(r->host);
@@ -1432,7 +1535,13 @@ clientReplyContext::identifyFoundObject(StoreEntry *newEntry)
 	return;
     }
     /* We don't cache any range requests (for now!) -- adrian */
+    /* RBC - and we won't until the store supports sparse objects.
+     * I suspec this test is incorrect though, as we can extract ranges from
+     * a fully cached object
+     */
     if (r->flags.range) {
+	/* XXX: test to see if we can satisfy the range with the cached object */
+        debug(85, 3) ("clientProcessRequest2: force MISS due to range presence\n");
 	http->entry = NULL;
 	http->logType = LOG_TCP_MISS;
 	doGetMoreData();
@@ -1470,7 +1579,7 @@ clientGetMoreData(clientStreamNode * aNode, clientHttpRequest * http)
 	context->ourNode = aNode;
     /* no cbdatareference, this is only used once, and safely */
     if (context->flags.storelogiccomplete) {
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+	StoreIOBuffer tempBuffer;
 	tempBuffer.offset = next->readBuffer.offset + context->headers_sz;
 	tempBuffer.length = next->readBuffer.length;
 	tempBuffer.data = next->readBuffer.data;
@@ -1501,7 +1610,7 @@ clientReplyContext::doGetMoreData()
     /* We still have to do store logic processing - vary, cache hit etc */
     if (http->entry != NULL) {
 	/* someone found the object in the cache for us */
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+	StoreIOBuffer tempBuffer;
 	storeLockObject(http->entry);
 	if (http->entry->mem_obj == NULL) {
 	    /*
@@ -1554,119 +1663,196 @@ clientReplyDetach(clientStreamNode * node, clientHttpRequest * http)
  */
 void
 clientSendMoreData(void *data, StoreIOBuffer result)
+{
+    clientReplyContext::clientSendMoreData (data, result);
+}
+
+void
+clientReplyContext::clientSendMoreData (void *data, StoreIOBuffer result)
 {
     clientReplyContext *context = static_cast<clientReplyContext *>(data);
-    clientHttpRequest *http = context->http;
-    clientStreamNode *next = (clientStreamNode*)http->client_stream.head->next->data;
+    context->sendMoreData (result);
+}
+
+void
+clientReplyContext::makeThisHead()
+{
+    /* At least, I think thats what this does */
+    dlinkDelete(&http->active, &ClientActiveRequests);
+    dlinkAdd(http, &http->active, &ClientActiveRequests);
+}
+
+bool
+clientReplyContext::errorInStream(StoreIOBuffer const &result, size_t const &sizeToProcess)const
+{
+    return /* aborted request */
+	(http->entry && EBIT_TEST(http->entry->flags, ENTRY_ABORTED)) ||
+	/* Upstream read error */ (result.flags.error) ||
+	/* Upstream EOF */ (sizeToProcess == 0);
+}
+
+void
+clientReplyContext::sendStreamError(StoreIOBuffer const &result)
+{
+    /* call clientWriteComplete so the client socket gets closed */
+    /* We call into the stream, because we don't know that there is a
+     * client socket!
+     */
+    debug(88,5)("clientReplyContext::sendStreamError: A stream error has occured, marking as complete and sending no data.\n");
+    StoreIOBuffer tempBuffer;
+    flags.complete = 1;
+    tempBuffer.flags.error = result.flags.error;
+    clientStreamCallback((clientStreamNode*)http->client_stream.head->data, http, NULL,
+	tempBuffer);
+}
+
+void
+clientReplyContext::pushStreamData(StoreIOBuffer const &result, char *source)
+{
+    StoreIOBuffer tempBuffer;
+    if (result.length == 0) {
+	debug (88,5)("clientReplyContext::pushStreamData: marking request as complete due to 0 length store result\n");
+	flags.complete = 1;
+    }
+    /* REMOVE ME: Only useful for two node streams */
+    assert(result.offset - headers_sz == ((clientStreamNode *) http->client_stream.tail->data)->readBuffer.offset);
+    tempBuffer.offset = result.offset - headers_sz;
+    tempBuffer.length = result.length;
+    tempBuffer.data = source;
+    clientStreamCallback((clientStreamNode*)http->client_stream.head->data, http, NULL,
+	tempBuffer);
+}
+
+clientStreamNode *
+clientReplyContext::next() const
+{
+    assert ( (clientStreamNode*)http->client_stream.head->next->data == getNextNode());
+    return getNextNode();
+}
+
+void
+clientReplyContext::waitForMoreData (StoreIOBuffer const &result)
+{
+    debug(88,5)("clientReplyContext::waitForMoreData: Waiting for more data to parse reply headers in client side.\n");
+    /* We don't have enough to parse the metadata yet */
+    /* TODO: the store should give us out of band metadata and
+     * obsolete this routine 
+     */
+    /* wait for more to arrive */
+    reqofs += result.length;
+    startSendProcess();
+}
+
+void
+clientReplyContext::startSendProcess()
+{
+    debug(88,5)("clientReplyContext::startSendProcess: triggering store read to clientSendMoreData\n");
+    assert(reqofs <= HTTP_REQBUF_SZ);
+    /* TODO: copy into the supplied buffer */
+    StoreIOBuffer tempBuffer;
+    tempBuffer.offset = reqofs;
+    tempBuffer.length = next()->readBuffer.length - reqofs;
+    tempBuffer.data = next()->readBuffer.data + reqofs;
+    storeClientCopy(sc, http->entry,
+	tempBuffer, clientSendMoreData, this);
+}
+
+void
+clientReplyContext::sendMoreData (StoreIOBuffer result)
+{
     StoreEntry *entry = http->entry;
     ConnStateData *conn = http->conn;
     int fd = conn ? conn->fd : -1;
     HttpReply *rep = NULL;
-    char *buf = next->readBuffer.data;
+    char *buf = next()->readBuffer.data;
     char *body_buf = buf;
-    ssize_t size = context->reqofs + result.length;
-    ssize_t body_size = size;
+    ssize_t sizeToProcess = reqofs + result.length;
 
-    /* This is not valid once we start doing range requests.
-     * Then it becomes context->reqofs == startoffirstrangeentry
+
+    /* This is always valid until we get the headers as metadata from 
+     * storeClientCopy. 
+     * Then it becomes reqofs == next->readBuffer.offset()
      */
-    assert(context->reqofs == 0 || context->flags.storelogiccomplete);
+    assert(reqofs == 0 || flags.storelogiccomplete);
 
-    if (context->flags.headersSent && buf != result.data) {
+    if (flags.headersSent && buf != result.data) {
 	/* we've got to copy some data */
-	assert(result.length <= next->readBuffer.length);
+	assert(result.length <= next()->readBuffer.length);
 	xmemcpy(buf, result.data, result.length);
 	body_buf = buf;
-    } else if (!context->flags.headersSent &&
-	       buf + context->reqofs !=result.data) {
+    } else if (!flags.headersSent &&
+	       buf + reqofs !=result.data) {
 	/* we've got to copy some data */
-	assert(result.length + context->reqofs <= next->readBuffer.length);
-	xmemcpy(buf + context->reqofs, result.data, result.length);
+	assert(result.length + reqofs <= next()->readBuffer.length);
+	xmemcpy(buf + reqofs, result.data, result.length);
 	body_buf = buf;
     }
     /* We've got the final data to start pushing... */
-    context->flags.storelogiccomplete = 1;
+    flags.storelogiccomplete = 1;
 
-    debug(88, 5) ("clientSendMoreData: %s, %d bytes (%u new bytes)\n",
-	http->uri, (int) size, (unsigned int)result.length);
-    assert(size <= HTTP_REQBUF_SZ || context->flags.headersSent);
+    assert(sizeToProcess <= HTTP_REQBUF_SZ || flags.headersSent);
     assert(http->request != NULL);
     /* ESI TODO: remove this assert once everything is stable */
     assert(http->client_stream.head->data
 	&& cbdataReferenceValid(http->client_stream.head->data));
-    dlinkDelete(&http->active, &ClientActiveRequests);
-    dlinkAdd(http, &http->active, &ClientActiveRequests);
+
+    makeThisHead();
+    debug(88, 5) ("clientSendMoreData: %s, %d bytes (%u new bytes)\n",
+	http->uri, (int) sizeToProcess, (unsigned int)result.length);
     debug(88, 5) ("clientSendMoreData: FD %d '%s', out.offset=%ld \n",
 	fd, storeUrl(entry), (long int) http->out.offset);
+
     /* update size of the request */
-    context->reqsize = size;
+    reqsize = sizeToProcess;
+    
     if (http->request->flags.resetTCP()) {
 	/* yuck. FIXME: move to client_side.c */
 	if (fd != -1)
 	    comm_reset_close(fd);
 	return;
-    } else if (			/* aborted request */
-	    (entry && EBIT_TEST(entry->flags, ENTRY_ABORTED)) ||
-	/* Upstream read error */ (result.flags.error) ||
-	/* Upstream EOF */ (body_size == 0)) {
-	/* call clientWriteComplete so the client socket gets closed */
-	/* We call into the stream, because we don't know that there is a
-	 * client socket!
-	 */
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
-	context->flags.complete = 1;
-	tempBuffer.flags.error = result.flags.error;
-	clientStreamCallback((clientStreamNode*)http->client_stream.head->data, http, NULL,
-	    tempBuffer);
-	/* clientWriteComplete(fd, NULL, 0, COMM_OK, http); */
+    }
+    
+    if (errorInStream(result, sizeToProcess)) {
+	sendStreamError(result);
 	return;
     }
-    if (context->flags.headersSent != 0) {
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
-	if (result.length == 0)
-	    context->flags.complete = 1;
-	/* REMOVE ME: Only useful for two node streams */
-	assert(result.offset - context->headers_sz == ((clientStreamNode *) http->client_stream.tail->data)->readBuffer.offset);
-	tempBuffer.offset = result.offset - context->headers_sz;
-	tempBuffer.length = result.length;
-	tempBuffer.data = buf;
-	clientStreamCallback((clientStreamNode*)http->client_stream.head->data, http, NULL,
-	    tempBuffer);
+
+    if (flags.headersSent) {
+	pushStreamData (result, buf);
 	return;
     }
     /* handle headers */
     if (Config.onoff.log_mime_hdrs) {
 	size_t k;
-	if ((k = headersEnd(buf, size))) {
+	if ((k = headersEnd(buf, sizeToProcess))) {
 	    safe_free(http->al.headers.reply);
 	    http->al.headers.reply = (char *)xcalloc(k + 1, 1);
 	    xstrncpy(http->al.headers.reply, buf, k);
 	}
     }
-    rep = clientBuildReply(context, buf, size);
+    rep = clientBuildReply(this, buf, sizeToProcess);
+    ssize_t body_size = sizeToProcess;
     if (rep) {
-	aclCheck_t *ch;
 	int rv;
 	httpReplyBodyBuildSize(http->request, rep, &Config.ReplyBodySize);
 	if (clientReplyBodyTooLarge(rep, rep->content_length)) {
 	    ErrorState *err =
 	    clientBuildError(ERR_TOO_BIG, HTTP_FORBIDDEN, NULL,
 		http->conn ? &http->conn->peer.sin_addr : &no_addr,
 		http->request);
-	    clientRemoveStoreReference(context, &context->sc, &http->entry);
-	    startError(context, http, err);
+	    clientRemoveStoreReference(this, &sc, &http->entry);
+	    startError(this, http, err);
 	    httpReplyDestroy(rep);
 	    return;
 	}
-	context->headers_sz = rep->hdr_sz;
-	body_size = size - rep->hdr_sz;
+	headers_sz = rep->hdr_sz;
+	body_size = sizeToProcess - rep->hdr_sz;
 	assert(body_size >= 0);
 	body_buf = buf + rep->hdr_sz;
-	debug(88,
-	    3)
+	debug(88,3)
 	    ("clientSendMoreData: Appending %d bytes after %d bytes of headers\n",
 	    (int) body_size, rep->hdr_sz);
-	ch = clientAclChecklistCreate(Config.accessList.reply, http);
+	aclCheck_t *ch = clientAclChecklistCreate(Config.accessList.reply, http);
 	ch->reply = rep;
 	rv = aclCheckFast(Config.accessList.reply, ch);
 	aclChecklistFree(ch);
@@ -1685,34 +1871,42 @@ clientSendMoreData(void *data, StoreIOBuffer result)
 		clientBuildError(ERR_ACCESS_DENIED, HTTP_FORBIDDEN, NULL,
 		http->conn ? &http->conn->peer.sin_addr : &no_addr,
 		http->request);
-	    clientRemoveStoreReference(context, &context->sc, &http->entry);
-	    startError(context, http, err);
+	    clientRemoveStoreReference(this, &sc, &http->entry);
+	    startError(this, http, err);
 	    httpReplyDestroy(rep);
 	    return;
 	}
-    } else if (size < HTTP_REQBUF_SZ && entry->store_status == STORE_PENDING) {
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
-	/* wait for more to arrive */
-	context->reqofs += result.length;
-	assert(context->reqofs <= HTTP_REQBUF_SZ);
-	/* TODO: copy into the supplied buffer */
-	tempBuffer.offset = context->reqofs;
-	tempBuffer.length = next->readBuffer.length - context->reqofs;
-	tempBuffer.data = next->readBuffer.data + context->reqofs;
-	storeClientCopy(context->sc, entry,
-	    tempBuffer, clientSendMoreData, context);
-	return;
-    }
-    if (!context->flags.headersSent)
-	context->flags.headersSent = 1;
-    if (http->request->method == METHOD_HEAD) {
-	if (rep) {
+	if (http->request->method == METHOD_HEAD) {
 	    /* do not forward body for HEAD replies */
-	    /* ESI TODO: Can ESI affect headers on the master document */
 	    body_size = 0;
 	    http->flags.done_copying = 1;
-	    context->flags.complete = 1;
+	    flags.complete = 1;
+	}
+	assert (!flags.headersSent);
+	flags.headersSent = true;
+	
+	StoreIOBuffer tempBuffer;
+	if (next()->readBuffer.offset != 0) {
+	    if (next()->readBuffer.offset > body_size) {
+		/* Can't use any of the body we recieved. send nothing */
+		tempBuffer.length = 0;
+		tempBuffer.data = NULL;
+	    } else {
+		tempBuffer.length = body_size - next()->readBuffer.offset;
+		tempBuffer.data = body_buf + next()->readBuffer.offset;
+	    }
 	} else {
+	    tempBuffer.length = body_size;
+	    tempBuffer.data = body_buf;
+	}
+	/* TODO: move the data in the buffer back by the request header size */
+	clientStreamCallback((clientStreamNode *)http->client_stream.head->data, 
+	    http, rep, tempBuffer);
+	return;
+    } else if (sizeToProcess < HTTP_REQBUF_SZ && entry->store_status == STORE_PENDING) {
+	waitForMoreData(result);
+	return;
+    } else if (http->request->method == METHOD_HEAD) {
 	    /*
 	     * If we are here, then store_status == STORE_OK and it
 	     * seems we have a HEAD repsponse which is missing the
@@ -1721,22 +1915,32 @@ clientSendMoreData(void *data, StoreIOBuffer result)
 	     * call this reply a body, set the done_copying flag and
 	     * continue...
 	     */
+	    /* RBC: Note that this is seriously broken, as we *need* the
+	     * metadata to allow further client modules to work. As such 
+	     * webservers are seriously broken, this is probably not 
+	     * going to get fixed.. perhapos we should remove it?
+	     */
+	    debug (88,0)("Broken head response - probably phttpd/0.99.72\n");
 	    http->flags.done_copying = 1;
-	    context->flags.complete = 1;
-	}
-    } {
-	StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
-	assert(rep || (body_buf && body_size));
-	tempBuffer.length = body_size;
-	tempBuffer.data = body_buf;
-	/* TODO: move the data in the buffer back by the request header size */
-	clientStreamCallback((clientStreamNode *)http->client_stream.head->data, http, rep,
-	    tempBuffer);
+	    flags.complete = 1;
+	    
+	    StoreIOBuffer tempBuffer;
+	    assert(body_buf && body_size);
+	    tempBuffer.length = body_size;
+	    tempBuffer.data = body_buf;
+	    clientStreamCallback((clientStreamNode *)http->client_stream.head->data, 
+		http, NULL, tempBuffer);
+    } else {
+	debug (88,0)("clientReplyContext::sendMoreData: Unable to parse reply headers within a single HTTP_REQBUF_SZ length buffer\n");
+	StoreIOBuffer tempBuffer;
+	tempBuffer.flags.error = 1;
+	sendStreamError(tempBuffer);
     }
+    fatal ("clientReplyContext::sendMoreData: Unreachable code reached \n");
 }
 
 int
-clientReplyBodyTooLarge(HttpReply * rep, ssize_t clen)
+clientReplyBodyTooLarge(HttpReply const * rep, ssize_t clen)
 {
     if (0 == rep->maxBodySize)
 	return 0;		/* disabled */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: client_side_request.cc,v 1.8 2002/10/22 21:16:11 hno Exp $
+ * $Id: client_side_request.cc,v 1.9 2003/01/23 00:37:18 robertc Exp $
  * 
  * DEBUG: section 85    Client-side Request Routines
  * AUTHOR: Robert Collins (Originally Duane Wessels in client_side.c)
@@ -45,6 +45,7 @@
 #include "clientStream.h"
 #include "client_side_request.h"
 #include "authenticate.h"
+#include "HttpRequest.h"
 
 #if LINGERING_CLOSE
 #define comm_close comm_lingering_close
@@ -77,6 +78,7 @@ void clientProcessRequest(clientHttpRequest *);
 extern "C" CSR clientGetMoreData;
 extern "C" CSS clientReplyStatus;
 extern "C" CSD clientReplyDetach;
+static void checkFailureRatio(err_type, hier_code);
 
 void
 clientRequestContextFree(void *data)
@@ -98,6 +100,106 @@ clientRequestContextNew(clientHttpRequest * http)
     return rv;
 }
 
+CBDATA_CLASS_INIT(ClientHttpRequest);
+void *
+ClientHttpRequest::operator new (size_t size)
+{
+    assert (size == sizeof (ClientHttpRequest));
+    CBDATA_INIT_TYPE(ClientHttpRequest);
+    ClientHttpRequest *result = cbdataAlloc(ClientHttpRequest);
+    /* Mark result as being owned - we want the refcounter to do the delete
+     * call */
+    cbdataReference(result);
+    return result;
+}
+
+void 
+ClientHttpRequest::operator delete (void *address)
+{
+    ClientHttpRequest *temp = static_cast<ClientHttpRequest *>(address);
+    cbdataFree(address);
+    /* And allow the memory to be freed */
+    cbdataReferenceDone (temp);
+}
+
+void
+ClientHttpRequest::deleteSelf() const
+{
+    delete this;
+}
+
+ClientHttpRequest::ClientHttpRequest()
+{
+    /* reset range iterator */
+    start = current_time;
+}
+
+/*
+ * This function is designed to serve a fairly specific purpose.
+ * Occasionally our vBNS-connected caches can talk to each other, but not
+ * the rest of the world.  Here we try to detect frequent failures which
+ * make the cache unusable (e.g. DNS lookup and connect() failures).  If
+ * the failure:success ratio goes above 1.0 then we go into "hit only"
+ * mode where we only return UDP_HIT or UDP_MISS_NOFETCH.  Neighbors
+ * will only fetch HITs from us if they are using the ICP protocol.  We
+ * stay in this mode for 5 minutes.
+ * 
+ * Duane W., Sept 16, 1996
+ */
+
+#define FAILURE_MODE_TIME 300
+
+static void
+checkFailureRatio(err_type etype, hier_code hcode)
+{
+    static double magic_factor = 100.0;
+    double n_good;
+    double n_bad;
+    if (hcode == HIER_NONE)
+	return;
+    n_good = magic_factor / (1.0 + request_failure_ratio);
+    n_bad = magic_factor - n_good;
+    switch (etype) {
+    case ERR_DNS_FAIL:
+    case ERR_CONNECT_FAIL:
+    case ERR_READ_ERROR:
+	n_bad++;
+	break;
+    default:
+	n_good++;
+    }
+    request_failure_ratio = n_bad / n_good;
+    if (hit_only_mode_until > squid_curtime)
+	return;
+    if (request_failure_ratio < 1.0)
+	return;
+    debug(33, 0) ("Failure Ratio at %4.2f\n", request_failure_ratio);
+    debug(33, 0) ("Going into hit-only-mode for %d minutes...\n",
+	FAILURE_MODE_TIME / 60);
+    hit_only_mode_until = squid_curtime + FAILURE_MODE_TIME;
+    request_failure_ratio = 0.8;	/* reset to something less than 1.0 */
+}
+
+ClientHttpRequest::~ClientHttpRequest()
+{
+    debug(33, 3) ("httpRequestFree: %s\n", uri);
+    /* if body_connection !NULL, then ProcessBody has not
+     * found the end of the body yet
+     */
+    if (request && request->body_connection)
+	clientAbortBody(request);	/* abort body transter */
+    /* the ICP check here was erroneous
+     * - storeReleaseRequest was always called if entry was valid 
+     */
+    assert(logType < LOG_TYPE_MAX);
+    logRequest();
+    if (request)
+	checkFailureRatio(request->errType, al.hier.code);
+    freeResources();
+    /* moving to the next connection is handled by the context free */
+    dlinkDelete(&active, &ClientActiveRequests);
+}
+    
 /* Create a request and kick it off */
 /*
  * TODO: Pass in the buffers to be used in the inital Read request, as they are
@@ -111,9 +213,9 @@ clientBeginRequest(method_t method, char const *url, CSCB * streamcallback,
     size_t url_sz;
     http_version_t http_ver =
     {1, 0};
-    clientHttpRequest *http = cbdataAlloc(clientHttpRequest);
+    clientHttpRequest *http = new ClientHttpRequest;
     request_t *request;
-    StoreIOBuffer tempBuffer = EMPTYIOBUFFER;
+    StoreIOBuffer tempBuffer;
     http->http_ver = http_ver;
     http->conn = NULL;
     http->start = current_time;
@@ -372,7 +474,7 @@ clientInterpretRequestHeaders(clientHttpRequest * http)
 	String s = httpHeaderGetList(req_hdr, HDR_PRAGMA);
 	if (strListIsMember(&s, "no-cache", ','))
 	    no_cache++;
-	stringClean(&s);
+	s.clean();
     }
     request->cache_control = httpHeaderGetCc(req_hdr);
     if (request->cache_control)
@@ -412,15 +514,20 @@ clientInterpretRequestHeaders(clientHttpRequest * http)
     }
     /* ignore range header in non-GETs */
     if (request->method == METHOD_GET) {
-	/*
-	 * Since we're not doing ranges atm, just set the flag if the header
-	 * exists, and then free the range header info -- adrian
-	 */
 	request->range = httpHeaderGetRange(req_hdr);
 	if (request->range) {
 	    request->flags.range = 1;
-	    httpHdrRangeDestroy(request->range);
-	    request->range = NULL;
+	    clientStreamNode *node = (clientStreamNode *)http->client_stream.tail->data;
+	    /* XXX: This is suboptimal. We should give the stream the range set,
+	     * and thereby let the top of the stream set the offset when the
+	     * size becomes known. As it is, we will end up requesting from 0 
+	     * for evey -X range specification.
+	     * RBC - this may be somewhat wrong. We should probably set the range
+	     * iter up at this point.
+	     */
+	    node->readBuffer.offset = request->range->lowestOffset(0);
+	    http->range_iter.pos = request->range->begin();
+	    http->range_iter.valid = true;
 	}
     }
     if (httpHeaderHas(req_hdr, HDR_AUTHORIZATION))
@@ -440,9 +547,9 @@ clientInterpretRequestHeaders(clientHttpRequest * http)
 	    request->flags.loopdetect = 1;
 	}
 #if FORW_VIA_DB
-	fvdbCountVia(strBuf(s));
+	fvdbCountVia(s.buf());
 #endif
-	stringClean(&s);
+	s.clean();
     }
 #if USE_USERAGENT_LOG
     if ((str = httpHeaderGetStr(req_hdr, HDR_USER_AGENT)))
@@ -455,8 +562,8 @@ clientInterpretRequestHeaders(clientHttpRequest * http)
 #if FORW_VIA_DB
     if (httpHeaderHas(req_hdr, HDR_X_FORWARDED_FOR)) {
 	String s = httpHeaderGetList(req_hdr, HDR_X_FORWARDED_FOR);
-	fvdbCountForw(strBuf(s));
-	stringClean(&s);
+	fvdbCountForw(s.buf());
+	s.clean();
     }
 #endif
     if (request->method == METHOD_TRACE) {
@@ -568,7 +675,6 @@ void
 clientProcessRequest(clientHttpRequest * http)
 {
     request_t *r = http->request;
-    clientStreamNode *node;
     debug(85, 4) ("clientProcessRequest: %s '%s'\n",
 	RequestMethodStr[r->method], http->uri);
     if (r->method == METHOD_CONNECT) {
@@ -583,6 +689,6 @@ clientProcessRequest(clientHttpRequest * http)
     /* no one should have touched this */
     assert(http->out.offset == 0);
     /* Use the Stream Luke */
-    node = (clientStreamNode *)http->client_stream.tail->data;
+    clientStreamNode *node = (clientStreamNode *)http->client_stream.tail->data;
     clientStreamRead(node, http, node->readBuffer);
 }
@@ -1,6 +1,6 @@
 
 /*
- * $Id: client_side_request.h,v 1.1 2002/09/24 10:46:43 robertc Exp $
+ * $Id: client_side_request.h,v 1.2 2003/01/23 00:37:18 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -34,7 +34,79 @@
 #ifndef SQUID_CLIENTSIDEREQUEST_H
 #define SQUID_CLIENTSIDEREQUEST_H
 
+#include "HttpHeader.h"
+#include "clientStream.h"
+
 /* client_side_request.c - client side request related routines (pure logic) */
 extern int clientBeginRequest(method_t, char const *, CSCB *, CSD *, void *, HttpHeader const *, char *, size_t);
 
+typedef class ClientHttpRequest clientHttpRequest;
+
+class ClientHttpRequest {
+public:
+    void *operator new (size_t);
+    void operator delete (void *);
+    void deleteSelf() const;
+
+    ClientHttpRequest();
+    ~ClientHttpRequest();
+    /* Not implemented - present to prevent synthetic operations */
+    ClientHttpRequest(ClientHttpRequest const &);
+    ClientHttpRequest& operator=(ClientHttpRequest const &);
+    
+    String rangeBoundaryStr() const;
+    void freeResources();
+    void updateCounters();
+    void logRequest();
+    MemObject * memObject() const;
+    bool multipartRangeRequest() const;
+    ConnStateData *conn;
+    request_t *request;		/* Parsed URL ... */
+    char *uri;
+    char *log_uri;
+    struct {
+	off_t offset;
+	size_t size;
+	size_t headers_sz;
+    } out;
+    HttpHdrRangeIter range_iter;	/* data for iterating thru range specs */
+    size_t req_sz;		/* raw request size on input, not current request size */
+    StoreEntry *entry;
+    StoreEntry *old_entry;
+    log_type logType;
+    struct timeval start;
+    http_version_t http_ver;
+    AccessLogEntry al;
+    struct {
+	unsigned int accel:1;
+	unsigned int internal:1;
+	unsigned int done_copying:1;
+	unsigned int purging:1;
+    } flags;
+    struct {
+	http_status status;
+	char *location;
+    } redirect;
+    dlink_node active;
+    dlink_list client_stream;
+    int mRangeCLen();
+private:
+    CBDATA_CLASS(ClientHttpRequest);
+};
+
+/* client http based routines */
+SQUIDCEXTERN char *clientConstructTraceEcho(clientHttpRequest *);
+SQUIDCEXTERN aclCheck_t *clientAclChecklistCreate(const acl_access * acl, const clientHttpRequest * http);
+SQUIDCEXTERN void *clientReplyNewContext(clientHttpRequest *);
+SQUIDCEXTERN int clientHttpRequestStatus(int fd, clientHttpRequest const *http);
+
+/* ones that should be elsewhere */
+SQUIDCEXTERN void redirectStart(clientHttpRequest *, RH *, void *);
+
+SQUIDCEXTERN void sslStart(clientHttpRequest *, size_t *, int *);
+
+#if DELAY_POOLS
+SQUIDCEXTERN delay_id delayClient(clientHttpRequest *);
+#endif
+
 #endif /* SQUID_CLIENTSIDEREQUEST_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: comm.cc,v 1.361 2003/01/09 12:27:14 robertc Exp $
+ * $Id: comm.cc,v 1.362 2003/01/23 00:37:18 robertc Exp $
  *
  * DEBUG: section 5     Socket Functions
  * AUTHOR: Harvest Derived
@@ -36,6 +36,7 @@
 #include "squid.h"
 #include "StoreIOBuffer.h"
 #include "comm.h"
+#include "fde.h"
 
 #if defined(_SQUID_CYGWIN_)
 #include <sys/ioctl.h>
@@ -443,6 +444,8 @@ comm_read(int fd, char *buf, int size, IOCB *handler, void *handler_data)
 	assert(fdc_table[fd].read.handler == NULL);
         assert(!fd_table[fd].flags.closing);
 
+	debug(5,4)("comm_read, queueing read for FD %d\n",fd);
+
 	/* Queue a read */
 	fdc_table[fd].read.buf = buf;
 	fdc_table[fd].read.size = size;
@@ -559,8 +562,9 @@ comm_has_pending_read_callback(int fd)
  * return whether a file descriptor has a read handler
  *
  * Assumptions: the fd is open
+ * 		the fd is a comm fd.
  */
-int
+bool
 comm_has_pending_read(int fd)
 {
 	assert(fd_table[fd].flags.open == 1);
@@ -9,7 +9,7 @@ typedef void IOWCB(int fd, char *data, size_t len, comm_err_t flag, int xerrno,
 extern void comm_fill_immediate(int fd, StoreIOBuffer sb, IOFCB *callback, void *data);
 
 extern int comm_has_pending_read_callback(int fd);
-extern int comm_has_pending_read(int fd);
+extern bool comm_has_pending_read(int fd);
 extern void comm_read_cancel(int fd, IOCB *callback, void *data);
 extern void fdc_open(int fd, unsigned int type, char *desc);
 extern int comm_udp_recvfrom(int fd, void *buf, size_t len, int flags,
@@ -1,6 +1,6 @@
 
 /*
- * $Id: comm_kqueue.cc,v 1.6 2002/10/28 00:37:36 adrian Exp $
+ * $Id: comm_kqueue.cc,v 1.7 2003/01/23 00:37:19 robertc Exp $
  *
  * DEBUG: section 5    Socket functions
  *
@@ -1,6 +1,6 @@
 
 /*
- * $Id: comm_poll.cc,v 1.8 2002/10/28 01:12:28 adrian Exp $
+ * $Id: comm_poll.cc,v 1.9 2003/01/23 00:37:19 robertc Exp $
  *
  * DEBUG: section 5     Socket Functions
  *
@@ -34,6 +34,7 @@
 
 #include "squid.h"
 #include "Store.h"
+#include "fde.h"
 
 #ifdef USE_POLL
 
@@ -1,6 +1,6 @@
 
 /*
- * $Id: comm_select.cc,v 1.64 2002/11/15 13:29:20 hno Exp $
+ * $Id: comm_select.cc,v 1.65 2003/01/23 00:37:19 robertc Exp $
  *
  * DEBUG: section 5     Socket Functions
  *
@@ -1,6 +1,6 @@
 
 /*
- * $Id: debug.cc,v 1.86 2003/01/17 05:14:29 robertc Exp $
+ * $Id: debug.cc,v 1.87 2003/01/23 00:37:19 robertc Exp $
  *
  * DEBUG: section 0     Debug Routines
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: defines.h,v 1.111 2003/01/17 05:14:29 robertc Exp $
+ * $Id: defines.h,v 1.112 2003/01/23 00:37:19 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -223,18 +223,12 @@
 #define DEFAULT_SQUID_ERROR_DIR "/usr/local/squid/etc/errors"
 #endif
 
-/* iteration for HttpHdrRange */
-#define HttpHdrRangeInitPos (-1)
-
 /* use this and only this to initialize HttpHeaderPos */
 #define HttpHeaderInitPos (-1)
 
 /* handy to determine the #elements in a static array */
 #define countof(arr) (sizeof(arr)/sizeof(*arr))
 
-/* to initialize static variables (see also MemBufNull) */
-#define MemBufNULL { NULL, 0, 0, 0, 0 }
-
 /*
  * Max number of ICP messages to receive per call to icpHandleUdp
  */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: delay_pools.cc,v 1.29 2002/10/14 08:43:46 hno Exp $
+ * $Id: delay_pools.cc,v 1.30 2003/01/23 00:37:19 robertc Exp $
  *
  * DEBUG: section 77    Delay Pools
  * AUTHOR: David Luyer <david@luyer.net>
@@ -39,6 +39,8 @@
 #include "squid.h"
 #include "StoreClient.h"
 #include "Store.h"
+#include "MemObject.h"
+#include "client_side_request.h"
 
 struct _class1DelayPool {
     int delay_class;
@@ -655,9 +657,10 @@ delayMostBytesWanted(const MemObject * mem, int max)
     dlink_node *node;
     for (node = mem->clients.head; node; node = node->next) {
 	sc = (store_client *) node->data;
-	if (sc->callback_data == NULL)	/* not waiting for more data */
+	if (!sc->callbackPending())
+	    /* not waiting for more data */
 	    continue;
-	if (sc->type != STORE_MEM_CLIENT)
+	if (sc->getType() != STORE_MEM_CLIENT)
 	    continue;
 	wanted = sc->copyInto.length;
 	if (wanted > max)
@@ -678,9 +681,10 @@ delayMostBytesAllowed(const MemObject * mem)
     delay_id d = 0;
     for (node = mem->clients.head; node; node = node->next) {
 	sc = (store_client *) node->data;
-	if (sc->callback_data == NULL)	/* not waiting for more data */
+	if (!sc->callbackPending())
+	    /* not waiting for more data */
 	    continue;
-	if (sc->type != STORE_MEM_CLIENT)
+	if (sc->getType() != STORE_MEM_CLIENT)
 	    continue;
 	j = delayBytesWanted(sc->delayId, 0, sc->copyInto.length);
 	if (j > jmax) {
@@ -1,6 +1,6 @@
 
 /*
- * $Id: disk.cc,v 1.162 2002/10/13 20:35:00 robertc Exp $
+ * $Id: disk.cc,v 1.163 2003/01/23 00:37:19 robertc Exp $
  *
  * DEBUG: section 6     Disk I/O Routines
  * AUTHOR: Harvest Derived
@@ -34,6 +34,7 @@
  */
 
 #include "squid.h"
+#include "fde.h"
 
 static PF diskHandleRead;
 static PF diskHandleWrite;
@@ -295,7 +296,7 @@ diskHandleWrite(int fd, void *notused)
 void
 file_write(int fd,
     off_t file_offset,
-    void *ptr_to_buf,
+    void const *ptr_to_buf,
     int len,
     DWCB * handle,
     void *handle_data,
@@ -1,6 +1,6 @@
 
 /*
- * $Id: dns.cc,v 1.89 2002/11/15 13:28:33 hno Exp $
+ * $Id: dns.cc,v 1.90 2003/01/23 00:37:19 robertc Exp $
  *
  * DEBUG: section 34    Dnsserver interface
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: dns_internal.cc,v 1.51 2003/01/17 05:14:29 robertc Exp $
+ * $Id: dns_internal.cc,v 1.52 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 78    DNS lookups; interacts with lib/rfc1035.c
  * AUTHOR: Duane Wessels
@@ -1,6 +1,6 @@
 
 /*
- * $Id: dnsserver.cc,v 1.61 2002/10/13 20:35:00 robertc Exp $
+ * $Id: dnsserver.cc,v 1.62 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 0     DNS Resolver
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: enums.h,v 1.218 2002/12/06 23:19:15 hno Exp $
+ * $Id: enums.h,v 1.219 2003/01/23 00:37:20 robertc Exp $
  *
  *
  * SQUID Web Proxy Cache          http://www.squid-cache.org/
@@ -151,7 +151,7 @@ typedef enum {
     ACL_PROXY_AUTH_NEEDED
 } acl_lookup_state;
 
-enum {
+enum fd_type {
     FD_NONE,
     FD_LOG,
     FD_FILE,
@@ -615,14 +615,10 @@ typedef enum {
     MEM_HTTP_HDR_CC,
     MEM_HTTP_HDR_CONTENT_RANGE,
     MEM_HTTP_HDR_ENTRY,
-    MEM_HTTP_HDR_RANGE,
-    MEM_HTTP_HDR_RANGE_SPEC,
     MEM_HTTP_REPLY,
     MEM_INTLIST,
     MEM_IPCACHE_ENTRY,
     MEM_MD5_DIGEST,
-    MEM_MEMOBJECT,
-    MEM_MEM_NODE,
     MEM_NETDBENTRY,
     MEM_NET_DB_NAME,
     MEM_RELIST,
@@ -632,7 +628,6 @@ typedef enum {
     MEM_IDNS_QUERY,
 #endif
     MEM_EVENT,
-    MEM_TLV,
     MEM_SWAP_LOG_DATA,
 #if USE_SSL
     MEM_ACL_CERT_DATA,
@@ -718,7 +713,6 @@ typedef enum {
     CBDATA_UNDEF = 0,
     CBDATA_acl_access,
     CBDATA_aclCheck_t,
-    CBDATA_clientHttpRequest,
     CBDATA_ConnStateData,
     CBDATA_ErrorState,
     CBDATA_FwdState,
@@ -1,6 +1,6 @@
 
 /*
- * $Id: errorpage.cc,v 1.181 2003/01/22 10:05:43 robertc Exp $
+ * $Id: errorpage.cc,v 1.182 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 4     Error Generation
  * AUTHOR: Duane Wessels
@@ -43,6 +43,10 @@
 #include "squid.h"
 #include "authenticate.h"
 #include "Store.h"
+#include "HttpReply.h"
+#include "HttpRequest.h"
+#include "MemObject.h"
+#include "fde.h"
 
 /* local types */
 
@@ -225,14 +229,13 @@ errorDynamicPageInfoDestroy(ErrorDynamicPageInfo * info)
 static int
 errorPageId(const char *page_name)
 {
-    int i;
-    for (i = 0; i < ERR_MAX; i++) {
+    for (int i = 0; i < ERR_MAX; i++) {
 	if (strcmp(err_type_str[i], page_name) == 0)
 	    return i;
     }
-    for (size_t in = 0; in < ErrorDynamicPages.count; in++) {
-	if (strcmp(((ErrorDynamicPageInfo *) ErrorDynamicPages.items[in])->page_name, page_name) == 0)
-	    return in + ERR_MAX;
+    for (size_t i = 0; i < ErrorDynamicPages.count; i++) {
+	if (strcmp(((ErrorDynamicPageInfo *) ErrorDynamicPages.items[i])->page_name, page_name) == 0)
+	    return i + ERR_MAX;
     }
     return ERR_NONE;
 }
@@ -297,7 +300,7 @@ errorAppendEntry(StoreEntry * entry, ErrorState * err)
     HttpReply *rep;
     MemObject *mem = entry->mem_obj;
     assert(mem != NULL);
-    assert(mem->inmem_hi == 0);
+    assert (entry->isEmpty());
     if (entry->store_status != STORE_PENDING) {
 	/*
 	 * If the entry is not STORE_PENDING, then no clients
@@ -325,10 +328,9 @@ errorAppendEntry(StoreEntry * entry, ErrorState * err)
      */
     authenticateFixHeader(rep, err->auth_user_request, err->request, 0, 1);
     httpReplySwapOut(rep, entry);
-    httpReplyAbsorb(mem->reply, rep);
     EBIT_CLR(entry->flags, ENTRY_FWD_HDR_WAIT);
     storeBufferFlush(entry);
-    storeComplete(entry);
+    entry->complete();
     storeNegativeCache(entry);
     storeReleaseRequest(entry);
     storeUnlockObject(entry);
@@ -457,7 +459,7 @@ errorDump(ErrorState * err, MemBuf * mb)
 	Packer p;
 	memBufPrintf(&str, "%s %s HTTP/%d.%d\n",
 	    RequestMethodStr[r->method],
-	    strLen(r->urlpath) ? strBuf(r->urlpath) : "/",
+	    r->urlpath.size() ? r->urlpath.buf() : "/",
 	    r->http_ver.major, r->http_ver.minor);
 	packerToMemInit(&p, &str);
 	httpHeaderPackInto(&r->header, &p);
@@ -600,7 +602,7 @@ errorConvert(char token, ErrorState * err)
 	    Packer p;
 	    memBufPrintf(&mb, "%s %s HTTP/%d.%d\n",
 		RequestMethodStr[r->method],
-		strLen(r->urlpath) ? strBuf(r->urlpath) : "/",
+		r->urlpath.size() ? r->urlpath.buf() : "/",
 		r->http_ver.major, r->http_ver.minor);
 	    packerToMemInit(&p, &mb);
 	    httpHeaderPackInto(&r->header, &p);
@@ -1,6 +1,6 @@
 
 /*
- * $Id: event.cc,v 1.34 2002/11/15 13:29:20 hno Exp $
+ * $Id: event.cc,v 1.35 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 41    Event Processing
  * AUTHOR: Henrik Nordstrom
@@ -1,6 +1,6 @@
 
 /*
- * $Id: external_acl.cc,v 1.21 2002/12/09 16:55:24 hno Exp $
+ * $Id: external_acl.cc,v 1.22 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 82    External ACL
  * AUTHOR: Henrik Nordstrom, MARA Systems AB
@@ -548,26 +548,26 @@ makeExternalAclKey(aclCheck_t * ch, external_acl_data * acl_data)
 	    str = buf;
 	    break;
 	case _external_acl_format::EXT_ACL_PATH:
-	    str = strBuf(request->urlpath);
+	    str = request->urlpath.buf();
 	    break;
 	case _external_acl_format::EXT_ACL_METHOD:
 	    str = RequestMethodStr[request->method];
 	    break;
 	case _external_acl_format::EXT_ACL_HEADER:
 	    sb = httpHeaderGetByName(&request->header, format->header);
-	    str = strBuf(sb);
+	    str = sb.buf();
 	    break;
 	case _external_acl_format::EXT_ACL_HEADER_ID:
 	    sb = httpHeaderGetStrOrList(&request->header, format->header_id);
-	    str = strBuf(sb);
+	    str = sb.buf();
 	    break;
 	case _external_acl_format::EXT_ACL_HEADER_MEMBER:
 	    sb = httpHeaderGetByNameListMember(&request->header, format->header, format->member, format->separator);
-	    str = strBuf(sb);
+	    str = sb.buf();
 	    break;
 	case _external_acl_format::EXT_ACL_HEADER_ID_MEMBER:
 	    sb = httpHeaderGetListMember(&request->header, format->header_id, format->member, format->separator);
-	    str = strBuf(sb);
+	    str = sb.buf();
 	    break;
 #if USE_SSL
 	case _external_acl_format::EXT_ACL_USER_CERT:
@@ -598,7 +598,7 @@ makeExternalAclKey(aclCheck_t * ch, external_acl_data * acl_data)
 	if (!first)
 	    memBufAppend(&mb, " ", 1);
 	strwordquote(&mb, str);
-	stringClean(&sb);
+	sb.clean();
 	first = 0;
     }
     for (arg = acl_data->arguments; arg; arg = arg->next) {
@@ -1,6 +1,6 @@
 
 /*
- * $Id: fd.cc,v 1.45 2002/10/13 20:35:01 robertc Exp $
+ * $Id: fd.cc,v 1.46 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 51    Filedescriptor Functions
  * AUTHOR: Duane Wessels
@@ -34,6 +34,7 @@
  */
 
 #include "squid.h"
+#include "fde.h"
 
 int default_read_method(int, char *, int);
 int default_write_method(int, const char *, int);
@@ -0,0 +1,94 @@
+
+/*
+ * $Id: fde.cc,v 1.1 2003/01/23 00:37:20 robertc Exp $
+ *
+ * DEBUG: section ??	FDE
+ * AUTHOR: Robert Collins
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#include "squid.h"
+#include "fde.h"
+#include "Store.h"
+#include "comm.h"
+
+bool
+fde::readPending(int fdNumber)
+{
+    if (type == FD_SOCKET)
+	return comm_has_pending_read(fdNumber);
+    return read_handler ? true : false ;
+}
+
+void
+fde::dumpStats (StoreEntry &dumpEntry, int fdNumber)
+{
+    if (!flags.open)
+	return;
+    storeAppendPrintf(&dumpEntry, "%4d %-6.6s %4d %7d%c %7d%c %-21s %s\n",
+        fdNumber,
+        fdTypeStr[type],
+        timeout_handler ? (int) (timeout - squid_curtime) / 60 : 0,
+        bytes_read,
+        readPending(fdNumber) ? '*' : ' ',
+        bytes_written,
+        write_handler ? '*' : ' ',
+        remoteAddr(),
+        desc);
+}
+
+void
+fde::DumpStats (StoreEntry *dumpEntry)
+{
+    int i;
+    storeAppendPrintf(dumpEntry, "Active file descriptors:\n");
+    storeAppendPrintf(dumpEntry, "%-4s %-6s %-4s %-7s* %-7s* %-21s %s\n",
+        "File",
+        "Type",
+        "Tout",
+        "Nread",
+        "Nwrite",
+        "Remote Address",
+        "Description");
+    storeAppendPrintf(dumpEntry, "---- ------ ---- -------- -------- --------------------- ------------------------------\n");
+    for (i = 0; i < Squid_MaxFD; i++) {
+        fd_table[i].dumpStats(*dumpEntry, i);
+    }
+}
+
+char const *
+fde::remoteAddr() const
+{
+    LOCAL_ARRAY(char, buf, 32);
+    if (type != FD_SOCKET)
+	return null_string;
+    snprintf(buf, 32, "%s.%d", ipaddr, (int) remote_port);
+    return buf;
+}
+
@@ -0,0 +1,90 @@
+
+/*
+ * $Id: fde.h,v 1.1 2003/01/23 00:37:20 robertc Exp $
+ *
+ *
+ * SQUID Web Proxy Cache          http://www.squid-cache.org/
+ * ----------------------------------------------------------
+ *
+ *  Squid is the result of efforts by numerous individuals from
+ *  the Internet community; see the CONTRIBUTORS file for full
+ *  details.   Many organizations have provided support for Squid's
+ *  development; see the SPONSORS file for full details.  Squid is
+ *  Copyrighted (C) 2001 by the Regents of the University of
+ *  California; see the COPYRIGHT file for full details.  Squid
+ *  incorporates software developed and/or copyrighted by other
+ *  sources; see the CREDITS file for full details.
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *  
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *  
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
+ *
+ */
+
+#ifndef SQUID_FDE_H
+#define SQUID_FDE_H
+
+class fde {
+public:
+    static void DumpStats (StoreEntry *);
+  
+    char const *remoteAddr() const;
+    void dumpStats (StoreEntry &, int);
+    bool readPending(int);
+
+    unsigned int type;
+    u_short local_port;
+    u_short remote_port;
+    struct in_addr local_addr;
+    unsigned char tos;
+    char ipaddr[16];            /* dotted decimal address of peer */
+    char desc[FD_DESC_SZ];
+    struct {
+        unsigned int open:1;
+        unsigned int close_request:1;
+        unsigned int write_daemon:1;
+        unsigned int closing:1;
+        unsigned int socket_eof:1;
+        unsigned int nolinger:1;
+        unsigned int nonblocking:1;
+        unsigned int ipc:1;
+        unsigned int called_connect:1;
+        unsigned int nodelay:1;
+        unsigned int close_on_exec:1;
+        unsigned int read_pending:1;
+    } flags;
+    int bytes_read;
+    int bytes_written;
+    int uses;                   /* ie # req's over persistent conn */
+    struct _fde_disk disk;
+    PF *read_handler;
+    void *read_data;
+    PF *write_handler;
+    void *write_data;
+    PF *timeout_handler;
+    time_t timeout;
+    void *timeout_data;
+    void *lifetime_data;
+    close_handler *closeHandler;        /* linked list */
+    DEFER *defer_check;         /* check if we should defer read */
+    void *defer_data;
+    CommWriteStateData *rwstate;        /* State data for comm_write */
+    READ_HANDLER *read_method;
+    WRITE_HANDLER *write_method;
+#if USE_SSL
+    SSL *ssl;
+    int ssl_shutdown:1;
+#endif
+};
+
+#endif /* SQUID_FDE_H */
@@ -1,6 +1,6 @@
 
 /*
- * $Id: filemap.cc,v 1.40 2002/10/13 20:35:01 robertc Exp $
+ * $Id: filemap.cc,v 1.41 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 8     Swap File Bitmap
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 
 /*
- * $Id: forward.cc,v 1.90 2002/12/06 23:19:15 hno Exp $
+ * $Id: forward.cc,v 1.91 2003/01/23 00:37:20 robertc Exp $
  *
  * DEBUG: section 17    Request Forwarding
  * AUTHOR: Duane Wessels
@@ -36,7 +36,9 @@
 
 #include "squid.h"
 #include "Store.h"
-
+#include "HttpRequest.h"
+#include "fde.h"
+#include "MemObject.h"
 
 static PSC fwdStartComplete;
 static void fwdDispatch(FwdState *);
@@ -87,19 +89,19 @@ fwdStateFree(FwdState * fwdState)
     debug(17, 3) ("fwdStateFree: %p\n", fwdState);
     assert(e->mem_obj);
 #if URL_CHECKSUM_DEBUG
-    assert(e->mem_obj->chksum == url_checksum(e->mem_obj->url));
+    e->mem_obj->checkUrlChecksum();
 #endif
 #if WIP_FWD_LOG
     fwdLog(fwdState);
 #endif
     if (e->store_status == STORE_PENDING) {
-	if (e->mem_obj->inmem_hi == 0) {
+	if (e->isEmpty()) {
 	    assert(fwdState->err);
 	    errorAppendEntry(e, fwdState->err);
 	    fwdState->err = NULL;
 	} else {
 	    EBIT_CLR(e->flags, ENTRY_FWD_HDR_WAIT);
-	    storeComplete(e);
+	    e->complete();
 	    storeReleaseRequest(e);
 	}
     }
@@ -131,7 +133,7 @@ fwdCheckRetry(FwdState * fwdState)
 {
     if (fwdState->entry->store_status != STORE_PENDING)
 	return 0;
-    if (fwdState->entry->mem_obj->inmem_hi > 0)
+    if (!fwdState->entry->isEmpty())
 	return 0;
     if (fwdState->n_tries > 10)
 	return 0;
@@ -338,7 +340,7 @@ fwdConnectTimeout(int fd, void *data)
     peer *p = fwdStateServerPeer(fwdState);
     debug(17, 2) ("fwdConnectTimeout: FD %d: '%s'\n", fd, storeUrl(entry));
     assert(fd == fwdState->server_fd);
-    if (entry->mem_obj->inmem_hi == 0) {
+    if (entry->isEmpty()) {
 	err = errorCon(ERR_CONNECT_FAIL, HTTP_GATEWAY_TIMEOUT);
 	err->request = requestLink(fwdState->request);
 	err->xerrno = ETIMEDOUT;
@@ -429,6 +431,7 @@ fwdConnectStart(void *data)
 	ctimeout = fs->_peer->connect_timeout > 0 ? fs->_peer->connect_timeout
 	    : Config.Timeout.peer_connect;
     } else if (fwdState->request->flags.accelerated &&
+	!fwdState->request->flags.internalclient &&
 	Config.Accel.single_host && Config.Accel.host) {
 	host = Config.Accel.host;
 	port = Config.Accel.port;
@@ -447,7 +450,7 @@ fwdConnectStart(void *data)
 	return;
     }
 #if URL_CHECKSUM_DEBUG
-    assert(fwdState->entry->mem_obj->chksum == url_checksum(url));
+    fwdState->entry->mem_obj->checkUrlChecksum();
 #endif
     outgoing = getOutgoingAddr(fwdState->request);
     tos = getOutgoingTOS(fwdState->request);
@@ -614,7 +617,7 @@ fwdReforward(FwdState * fwdState)
     assert(e->store_status == STORE_PENDING);
     assert(e->mem_obj);
 #if URL_CHECKSUM_DEBUG
-    assert(e->mem_obj->chksum == url_checksum(e->mem_obj->url));
+    e->mem_obj->checkUrlChecksum();
 #endif
     debug(17, 3) ("fwdReforward: %s?\n", storeUrl(e));
     if (!EBIT_TEST(e->flags, ENTRY_FWD_HDR_WAIT)) {
@@ -632,7 +635,7 @@ fwdReforward(FwdState * fwdState)
 	debug(17, 3) ("fwdReforward: No forward-servers left\n");
 	return 0;
     }
-    s = e->mem_obj->reply->sline.status;
+    s = e->getReply()->sline.status;
     debug(17, 3) ("fwdReforward: status %d\n", (int) s);
     return fwdReforwardableStatus(s);
 }
@@ -683,7 +686,7 @@ fwdStart(int fd, StoreEntry * e, request_t * r)
     e->mem_obj->request = requestLink(r);
     e->mem_obj->fd = fd;
 #if URL_CHECKSUM_DEBUG
-    assert(e->mem_obj->chksum == url_checksum(e->mem_obj->url));
+    e->mem_obj->checkUrlChecksum();
 #endif
     if (shutting_down) {
 	/* more yuck */
@@ -720,40 +723,6 @@ fwdStart(int fd, StoreEntry * e, request_t * r)
     peerSelect(r, e, fwdStartComplete, fwdState);
 }
 
-int
-fwdCheckDeferRead(int fd, void *data)
-{
-    StoreEntry *e = (StoreEntry *)data;
-    MemObject *mem = e->mem_obj;
-    int rc = 0;
-    if (mem == NULL)
-	return 0;
-#if URL_CHECKSUM_DEBUG
-    assert(e->mem_obj->chksum == url_checksum(e->mem_obj->url));
-#endif
-#if DELAY_POOLS
-    if (fd < 0)
-	(void) 0;
-    else if (delayIsNoDelay(fd))
-	(void) 0;
-    else {
-	int i = delayMostBytesWanted(mem, INT_MAX);
-	if (0 == i)
-	    return 1;
-	/* was: rc = -(rc != INT_MAX); */
-	else if (INT_MAX == i)
-	    rc = 0;
-	else
-	    rc = -1;
-    }
-#endif
-    if (EBIT_TEST(e->flags, ENTRY_FWD_HDR_WAIT))
-	return rc;
-    if ((size_t)mem->inmem_hi - storeLowestMemReaderOffset(e) < Config.readAheadGap)
-	return rc;
-    return 1;
-}
-
 void
 fwdFail(FwdState * fwdState, ErrorState * errorState)
 {
@@ -803,24 +772,24 @@ fwdComplete(FwdState * fwdState)
     StoreEntry *e = fwdState->entry;
     assert(e->store_status == STORE_PENDING);
     debug(17, 3) ("fwdComplete: %s\n\tstatus %d\n", storeUrl(e),
-	e->mem_obj->reply->sline.status);
+	e->getReply()->sline.status);
 #if URL_CHECKSUM_DEBUG
-    assert(e->mem_obj->chksum == url_checksum(e->mem_obj->url));
+    e->mem_obj->checkUrlChecksum();
 #endif
-    fwdLogReplyStatus(fwdState->n_tries, e->mem_obj->reply->sline.status);
+    fwdLogReplyStatus(fwdState->n_tries, e->getReply()->sline.status);
     if (fwdReforward(fwdState)) {
 	debug(17, 3) ("fwdComplete: re-forwarding %d %s\n",
-	    e->mem_obj->reply->sline.status,
+	    e->getReply()->sline.status,
 	    storeUrl(e));
 	if (fwdState->server_fd > -1)
 	    fwdUnregister(fwdState->server_fd, fwdState);
 	storeEntryReset(e);
 	fwdStartComplete(fwdState->servers, fwdState);
     } else {
 	debug(17, 3) ("fwdComplete: not re-forwarding status %d\n",
-	    e->mem_obj->reply->sline.status);
+	    e->getReply()->sline.status);
 	EBIT_CLR(e->flags, ENTRY_FWD_HDR_WAIT);
-	storeComplete(e);
+	e->complete();
 	/*
 	 * If fwdState isn't associated with a server FD, it
 	 * won't get freed unless we do it here.
@@ -1,6 +1,6 @@
 
 /*
- * $Id: fqdncache.cc,v 1.152 2002/10/13 20:35:01 robertc Exp $
+ * $Id: fqdncache.cc,v 1.153 2003/01/23 00:37:21 robertc Exp $
  *
  * DEBUG: section 35    FQDN Cache
  * AUTHOR: Harvest Derived
@@ -1,6 +1,6 @@
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.am,v 1.3 2002/10/13 20:35:24 robertc Exp $
+#  $Id: Makefile.am,v 1.4 2003/01/23 00:38:06 robertc Exp $
 #
 
 AUTOMAKE_OPTIONS = subdir-objects
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -15,9 +16,8 @@
 
 #  Makefile for storage modules in the Squid Object Cache server
 #
-#  $Id: Makefile.in,v 1.25 2002/10/25 03:48:57 robertc Exp $
+#  $Id: Makefile.in,v 1.26 2003/01/23 00:38:07 robertc Exp $
 #
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -48,9 +48,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -62,6 +66,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -79,7 +87,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -92,7 +99,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -109,6 +115,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -184,19 +191,20 @@ CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/cfgaux/depcomp
-@AMDEP_TRUE@DEP_FILES = $(DEPDIR)/aufs/aiops.Po \
-@AMDEP_TRUE@	$(DEPDIR)/aufs/async_io.Po \
-@AMDEP_TRUE@	$(DEPDIR)/aufs/store_dir_aufs.Po \
-@AMDEP_TRUE@	$(DEPDIR)/aufs/store_io_aufs.Po \
-@AMDEP_TRUE@	$(DEPDIR)/coss/async_io.Po \
-@AMDEP_TRUE@	$(DEPDIR)/coss/store_dir_coss.Po \
-@AMDEP_TRUE@	$(DEPDIR)/coss/store_io_coss.Po \
-@AMDEP_TRUE@	$(DEPDIR)/diskd/diskd.Po \
-@AMDEP_TRUE@	$(DEPDIR)/diskd/store_dir_diskd.Po \
-@AMDEP_TRUE@	$(DEPDIR)/diskd/store_io_diskd.Po \
-@AMDEP_TRUE@	$(DEPDIR)/null/store_null.Po \
-@AMDEP_TRUE@	$(DEPDIR)/ufs/store_dir_ufs.Po \
-@AMDEP_TRUE@	$(DEPDIR)/ufs/store_io_ufs.Po
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = aufs/$(DEPDIR)/aiops.Po \
+@AMDEP_TRUE@	aufs/$(DEPDIR)/async_io.Po \
+@AMDEP_TRUE@	aufs/$(DEPDIR)/store_dir_aufs.Po \
+@AMDEP_TRUE@	aufs/$(DEPDIR)/store_io_aufs.Po \
+@AMDEP_TRUE@	coss/$(DEPDIR)/async_io.Po \
+@AMDEP_TRUE@	coss/$(DEPDIR)/store_dir_coss.Po \
+@AMDEP_TRUE@	coss/$(DEPDIR)/store_io_coss.Po \
+@AMDEP_TRUE@	diskd/$(DEPDIR)/diskd.Po \
+@AMDEP_TRUE@	diskd/$(DEPDIR)/store_dir_diskd.Po \
+@AMDEP_TRUE@	diskd/$(DEPDIR)/store_io_diskd.Po \
+@AMDEP_TRUE@	null/$(DEPDIR)/store_null.Po \
+@AMDEP_TRUE@	ufs/$(DEPDIR)/store_dir_ufs.Po \
+@AMDEP_TRUE@	ufs/$(DEPDIR)/store_io_ufs.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
@@ -226,86 +234,82 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  src/fs/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
-
-AR = ar
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 
 clean-noinstLIBRARIES:
 	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
 aufs/.dirstamp:
 	@$(mkinstalldirs) aufs
 	@: > aufs/.dirstamp
-$(DEPDIR)/aufs/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/aufs
-	@: > $(DEPDIR)/aufs/.dirstamp
+aufs/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) aufs/$(DEPDIR)
+	@: > aufs/$(DEPDIR)/.dirstamp
 aufs/aiops.$(OBJEXT): aufs/aiops.cc aufs/.dirstamp \
-	$(DEPDIR)/aufs/.dirstamp
+	aufs/$(DEPDIR)/.dirstamp
 aufs/async_io.$(OBJEXT): aufs/async_io.cc aufs/.dirstamp \
-	$(DEPDIR)/aufs/.dirstamp
+	aufs/$(DEPDIR)/.dirstamp
 aufs/store_dir_aufs.$(OBJEXT): aufs/store_dir_aufs.cc aufs/.dirstamp \
-	$(DEPDIR)/aufs/.dirstamp
+	aufs/$(DEPDIR)/.dirstamp
 aufs/store_io_aufs.$(OBJEXT): aufs/store_io_aufs.cc aufs/.dirstamp \
-	$(DEPDIR)/aufs/.dirstamp
+	aufs/$(DEPDIR)/.dirstamp
 libaufs.a: $(libaufs_a_OBJECTS) $(libaufs_a_DEPENDENCIES) 
 	-rm -f libaufs.a
 	$(libaufs_a_AR) libaufs.a $(libaufs_a_OBJECTS) $(libaufs_a_LIBADD)
 	$(RANLIB) libaufs.a
 coss/.dirstamp:
 	@$(mkinstalldirs) coss
 	@: > coss/.dirstamp
-$(DEPDIR)/coss/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/coss
-	@: > $(DEPDIR)/coss/.dirstamp
+coss/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) coss/$(DEPDIR)
+	@: > coss/$(DEPDIR)/.dirstamp
 coss/store_io_coss.$(OBJEXT): coss/store_io_coss.cc coss/.dirstamp \
-	$(DEPDIR)/coss/.dirstamp
+	coss/$(DEPDIR)/.dirstamp
 coss/store_dir_coss.$(OBJEXT): coss/store_dir_coss.cc coss/.dirstamp \
-	$(DEPDIR)/coss/.dirstamp
+	coss/$(DEPDIR)/.dirstamp
 coss/async_io.$(OBJEXT): coss/async_io.cc coss/.dirstamp \
-	$(DEPDIR)/coss/.dirstamp
+	coss/$(DEPDIR)/.dirstamp
 libcoss.a: $(libcoss_a_OBJECTS) $(libcoss_a_DEPENDENCIES) 
 	-rm -f libcoss.a
 	$(libcoss_a_AR) libcoss.a $(libcoss_a_OBJECTS) $(libcoss_a_LIBADD)
 	$(RANLIB) libcoss.a
 diskd/.dirstamp:
 	@$(mkinstalldirs) diskd
 	@: > diskd/.dirstamp
-$(DEPDIR)/diskd/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/diskd
-	@: > $(DEPDIR)/diskd/.dirstamp
+diskd/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) diskd/$(DEPDIR)
+	@: > diskd/$(DEPDIR)/.dirstamp
 diskd/diskd.$(OBJEXT): diskd/diskd.cc diskd/.dirstamp \
-	$(DEPDIR)/diskd/.dirstamp
+	diskd/$(DEPDIR)/.dirstamp
 diskd/store_dir_diskd.$(OBJEXT): diskd/store_dir_diskd.cc \
-	diskd/.dirstamp $(DEPDIR)/diskd/.dirstamp
+	diskd/.dirstamp diskd/$(DEPDIR)/.dirstamp
 diskd/store_io_diskd.$(OBJEXT): diskd/store_io_diskd.cc diskd/.dirstamp \
-	$(DEPDIR)/diskd/.dirstamp
+	diskd/$(DEPDIR)/.dirstamp
 libdiskd.a: $(libdiskd_a_OBJECTS) $(libdiskd_a_DEPENDENCIES) 
 	-rm -f libdiskd.a
 	$(libdiskd_a_AR) libdiskd.a $(libdiskd_a_OBJECTS) $(libdiskd_a_LIBADD)
 	$(RANLIB) libdiskd.a
 null/.dirstamp:
 	@$(mkinstalldirs) null
 	@: > null/.dirstamp
-$(DEPDIR)/null/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/null
-	@: > $(DEPDIR)/null/.dirstamp
+null/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) null/$(DEPDIR)
+	@: > null/$(DEPDIR)/.dirstamp
 null/store_null.$(OBJEXT): null/store_null.cc null/.dirstamp \
-	$(DEPDIR)/null/.dirstamp
+	null/$(DEPDIR)/.dirstamp
 libnull.a: $(libnull_a_OBJECTS) $(libnull_a_DEPENDENCIES) 
 	-rm -f libnull.a
 	$(libnull_a_AR) libnull.a $(libnull_a_OBJECTS) $(libnull_a_LIBADD)
 	$(RANLIB) libnull.a
 ufs/.dirstamp:
 	@$(mkinstalldirs) ufs
 	@: > ufs/.dirstamp
-$(DEPDIR)/ufs/.dirstamp:
-	@$(mkinstalldirs) $(DEPDIR)/ufs
-	@: > $(DEPDIR)/ufs/.dirstamp
+ufs/$(DEPDIR)/.dirstamp:
+	@$(mkinstalldirs) ufs/$(DEPDIR)
+	@: > ufs/$(DEPDIR)/.dirstamp
 ufs/store_dir_ufs.$(OBJEXT): ufs/store_dir_ufs.cc ufs/.dirstamp \
-	$(DEPDIR)/ufs/.dirstamp
+	ufs/$(DEPDIR)/.dirstamp
 ufs/store_io_ufs.$(OBJEXT): ufs/store_io_ufs.cc ufs/.dirstamp \
-	$(DEPDIR)/ufs/.dirstamp
+	ufs/$(DEPDIR)/.dirstamp
 libufs.a: $(libufs_a_OBJECTS) $(libufs_a_DEPENDENCIES) 
 	-rm -f libufs.a
 	$(libufs_a_AR) libufs.a $(libufs_a_OBJECTS) $(libufs_a_LIBADD)
@@ -329,39 +333,39 @@ mostlyclean-compile:
 
 distclean-compile:
 	-rm -f *.tab.c
-	-rm -f $(DEPDIR)/aufs/.dirstamp
-	-rm -f $(DEPDIR)/coss/.dirstamp
-	-rm -f $(DEPDIR)/diskd/.dirstamp
-	-rm -f $(DEPDIR)/null/.dirstamp
-	-rm -f $(DEPDIR)/ufs/.dirstamp
+	-rm -f aufs/$(DEPDIR)/.dirstamp
 	-rm -f aufs/.dirstamp
+	-rm -f coss/$(DEPDIR)/.dirstamp
 	-rm -f coss/.dirstamp
+	-rm -f diskd/$(DEPDIR)/.dirstamp
 	-rm -f diskd/.dirstamp
+	-rm -f null/$(DEPDIR)/.dirstamp
 	-rm -f null/.dirstamp
+	-rm -f ufs/$(DEPDIR)/.dirstamp
 	-rm -f ufs/.dirstamp
 
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/aufs/aiops.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/aufs/async_io.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/aufs/store_dir_aufs.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/aufs/store_io_aufs.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/coss/async_io.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/coss/store_dir_coss.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/coss/store_io_coss.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/diskd/diskd.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/diskd/store_dir_diskd.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/diskd/store_io_diskd.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/null/store_null.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ufs/store_dir_ufs.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@$(DEPDIR)/ufs/store_io_ufs.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@aufs/$(DEPDIR)/aiops.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@aufs/$(DEPDIR)/async_io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@aufs/$(DEPDIR)/store_dir_aufs.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@aufs/$(DEPDIR)/store_io_aufs.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@coss/$(DEPDIR)/async_io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@coss/$(DEPDIR)/store_dir_coss.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@coss/$(DEPDIR)/store_io_coss.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@diskd/$(DEPDIR)/diskd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@diskd/$(DEPDIR)/store_dir_diskd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@diskd/$(DEPDIR)/store_io_diskd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@null/$(DEPDIR)/store_null.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@ufs/$(DEPDIR)/store_dir_ufs.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@ufs/$(DEPDIR)/store_io_ufs.Po@am__quote@
 
 distclean-depend:
-	-rm -rf $(DEPDIR)
+	-rm -rf aufs/$(DEPDIR) coss/$(DEPDIR) diskd/$(DEPDIR) null/$(DEPDIR) ufs/$(DEPDIR)
 
 .cc.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXXCOMPILE) -c -o $@ `test -f $< || echo '$(srcdir)/'`$<
+	$(CXXCOMPILE) -c -o $@ `test -f '$<' || echo '$(srcdir)/'`$<
 
 .cc.obj:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -371,157 +375,157 @@ distclean-depend:
 
 aufs/aiops.o: aufs/aiops.cc
 @AMDEP_TRUE@	source='aufs/aiops.cc' object='aufs/aiops.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/aiops.Po' tmpdepfile='$(DEPDIR)/aufs/aiops.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/aiops.Po' tmpdepfile='aufs/$(DEPDIR)/aiops.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/aiops.o `test -f aufs/aiops.cc || echo '$(srcdir)/'`aufs/aiops.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/aiops.o `test -f 'aufs/aiops.cc' || echo '$(srcdir)/'`aufs/aiops.cc
 
 aufs/aiops.obj: aufs/aiops.cc
 @AMDEP_TRUE@	source='aufs/aiops.cc' object='aufs/aiops.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/aiops.Po' tmpdepfile='$(DEPDIR)/aufs/aiops.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/aiops.Po' tmpdepfile='aufs/$(DEPDIR)/aiops.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/aiops.obj `cygpath -w aufs/aiops.cc`
 
 aufs/async_io.o: aufs/async_io.cc
 @AMDEP_TRUE@	source='aufs/async_io.cc' object='aufs/async_io.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/async_io.Po' tmpdepfile='$(DEPDIR)/aufs/async_io.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/async_io.Po' tmpdepfile='aufs/$(DEPDIR)/async_io.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/async_io.o `test -f aufs/async_io.cc || echo '$(srcdir)/'`aufs/async_io.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/async_io.o `test -f 'aufs/async_io.cc' || echo '$(srcdir)/'`aufs/async_io.cc
 
 aufs/async_io.obj: aufs/async_io.cc
 @AMDEP_TRUE@	source='aufs/async_io.cc' object='aufs/async_io.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/async_io.Po' tmpdepfile='$(DEPDIR)/aufs/async_io.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/async_io.Po' tmpdepfile='aufs/$(DEPDIR)/async_io.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/async_io.obj `cygpath -w aufs/async_io.cc`
 
 aufs/store_dir_aufs.o: aufs/store_dir_aufs.cc
 @AMDEP_TRUE@	source='aufs/store_dir_aufs.cc' object='aufs/store_dir_aufs.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/store_dir_aufs.Po' tmpdepfile='$(DEPDIR)/aufs/store_dir_aufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/store_dir_aufs.Po' tmpdepfile='aufs/$(DEPDIR)/store_dir_aufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/store_dir_aufs.o `test -f aufs/store_dir_aufs.cc || echo '$(srcdir)/'`aufs/store_dir_aufs.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/store_dir_aufs.o `test -f 'aufs/store_dir_aufs.cc' || echo '$(srcdir)/'`aufs/store_dir_aufs.cc
 
 aufs/store_dir_aufs.obj: aufs/store_dir_aufs.cc
 @AMDEP_TRUE@	source='aufs/store_dir_aufs.cc' object='aufs/store_dir_aufs.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/store_dir_aufs.Po' tmpdepfile='$(DEPDIR)/aufs/store_dir_aufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/store_dir_aufs.Po' tmpdepfile='aufs/$(DEPDIR)/store_dir_aufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/store_dir_aufs.obj `cygpath -w aufs/store_dir_aufs.cc`
 
 aufs/store_io_aufs.o: aufs/store_io_aufs.cc
 @AMDEP_TRUE@	source='aufs/store_io_aufs.cc' object='aufs/store_io_aufs.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/store_io_aufs.Po' tmpdepfile='$(DEPDIR)/aufs/store_io_aufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/store_io_aufs.Po' tmpdepfile='aufs/$(DEPDIR)/store_io_aufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/store_io_aufs.o `test -f aufs/store_io_aufs.cc || echo '$(srcdir)/'`aufs/store_io_aufs.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/store_io_aufs.o `test -f 'aufs/store_io_aufs.cc' || echo '$(srcdir)/'`aufs/store_io_aufs.cc
 
 aufs/store_io_aufs.obj: aufs/store_io_aufs.cc
 @AMDEP_TRUE@	source='aufs/store_io_aufs.cc' object='aufs/store_io_aufs.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/aufs/store_io_aufs.Po' tmpdepfile='$(DEPDIR)/aufs/store_io_aufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='aufs/$(DEPDIR)/store_io_aufs.Po' tmpdepfile='aufs/$(DEPDIR)/store_io_aufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o aufs/store_io_aufs.obj `cygpath -w aufs/store_io_aufs.cc`
 
 coss/store_io_coss.o: coss/store_io_coss.cc
 @AMDEP_TRUE@	source='coss/store_io_coss.cc' object='coss/store_io_coss.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/coss/store_io_coss.Po' tmpdepfile='$(DEPDIR)/coss/store_io_coss.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='coss/$(DEPDIR)/store_io_coss.Po' tmpdepfile='coss/$(DEPDIR)/store_io_coss.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/store_io_coss.o `test -f coss/store_io_coss.cc || echo '$(srcdir)/'`coss/store_io_coss.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/store_io_coss.o `test -f 'coss/store_io_coss.cc' || echo '$(srcdir)/'`coss/store_io_coss.cc
 
 coss/store_io_coss.obj: coss/store_io_coss.cc
 @AMDEP_TRUE@	source='coss/store_io_coss.cc' object='coss/store_io_coss.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/coss/store_io_coss.Po' tmpdepfile='$(DEPDIR)/coss/store_io_coss.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='coss/$(DEPDIR)/store_io_coss.Po' tmpdepfile='coss/$(DEPDIR)/store_io_coss.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/store_io_coss.obj `cygpath -w coss/store_io_coss.cc`
 
 coss/store_dir_coss.o: coss/store_dir_coss.cc
 @AMDEP_TRUE@	source='coss/store_dir_coss.cc' object='coss/store_dir_coss.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/coss/store_dir_coss.Po' tmpdepfile='$(DEPDIR)/coss/store_dir_coss.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='coss/$(DEPDIR)/store_dir_coss.Po' tmpdepfile='coss/$(DEPDIR)/store_dir_coss.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/store_dir_coss.o `test -f coss/store_dir_coss.cc || echo '$(srcdir)/'`coss/store_dir_coss.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/store_dir_coss.o `test -f 'coss/store_dir_coss.cc' || echo '$(srcdir)/'`coss/store_dir_coss.cc
 
 coss/store_dir_coss.obj: coss/store_dir_coss.cc
 @AMDEP_TRUE@	source='coss/store_dir_coss.cc' object='coss/store_dir_coss.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/coss/store_dir_coss.Po' tmpdepfile='$(DEPDIR)/coss/store_dir_coss.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='coss/$(DEPDIR)/store_dir_coss.Po' tmpdepfile='coss/$(DEPDIR)/store_dir_coss.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/store_dir_coss.obj `cygpath -w coss/store_dir_coss.cc`
 
 coss/async_io.o: coss/async_io.cc
 @AMDEP_TRUE@	source='coss/async_io.cc' object='coss/async_io.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/coss/async_io.Po' tmpdepfile='$(DEPDIR)/coss/async_io.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='coss/$(DEPDIR)/async_io.Po' tmpdepfile='coss/$(DEPDIR)/async_io.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/async_io.o `test -f coss/async_io.cc || echo '$(srcdir)/'`coss/async_io.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/async_io.o `test -f 'coss/async_io.cc' || echo '$(srcdir)/'`coss/async_io.cc
 
 coss/async_io.obj: coss/async_io.cc
 @AMDEP_TRUE@	source='coss/async_io.cc' object='coss/async_io.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/coss/async_io.Po' tmpdepfile='$(DEPDIR)/coss/async_io.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='coss/$(DEPDIR)/async_io.Po' tmpdepfile='coss/$(DEPDIR)/async_io.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o coss/async_io.obj `cygpath -w coss/async_io.cc`
 
 diskd/diskd.o: diskd/diskd.cc
 @AMDEP_TRUE@	source='diskd/diskd.cc' object='diskd/diskd.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/diskd/diskd.Po' tmpdepfile='$(DEPDIR)/diskd/diskd.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='diskd/$(DEPDIR)/diskd.Po' tmpdepfile='diskd/$(DEPDIR)/diskd.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/diskd.o `test -f diskd/diskd.cc || echo '$(srcdir)/'`diskd/diskd.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/diskd.o `test -f 'diskd/diskd.cc' || echo '$(srcdir)/'`diskd/diskd.cc
 
 diskd/diskd.obj: diskd/diskd.cc
 @AMDEP_TRUE@	source='diskd/diskd.cc' object='diskd/diskd.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/diskd/diskd.Po' tmpdepfile='$(DEPDIR)/diskd/diskd.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='diskd/$(DEPDIR)/diskd.Po' tmpdepfile='diskd/$(DEPDIR)/diskd.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/diskd.obj `cygpath -w diskd/diskd.cc`
 
 diskd/store_dir_diskd.o: diskd/store_dir_diskd.cc
 @AMDEP_TRUE@	source='diskd/store_dir_diskd.cc' object='diskd/store_dir_diskd.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/diskd/store_dir_diskd.Po' tmpdepfile='$(DEPDIR)/diskd/store_dir_diskd.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='diskd/$(DEPDIR)/store_dir_diskd.Po' tmpdepfile='diskd/$(DEPDIR)/store_dir_diskd.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/store_dir_diskd.o `test -f diskd/store_dir_diskd.cc || echo '$(srcdir)/'`diskd/store_dir_diskd.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/store_dir_diskd.o `test -f 'diskd/store_dir_diskd.cc' || echo '$(srcdir)/'`diskd/store_dir_diskd.cc
 
 diskd/store_dir_diskd.obj: diskd/store_dir_diskd.cc
 @AMDEP_TRUE@	source='diskd/store_dir_diskd.cc' object='diskd/store_dir_diskd.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/diskd/store_dir_diskd.Po' tmpdepfile='$(DEPDIR)/diskd/store_dir_diskd.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='diskd/$(DEPDIR)/store_dir_diskd.Po' tmpdepfile='diskd/$(DEPDIR)/store_dir_diskd.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/store_dir_diskd.obj `cygpath -w diskd/store_dir_diskd.cc`
 
 diskd/store_io_diskd.o: diskd/store_io_diskd.cc
 @AMDEP_TRUE@	source='diskd/store_io_diskd.cc' object='diskd/store_io_diskd.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/diskd/store_io_diskd.Po' tmpdepfile='$(DEPDIR)/diskd/store_io_diskd.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='diskd/$(DEPDIR)/store_io_diskd.Po' tmpdepfile='diskd/$(DEPDIR)/store_io_diskd.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/store_io_diskd.o `test -f diskd/store_io_diskd.cc || echo '$(srcdir)/'`diskd/store_io_diskd.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/store_io_diskd.o `test -f 'diskd/store_io_diskd.cc' || echo '$(srcdir)/'`diskd/store_io_diskd.cc
 
 diskd/store_io_diskd.obj: diskd/store_io_diskd.cc
 @AMDEP_TRUE@	source='diskd/store_io_diskd.cc' object='diskd/store_io_diskd.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/diskd/store_io_diskd.Po' tmpdepfile='$(DEPDIR)/diskd/store_io_diskd.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='diskd/$(DEPDIR)/store_io_diskd.Po' tmpdepfile='diskd/$(DEPDIR)/store_io_diskd.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o diskd/store_io_diskd.obj `cygpath -w diskd/store_io_diskd.cc`
 
 null/store_null.o: null/store_null.cc
 @AMDEP_TRUE@	source='null/store_null.cc' object='null/store_null.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/null/store_null.Po' tmpdepfile='$(DEPDIR)/null/store_null.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='null/$(DEPDIR)/store_null.Po' tmpdepfile='null/$(DEPDIR)/store_null.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o null/store_null.o `test -f null/store_null.cc || echo '$(srcdir)/'`null/store_null.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o null/store_null.o `test -f 'null/store_null.cc' || echo '$(srcdir)/'`null/store_null.cc
 
 null/store_null.obj: null/store_null.cc
 @AMDEP_TRUE@	source='null/store_null.cc' object='null/store_null.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/null/store_null.Po' tmpdepfile='$(DEPDIR)/null/store_null.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='null/$(DEPDIR)/store_null.Po' tmpdepfile='null/$(DEPDIR)/store_null.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o null/store_null.obj `cygpath -w null/store_null.cc`
 
 ufs/store_dir_ufs.o: ufs/store_dir_ufs.cc
 @AMDEP_TRUE@	source='ufs/store_dir_ufs.cc' object='ufs/store_dir_ufs.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/ufs/store_dir_ufs.Po' tmpdepfile='$(DEPDIR)/ufs/store_dir_ufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='ufs/$(DEPDIR)/store_dir_ufs.Po' tmpdepfile='ufs/$(DEPDIR)/store_dir_ufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ufs/store_dir_ufs.o `test -f ufs/store_dir_ufs.cc || echo '$(srcdir)/'`ufs/store_dir_ufs.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ufs/store_dir_ufs.o `test -f 'ufs/store_dir_ufs.cc' || echo '$(srcdir)/'`ufs/store_dir_ufs.cc
 
 ufs/store_dir_ufs.obj: ufs/store_dir_ufs.cc
 @AMDEP_TRUE@	source='ufs/store_dir_ufs.cc' object='ufs/store_dir_ufs.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/ufs/store_dir_ufs.Po' tmpdepfile='$(DEPDIR)/ufs/store_dir_ufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='ufs/$(DEPDIR)/store_dir_ufs.Po' tmpdepfile='ufs/$(DEPDIR)/store_dir_ufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ufs/store_dir_ufs.obj `cygpath -w ufs/store_dir_ufs.cc`
 
 ufs/store_io_ufs.o: ufs/store_io_ufs.cc
 @AMDEP_TRUE@	source='ufs/store_io_ufs.cc' object='ufs/store_io_ufs.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/ufs/store_io_ufs.Po' tmpdepfile='$(DEPDIR)/ufs/store_io_ufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='ufs/$(DEPDIR)/store_io_ufs.Po' tmpdepfile='ufs/$(DEPDIR)/store_io_ufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ufs/store_io_ufs.o `test -f ufs/store_io_ufs.cc || echo '$(srcdir)/'`ufs/store_io_ufs.cc
+	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ufs/store_io_ufs.o `test -f 'ufs/store_io_ufs.cc' || echo '$(srcdir)/'`ufs/store_io_ufs.cc
 
 ufs/store_io_ufs.obj: ufs/store_io_ufs.cc
 @AMDEP_TRUE@	source='ufs/store_io_ufs.cc' object='ufs/store_io_ufs.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@	depfile='$(DEPDIR)/ufs/store_io_ufs.Po' tmpdepfile='$(DEPDIR)/ufs/store_io_ufs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='ufs/$(DEPDIR)/store_io_ufs.Po' tmpdepfile='ufs/$(DEPDIR)/store_io_ufs.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o ufs/store_io_ufs.obj `cygpath -w ufs/store_io_ufs.cc`
 CXXDEPMODE = @CXXDEPMODE@
@@ -534,7 +538,7 @@ uninstall-info-am:
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
 $(RECURSIVE_TARGETS):
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -554,7 +558,7 @@ $(RECURSIVE_TARGETS):
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	case "$@" in \
 	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
@@ -582,16 +586,19 @@ tags-recursive:
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	mkid -fID $$unique $(LISP)
+	mkid -fID $$unique
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -602,46 +609,51 @@ TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS) $(TAGS_FILES)'; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || etags $(ETAGS_ARGS) $$tags  $$unique $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
 
 GTAGS:
-	here=`CDPATH=: && cd $(top_builddir) && pwd` \
+	here=`$(am__cd) $(top_builddir) && pwd` \
 	  && cd $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
 	$(mkinstalldirs) $(distdir)/coss
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
 	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(DIST_SUBDIRS); do \
+	list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
 	    test -d $(distdir)/$$subdir \
 	    || mkdir $(distdir)/$$subdir \
@@ -671,14 +683,15 @@ install-am: all-am
 installcheck: installcheck-recursive
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -1,6 +1,7 @@
-# Makefile.in generated automatically by automake 1.5 from Makefile.am.
+# Makefile.in generated by automake 1.6.3 from Makefile.am.
+# @configure_input@
 
-# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -12,7 +13,6 @@
 # PARTICULAR PURPOSE.
 
 @SET_MAKE@
-
 SHELL = @SHELL@
 
 srcdir = @srcdir@
@@ -43,9 +43,13 @@ AUTOCONF = @AUTOCONF@
 AUTOMAKE = @AUTOMAKE@
 AUTOHEADER = @AUTOHEADER@
 
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA = @INSTALL_DATA@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_HEADER = $(INSTALL_DATA)
 transform = @program_transform_name@
@@ -57,6 +61,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 host_alias = @host_alias@
 host_triplet = @host@
+
+EXEEXT = @EXEEXT@
+OBJEXT = @OBJEXT@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 AMTAR = @AMTAR@
 AR = @AR@
 AR_R = @AR_R@
@@ -74,7 +82,6 @@ DEPDIR = @DEPDIR@
 DIGEST_AUTH_HELPERS = @DIGEST_AUTH_HELPERS@
 ERR_DEFAULT_LANGUAGE = @ERR_DEFAULT_LANGUAGE@
 ERR_LANGUAGES = @ERR_LANGUAGES@
-EXEEXT = @EXEEXT@
 EXTERNAL_ACL_HELPERS = @EXTERNAL_ACL_HELPERS@
 FALSE = @FALSE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -87,7 +94,6 @@ MAINT = @MAINT@
 MKDIR = @MKDIR@
 MV = @MV@
 NTLM_AUTH_HELPERS = @NTLM_AUTH_HELPERS@
-OBJEXT = @OBJEXT@
 OPT_DEFAULT_HOSTS = @OPT_DEFAULT_HOSTS@
 PACKAGE = @PACKAGE@
 PERL = @PERL@
@@ -104,6 +110,7 @@ STORE_LIBS = @STORE_LIBS@
 STORE_MODULES = @STORE_MODULES@
 STORE_MODULE_SUBDIRS = @STORE_MODULE_SUBDIRS@
 STORE_OBJS = @STORE_OBJS@
+STRIP = @STRIP@
 TRUE = @TRUE@
 VERSION = @VERSION@
 XTRA_LIBS = @XTRA_LIBS@
@@ -125,29 +132,31 @@ $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am  $(top_srcdir)/configu
 	cd $(top_srcdir) && \
 	  $(AUTOMAKE) --foreign  src/fs/aufs/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) && \
-	  CONFIG_HEADERS= CONFIG_LINKS= \
-	  CONFIG_FILES=$(subdir)/$@ $(SHELL) ./config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
 uninstall-info-am:
 tags: TAGS
 TAGS:
 
-
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 
 top_distdir = ../../..
 distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
+	@list='$(DISTFILES)'; for file in $$list; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    $(mkinstalldirs) "$(distdir)/$$dir"; \
+	    dir="/$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
 	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pR $$d/$$file $(distdir) \
-	    || exit 1; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || cp -p $$d/$$file $(distdir)/$$file \
@@ -171,14 +180,15 @@ install-am: all-am
 installcheck: installcheck-am
 install-strip:
 	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  INSTALL_STRIP_FLAG=-s \
 	  `test -z '$(STRIP)' || \
 	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES) stamp-h stamp-h[0-9]*
+	-rm -f Makefile $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -227,7 +237,6 @@ uninstall-am: uninstall-info-am
 	maintainer-clean maintainer-clean-generic mostlyclean \
 	mostlyclean-generic uninstall uninstall-am uninstall-info-am
 
-
 all clean:
 	@cd .. && $(MAKE) $(MFLAGS) aufs/$@
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
@@ -1,5 +1,5 @@
 /*
- * $Id: aiops.cc,v 1.21 2003/01/09 12:27:18 robertc Exp $
+ * $Id: aiops.cc,v 1.22 2003/01/23 00:38:09 robertc Exp $
  *
  * DEBUG: section 43    AIOPS
  * AUTHOR: Stewart Forster <slf@connect.com.au>
@@ -1,6 +1,6 @@
 
 /*
- * $Id: async_io.cc,v 1.21 2003/01/04 01:28:13 hno Exp $
+ * $Id: async_io.cc,v 1.22 2003/01/23 00:38:09 robertc Exp $
  *
  * DEBUG: section 32    Asynchronous Disk I/O
  * AUTHOR: Pete Bentley <pete@demon.net>
@@ -37,6 +37,7 @@
 #include "squid.h"
 #include "store_asyncufs.h"
 #include "Store.h"
+#include "fde.h"
 
 #define _AIO_OPEN	0
 #define _AIO_READ	1
@@ -1,6 +1,6 @@
 
 /*
- * $Id: store_dir_aufs.cc,v 1.53 2002/12/27 10:26:35 robertc Exp $
+ * $Id: store_dir_aufs.cc,v 1.54 2003/01/23 00:38:09 robertc Exp $
  *
  * DEBUG: section 47    Store Directory Routines
  * AUTHOR: Duane Wessels