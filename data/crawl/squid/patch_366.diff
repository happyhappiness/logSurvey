@@ -171,9 +171,13 @@ max(A const & lhs, A const & rhs)
  * Signalling flags are apparently not always provided.
  * TODO find out if these can be moved into specific OS portability files.
  */
+#if defined(__cplusplus)
+#include <csignal>
+#else
 #if HAVE_SIGNAL_H
 #include <signal.h>
 #endif
+#endif
 #ifndef SA_RESTART
 #define SA_RESTART 0
 #endif
@@ -41,10 +41,9 @@
 #define sys_nerr _sys_nerr
 
 #undef assert
-#include <assert.h>
-#include <stdio.h>
+#include <cassert>
+#include <cstring>
 #include <fcntl.h>
-#include <string.h>
 #include <sys/timeb.h>
 #if HAVE_WIN32_PSAPI
 #include <psapi.h>
@@ -15,7 +15,7 @@
 
 // Import the stdio.h definitions first to do the state setup
 #if HAVE_STDIO_H
-#include<stdio.h>
+#include <stdio.h>
 #endif
 
 // Check for the buggy case
@@ -46,7 +46,7 @@ inline FILE * tmpfile(void) { return tmpfile64(); }
 #endif /* __USE_FILE_OFFSET64 && !__REDIRECT */
 
 // Finally import the <cstdio> stuff we actually use
-#if HAVE_CSTDIO && defined(__cplusplus)
+#if defined(__cplusplus)
 #include <cstdio>
 #endif
 
@@ -6,7 +6,7 @@
  * We provide a clean set of wrappers for the various operations
  * Depending on what is available and needed.
  */
-#if HAVE_CSTDARG && defined(__cplusplus)
+#if defined(__cplusplus)
 #include <cstdarg>
 
 #else
@@ -18,7 +18,7 @@
 #define VA_SHIFT(v,t) ;         /* no-op for ANSI */
 #define VA_END va_end(ap)
 
-#else
+#else /* !HAVE_STDARG_H */
 #if HAVE_VARARGS_H
 #include <varargs.h>
 #undef HAVE_STDARGS
@@ -27,7 +27,7 @@
 #define VA_SHIFT(v,t) v = va_arg(ap,t)
 #define VA_END va_end(ap)
 
-#else
+#else /* !HAVE_VARARGS_H*/
 #error XX **NO VARARGS ** XX
 #endif /* HAVE_VARARGS_H */
 #endif /* HAVE_STDARG_H */
@@ -59,9 +59,7 @@
 #if HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstring>
 
 /**
  * Find the first occurrence of find in s, where the search is limited to the
@@ -1,9 +1,7 @@
 #define SQUID_UNIT_TEST 1
 #include "squid.h"
 
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
+#include <cassert>
 
 #include "testPreCompiler.h"
 
@@ -1,9 +1,7 @@
 #include "squid.h"
 #include "compat/xstrerror.h"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstring>
 
 #if _SQUID_WINDOWS_
 static struct _wsaerrtext {
@@ -2161,18 +2161,11 @@ AC_HEADER_DIRENT
 AC_HEADER_STDC
 
 AC_CHECK_HEADERS( \
-  algorithm \
   arpa/inet.h \
   arpa/nameser.h \
   assert.h \
   bstring.h \
-  cassert \
   crypt.h \
-  cstdarg \
-  cstdio \
-  cstdlib \
-  cstring \
-  list \
   ctype.h \
   errno.h \
   execinfo.h \
@@ -2182,11 +2175,6 @@ AC_CHECK_HEADERS( \
   glob.h \
   gnumalloc.h \
   grp.h \
-  iosfwd \
-  iomanip \
-  iostream \
-  fstream \
-  climits \
   ip_compat.h \
   ip_fil_compat.h \
   ip_fil.h \
@@ -2195,16 +2183,13 @@ AC_CHECK_HEADERS( \
   lber.h \
   ldap.h \
   libc.h \
-  limits \
   limits.h \
   linux/posix_types.h \
   linux/types.h \
   machine/byte_swap.h \
   malloc.h \
-  map \
   math.h \
   memory.h \
-  memory \
   mount.h \
   netdb.h \
   netinet/in.h \
@@ -2218,7 +2203,6 @@ AC_CHECK_HEADERS( \
   netinet/tcp.h \
   openssl/engine.h \
   openssl/txt_db.h \
-  ostream \
   paths.h \
   poll.h \
   pwd.h \
@@ -2227,14 +2211,11 @@ AC_CHECK_HEADERS( \
   sched.h \
   siginfo.h \
   signal.h \
-  sstream \
   stdarg.h \
   stdbool.h \
   stddef.h \
-  stdexcept \
   stdio.h \
   stdlib.h \
-  string \
   string.h \
   strings.h \
   sys/bitypes.h \
@@ -35,7 +35,6 @@
  * - initial version (Richard Huveneers <Richard.Huveneers@hekkihek.hacom.nl>)
  */
 
-#include <stdio.h>
 #include <unistd.h>
 #include <string.h>
 #include <ctype.h>
@@ -89,9 +89,8 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#include <stdio.h>
-#include <string.h>
-#include <ctype.h>
+#include <cctype>
+#include <cstring>
 
 #if _SQUID_WINDOWS_ && !_SQUID_CYGWIN_
 #define snprintf _snprintf
@@ -10,13 +10,14 @@
  * The code originated from denyusers.c.
  */
 
-#include <stdlib.h>
+#include "msntauth.h"
+#include "usersfile.h"
+
+#include <cstdlib>
+#include <cstring>
 #include <unistd.h>
 #include <sys/types.h>
 #include <sys/param.h>
-#include <string.h>
-#include "msntauth.h"
-#include "usersfile.h"
 
 static usersfile AllowUsers;
 static int init = 0;
@@ -13,14 +13,13 @@
 /* Squid provides a number of portability overrides */
 #include "squid.h"
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
+#include <cassert>
+#include <cerrno>
+#include <cstdlib>
+#include <cstring>
 #include <syslog.h>
-#include <errno.h>
 #include <sys/param.h>
 #include <netdb.h>
-#include <assert.h>
 
 #include "msntauth.h"
 #include "valid.h"
@@ -9,15 +9,15 @@
  * have been explicitly denied by the system administrator.
  * Routines at the bottom also use the allowed user functions.
  */
+#include "msntauth.h"
+#include "usersfile.h"
 
-#include <stdlib.h>
+#include <cstdlib>
+#include <cstring>
+#include <ctime>
 #include <unistd.h>
-#include <time.h>
 #include <sys/types.h>
 #include <sys/param.h>
-#include <string.h>
-#include "msntauth.h"
-#include "usersfile.h"
 
 static usersfile DenyUsers;
 static int init = 0;
@@ -33,10 +33,9 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#include <stdio.h>
-#include <signal.h>
+#include <csignal>
+#include <cstring>
 #include <syslog.h>
-#include <string.h>
 
 #include "msntauth.h"
 
@@ -11,14 +11,13 @@
 #include "squid.h"
 #include "util.h"
 
-#include <stdio.h>
-#include <string.h>
+#include <cctype>
+#include <cerrno>
+#include <cstring>
+#include <ctime>
 #include <syslog.h>
 #include <unistd.h>
 #include <sys/stat.h>
-#include <errno.h>
-#include <time.h>
-#include <ctype.h>
 #include <sys/param.h>
 #include <fcntl.h>
 
@@ -23,24 +23,17 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
+#include <cerrno>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
 #if HAVE_CRYPT_H
 #include <crypt.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 static hash_table *hash = NULL;
 static HASHFREE my_free;
@@ -15,17 +15,11 @@
  *
  */
 #include "squid.h"
-
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-
 #include "crypt_md5.h"
 #include "md5.h"
 
+#include <cstring>
+
 static unsigned char itoa64[] =	/* 0 ... 63 => ascii - 64 */
     "./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
 
@@ -9,18 +9,11 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
+#include <cstdlib>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
@@ -3,15 +3,8 @@
  */
 #include "squid.h"
 
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstdlib>
+#include <cstring>
 #if HAVE_SYSLOG_H
 #include <syslog.h>
 #endif
@@ -68,21 +68,10 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_SIGNAL_H
-#include <signal.h>
-#endif
-#if HAVE_TIME_H
-#include <time.h>
-#endif
+#include <cassert>
+#include <csignal>
+#include <cstring>
+#include <ctime>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -51,6 +51,10 @@
 #include "radius-util.h"
 #include "radius.h"
 
+#include <cctype>
+#include <cerrno>
+#include <cstring>
+#include <ctime>
 #if HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
 #endif
@@ -66,12 +70,6 @@
 #if _SQUID_WINDOWS_
 #include <io.h>
 #endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -81,18 +79,9 @@
 #if HAVE_PWD_H
 #include <pwd.h>
 #endif
-#if HAVE_TIME_H
-#include <time.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 /* AYJ: helper input buffer may be a lot larger than this used to expect... */
 #define MAXPWNAM	254
@@ -37,35 +37,24 @@ char util_sccsid[] =
     "		2.1 Copyright 1997 Cistron Internet Services B.V.";
 
 #include "squid.h"
+#include "md5.h"
+#include "radius-util.h"
 
+#include <cctype>
+#include <csignal>
+#include <ctime>
 #if HAVE_SYS_SOCKET_H
-#include	<sys/socket.h>
+#include <sys/socket.h>
 #endif
 #if HAVE_NETINET_IN_H
-#include	<netinet/in.h>
-#endif
-
-#if HAVE_STDIO_H
-#include	<stdio.h>
+#include <netinet/in.h>
 #endif
 #if HAVE_NETDB_H
-#include	<netdb.h>
+#include <netdb.h>
 #endif
 #if HAVE_PWD_H
-#include	<pwd.h>
-#endif
-#if HAVE_TIME_H
-#include	<time.h>
+#include <pwd.h>
 #endif
-#if HAVE_CTYPE_H
-#include	<ctype.h>
-#endif
-#if HAVE_SIGNAL_H
-#include	<signal.h>
-#endif
-
-#include	"md5.h"
-#include	"radius-util.h"
 
 /*
  *	Check for valid IP address in standard dot notation.
@@ -29,18 +29,9 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cerrno>
+#include <cstdlib>
+#include <cstring>
 #if HAVE_SASL_SASL_H
 #include <sasl/sasl.h>
 #else
@@ -45,12 +45,7 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstring>
 
 #define NMB_UNICAST		1
 #define NMB_BROADCAST	2
@@ -30,9 +30,6 @@
 #include "util.h"
 #include "valid.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if GETOPT_H
 #include <getopt.h>
 #endif
@@ -61,7 +61,6 @@ extern const char * errormsg;
 
 /* Debugging stuff */
 #if defined(__GNUC__)			/* this is really a gcc-ism */
-#include <stdio.h>
 #include <unistd.h>
 static char *__foo;
 #define debug(X...) if (debug_enabled) { \
@@ -15,12 +15,7 @@
 #include "squid.h"
 #include "helpers/defines.h"
 
-#if HAVE_CSTRING
 #include <cstring>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 
 /**
  * options:
@@ -27,20 +27,12 @@
 #include "squid.h"
 #include "helpers/defines.h"
 #include "rfc1738.h"
-//#include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
+#include <cstdlib>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_CRYPT_H
 #include <crypt.h>
 #endif
@@ -11,21 +11,12 @@
 #ifndef SQUID_DIGEST_COMMON_H_
 #define SQUID_DIGEST_COMMON_H_
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
+#include <cctype>
+#include <cstdlib>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
@@ -11,21 +11,12 @@
 #ifndef SQUID_DIGEST_COMMON_H_
 #define SQUID_DIGEST_COMMON_H_
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
+#include <cctype>
+#include <cstdlib>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_STRINGS_H
 #include <strings.h>
 #endif
@@ -15,15 +15,10 @@
 #include "rfc2617.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
@@ -66,20 +66,13 @@
 int _wcsicmp(const wchar_t *, const wchar_t *);
 #endif
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#undef assert
+#include <cassert>
+#include <cctype>
+#include <cstring>
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
-#undef assert
-#include <assert.h>
 #include <windows.h>
 #include <objbase.h>
 #include <initguid.h>
@@ -41,15 +41,8 @@
 
 #define LDAP_DEPRECATED 1
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
+#include <cctype>
+#include <cstring>
 
 #if _SQUID_WINDOWS_ && !_SQUID_CYGWIN_
 
@@ -77,20 +77,13 @@
 int _wcsicmp(const wchar_t *, const wchar_t *);
 #endif
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#undef assert
+#include <cassert>
+#include <cctype>
+#include <cstring>
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
-#undef assert
-#include <assert.h>
 #include <windows.h>
 #include <lm.h>
 #include <ntsecapi.h>
@@ -35,30 +35,19 @@
 #define EDUI_PROGRAM_VERSION		"2.1"
 
 /* System includes */
-#ifdef HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #ifndef _GNU_SOURCE
 #define _GNU_SOURCE
 #endif
 #ifndef __USE_GNU
 #define __USE_GNU
 #endif
-#ifdef HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#ifdef HAVE_STRING_H
-#include <string.h>
-#endif
-#ifdef HAVE_CTYPE_H
-#include <ctype.h>
-#endif
-#ifdef HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#ifdef HAVE_SIGNAL_H
-#include <signal.h>
-#endif
+#include <cctype>
+#include <cerrno>
+#include <csignal>
+#include <cstdarg>
+#include <cstdlib>
+#include <cstring>
+#include <ctime>
 #ifdef HAVE_ARPA_INET_H
 #include <arpa/inet.h>
 #endif
@@ -69,12 +58,6 @@
 #ifdef HAVE_LDAP_H
 #include <ldap.h>
 #endif
-#ifdef HAVE_STDARG_H
-#include <stdarg.h>
-#endif
-#ifdef HAVE_TIME_H
-#include <time.h>
-#endif
 
 #ifdef HELPER_INPUT_BUFFER
 #define EDUI_MAXLEN		HELPER_INPUT_BUFFER
@@ -23,15 +23,8 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstdlib>
+#include <cstring>
 #if HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
 #endif
@@ -37,9 +37,7 @@
 #ifdef HAVE_LDAP
 
 #include "support.h"
-#ifdef HAVE_CTYPE_H
-#include <ctype.h>
-#endif
+#include <cctype>
 
 void
 init_args(struct main_args *margs)
@@ -420,8 +418,7 @@ strup(char *s)
 }
 
 #else
-#include <stdio.h>
-#include <stdlib.h>
+#include <cstdlib>
 int
 main(int argc, char *const argv[])
 {
@@ -24,9 +24,7 @@
 
 #define KERBEROS_LDAP_GROUP_VERSION "1.3.1sq"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstring>
 
 #if HAVE_KRB5_H
 #if HAVE_BROKEN_SOLARIS_KRB5_H
@@ -27,9 +27,7 @@
 #ifdef HAVE_LDAP
 
 #include "support.h"
-#ifdef HAVE_TIME_H
-#include <time.h>
-#endif
+#include <ctime>
 
 const char *
 LogTime()
@@ -23,19 +23,18 @@
 #endif
 #include "helpers/defines.h"
 
+#include <cstdlib>
+#include <cstring>
+#include <ctime>
 #if HAVE_DB_H
 #include <db.h>
 #endif
 #include <fcntl.h>
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
 #include <sys/types.h>
 #include <sys/stat.h>
-#include <time.h>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -18,22 +18,19 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111, USA.
  */
 
-#if HAVE_CONFIG_H
 #include "squid.h"
-#endif
 #include "helpers/defines.h"
 
+#include <cstdarg>
+#include <cstdlib>
+#include <cstring>
+#include <ctime>
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <stdarg.h>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#include <string.h>
-#include <time.h>
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
@@ -58,12 +58,8 @@
 #include "rfc1738.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cctype>
+#include <cstring>
 #if HAVE_GRP_H
 #include <grp.h>
 #endif
@@ -73,9 +69,6 @@
 #if HAVE_PWD_H
 #include <pwd.h>
 #endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
 
 /*
  * Verify if user's primary group matches groupname
@@ -1,32 +1,21 @@
 #include "squid.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
+#include <cassert>
+#include <cerrno>
+#include <csignal>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 #if HAVE_FCNTL_H
 #include <fcntl.h>
 #endif
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
 #if HAVE_SYS_PARAM_H
 #include <sys/param.h>
 #endif
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
-#if HAVE_SIGNAL_H
-#include <signal.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_PATHS_H
 #include <paths.h>
 #endif
@@ -27,21 +27,14 @@
  * -----------------------------------------------------------------------------
  */
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
+#include <cstring>
+#include <ctime>
 #if HAVE_NETDB_H
 #include <netdb.h>
 #endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_TIME_H
-#include <time.h>
-#endif
 
 #include "base64.h"
 #include "util.h"
@@ -492,8 +492,7 @@ main(int argc, char *const argv[])
     }
 }
 #else
-#include <stdio.h>
-#include <stdlib.h>
+#include <cstdlib>
 #ifndef MAX_AUTHTOKEN_LEN
 #define MAX_AUTHTOKEN_LEN   65535
 #endif
@@ -29,24 +29,15 @@
 
 #if HAVE_GSSAPI
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
+#include <cerrno>
+#include <cstring>
+#include <ctime>
 #if HAVE_NETDB_H
 #include <netdb.h>
 #endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_TIME_H
-#include <time.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 #include "base64.h"
 #include "util.h"
@@ -238,7 +229,7 @@ main(int argc, char *argv[])
 }
 
 #else
-#include <stdlib.h>
+#include <cstdlib>
 int
 main(int argc, char *argv[])
 {
@@ -28,27 +28,16 @@
 #include "squid.h"
 #include "base64.h"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
+#include <cerrno>
+#include <cstring>
+#include <cstdlib>
+#include <ctime>
 #if HAVE_NETDB_H
 #include <netdb.h>
 #endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_TIME_H
-#include <time.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 #if !defined(HAVE_DECL_XMALLOC) || !HAVE_DECL_XMALLOC
 #define xmalloc malloc
@@ -56,14 +56,9 @@
 #include "helpers/defines.h"
 #include "ntlmauth/ntlmauth.h"
 #include "ntlmauth/support_bits.cci"
-//#include "util.h"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
+#include <cctype>
+#include <cstring>
 #if HAVE_CRYPT_H
 #include <crypt.h>
 #endif
@@ -73,9 +68,6 @@
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STDINT_H
 #include <stdint.h>
 #endif
@@ -20,41 +20,23 @@
 #include "ntlmauth/support_bits.cci"
 #include "rfcnb/rfcnb.h"
 #include "smblib/smblib.h"
-//#include "util.h"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cassert>
+#include <cctype>
+#include <cerrno>
+#include <csignal>
+#include <cstdlib>
+#include <cstring>
+#include <ctime>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_SIGNAL_H
-#include <signal.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
-#if HAVE_TIME_H
-#include <time.h>
-#endif
 
 /************* CONFIGURATION ***************/
 
@@ -15,12 +15,7 @@
 #include "squid.h"
 #include "helpers/defines.h"
 
-#if HAVE_CSTRING
 #include <cstring>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 
 /**
  * options:
@@ -31,12 +31,8 @@
 #ifndef SQUID_RANGE_H
 #define SQUID_RANGE_H
 
-#if HAVE_IOSFWD
 #include <iosfwd>
-#endif
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 /* represents [start, end) */
 
@@ -32,9 +32,6 @@
 #ifndef SQUID_UTIL_H
 #define SQUID_UTIL_H
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_TIME_H
 #include <time.h>
 #endif
@@ -32,19 +32,16 @@
  */
 
 #include "squid.h"
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
+
+#include <cassert>
 
 #include "MemPool.h"
 #include "MemPoolChunked.h"
 #include "MemPoolMalloc.h"
 
 #define FLUSH_LIMIT 1000	/* Flush memPool counters to memMeters after flush limit calls */
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstring>
 
 /*
  * XXX This is a boundary violation between lib and src.. would be good
@@ -80,17 +80,14 @@
  */
 
 #include "squid.h"
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
+
+#include <cassert>
 
 #include "MemPoolChunked.h"
 
 #define MEM_MAX_MMAP_CHUNKS 2048
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstring>
 
 /*
  * XXX This is a boundary violation between lib and src.. would be good
@@ -32,15 +32,10 @@
  */
 
 #include "squid.h"
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
-
 #include "MemPoolMalloc.h"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cassert>
+#include <cstring>
 
 /*
  * XXX This is a boundary violation between lib and src.. would be good
@@ -5,12 +5,7 @@
 
 #include "squid.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
+#include <cstdlib>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -7,9 +7,6 @@
 #include "squid.h"
 #include "base64.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
@@ -33,7 +33,6 @@
 static char sccsid[] = "@(#)getopt.c	8.3 (Berkeley) 4/27/95";
 #endif /* LIBC_SCCS and not lint */
 
-#include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 
@@ -35,15 +35,10 @@
 #include "hash.h"
 #include "profiler/Profiler.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cassert>
+#include <cmath>
+#include <cstdlib>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -52,12 +47,6 @@
 #elif HAVE_MALLOC_H
 #include <malloc.h>
 #endif
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
-#if HAVE_MATH_H
-#include <math.h>
-#endif
 
 static void hash_next_bucket(hash_table * hid);
 
@@ -47,9 +47,6 @@
 #if HAVE_STRING_H
 #include <string.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 
 #include "util.h"
 
@@ -33,9 +33,6 @@
 #include "squid.h"
 #include "html_quote.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STRING_H
 #include <string.h>
 #endif
@@ -1,9 +1,6 @@
 #include "squid.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STRING_H
 #include <string.h>
 #endif
@@ -19,7 +19,6 @@
 
 #include "squid.h"
 #include "Trie.h"
-#include <stdio.h>
 
 int
 main (int argc, char **argv)
@@ -21,9 +21,7 @@
 #include "libTrie/Trie.h"
 #include "libTrie/TrieCharTransform.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 bool
 CaseSensitiveCheck()
@@ -36,15 +36,11 @@
 #include "profiler/Profiler.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
+#include <cassert>
+#include <cctype>
+#include <cerrno>
+#include <cmath>
+#include <cstring>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -53,15 +49,6 @@
 #elif HAVE_MALLOC_H
 #include <malloc.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#if HAVE_MATH_H
-#include <math.h>
-#endif
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
 
 #if MEM_GEN_TRACE
 
@@ -5,7 +5,7 @@
 
 #include "squid.h"
 #include "md5.h"
-#include "stdio.h"
+//#include "stdio.h" // ???
 
 static void MDPrint(unsigned char digest[16]);
 static void MDString(char *string);
@@ -25,9 +25,7 @@
 
 #include "squid.h"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cstring>
 #if HAVE_STRINGS_H
 #include <strings.h>
 #endif
@@ -116,9 +116,7 @@
 
 #if USE_XPROF_STATS
 
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
+#include <cassert>
 #if HAVE_GNUMALLLOC_H
 #include <gnumalloc.h>
 #elif HAVE_MALLOC_H
@@ -71,9 +71,6 @@
 #if HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
@@ -39,9 +39,6 @@
 #include "squid.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STRING_H
 #include <string.h>
 #endif
@@ -37,9 +37,6 @@
  *  Adapted from HTSUtils.c in CERN httpd 3.0 (http://info.cern.ch/httpd/)
  *  by Darren Hardy <hardy@cs.colorado.edu>, November 1994.
  */
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STRING_H
 #include <string.h>
 #endif
@@ -33,9 +33,6 @@
 #include "squid.h"
 #include "rfc1738.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STRING_H
 #include <string.h>
 #endif
@@ -57,9 +57,6 @@
 #include "compat/inet_pton.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -41,7 +41,6 @@ typedef short int16;
 #endif
 #include <signal.h>
 #include <errno.h>
-#include <stdio.h>
 #include <unistd.h>
 
 #define TRUE 1
@@ -31,8 +31,6 @@
 /* ensure we don't overwrite strings when not passed enough space. Also */
 /* added code to say unknown error codes if we see any                  */
 
-#include <stdio.h>
-
 typedef struct {
     char *name;
     int code;
@@ -34,7 +34,6 @@
 #include <sys/socket.h>
 #include <signal.h>
 #include <errno.h>
-#include <stdio.h>
 #include <unistd.h>
 #include <strings.h>
 
@@ -33,8 +33,6 @@
 
 #include "squid.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -29,8 +29,6 @@
 
 #include "squid.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -24,8 +24,6 @@ SOFTWARE.
 #define SQUID_NO_STRING_BUFFER_PROTECT 1
 #include "squid.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -32,8 +32,6 @@ SOFTWARE.
 #include "snmp_vars.h"
 #include "util.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -25,8 +25,6 @@
 
 #include "squid.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -31,8 +31,6 @@
  ***************************************************************************/
 
 #include "squid.h"
-
-#include <stdio.h>
 #include "snmp_api_error.h"
 
 /***************************************************************************
@@ -27,9 +27,6 @@
  **********************************************************************/
 
 #include "squid.h"
-
-#include <stdio.h>
-
 #include "snmp_error.h"
 
 static const char *error_string[25] = {
@@ -35,8 +35,6 @@
 
 #include "squid.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -35,8 +35,6 @@
 
 #include "squid.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -34,8 +34,6 @@
 
 #include "squid.h"
 
-#include <stdio.h>
-
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -1,7 +1,5 @@
 #include "squid.h"
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
+
 #if HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
@@ -1,9 +1,7 @@
 #define SQUID_UNIT_TEST 1
 #include "squid.h"
 
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
+#include <cassert>
 
 #include "testRFC1035.h"
 
@@ -1,9 +1,7 @@
 #define SQUID_UNIT_TEST 1
 #include "squid.h"
 
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
+#include <cassert>
 
 #include "testRFC1738.h"
 
@@ -35,9 +35,6 @@
 #include "squid.h"
 #include "util.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_STRING_H
 #include <string.h>
 #endif
@@ -35,11 +35,10 @@
 #define SQUID_CONFIGPARSER_H
 
 #include "SquidString.h"
+
 #include <queue>
 #include <stack>
-#if HAVE_STRING
 #include <string>
-#endif
 
 class wordlist;
 /**
@@ -9,12 +9,8 @@
 #include "Debug.h"
 #include "util.h"
 
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cerrno>
+#include <cstring>
 
 CpuAffinitySet::CpuAffinitySet()
 {
@@ -32,17 +32,10 @@
 #ifndef SQUID_DEBUG_H
 #define SQUID_DEBUG_H
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
-
 #undef assert
-#if HAVE_SSTREAM
 #include <sstream>
-#endif
-#if HAVE_IOMANIP
 #include <iomanip>
-#endif
 #if defined(assert)
 #undef assert
 #endif
@@ -34,9 +34,8 @@
 #include "DiskIO/DiskDaemon/diomsg.h"
 #include "hash.h"
 
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
+#include <cerrno>
+#include <iostream>
 #if HAVE_SYS_IPC_H
 #include <sys/ipc.h>
 #endif
@@ -46,9 +45,6 @@
 #if HAVE_SYS_SHM_H
 #include <sys/shm.h>
 #endif
-#if HAVE_IOSTREAM
-#include <iostream>
-#endif
 
 void
 xassert(const char *msg, const char *file, int line)
@@ -35,22 +35,21 @@
 #endif
 
 #include "squid.h"
+#include "DiskIO/DiskThreads/CommIO.h"
 #include "DiskThreads.h"
 #include "SquidConfig.h"
+#include "SquidTime.h"
+#include "Store.h"
 
-#include <stdio.h>
+#include <csignal>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <pthread.h>
 #include <errno.h>
 #include <dirent.h>
-#include <signal.h>
 #if HAVE_SCHED_H
 #include <sched.h>
 #endif
-#include "DiskIO/DiskThreads/CommIO.h"
-#include "SquidTime.h"
-#include "Store.h"
 
 #define RIDICULOUS_LENGTH	4096
 
@@ -40,12 +40,11 @@
 #include "SquidTime.h"
 #include "Store.h"
 
-#include <stdio.h>
+#include <csignal>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <errno.h>
 #include <dirent.h>
-#include <signal.h>
 
 #define RIDICULOUS_LENGTH	4096
 
@@ -34,9 +34,7 @@
 #include "squid.h"
 #include "ETag.h"
 
-#if HAVE_CSTRING
 #include <cstring>
-#endif
 
 /*
  * Note: ETag is not an http "field" like, for example HttpHdrRange. ETag is a
@@ -3,9 +3,7 @@
 #include "FadingCounter.h"
 #include "SquidTime.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif /* HAVE_MATH_H */
+#include <cmath>
 
 FadingCounter::FadingCounter(): horizon(-1), precision(10), delta(-1),
         lastTime(0), total(0)
@@ -32,9 +32,7 @@
 
 #include "dlink.h"
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 template <class _Arg, class _Result>
 struct unary_function {
@@ -6,7 +6,7 @@
 #include "HelperChildConfig.h"
 #include "Parsing.h"
 
-#include <string.h>
+#include <cstring>
 
 HelperChildConfig::HelperChildConfig(const unsigned int m):
         n_max(m),
@@ -5,9 +5,7 @@
 #include "MemBuf.h"
 #include "Notes.h"
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 class helper_stateful_server;
 
@@ -41,9 +41,7 @@
 #include "Store.h"
 #include "StrList.h"
 
-#if HAVE_MAP
 #include <map>
-#endif
 
 /* a row in the table used for parsing cache control header and statistics */
 typedef struct {
@@ -44,9 +44,7 @@
 #include "Store.h"
 #include "StrList.h"
 
-#if HAVE_MAP
 #include <map>
-#endif
 
 /* a row in the table used for parsing surrogate-control header and statistics */
 typedef struct {
@@ -6,18 +6,10 @@
 #include "HttpHeader.h"
 #include "typedefs.h"
 
-#if HAVE_FUNCTIONAL
 #include <functional>
-#endif
-#if HAVE_LIST
 #include <list>
-#endif
-#if HAVE_MAP
 #include <map>
-#endif
-#if HAVE_STRING
 #include <string>
-#endif
 #if HAVE_STRINGS_H
 #include <strings.h>
 #endif
@@ -37,9 +37,7 @@
 /* for FREE */
 #include "typedefs.h"
 
-#if HAVE_IOSFWD
 #include <iosfwd>
-#endif
 
 class StoreEntry;
 class MemPoolStats;
@@ -33,9 +33,7 @@
 #include "MemBlob.h"
 #include "SBufDetailedStats.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 MemBlobStats MemBlob::Stats;
 InstanceIdDefinitions(MemBlob, "blob");
@@ -9,9 +9,7 @@
 #include "SquidString.h"
 #include "typedefs.h"
 
-#if HAVE_STRING
 #include <string>
-#endif
 #include <vector>
 
 class HttpRequest;
@@ -36,9 +36,6 @@ class Packer;
 /* a common objPackInto interface; used by debugObj */
 typedef void (*ObjPackMethod) (void *obj, Packer * p);
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 /* append/vprintf's for Packer */
 typedef void (*append_f) (void *, const char *buf, int size);
 typedef void (*vprintf_f) (void *, const char *fmt, va_list args);
@@ -36,17 +36,9 @@
 #include "SBufExceptions.h"
 #include "util.h"
 
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-
-#if HAVE_SSTREAM
-#include <sstream>
-#endif
-
-#if HAVE_IOSTREAM
+#include <cstring>
 #include <iostream>
-#endif
+#include <sstream>
 
 #ifdef VA_COPY
 #undef VA_COPY
@@ -34,20 +34,12 @@
 #include "SBufExceptions.h"
 #include "SquidString.h"
 
-#if HAVE_CLIMITS
 #include <climits>
-#elif HAVE_LIMITS_H
-#include <limits.h>
-#endif
+#include <cstdarg>
+#include <iosfwd>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STDARG_H
-#include <stdarg.h>
-#endif
-#if HAVE_IOSFWD
-#include <iosfwd>
-#endif
 
 /* SBuf placeholder for printf */
 #ifndef SQUIDSBUFPH
@@ -32,9 +32,7 @@
 
 #include "SBuf.h"
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 /** streambuf class for a SBuf-backed stream interface.
  *
@@ -33,9 +33,7 @@
 #ifndef SQUID_STRING_H
 #define SQUID_STRING_H
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 /* squid string placeholder (for printf) */
 #ifndef SQUIDSTRINGPH
@@ -34,9 +34,7 @@
 
 #include "rfc1123.h"
 
-#if HAVE_TIME_H
-#include <time.h>
-#endif
+#include <ctime>
 /* NP: sys/time.h is provided by libcompat */
 
 /* globals for accessing time */
@@ -34,9 +34,8 @@
 #include "squid.h"
 #include "StatHist.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
+
 /* Local functions */
 static StatHistBinDumper statHistBinDumper;
 
@@ -51,9 +51,7 @@
 #include "esi/Element.h"
 #endif
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 class AsyncCall;
 class HttpRequest;
@@ -33,9 +33,7 @@
 
 #include "Store.h"
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 /*
  * This class provides a streambuf interface for writing
@@ -38,9 +38,7 @@
 #include "profiler/Profiler.h"
 #include "Store.h"
 
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
+#include <climits>
 
 int
 String::psize() const
@@ -17,9 +17,7 @@
 #include "tools.h"
 #include "Transients.h"
 
-#if HAVE_LIMITS_H
 #include <limits>
-#endif
 
 /// shared memory segment path to use for Transients maps
 static const char *MapLabel = "transients_map";
@@ -39,12 +39,8 @@
 #include "dlink.h"
 #include "MemPool.h"
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
-#if HAVE_STRING
 #include <string>
-#endif
 #include <vector>
 
 class ConfigParser;
@@ -4,9 +4,7 @@
 #include "acl/forward.h"
 #include "err_type.h"
 
-#if HAVE_SSTREAM
 #include <sstream>
-#endif
 
 class ConfigParser;
 class dlink_list;
@@ -40,9 +40,7 @@
 #include "HttpReply.h"
 #include "wordlist.h"
 
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
+#include <climits>
 
 static void aclParseHTTPStatusList(SplayNode<acl_httpstatus_data *> **curlist);
 static int aclHTTPStatusCompare(acl_httpstatus_data * const &a, acl_httpstatus_data * const &b);
@@ -15,9 +15,7 @@
 #include <libecap/common/options.h>
 #include <libecap/common/name.h>
 #include <libecap/common/named_values.h>
-#if HAVE_LIMITS
 #include <limits>
-#endif
 #include <map>
 
 /// libecap::adapter::services indexed by their URI
@@ -7,9 +7,7 @@
 #endif
 
 #include <cstring>
-#if HAVE_LIMITS
 #include <limits>
-#endif
 
 CBDATA_NAMESPACED_CLASS_INIT(AnyP, PortCfg);
 
@@ -1,9 +1,7 @@
 #ifndef _SQUID_SRC_ANYP_PROTOCOLTYPE_H
 #define _SQUID_SRC_ANYP_PROTOCOLTYPE_H
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 namespace AnyP
 {
@@ -3,9 +3,7 @@
 
 #include "anyp/ProtocolType.h"
 
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 namespace AnyP
 {
@@ -2,9 +2,8 @@
 #define SQUID_ANYP_URISCHEME_H
 
 #include "anyp/ProtocolType.h"
-#if HAVE_IOSFWD
+
 #include <iosfwd>
-#endif
 
 namespace AnyP
 {
@@ -6,12 +6,9 @@
 #define SQUID_LRUMAP_H
 
 #include "SquidTime.h"
-#if HAVE_LIST
+
 #include <list>
-#endif
-#if HAVE_MAP
 #include <map>
-#endif
 
 template <class EntryValue, size_t EntryCost = sizeof(EntryValue)> class LruMap
 {
@@ -36,9 +36,7 @@
 // reference counting requires the Lock API on base classes
 #include "base/Lock.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 /**
  * Template for Reference Counting pointers.
@@ -109,12 +109,8 @@
 #if HAVE_GLOB_H
 #include <glob.h>
 #endif
-#if HAVE_LIMITS_H
 #include <limits>
-#endif
-#if HAVE_LIST
 #include <list>
-#endif
 #if HAVE_PWD_H
 #include <pwd.h>
 #endif
@@ -41,9 +41,7 @@
 #include "Store.h"
 #include "URL.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
 
 #define ROTATE_LEFT(x, n) (((x) << (n)) | ((x) >> (32-(n))))
 
@@ -52,12 +52,10 @@
 #include "Store.h"
 #include "Generic.h"
 
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
+#include <climits>
 #if USE_CBDATA_DEBUG
-#include <vector>
 #include <algorithm>
+#include <vector>
 #endif
 
 #if WITH_VALGRIND
@@ -148,15 +148,9 @@
 #include "ssl/crtd_message.h"
 #endif
 
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
-#if HAVE_MATH_H
-#include <math.h>
-#endif
-#if HAVE_LIMITS
+#include <climits>
+#include <cmath>
 #include <limits>
-#endif
 
 #if LINGERING_CLOSE
 #define comm_close comm_lingering_close
@@ -63,6 +63,8 @@
 #include "ssl/support.h"
 #endif
 
+#include <cerrno>
+#include <cmath>
 #if _SQUID_CYGWIN_
 #include <sys/ioctl.h>
 #endif
@@ -72,12 +74,6 @@
 #if HAVE_SYS_UN_H
 #include <sys/un.h>
 #endif
-#if HAVE_MATH_H
-#include <math.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 /*
  * New C-like simple comm code. This stuff is a mess and doesn't really buy us anything.
@@ -48,12 +48,8 @@
 #include "eui/Eui64.h"
 #endif
 
-#if HAVE_IOSFWD
 #include <iosfwd>
-#endif
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 class CachePeer;
 
@@ -62,20 +62,16 @@
 #include "StatHist.h"
 #include "Store.h"
 
+#include <cerrno>
+#include <climits>
 #if HAVE_SYS_DEVPOLL_H
 /* Solaris /dev/poll support, see "man -s 7D poll" */
 #include <sys/devpoll.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
 
 #define DEBUG_DEVPOLL 0
 
-// OPEN_MAX is defined in <limits.h>
+// OPEN_MAX is defined in <climits>
 #define	DEVPOLL_UPDATESIZE	OPEN_MAX
 #define	DEVPOLL_QUERYSIZE	OPEN_MAX
 
@@ -9,13 +9,11 @@
 #include "profiler/Profiler.h"
 #include "SquidTime.h"
 #include "StatCounters.h"
-
 #if USE_DELAY_POOLS
 #include "ClientInfo.h"
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
+
+#include <cerrno>
 
 void
 Comm::Write(const Comm::ConnectionPointer &conn, MemBuf *mb, AsyncCall::Pointer &callback)
@@ -36,12 +36,8 @@
 #include "esi/Expression.h"
 #include "profiler/Profiler.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
+#include <cerrno>
+#include <cmath>
 
 /* stack precedence rules:
  * before pushing an operator onto the stack, the
@@ -11,14 +11,7 @@ namespace Ip
 class Address;
 };
 
-#if HAVE_CSTRING
 #include <cstring>
-#endif
-
-/* memcpy and friends */
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 
 namespace Eui
 {
@@ -8,18 +8,11 @@ namespace Ip
 class Address;
 }
 
-#if HAVE_CSTRING
 #include <cstring>
-#endif
 #if HAVE_SYS_EUI64_H
 #include <sys/eui64.h>
 #endif
 
-/* memcpy and friends */
-#if HAVE_STRING_H
-#include <string.h>
-#endif
-
 namespace Eui
 {
 
@@ -39,9 +39,7 @@
 #include "Store.h"
 #include "tools.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
 
 /* The list of event processes */
 
@@ -34,10 +34,6 @@
 #include "SwapDir.h"
 #include "tools.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-
 static void
 fatal_common(const char *message)
 {
@@ -42,15 +42,11 @@
 #include "tools.h"
 #include "UFSSwapLogParser.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cerrno>
+#include <cmath>
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 CBDATA_NAMESPACED_CLASS_INIT(Fs::Ufs,RebuildState);
 
@@ -52,15 +52,11 @@
 #include "tools.h"
 #include "UFSSwapDir.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cerrno>
+#include <cmath>
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 int Fs::Ufs::UFSSwapDir::NumberOfUFSDirs = 0;
 int *Fs::Ufs::UFSSwapDir::UFSDirToGlobalDirMapping = NULL;
@@ -30,8 +30,6 @@
 #ifndef SQUID_FS_UFS_UFSSWAPLOGPARSER_H
 #define SQUID_FS_UFS_UFSSWAPLOGPARSER_H
 
-#include <stdio.h>
-
 class StoreSwapLogData;
 
 namespace Fs
@@ -37,10 +37,6 @@
 #include "IoStats.h"
 #include "rfc2181.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-
 extern char *ConfigFile;	/* NULL */
 extern char *IcpOpcodeStr[];
 extern char tmp_error_buf[ERROR_BUF_SZ];
@@ -245,12 +245,13 @@ main(int argc, char *argv[])
     return 0;
 }
 
-#else
-#include <stdio.h>
+#else / * !USE_ICMP */
+
+#include <ostream>
 int
 main(int argc, char *argv[])
 {
-    fprintf(stderr, "%s: ICMP support not compiled in.\n", argv[0]);
+    std::cerr << argv[0] << ": ICMP support not compiled in." << std::endl;
     return 1;
 }
 
@@ -32,9 +32,7 @@
 
 #include "squid.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
 
 int
 isPowTen(int count)
@@ -11,12 +11,8 @@
 #include "ip/tools.h"
 #include "util.h"
 
-#if HAVE_ASSERT_H
-#include <assert.h>
-#endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+#include <cassert>
+#include <cstring>
 #if HAVE_ARPA_INET_H
 /* for inet_ntoa() */
 #include <arpa/inet.h>
@@ -6,6 +6,8 @@
 #ifndef _SQUID_SRC_IP_ADDRESS_H
 #define _SQUID_SRC_IP_ADDRESS_H
 
+#include <iosfwd>
+#include <ostream>
 #if HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
 #endif
@@ -22,13 +24,6 @@
 #include <netdb.h>
 #endif
 
-#if HAVE_IOSFWD
-#include <iosfwd>
-#endif
-#if HAVE_OSTREAM
-#include <ostream>
-#endif
-
 namespace Ip
 {
 
@@ -92,10 +92,8 @@
 #endif /* PF_TRANSPARENT required headers */
 
 #if LINUX_NETFILTER
-#if HAVE_LIMITS_H
-/* must be before including netfilter_ipv4.h */
-#include <limits.h>
-#endif
+/* <climits> must be before including netfilter_ipv4.h */
+#include <climits>
 #include <linux/if.h>
 #include <linux/netfilter_ipv4.h>
 #if HAVE_LINUX_NETFILTER_IPV6_IP6_TABLES_H
@@ -8,14 +8,10 @@
 #if HAVE_LIBNETFILTER_CONNTRACK_LIBNETFILTER_CONNTRACK_H
 #include <libnetfilter_conntrack/libnetfilter_conntrack.h>
 #endif
-
 #if HAVE_LIBNETFILTER_CONNTRACK_LIBNETFILTER_CONNTRACK_TCP_H
 #include <libnetfilter_conntrack/libnetfilter_conntrack_tcp.h>
 #endif
-
-#if HAVE_LIMITS
 #include <limits>
-#endif
 
 class fde;
 
@@ -1,13 +1,12 @@
 #define SQUID_UNIT_TEST 1
 #include "squid.h"
-//#include "compat/getaddrinfo.h"
 #include "ip/Address.h"
 #include "ip/tools.h"
 #include "testAddress.h"
 
-#if HAVE_CSTRING
 #include <cstring>
-#endif
+#include <stdexcept>
+#include <string>
 #if HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif
@@ -17,12 +16,6 @@
 #if HAVE_NETDB_H
 #include <netdb.h>
 #endif
-#if HAVE_STRING
-#include <string>
-#endif
-#if HAVE_STDEXCEPT
-#include <stdexcept>
-#endif
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testIpAddress );
 
@@ -7,10 +7,7 @@
 #include "globals.h"
 #include "ipc/Kid.h"
 
-#if HAVE_TIME_H
-#include <time.h>
-#endif
-
+#include <ctime>
 #if HAVE_SYS_WAIT_H
 #include <sys/wait.h>
 #endif
@@ -12,9 +12,7 @@
 #include "ip/forward.h"
 #include "ipc/FdNotes.h"
 
-#if HAVE_IOSFWD
 #include <iosfwd>
-#endif
 
 namespace Ipc
 {
@@ -8,7 +8,7 @@
 #include "ipc/TypedMsgHdr.h"
 #include "tools.h"
 
-#include <string.h>
+#include <cstring>
 
 Ipc::TypedMsgHdr::TypedMsgHdr()
 {
@@ -6,9 +6,7 @@
 #include "squid.h"
 #include "ipc/mem/Page.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 std::ostream &Ipc::Mem::operator <<(std::ostream &os, const PageId &page)
 {
@@ -1,12 +1,7 @@
-/*
- */
-
 #ifndef SQUID_IPC_MEM_PAGE_H
 #define SQUID_IPC_MEM_PAGE_H
 
-#if HAVE_IOSFWD
 #include <iosfwd>
-#endif
 
 namespace Ipc
 {
@@ -4,9 +4,7 @@
 #include "base/AsyncJob.h"
 #include "ip/Address.h"
 
-#if HAVE_LIST
 #include <list>
-#endif
 
 class MemBlob;
 typedef RefCount<MemBlob> MemBlobPointer;
@@ -51,12 +51,8 @@
 #include "Store.h"
 #include "StoreEntryStream.h"
 
-#if HAVE_IOMANIP
 #include <iomanip>
-#endif
-#if HAVE_OSTREAM
 #include <ostream>
-#endif
 
 /* forward declarations */
 static void memFree2K(void *);
@@ -635,9 +631,7 @@ Mem::PoolReport(const MemPoolStats * mp_st, const MemPoolMeter * AllMeter, std::
     MemPoolMeter *pm = mp_st->meter;
     const char *delim = "\t ";
 
-#if HAVE_IOMANIP
     stream.setf(std::ios_base::fixed);
-#endif
     stream << std::setw(20) << std::left << mp_st->label << delim;
     stream << std::setw(4) << std::right << mp_st->obj_size << delim;
 
@@ -40,9 +40,7 @@
 #include "SquidConfig.h"
 #include "Store.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
 
 #define ROTATE_LEFT(x, n) (((x) << (n)) | ((x) >> (32-(n))))
 
@@ -45,9 +45,7 @@
 #include "SquidConfig.h"
 #include "Store.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
 
 #define ROTATE_LEFT(x, n) (((x) << (n)) | ((x) >> (32-(n))))
 
@@ -31,15 +31,14 @@
  */
 #include "squid.h"
 
-#include <stdio.h>
+#include <csignal>
+#include <cstring>
 #include <fcntl.h>
-#include <string.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
 #include <netdb.h>
 #include <unistd.h>
-#include <signal.h>
 
 #define RECV_BUF_SIZE 8192
 
@@ -46,9 +46,7 @@
 #include "Store.h"
 #include "store_heap_replacement.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
 
 /*
  * Key generation function to implement the LFU-DA policy (Least
@@ -10,9 +10,8 @@
 #include "snmp/Var.h"
 #include "snmp_core.h"
 #include "tools.h"
-#if HAVE_ALGORITHM
+
 #include <algorithm>
-#endif
 
 Snmp::Pdu::Pdu()
 {
@@ -9,9 +9,8 @@
 #include "ipc/TypedMsgHdr.h"
 #include "snmp/Var.h"
 #include "tools.h"
-#if HAVE_ALGORITHM
+
 #include <algorithm>
-#endif
 
 Snmp::Var::Var()
 {
@@ -1,12 +1,9 @@
 #include "squid.h"
 #include "errorpage.h"
 #include "ssl/ErrorDetail.h"
-#if HAVE_MAP
-#include <map>
-#endif
-#if HAVE_CLIMITS
+
 #include <climits>
-#endif
+#include <map>
 
 struct SslErrorEntry {
     Ssl::ssl_error_t value;
@@ -6,12 +6,8 @@
 #include "SquidString.h"
 #include "ssl/support.h"
 
-#if HAVE_MAP
 #include <map>
-#endif
-#if HAVE_STRING
 #include <string>
-#endif
 
 class HttpRequest;
 
@@ -1,14 +1,9 @@
 #include "squid.h"
 #include "ssl/certificate_db.h"
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
-#if HAVE_FSTREAM
+
+#include <cerrno>
 #include <fstream>
-#endif
-#if HAVE_STDEXCEPT
 #include <stdexcept>
-#endif
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
@@ -2,12 +2,11 @@
 #define SQUID_SSL_CERTIFICATE_DB_H
 
 #include "ssl/gadgets.h"
-#if HAVE_STRING
-#include <string>
-#endif
+
 #if HAVE_OPENSSL_OPENSSLV_H
 #include <openssl/opensslv.h>
 #endif
+#include <string>
 
 namespace Ssl
 {
@@ -3,9 +3,8 @@
 #include "ssl/context_storage.h"
 #include "Store.h"
 #include "StoreEntryStream.h"
-#if HAVE_LIMITS
+
 #include <limits>
-#endif
 #if USE_SSL
 #include <openssl/ssl.h>
 #endif
@@ -10,12 +10,9 @@
 #include "mgr/Command.h"
 #include "SquidTime.h"
 #include "ssl/gadgets.h"
-#if HAVE_MAP
-#include <map>
-#endif
-#if HAVE_LIST
+
 #include <list>
-#endif
+#include <map>
 #include <openssl/ssl.h>
 
 /// TODO: Replace on real size.
@@ -1,15 +1,10 @@
 #include "squid.h"
 #include "ssl/crtd_message.h"
 #include "ssl/gadgets.h"
-#if HAVE_CSTDLIB
+
 #include <cstdlib>
-#endif
-#if HAVE_CSTRING
 #include <cstring>
-#endif
-#if HAVE_STDEXCEPT
 #include <stdexcept>
-#endif
 
 Ssl::CrtdMessage::CrtdMessage(MessageKind kind)
         :   body_size(0), state(kind == REPLY ? BEFORE_LENGTH: BEFORE_CODE)
@@ -1,12 +1,8 @@
 #ifndef SQUID_SSL_CRTD_MESSAGE_H
 #define SQUID_SSL_CRTD_MESSAGE_H
 
-#if HAVE_STRING
-#include <string>
-#endif
-#if HAVE_MAP
 #include <map>
-#endif
+#include <string>
 
 namespace Ssl
 {
@@ -14,9 +14,7 @@
 #if HAVE_OPENSSL_TXT_DB_H
 #include <openssl/txt_db.h>
 #endif
-#if HAVE_STRING
 #include <string>
-#endif
 
 namespace Ssl
 {
@@ -3,21 +3,11 @@
 #include "ssl/certificate_db.h"
 #include "ssl/crtd_message.h"
 
-#if HAVE_CSTRING
 #include <cstring>
-#endif
-#if HAVE_SSTREAM
-#include <sstream>
-#endif
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
-#if HAVE_STDEXCEPT
+#include <sstream>
 #include <stdexcept>
-#endif
-#if HAVE_STRING
 #include <string>
-#endif
 #if HAVE_GETOPT_H
 #include <getopt.h>
 #endif
@@ -69,10 +69,8 @@
 #if USE_DELAY_POOLS
 #include "DelayPools.h"
 #endif
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
 
+#include <climits>
 #include <stack>
 
 #define REBUILD_TIMESTAMP_DELTA_MAX 2
@@ -56,9 +56,7 @@
 #include "Store.h"
 #include "StoreSearch.h"
 
-#if HAVE_MATH_H
-#include <math.h>
-#endif
+#include <cmath>
 
 /*
  * local types
@@ -48,6 +48,8 @@
 #include "tools.h"
 #include "Transients.h"
 
+#include <cerrno>
+#include <climits>
 #if HAVE_STATVFS
 #if HAVE_SYS_STATVFS_H
 #include <sys/statvfs.h>
@@ -57,9 +59,6 @@
 #if HAVE_SYS_PARAM_H
 #include <sys/param.h>
 #endif
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
 #if HAVE_SYS_MOUNT_H
 #include <sys/mount.h>
 #endif
@@ -70,9 +69,6 @@
 #if HAVE_SYS_WAIT_H
 #include <sys/wait.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 
 static STDIRSELECT storeDirSelectSwapDirRoundRobin;
 static STDIRSELECT storeDirSelectSwapDirLeastLoad;
@@ -3,10 +3,8 @@
 
 #include "SBuf.h"
 
-#if HAVE_STRING
-#include <string>
-#endif
 #include <set>
+#include <string>
 
 /// Generates and executes a [configurable] large number of SBuf::*find()
 /// test cases using random strings. Reports detected failures.
@@ -5,7 +5,7 @@
 #define STUB_API "stub_HelperChildconfig.cc"
 #include "tests/STUB.h"
 
-#include <string.h>
+#include <cstring>
 
 HelperChildConfig::HelperChildConfig(const unsigned int m):
         n_max(m),
@@ -8,10 +8,6 @@
 #include "squid.h"
 #include "Debug.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-
 FILE *debug_log = NULL;
 int Debug::TheDepth = 0;
 
@@ -34,9 +34,8 @@
 #include "MemBuf.h"
 #include "store_rebuild.h"
 #include "SwapDir.h"
-#if HAVE_STRING_H
-#include <string.h>
-#endif
+
+#include <cstring>
 
 #define STUB_API "stub_store_rebuild.cc"
 #include "tests/STUB.h"
@@ -1,5 +1,4 @@
 #define SQUID_UNIT_TEST 1
-
 #include "squid.h"
 
 #if USE_AUTH
@@ -8,9 +7,7 @@
 #include "ConfigParser.h"
 #include "testACLMaxUserIP.h"
 
-#if HAVE_STDEXCEPT
 #include <stdexcept>
-#endif
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testACLMaxUserIP );
 
@@ -166,9 +166,7 @@ testAuthConfig::create()
     }
 }
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 /* AuthUserRequest::scheme returns the correct scheme for all
  * authentication types
@@ -1,11 +1,9 @@
 #define SQUID_UNIT_TEST 1
-
 #include "squid.h"
+
 #include "testBoilerplate.h"
 
-#if HAVE_STDEXCEPT
 #include <stdexcept>
-#endif
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testBoilerplate );
 
@@ -1,6 +1,6 @@
 #define SQUID_UNIT_TEST 1
-
 #include "squid.h"
+
 #include "DiskIO/DiskIOModule.h"
 #include "HttpHeader.h"
 #include "HttpReply.h"
@@ -12,9 +12,7 @@
 #include "testDiskIO.h"
 #include "testStoreSupport.h"
 
-#if HAVE_STDEXCEPT
 #include <stdexcept>
-#endif
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testDiskIO );
 
@@ -8,9 +8,7 @@
 #include "SquidConfig.h"
 #include "testHttpRequestMethod.h"
 
-#if HAVE_SSTREAM
 #include <sstream>
-#endif
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testHttpRequestMethod );
 
@@ -18,12 +18,10 @@
 #include "testRock.h"
 #include "testStoreSupport.h"
 
+#include <stdexcept>
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
-#if HAVE_STDEXCEPT
-#include <stdexcept>
-#endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -8,10 +8,7 @@
 #include "testStore.h"
 #include "testStoreEntryStream.h"
 
-#if HAVE_IOMANIP
 #include <iomanip>
-#endif
-
 #include <cppunit/TestAssert.h>
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testStoreEntryStream );
@@ -7,9 +7,7 @@
 #include "testURL.h"
 #include "URL.h"
 
-#if HAVE_SSTREAM
 #include <sstream>
-#endif
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testURL );
 
@@ -15,9 +15,7 @@
 #include "testStoreSupport.h"
 #include "testUfs.h"
 
-#if HAVE_STDEXCEPT
 #include <stdexcept>
-#endif
 
 #define TESTDIR "testUfs_Store"
 
@@ -9,9 +9,7 @@
 #include "SquidString.h"
 #include "tests/testUriScheme.h"
 
-#if HAVE_SSTREAM
 #include <sstream>
-#endif
 
 CPPUNIT_TEST_SUITE_REGISTRATION( testUriScheme );
 
@@ -55,12 +55,8 @@
 #include "DelayId.h"
 #endif
 
-#if HAVE_LIMITS_H
-#include <limits.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
+#include <climits>
+#include <cerrno>
 
 /**
  * TunnelStateData is the state engine performing the tasks for
@@ -41,15 +41,9 @@
 #undef malloc
 #undef free
 
-#if HAVE_STDEXCEPT
-#include <stdexcept>
-#endif
-#if HAVE_IOSTREAM
-#include <iostream>
-#endif
-#if HAVE_CASSERT
 #include <cassert>
-#endif
+#include <iostream>
+#include <stdexcept>
 
 /* stub functions for parts of squid not factored to be dynamic yet */
 void
@@ -36,9 +36,7 @@
 
 #include "MemPool.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 /* TODO: put this in a libTest */
 void
@@ -33,9 +33,7 @@
 
 #include "squid.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 class CallCounter
 {
@@ -35,9 +35,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_CTYPE_H
 #include <ctype.h>
 #endif
@@ -38,12 +38,8 @@
 #include "mem_node.h"
 #include "stmem.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
-#if HAVE_SSTREAM
 #include <sstream>
-#endif
 
 /*For  a reason required on some platforms */
 unsigned int TextException::FileNameHash(const char *fname)
@@ -34,9 +34,7 @@
 #include "squid.h"
 #include "mem_node.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 /* TODO: put this in a libTest */
 void
@@ -4,9 +4,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_CTYPE_H
 #include <ctype.h>
 #endif
@@ -4,9 +4,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_FCNTL_H
 #include <fcntl.h>
 #endif
@@ -5,12 +5,7 @@
 
 #include "squid.h"
 
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
+#include <cstdlib>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -35,9 +35,7 @@
 #include "mem_node.h"
 #include "stmem.h"
 
-#if HAVE_IOSTREAM
 #include <iostream>
-#endif
 
 class HasExplicit
 {
@@ -34,9 +34,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_FCNTL_H
 #include <fcntl.h>
 #endif
@@ -34,9 +34,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
 #if HAVE_FCNTL_H
 #include <fcntl.h>
 #endif
@@ -39,18 +39,14 @@
 #include "rfc1738.h"
 #include "util.h"
 
+#include <cctype>
+#include <cerrno>
+#include <csignal>
+#include <cstring>
+#include <ctime>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_STDIO_H
-#include <stdio.h>
-#endif
-#if HAVE_CTYPE_H
-#include <ctype.h>
-#endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 #if HAVE_FCNTL_H
 #include <fcntl.h>
 #endif
@@ -71,12 +67,6 @@
 #if HAVE_PWD_H
 #include <pwd.h>
 #endif
-#if HAVE_SIGNAL_H
-#include <signal.h>
-#endif
-#if HAVE_TIME_H
-#include <time.h>
-#endif
 #if HAVE_SYS_PARAM_H
 #include <sys/param.h>
 #endif
@@ -101,9 +91,6 @@
 #if HAVE_LIBC_H
 #include <libc.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_STRINGS_H
 #include <strings.h>
 #endif
@@ -35,13 +35,13 @@
 //
 //
 #include "conffile.hh"
+
+#include <cerrno>
+#include <cstdlib>
+#include <cstring>
+#include <fstream>
 #include <sys/types.h>
-#include <errno.h>
 #include <memory.h>
-#include <string.h>
-#include <stdlib.h>
-#include <stdio.h>
-#include <fstream>
 
 int
 readConfigFile( CacheDirVector& cachedir, const char* fn, FILE* debug )
@@ -52,7 +52,6 @@ typedef int bool;
 #define DEFAULT_SQUID_CONF "/usr/local/squid/etc/squid.conf"
 #endif
 
-#include <stdio.h>
 #include <vector>
 
 struct CacheDir {
@@ -42,12 +42,12 @@
 //
 
 #include "convert.hh"
-#include <string.h>
+
+#include <cstdlib>
+#include <cstring>
 #include <netinet/in.h>
 #include <arpa/inet.h>
 #include <netdb.h>
-#include <stdlib.h>
-#include <stdio.h>
 
 #ifndef SA
 #define SA struct sockaddr
@@ -38,13 +38,10 @@
 #include "squid.h"
 #include "copyout.hh"
 
-//#include <assert.h>
-//#include <sys/types.h>
 #include <sys/stat.h>
-#include <stdio.h>
-#include <string.h>
+#include <cerrno>
+#include <cstring>
 #include <fcntl.h>
-#include <errno.h>
 #include <unistd.h>
 #include <sys/mman.h>
 
@@ -93,18 +93,17 @@
 #include "squid.h"
 #include "util.h"
 
-#include <stdarg.h>
-#include <stdio.h>
+#include <cerrno>
+#include <climits>
+#include <csignal>
+#include <cstdarg>
+#include <cstdlib>
+#include <cstring>
 #include <dirent.h>
-#include <string.h>
 #include <sys/stat.h>
 #include <sys/wait.h>
 #include <fcntl.h>
 #include <unistd.h>
-#include <stdlib.h>
-#include <limits.h>
-#include <signal.h>
-#include <errno.h>
 
 #if HAVE_SIGINFO_H
 #include <siginfo.h>
@@ -44,14 +44,11 @@
 #include "squid.h"
 #include "signal.hh"
 
-//#include <sys/types.h>
-#include <errno.h>
-#include <string.h>
+#include <cerrno>
+#include <cstring>
 #include <memory.h>
-#include <stdio.h>
 #include <unistd.h>
 #include <sys/wait.h>
-//#include <signal.h>
 
 SigFunc*
 Signal( int signo, SigFunc* newhandler, bool doInterrupt )
@@ -50,9 +50,7 @@
 
 #include "squid.h"
 
-#if HAVE_SIGNAL_H
-#include <signal.h>
-#endif
+#include <csignal>
 
 #if !defined(__cplusplus)
 #ifndef HAVE_BOOL
@@ -43,13 +43,13 @@
 //
 //
 #include "socket.hh"
+
+#include <cerrno>
+#include <cstring>
 #include <netinet/tcp.h>
 #include <arpa/inet.h>
 #include <netdb.h>
 
-#include <errno.h>
-#include <stdio.h>
-#include <string.h>
 #include <unistd.h>
 
 #include "convert.hh"
@@ -33,7 +33,6 @@
 //
 //
 #include "squid.h"
-//#include <assert.h>
 #include "squid-tlv.hh"
 
 SquidTLV::SquidTLV( SquidMetaType _type, size_t _size, void* _data )
@@ -44,28 +44,22 @@ using namespace Squid;
 /** \endcond */
 #endif
 
+#include <cerrno>
 #include <csignal>
-#include <cstdio>
+#include <cstring>
 #include <iostream>
-
 #if _SQUID_WINDOWS_
 #include <io.h>
 #endif
 #if HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
 #endif
-#if HAVE_STRING_H
-#include <string.h>
-#endif
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 #if HAVE_NETDB_H
 #include <netdb.h>
 #endif
-#if HAVE_ERRNO_H
-#include <errno.h>
-#endif
 #if HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif