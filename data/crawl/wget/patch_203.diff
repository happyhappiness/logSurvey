diff --git a/ChangeLog b/ChangeLog
index 27e1d06..70894d4 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,7 @@
+2011-04-04  Giuseppe Scrivano  <gscrivano@gnu.org>
+
+	* configure.ac: Use AC_CHECK_LIB to look for the openssl library.
+
 2011-04-03  Giuseppe Scrivano  <gscrivano@gnu.org>
 
 	* bootstrap.conf (gnulib_modules): Add `fcntl'.
diff --git a/configure.ac b/configure.ac
index 205b653..e16f2cb 100644
--- a/configure.ac
+++ b/configure.ac
@@ -223,11 +223,12 @@ WGET_NSL_SOCKET
 dnl Deal with specific hosts
 case $host_os in
   *mingw32* )
-    AC_SUBST(W32LIBS, '-lws2_32 -lgdi32')
+    LIBS+='-lws2_32 -lgdi32'
     AC_LIBOBJ([mswindows])
     ;;
 esac
 
+
 dnl
 dnl Checks for libraries.
 dnl
@@ -241,29 +242,17 @@ AS_IF([test x"$with_ssl" = xopenssl], [
       AC_CHECK_LIB(dl, shl_load)
     ])
 
-    dnl Now actually check for -lssl
-    AC_LIB_HAVE_LINKFLAGS([ssl], [crypto], [
-  #include <openssl/ssl.h>
-  #include <openssl/x509.h>
-  #include <openssl/err.h>
-  #include <openssl/rand.h>
-  #include <openssl/des.h>
-  #include <openssl/md4.h>
-  #include <openssl/md5.h>
-    ], [SSL_library_init ()])
-    if test x"$LIBSSL" != x
-    then
-      AC_MSG_NOTICE([compiling in support for SSL via OpenSSL])
-      AC_LIBOBJ([openssl])
-    elif test x"$with_ssl" != x
-    then
-      AC_MSG_ERROR([--with-ssl=openssl was given, but SSL is not available.])
-    fi
+    AC_CHECK_LIB(z, compress)
+    AC_CHECK_LIB(crypto, EVP_MD_CTX_init)
+    AC_CHECK_LIB(ssl, ERR_func_error_string,,
+                AC_MSG_ERROR([openssl development libraries not found]))
+   AC_LIBOBJ([openssl])
 ], [
   # --with-ssl is not gnutls: check if it's no
   AS_IF([test x"$with_ssl" != xno], [
     dnl Now actually check for -lssl
 
+    AC_CHECK_LIB(z, compress)
     AC_CHECK_LIB(gpg-error, gpg_err_init)
     AC_CHECK_LIB(gcrypt, gcry_control)
     AC_CHECK_LIB(gnutls, main)
diff --git a/src/ChangeLog b/src/ChangeLog
index 4c0ff9c..5186f0c 100644
--- a/src/ChangeLog
+++ b/src/ChangeLog
@@ -1,3 +1,7 @@
+2011-04-04  Giuseppe Scrivano  <gscrivano@gnu.org>
+
+	* Makefile.am (LIBS): Remove  @LIBSSL@ @W32LIBS@
+
 2011-04-03  Giuseppe Scrivano  <gscrivano@gnu.org>
 
 	* gnutls.c: Include <fcntl.h>.
diff --git a/src/Makefile.am b/src/Makefile.am
index ba429b1..6a3e994 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -37,7 +37,7 @@ endif
 
 # The following line is losing on some versions of make!
 DEFS     = @DEFS@ -DSYSTEM_WGETRC=\"$(sysconfdir)/wgetrc\" -DLOCALEDIR=\"$(localedir)\"
-LIBS     = @LIBSSL@ @LIBICONV@ @LIBINTL@ @LIBS@ @W32LIBS@
+LIBS     = @LIBICONV@ @LIBINTL@ @LIBS@
 
 bin_PROGRAMS = wget
 wget_SOURCES = cmpt.c connect.c convert.c cookies.c ftp.c    		  \
diff --git a/tests/ChangeLog b/tests/ChangeLog
index 2345566..9c85316 100644
--- a/tests/ChangeLog
+++ b/tests/ChangeLog
@@ -1,3 +1,7 @@
+2011-04-04  Giuseppe Scrivano  <gscrivano@gnu.org>
+
+	* Makefile.am (LIBS): Remove  @LIBSSL@ @W32LIBS@
+
 2010-10-23  Giuseppe Scrivano  <gscrivano@gnu.org>
 
 	* Makefile.am (LIBS): Remove @LIBGNUTLS@ and use @W32LIBS@ as last
diff --git a/tests/Makefile.am b/tests/Makefile.am
index 2bd27f3..c27e390 100644
--- a/tests/Makefile.am
+++ b/tests/Makefile.am
@@ -34,7 +34,7 @@
 PERL     = perl
 PERLRUN = $(PERL) -I$(srcdir)
 
-LIBS     = @LIBSSL@ @LIBICONV@ @LIBINTL@ @LIBS@ @W32LIBS@
+LIBS     = @LIBICONV@ @LIBINTL@ @LIBS@
 
 .PHONY: test run-unit-tests run-px-tests
 
-- 
cgit v1.0-41-gc330

